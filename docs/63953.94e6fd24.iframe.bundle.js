"use strict";(self.webpackChunk_storiny_monorepo=self.webpackChunk_storiny_monorepo||[]).push([[63953],{"./packages/ui/src/components/masonry/masonry.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Masonry});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),masonry_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/ui/src/components/masonry/masonry.module.scss"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(masonry_module.A,options);const masonry_masonry_module=masonry_module.A&&masonry_module.A.locals?masonry_module.A.locals:void 0,layout_number_to_css=num=>num!==1/0?num:void 0,MeasureItems=({base_index,get_positions,items,measurement_store,render_item,...rest})=>{const measuring_positions=get_positions(items),refs=react.useMemo((()=>new Map),[]),refs_size=refs.size;return react.useLayoutEffect((()=>{if(refs_size===items.length){const heights=new Map;refs.forEach(((element,data)=>{heights.set(data,element.clientHeight)})),heights.forEach(((height,data)=>{measurement_store.set(data,height)})),refs.clear()}}),[items.length,measurement_store,refs,refs_size]),(0,jsx_runtime.jsx)(react.Fragment,{children:items.map(((data,index)=>{const measurement_index=base_index+index,position=measuring_positions[index];return(0,react.createElement)("div",{...rest,key:`measuring-${measurement_index}`,ref:element=>{element&&refs.set(data,element)},style:{...null==rest?void 0:rest.style,visibility:"hidden",position:"absolute",top:layout_number_to_css(position.top),left:layout_number_to_css(position.left),width:layout_number_to_css(position.width),height:layout_number_to_css(position.height)}},render_item({data,item_index:measurement_index,is_measuring:!0}))}))})},measure_items=MeasureItems;MeasureItems.__docgenInfo={description:"",methods:[],displayName:"MeasureItems",props:{base_index:{required:!0,tsType:{name:"number"},description:"Relative measurement index\n@internal"},get_positions:{required:!0,tsType:{name:"signature",type:"function",raw:"(items: T[]) => Position[]",signature:{arguments:[{type:{name:"Array",elements:[{name:"T"}],raw:"T[]"},name:"items"}],return:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  height: number;\n  left: number;\n  top: number;\n  width: number;\n}",signature:{properties:[{key:"height",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"top",value:{name:"number",required:!0}},{key:"width",value:{name:"number",required:!0}}]}}],raw:"Position[]"}}},description:"Function to compute positions of items\n@param items Items"},items:{required:!0,tsType:{name:"Array",elements:[{name:"T"}],raw:"T[]"},description:"Items to render"},measurement_store:{required:!0,tsType:{name:"Cache",elements:[{name:"T"},{name:"number"}],raw:"Cache<T, number>"},description:"Store holding item's measurements"},render_item:{required:!0,tsType:{name:"signature",type:"function",raw:"(args: RenderItemArgs<T>) => React.ReactElement",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n  /**\n   * Item data\n   */\n  data: T;\n  /**\n   * Boolean parameter indicating whether the item is currently being measured\n   */\n  is_measuring: boolean;\n  /**\n   * Item index\n   */\n  item_index: number;\n}",signature:{properties:[{key:"data",value:{name:"T",required:!0},description:"Item data"},{key:"is_measuring",value:{name:"boolean",required:!0},description:"Boolean parameter indicating whether the item is currently being measured"},{key:"item_index",value:{name:"number",required:!0},description:"Item index"}]}},name:"args"}],return:{name:"ReactReactElement",raw:"React.ReactElement"}}},description:"Function to render individual items"}}};const get_scroll_container=scroll_container=>"function"==typeof scroll_container?scroll_container():scroll_container;class Scroller extends react.Component{componentDidMount(){const scroll_container=get_scroll_container(this.props.scroll_container);scroll_container&&this.update_scroll_container(scroll_container)}componentDidUpdate(){const next_scroll_container=get_scroll_container(this.props.scroll_container);next_scroll_container&&next_scroll_container!==this.scroll_container&&this.update_scroll_container(next_scroll_container)}componentWillUnmount(){this.scroll_container&&this.scroll_container.removeEventListener("scroll",this.handle_scroll)}update_scroll_container(scroll_container){this.scroll_container&&this.scroll_container.removeEventListener("scroll",this.handle_scroll),this.scroll_container=scroll_container,this.scroll_container.addEventListener("scroll",this.handle_scroll)}render(){return react.Children.only(this.props.children)}constructor(...args){super(...args),this.get_scroll_container_ref=()=>this.scroll_container,this.handle_scroll=event=>{this.props.on_scroll(event)}}}Scroller.__docgenInfo={description:"",methods:[{name:"get_scroll_container_ref",docblock:"Getter for scroll container",modifiers:[],params:[],returns:null,description:"Getter for scroll container"}],displayName:"Scroller",props:{children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"Scroller content"},on_scroll:{required:!0,tsType:{name:"signature",type:"function",raw:"(event: Event) => void",signature:{arguments:[{type:{name:"Event"},name:"event"}],return:{name:"void"}}},description:"Scroll event handler\n@param event Scroll event"},scroll_container:{required:!0,tsType:{name:"union",raw:"| (HTMLElement | null | undefined)\n| (() => HTMLElement | null | undefined)",elements:[{name:"unknown"},{name:"unknown"}]},description:"Function to render a scroll container"}}};class MeasurementStore{get(key){return this.map.get(key)}has(key){return this.map.has(key)}set(key,value){this.map.set(key,value)}reset(){this.map=new WeakMap}constructor(){this.map=new WeakMap}}class HeightStore{get_heights(){return this.heights}set_heights(next_heights){this.heights=next_heights}reset(){this.heights=[]}constructor(){this.heights=[]}}const get_window_scroll_pos=()=>void 0!==window.scrollY?window.scrollY:document.documentElement&&void 0!==document.documentElement.scrollTop?document.documentElement.scrollTop:0,get_scroll_pos=element=>element===window?get_window_scroll_pos():element.scrollTop,debounce=(fn,threshhold=100)=>{let defer_timer=null;const debounced=(...args)=>{defer_timer&&clearTimeout(defer_timer),defer_timer=setTimeout((()=>{defer_timer=null,fn(...args)}),threshhold)};return debounced.clearTimeout=()=>{defer_timer&&clearTimeout(defer_timer)},debounced};class Masonry extends react.Component{static getDerivedStateFromProps(props,state){const{items}=props,{measurement_store}=state,has_pending_measurements=items.some((item=>!measurement_store.has(item)));for(let i=0;i<items.length;i+=1){if(void 0===state.items[i])return{has_pending_measurements,items,is_fetching:!1};if(items[i]!==state.items[i]||items.length<state.items.length)return{has_pending_measurements,items,is_fetching:!1}}return 0===items.length&&state.items.length>0?{has_pending_measurements,items,is_fetching:!1}:has_pending_measurements!==state.has_pending_measurements?{has_pending_measurements,items}:null}componentDidMount(){window.addEventListener("resize",this.handle_resize),this.measure_container();let{scrollTop}=this.state;if(null!=this.scroll_container){const scroll_container=this.scroll_container.get_scroll_container_ref();scroll_container&&(scrollTop=get_scroll_pos(scroll_container))}this.setState((prev_state=>({scrollTop,width:this.grid_wrapper?this.grid_wrapper.clientWidth:prev_state.width})))}componentDidUpdate(_,prev_state){const{items}=this.props,{measurement_store}=this.state;this.measure_container_async(),null!=prev_state.width&&this.state.width!==prev_state.width&&(measurement_store.reset(),this.position_store.reset(),this.height_store.reset());const has_pending_measurements=items.some((item=>!!item&&!measurement_store.has(item)));(has_pending_measurements||has_pending_measurements!==this.state.has_pending_measurements||null==prev_state.width)&&(this.insert_animation_frame=requestAnimationFrame((()=>{this.setState({has_pending_measurements})})))}componentWillUnmount(){this.insert_animation_frame&&cancelAnimationFrame(this.insert_animation_frame),this.measure_container_async.clearTimeout(),this.handle_resize.clearTimeout(),this.update_scroll_position.clearTimeout(),window.removeEventListener("resize",this.handle_resize)}measure_container(){if(this.scroll_container){const{scroll_container}=this,scroll_container_ref=null==scroll_container?void 0:scroll_container.get_scroll_container_ref();if(scroll_container_ref){this.container_height=(element=>element===window?window.innerHeight:element.clientHeight)(scroll_container_ref);const element=this.grid_wrapper;if(element instanceof HTMLElement){const relative_scroll_top=(element=>element===window?get_window_scroll_pos():element.scrollTop-element.getBoundingClientRect().top)(scroll_container_ref);this.container_offset=element.getBoundingClientRect().top+relative_scroll_top}}}}reflow(){this.state.measurement_store.reset(),this.position_store.reset(),this.height_store.reset(),this.measure_container(),this.forceUpdate()}render(){const{column_width,gutter_width:gutter,items,min_cols,render_item,get_item_key,scroll_container,slot_props}=this.props,{has_pending_measurements,measurement_store,width}=this.state,get_positions=(({gutter=0,cache,min_cols=2,ideal_column_width=240,width})=>{if(null==width)return items=>items.map((()=>({top:1/0,left:1/0,width:1/0,height:1/0})));const col_guess=Math.floor(width/ideal_column_width),col_count=Math.max(Math.floor((width-col_guess*gutter)/ideal_column_width),min_cols),col_width=Math.floor(width/col_count);return items=>{const heights=new Array(col_count).fill(0);return items.reduce(((acc,item)=>{const positions=acc,height=cache.get(item);let position;if(null==height)position={top:1/0,left:1/0,width:col_width,height:1/0};else{const col=(arr=>{let curr_index=0;for(let i=0;i<arr.length;i+=1)arr[i]<arr[curr_index]&&(curr_index=i);return curr_index})(heights),top=heights[col],left=col*col_width+gutter/2;heights[col]+=height,position={top,left,width:col_width-gutter,height}}return positions.push(position),positions}),[])}})({gutter,cache:measurement_store,min_cols,ideal_column_width:column_width,width});let grid_body;var _slot_props_container,_slot_props_container1;if(null===width&&has_pending_measurements)grid_body=(0,jsx_runtime.jsx)("div",{...null==slot_props?void 0:slot_props.container,className:(0,clsx_m.A)(masonry_masonry_module.masonry,null==slot_props||null===(_slot_props_container=slot_props.container)||void 0===_slot_props_container?void 0:_slot_props_container.className),ref:this.set_grid_wrapper_ref,role:"list",style:{...null==slot_props||null===(_slot_props_container1=slot_props.container)||void 0===_slot_props_container1?void 0:_slot_props_container1.style,height:0,width:"100%"},children:items.filter(Boolean).map(((item,i)=>{var _slot_props_item;return(0,react.createElement)("div",{...null==slot_props?void 0:slot_props.item,"data-grid-item":"",key:get_item_key?get_item_key(item):i,ref:element=>{element&&measurement_store.set(item,element.clientHeight)},role:"listitem",style:{...null==slot_props||null===(_slot_props_item=slot_props.item)||void 0===_slot_props_item?void 0:_slot_props_item.style,top:0,left:0,transform:"translateX(0px) translateY(0px)",WebkitTransform:"translateX(0px) translateY(0px)"}},render_item({data:item,item_index:i,is_measuring:!1}))}))});else if(null===width)grid_body=(0,jsx_runtime.jsx)("div",{ref:this.set_grid_wrapper_ref,style:{width:"100%"}});else{var _slot_props_container2,_slot_props_container3,_slot_props_container4,_slot_props_container5;const items_with_measurements=items.filter((item=>item&&measurement_store.has(item))),items_to_render=items_with_measurements,items_to_measure=items.filter((item=>item&&!measurement_store.has(item))).slice(0,min_cols),positions=get_positions(items_with_measurements),height=positions.length?Math.max(...positions.map((pos=>pos.top+pos.height))):0;grid_body=(0,jsx_runtime.jsxs)("div",{ref:this.set_grid_wrapper_ref,style:{width:"100%"},children:[(0,jsx_runtime.jsx)("div",{...null==slot_props?void 0:slot_props.container,className:(0,clsx_m.A)(masonry_masonry_module.masonry,null==slot_props||null===(_slot_props_container2=slot_props.container)||void 0===_slot_props_container2?void 0:_slot_props_container2.className),role:"list",style:{...null==slot_props||null===(_slot_props_container3=slot_props.container)||void 0===_slot_props_container3?void 0:_slot_props_container3.style,height,width},children:items_to_render.map(((item,i)=>this.render_masonry_component(item,i,positions[i])))}),(0,jsx_runtime.jsx)("div",{...null==slot_props?void 0:slot_props.container,className:(0,clsx_m.A)(masonry_masonry_module.masonry,null==slot_props||null===(_slot_props_container4=slot_props.container)||void 0===_slot_props_container4?void 0:_slot_props_container4.className),style:{...null==slot_props||null===(_slot_props_container5=slot_props.container)||void 0===_slot_props_container5?void 0:_slot_props_container5.style,width},children:(0,jsx_runtime.jsx)(measure_items,{...null==slot_props?void 0:slot_props.item,base_index:items_with_measurements.length,get_positions,items:items_to_measure,measurement_store,render_item})})]})}return scroll_container?(0,jsx_runtime.jsx)(Scroller,{on_scroll:this.update_scroll_position,ref:this.set_scroll_container_ref,scroll_container,children:grid_body}):grid_body}constructor(props){super(props),this.render_masonry_component=(item_data,index,position)=>{var _slot_props_item,_slot_props_item1;const{render_item,scroll_container,overscan_factor,get_item_key,slot_props}=this.props,{top,left,width,height}=position;let is_visible;if(scroll_container&&overscan_factor){const virtual_buffer=this.container_height*overscan_factor,offset_scroll_pos=this.state.scrollTop-this.container_offset,viewport_top=offset_scroll_pos-virtual_buffer,viewport_bottom=offset_scroll_pos+this.container_height+virtual_buffer;is_visible=!(position.top+position.height<viewport_top||position.top>viewport_bottom)}else is_visible=!0;return is_visible?(0,react.createElement)("div",{...null==slot_props?void 0:slot_props.item,className:(0,clsx_m.A)(masonry_masonry_module.item,masonry_masonry_module.mounted,null==slot_props||null===(_slot_props_item=slot_props.item)||void 0===_slot_props_item?void 0:_slot_props_item.className),"data-grid-item":"",key:get_item_key?get_item_key(item_data):`item-${index}`,role:"listitem",style:{...null==slot_props||null===(_slot_props_item1=slot_props.item)||void 0===_slot_props_item1?void 0:_slot_props_item1.style,top:0,left:0,transform:`translateX(${left}px) translateY(${top}px)`,WebkitTransform:`translateX(${left}px) translateY(${top}px)`,width:layout_number_to_css(width),height:layout_number_to_css(height)}},render_item({data:item_data,item_index:index,is_measuring:!1})):null},this.handle_resize=debounce((()=>{this.grid_wrapper&&this.setState({width:this.grid_wrapper.clientWidth})}),300),this.update_scroll_position=((fn,threshhold=100)=>{let last,defer_timer;const throttled=(...args)=>{const now=Date.now();void 0!==last&&now-last<threshhold?(clearTimeout(defer_timer),defer_timer=setTimeout((()=>{last=now,fn(...args)}),threshhold-(now-(null!=last?last:0)))):(last=now,fn(...args))};return throttled.clearTimeout=()=>{defer_timer&&clearTimeout(defer_timer)},throttled})((()=>{if(!this.scroll_container)return;const scroll_container=this.scroll_container.get_scroll_container_ref();scroll_container&&this.setState({scrollTop:get_scroll_pos(scroll_container)})})),this.measure_container_async=debounce((()=>{this.measure_container()}),0),this.set_grid_wrapper_ref=ref=>{this.grid_wrapper=ref},this.set_scroll_container_ref=ref=>{this.scroll_container=ref};const measurement_store=new MeasurementStore;this.container_height=0,this.container_offset=0,this.position_store=new MeasurementStore,this.height_store=new HeightStore,this.state={has_pending_measurements:props.items.some((item=>!!item&&!measurement_store.has(item))),is_fetching:!1,items:props.items,measurement_store,scrollTop:0,width:void 0}}}Masonry.defaultProps={overscan_factor:1,min_cols:3,column_width:228},Masonry.__docgenInfo={description:"",methods:[{name:"reflow",docblock:"Clears measurements/positions and forces a reflow of the entire grid.\n\nUsed only if absolutely necessary, such as when the number of columns\nwe would display should change after a resize.",modifiers:[],params:[],returns:{type:{name:"void"}},description:"Clears measurements/positions and forces a reflow of the entire grid.\n\nUsed only if absolutely necessary, such as when the number of columns\nwe would display should change after a resize."}],displayName:"Masonry",props:{column_width:{required:!1,tsType:{name:"number"},description:'The preferred/target item width in pixels. If `layout="flexible"` is set, the item width will\ngrow to fill column space, and shrink to fit if below the minimum number of columns\n@default 228',defaultValue:{value:"228",computed:!1}},get_item_key:{required:!1,tsType:{name:"signature",type:"function",raw:"(data: T) => string",signature:{arguments:[{type:{name:"T"},name:"data"}],return:{name:"string"}}},description:"Function for generating unique keys for items\n@param data Items"},gutter_width:{required:!1,tsType:{name:"number"},description:"The amount of vertical and horizontal space between each item, specified\nin pixels"},items:{required:!0,tsType:{name:"Array",elements:[{name:"T"}],raw:"T[]"},description:"Array of items to display that contains the data to be rendered by\n`renderItem`"},min_cols:{required:!1,tsType:{name:"number"},description:"Minimum number of columns to display, regardless of the container width\n@default 3",defaultValue:{value:"3",computed:!1}},overscan_factor:{required:!1,tsType:{name:"number"},description:"Overscan buffer size, specified as a multiplier of the container height. It specifies the amount of extra buffer space for populating visible items\n@default 1",defaultValue:{value:"1",computed:!1}},render_item:{required:!0,tsType:{name:"signature",type:"function",raw:"(args: RenderItemArgs<T>) => React.ReactElement",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n  /**\n   * Item data\n   */\n  data: T;\n  /**\n   * Boolean parameter indicating whether the item is currently being measured\n   */\n  is_measuring: boolean;\n  /**\n   * Item index\n   */\n  item_index: number;\n}",signature:{properties:[{key:"data",value:{name:"T",required:!0},description:"Item data"},{key:"is_measuring",value:{name:"boolean",required:!0},description:"Boolean parameter indicating whether the item is currently being measured"},{key:"item_index",value:{name:"number",required:!0},description:"Item index"}]}},name:"args"}],return:{name:"ReactReactElement",raw:"React.ReactElement"}}},description:"Function to render item in the grid\nIf present, `heightAdjustment` indicates the number of pixels this item\nneeds to grow/shrink to accommodate a 2-column item in the grid. Items\nmust respond to this prop by adjusting their height or layout issues will\noccur."},scroll_container:{required:!1,tsType:{name:"signature",type:"function",raw:"() => HTMLElement",signature:{arguments:[],return:{name:"HTMLElement"}}},description:"Function that returns a DOM node that masonry uses for scroll event\nsubscription"},slot_props:{required:!1,tsType:{name:"signature",type:"object",raw:'{\n  container?: React.ComponentPropsWithoutRef<"div">;\n  item?: React.ComponentPropsWithoutRef<"div">;\n}',signature:{properties:[{key:"container",value:{name:"ReactComponentPropsWithoutRef",raw:'React.ComponentPropsWithoutRef<"div">',elements:[{name:"literal",value:'"div"'}],required:!1}},{key:"item",value:{name:"ReactComponentPropsWithoutRef",raw:'React.ComponentPropsWithoutRef<"div">',elements:[{name:"literal",value:'"div"'}],required:!1}}]}},description:"The props passed to the individual component elements."}}}},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/ui/src/components/masonry/masonry.module.scss":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".j8hIgbxraQ0mLJBB9rG9{position:relative;height:100%;margin:0 auto}.pdC6FM6S1ub4KatJcwYi{position:absolute}.UmQWMLtaUk6t_nPrvcXJ{transition:transform 150ms}","",{version:3,sources:["webpack://./packages/ui/src/components/masonry/masonry.module.scss"],names:[],mappings:"AAAA,sBACE,iBAAA,CACA,WAAA,CACA,aAAA,CAGF,sBACE,iBAAA,CAGF,sBACE,0BAAA",sourcesContent:[".masonry {\n  position: relative;\n  height: 100%;\n  margin: 0 auto;\n}\n\n.item {\n  position: absolute;\n}\n\n.mounted {\n  transition: transform 150ms;\n}\n"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={masonry:"j8hIgbxraQ0mLJBB9rG9",item:"pdC6FM6S1ub4KatJcwYi",mounted:"UmQWMLtaUk6t_nPrvcXJ"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);