"use strict";(self.webpackChunk_storiny_monorepo=self.webpackChunk_storiny_monorepo||[]).push([[52300],{"./packages/editor/src/components/layout/left-sidebar/content/editable/toc/toc.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>toc_toc});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js"),react=__webpack_require__("./node_modules/jotai/esm/react.mjs"),compiled_react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),scroll_area=__webpack_require__("./packages/ui/src/components/scroll-area/scroll-area.tsx"),spacer=__webpack_require__("./packages/ui/src/components/spacer/spacer.tsx"),typography=__webpack_require__("./packages/ui/src/components/typography/typography.tsx"),main_module=__webpack_require__("./packages/ui/src/theme/main.module.scss"),story_metadata=__webpack_require__("./packages/editor/src/atoms/story-metadata/index.ts"),LexicalComposerContext_prod=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),LexicalUtils_prod=__webpack_require__("./node_modules/@lexical/utils/LexicalUtils.prod.mjs"),Lexical_prod=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),heading=__webpack_require__("./packages/editor/src/nodes/heading/heading.ts"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),toc_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/editor/src/plugins/toc/toc.module.scss"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(toc_module.A,options);const toc_toc_module=toc_module.A&&toc_module.A.locals?toc_module.A.locals:void 0,to_entry=heading=>[heading.getKey(),heading.getTextContent(),heading.get_tag()],$insert_heading_into_table_of_contents=(prev_heading,pext_heading,current_table_of_contents)=>{if(null===pext_heading)return current_table_of_contents;const next_entry=to_entry(pext_heading);let next_table_of_contents=[];if(null===prev_heading)next_table_of_contents=[next_entry,...current_table_of_contents];else for(let i=0;i<current_table_of_contents.length;i++){const key=current_table_of_contents[i][0];next_table_of_contents.push(current_table_of_contents[i]),key===prev_heading.getKey()&&key!==pext_heading.getKey()&&next_table_of_contents.push(next_entry)}return next_table_of_contents},$delete_heading_from_table_of_contents=(key,current_table_of_contents)=>{const next_table_of_contents=[];for(const heading of current_table_of_contents)heading[0]!==key&&next_table_of_contents.push(heading);return next_table_of_contents},$update_heading_in_table_of_contents=(heading,current_table_of_contents)=>{const next_table_of_contents=[];for(const old_heading of current_table_of_contents)old_heading[0]===heading.getKey()?next_table_of_contents.push(to_entry(heading)):next_table_of_contents.push(old_heading);return next_table_of_contents},$update_heading_position=(prev_heading,heading,current_table_of_contents)=>{const next_table_of_contents=[],next_entry=to_entry(heading);prev_heading||next_table_of_contents.push(next_entry);for(const old_heading of current_table_of_contents)old_heading[0]!==heading.getKey()&&(next_table_of_contents.push(old_heading),prev_heading&&old_heading[0]===prev_heading.getKey()&&next_table_of_contents.push(next_entry));return next_table_of_contents},TableOfContentsPlugin=()=>{const[editor]=(0,LexicalComposerContext_prod.DF)(),[table_of_contents,set_table_of_contents]=compiled_react.useState([]),[selected_key,set_selected_key]=compiled_react.useState("");((table_of_contents,set_active_heading)=>{const[editor]=(0,LexicalComposerContext_prod.DF)(),heading_elements_ref=compiled_react.useRef({});compiled_react.useEffect((()=>{const observer=new IntersectionObserver((headings=>{heading_elements_ref.current=headings.reduce(((map,heading_element)=>(map[heading_element.target.getAttribute("data-key")||""]=heading_element,map)),heading_elements_ref.current);const visible_headings=[];Object.keys(heading_elements_ref.current).forEach((key=>{const heading_element=heading_elements_ref.current[key];heading_element.isIntersecting&&visible_headings.push(heading_element)}));const get_index_from_key=key=>table_of_contents.findIndex((heading=>heading[0]===key));if(1===visible_headings.length)set_active_heading(visible_headings[0].target.getAttribute("data-key")||"");else if(visible_headings.length>1){const sorted_visible_headings=visible_headings.sort(((a,b)=>get_index_from_key(a.target.getAttribute("data-key")||"")>get_index_from_key(b.target.getAttribute("data-key")||"")?-1:0));set_active_heading(sorted_visible_headings[0].target.getAttribute("data-key")||"")}}),{rootMargin:"-52px 0px 0px 0px"});for(const[heading_key]of table_of_contents){const element=editor.getElementByKey(heading_key);element&&(element.setAttribute("data-key",heading_key),observer.observe(element))}return()=>{heading_elements_ref.current={},observer.disconnect()}}),[editor,set_active_heading,table_of_contents])})(table_of_contents,set_selected_key);return compiled_react.useEffect((()=>{let current_table_of_contents=[];return editor.getEditorState().read((()=>{for(const child of(0,Lexical_prod.Ni)().getChildren().filter(heading.T_))current_table_of_contents.push([child.getKey(),child.getTextContent(),child.get_tag()]);set_table_of_contents(current_table_of_contents)})),(0,LexicalUtils_prod.Sd)(editor.registerMutationListener(heading.jL,(mutated_nodes=>{editor.getEditorState().read((()=>{for(const[node_key,mutation]of mutated_nodes)if("created"===mutation){const pext_heading=(0,Lexical_prod.ns)(node_key);if(null!==pext_heading){let prev_heading=pext_heading.getPreviousSibling();for(;null!==prev_heading&&!(0,heading.T_)(prev_heading);)prev_heading=prev_heading.getPreviousSibling();current_table_of_contents=$insert_heading_into_table_of_contents(prev_heading,pext_heading,current_table_of_contents)}}else if("destroyed"===mutation)current_table_of_contents=$delete_heading_from_table_of_contents(node_key,current_table_of_contents);else if("updated"===mutation){const pext_heading=(0,Lexical_prod.ns)(node_key);if(null!==pext_heading){let prev_heading=pext_heading.getPreviousSibling();for(;null!==prev_heading&&!(0,heading.T_)(prev_heading);)prev_heading=prev_heading.getPreviousSibling();current_table_of_contents=$update_heading_position(prev_heading,pext_heading,current_table_of_contents)}}set_table_of_contents(current_table_of_contents)}))})),editor.registerMutationListener(Lexical_prod.Ey,(mutated_nodes=>{editor.getEditorState().read((()=>{for(const[node_key,mutation]of mutated_nodes)if("updated"===mutation){const curr_node=(0,Lexical_prod.ns)(node_key);if(null!==curr_node){const parent_node=curr_node.getParentOrThrow();(0,heading.T_)(parent_node)&&(current_table_of_contents=$update_heading_in_table_of_contents(parent_node,current_table_of_contents),set_table_of_contents(current_table_of_contents))}}}))})))}),[editor]),table_of_contents.length?(0,jsx_runtime.jsx)("ul",{className:toc_toc_module.toc,children:table_of_contents.map((([key,text,tag])=>(0,jsx_runtime.jsx)(typography.A,{as:"li",className:(0,clsx_m.$)(main_module.A.focusable,main_module.A[text.trim()?"t-minor":"t-muted"],toc_toc_module.x,toc_toc_module.item,"h3"===tag&&toc_toc_module.sub,!text.trim()&&toc_toc_module.empty,selected_key===key&&toc_toc_module.selected),ellipsis:!0,level:"body2",onClick:()=>(key=>{editor.getEditorState().read((()=>{const dom_element=editor.getElementByKey(key);dom_element&&dom_element.scrollIntoView({behavior:"smooth"})}))})(key),role:"button",tabIndex:0,title:text,children:text.trim()||"Empty "+("h3"===tag?"subheading":"heading")},key)))}):(0,jsx_runtime.jsx)(typography.A,{className:main_module.A["t-center"],color:"muted",level:"body2",style:{display:"table-cell",verticalAlign:"middle"},children:"Empty"})},toc=TableOfContentsPlugin;TableOfContentsPlugin.__docgenInfo={description:"",methods:[],displayName:"TableOfContentsPlugin"};var editable_toc_toc_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/editor/src/components/layout/left-sidebar/content/editable/toc/toc.module.scss"),toc_module_options={};toc_module_options.styleTagTransform=styleTagTransform_default(),toc_module_options.setAttributes=setAttributesWithoutAttributes_default(),toc_module_options.insert=insertBySelector_default().bind(null,"head"),toc_module_options.domAPI=styleDomAPI_default(),toc_module_options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(editable_toc_toc_module.A,toc_module_options);const content_editable_toc_toc_module=editable_toc_toc_module.A&&editable_toc_toc_module.A.locals?editable_toc_toc_module.A.locals:void 0,EditorToc=({read_only})=>{const story=(0,react.md)(story_metadata._);return(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.$)(main_module.A["flex-col"],read_only&&main_module.A["full-h"]),children:[(0,jsx_runtime.jsxs)("div",{className:main_module.A["flex-center"],children:[(0,jsx_runtime.jsx)(typography.A,{color:"minor",level:"body2",weight:"medium",children:"Table of contents"}),(0,jsx_runtime.jsx)(spacer.A,{className:main_module.A["f-grow"]})]}),(0,jsx_runtime.jsx)(spacer.A,{orientation:"vertical",size:2}),(0,jsx_runtime.jsx)(scroll_area.Ay,{className:(0,clsx_m.$)(read_only&&main_module.A["full-h"],content_editable_toc_toc_module.x,content_editable_toc_toc_module["scroll-area"]),slot_props:{viewport:{className:(0,clsx_m.$)(main_module.A["flex-center"],content_editable_toc_toc_module.x,content_editable_toc_toc_module.viewport,read_only&&content_editable_toc_toc_module["read-only"]),"data-testid":"toc"},scrollbar:{style:{backgroundColor:"transparent"}}},type:"auto",children:story.disable_toc?(0,jsx_runtime.jsx)(typography.A,{className:main_module.A["t-center"],color:"muted",level:"body2",style:{display:"table-cell",verticalAlign:"middle"},children:"Disabled"}):(0,jsx_runtime.jsx)(toc,{})})]})},toc_toc=EditorToc;EditorToc.__docgenInfo={description:"",methods:[],displayName:"EditorToc",props:{read_only:{required:!1,tsType:{name:"boolean"},description:""}}}},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/editor/src/components/layout/left-sidebar/content/editable/toc/toc.module.scss":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".xXwdIF6Ps3P4lFqOJ2sq.jmVeGCYl6lRBjWBB0Q_9{max-height:300px;min-height:180px}.xXwdIF6Ps3P4lFqOJ2sq.vtiv2XKKu3YiZMAUE_UJ{display:flex;align-items:stretch;border:1px solid var(--divider);border-radius:var(--radius-md)}","",{version:3,sources:["webpack://./packages/editor/src/components/layout/left-sidebar/content/editable/toc/toc.module.scss"],names:[],mappings:"AACE,2CACE,gBAAA,CACA,gBAAA,CAGF,2CACE,YAAA,CACA,mBAAA,CACA,+BAAA,CACA,8BAAA",sourcesContent:[".x {\n  &.scroll-area {\n    max-height: 300px;\n    min-height: 180px;\n  }\n\n  &.viewport {\n    display: flex;\n    align-items: stretch;\n    border: 1px solid var(--divider);\n    border-radius: var(--radius-md);\n  }\n}\n"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={x:"xXwdIF6Ps3P4lFqOJ2sq","scroll-area":"jmVeGCYl6lRBjWBB0Q_9",viewport:"vtiv2XKKu3YiZMAUE_UJ"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/editor/src/plugins/toc/toc.module.scss":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".YGFFZ5_kmmEA0ZdfRQ8c{list-style:none;padding:12px 32px 12px 0}.KRPzVaZp4HxDnBTYQ8cl.qgKsU6YVzLu4DJsXRhm9{padding:4px 16px;cursor:pointer;border-left:1px solid var(--border, transparent);width:100% !important}.KRPzVaZp4HxDnBTYQ8cl.qgKsU6YVzLu4DJsXRhm9:not(.VfNtf0bk00wKMFwuIu3A)+.VfNtf0bk00wKMFwuIu3A{margin-top:8px}.KRPzVaZp4HxDnBTYQ8cl.qgKsU6YVzLu4DJsXRhm9.VfNtf0bk00wKMFwuIu3A{--border: var(--divider);margin-left:16px}.KRPzVaZp4HxDnBTYQ8cl.qgKsU6YVzLu4DJsXRhm9.VfNtf0bk00wKMFwuIu3A+:not(.VfNtf0bk00wKMFwuIu3A){margin-top:16px}.KRPzVaZp4HxDnBTYQ8cl.qgKsU6YVzLu4DJsXRhm9.sj83Oo_9QANPn0js8HDg{--border: var(--inverted-400) !important}.KRPzVaZp4HxDnBTYQ8cl.qgKsU6YVzLu4DJsXRhm9.sj83Oo_9QANPn0js8HDg:not(.n_QrAH2BEW7TltoT5Rrq){color:var(--fg-major);font-weight:var(--font-weight-bold)}","",{version:3,sources:["webpack://./packages/editor/src/plugins/toc/toc.module.scss"],names:[],mappings:"AAAA,sBACE,eAAA,CACA,wBAAA,CAIA,2CACE,gBAAA,CACA,cAAA,CACA,gDAAA,CACA,qBAAA,CAEA,4FACE,cAAA,CAGF,gEACE,wBAAA,CAEA,gBAAA,CAEA,4FACE,eAAA,CAIJ,gEACE,wCAAA,CAEA,2FACE,qBAAA,CACA,mCAAA",sourcesContent:[".toc {\n  list-style: none;\n  padding: 12px 32px 12px 0;\n}\n\n.x {\n  &.item {\n    padding: 4px 16px;\n    cursor: pointer;\n    border-left: 1px solid var(--border, transparent);\n    width: 100% !important;\n\n    &:not(.sub) + .sub {\n      margin-top: 8px;\n    }\n\n    &.sub {\n      --border: var(--divider);\n\n      margin-left: 16px;\n\n      & + :not(.sub) {\n        margin-top: 16px;\n      }\n    }\n\n    &.selected {\n      --border: var(--inverted-400) !important;\n\n      &:not(.empty) {\n        color: var(--fg-major);\n        font-weight: var(--font-weight-bold);\n      }\n    }\n  }\n}\n"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={toc:"YGFFZ5_kmmEA0ZdfRQ8c",x:"KRPzVaZp4HxDnBTYQ8cl",item:"qgKsU6YVzLu4DJsXRhm9",sub:"VfNtf0bk00wKMFwuIu3A",selected:"sj83Oo_9QANPn0js8HDg",empty:"n_QrAH2BEW7TltoT5Rrq"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);