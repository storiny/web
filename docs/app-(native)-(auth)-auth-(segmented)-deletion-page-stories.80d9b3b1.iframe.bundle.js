"use strict";(self.webpackChunk_storiny_monorepo=self.webpackChunk_storiny_monorepo||[]).push([[38637],{"./apps/web/src/app/(native)/(auth)/auth/(segmented)/@deletion/page.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>page_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),mock=__webpack_require__("./packages/ui/src/redux/mock/index.tsx"),layout=__webpack_require__("./apps/web/src/app/(native)/(auth)/layout.tsx"),utils=__webpack_require__("./apps/web/src/common/utils/index.ts"),button_button=__webpack_require__("./packages/ui/src/components/button/button.tsx"),grow=__webpack_require__("./packages/ui/src/components/grow/grow.tsx"),spacer=__webpack_require__("./packages/ui/src/components/spacer/spacer.tsx"),use_toast=__webpack_require__("./packages/ui/src/components/toast/use-toast/use-toast.tsx"),typography=__webpack_require__("./packages/ui/src/components/typography/typography.tsx"),login=__webpack_require__("./packages/ui/src/redux/features/api/endpoints/auth/login/index.ts"),main_module=__webpack_require__("./packages/ui/src/theme/main.module.scss"),handle_api_error=__webpack_require__("./packages/ui/src/utils/handle-api-error/handle-api-error.ts"),_auth_state=__webpack_require__("./apps/web/src/app/(native)/(auth)/state.tsx");const Page=()=>{const{state}=(0,_auth_state.H)(),router=(0,utils.mC)(),toast=(0,use_toast.w)(),[done,set_done]=react.useState(!1),[recover_account,{isLoading:is_loading}]=(0,login.K)(),handle_recover=react.useCallback((()=>{state.login_data?recover_account({...state.login_data,code:state.mfa_code||void 0,bypass:!0}).unwrap().then((res=>{"success"===res.result?(set_done(!0),router.replace("/"),router.refresh()):(set_done(!1),toast("Could not recover your account","error"))})).catch((error=>{set_done(!1),(0,handle_api_error.n)(error,toast,null,"Could not recover your account")})):toast("Could not recover your account","error")}),[recover_account,router,state.login_data,state.mfa_code,toast]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(typography.A,{as:"h1",level:"h3",children:"Account held for deletion"}),(0,jsx_runtime.jsx)(spacer.A,{orientation:"vertical",size:.5}),(0,jsx_runtime.jsxs)(typography.A,{color:"minor",level:"body2",children:["We have received a request for the deletion of this Storiny account.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),"This account and all its related data will be permanently deleted within 30 days. To halt the deletion request, simply recover your account."]}),(0,jsx_runtime.jsx)(grow.A,{}),(0,jsx_runtime.jsx)("div",{className:main_module.A["flex-center"],children:(0,jsx_runtime.jsx)(button_button.A,{className:main_module.A["full-w"],disabled:done,loading:is_loading,onClick:handle_recover,size:"lg",children:"Recover account"})})]})},page=Page;Page.__docgenInfo={description:"",methods:[],displayName:"Page"};const page_stories={title:"pages/auth/@deletion",component:page,parameters:{layout:"fullscreen"},tags:["autodocs"]},Default={decorators:[Story=>(0,mock.s)((0,jsx_runtime.jsx)(layout.A,{children:(0,jsx_runtime.jsx)(Story,{})}),{ignore_primitive_providers:!0})]},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  decorators: [(Story): React.ReactElement => render_with_state(<AuthLayout>\n          <Story />\n        </AuthLayout>, {\n    ignore_primitive_providers: true\n  })]\n}",...Default.parameters?.docs?.source}}}},"./apps/web/src/app/(native)/(auth)/layout.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>layout});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js"),plus_pattern=(__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),__webpack_require__("./packages/ui/src/brand/plus-pattern/plus-pattern.tsx")),main=__webpack_require__("./packages/ui/src/components/main/main.tsx"),navbar=__webpack_require__("./packages/ui/src/layout/navbar/navbar.tsx"),main_module=__webpack_require__("./packages/ui/src/theme/main.module.scss"),layout_module=__webpack_require__("./apps/web/src/app/(native)/(auth)/layout.module.scss"),state=__webpack_require__("./apps/web/src/app/(native)/(auth)/state.tsx");__webpack_require__("./node_modules/process/browser.js").env.NEXT_PUBLIC_WEB_URL;const AuthLayout=({children})=>(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.$)(main_module.A.grid,main_module.A["grid-container"],main_module.A.minimal),children:[(0,jsx_runtime.jsx)(navbar.A,{variant:"minimal"}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.$)(main_module.A["full-w"],main_module.A["full-h"]),role:"presentation",style:{minHeight:"100vh",position:"fixed",pointerEvents:"none"},children:(0,jsx_runtime.jsx)(plus_pattern.A,{})}),(0,jsx_runtime.jsx)(main.A,{className:(0,clsx_m.$)(layout_module.A.x,layout_module.A.main),children:(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.$)(main_module.A["flex-col"],layout_module.A.container),children:(0,jsx_runtime.jsx)(state.A,{children})})})]}),layout=AuthLayout;AuthLayout.__docgenInfo={description:"",methods:[],displayName:"AuthLayout",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}}},"./apps/web/src/app/(native)/(auth)/state.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,H:()=>use_auth_state});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),deepmerge__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/deepmerge/dist/cjs.js"),deepmerge__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(deepmerge__WEBPACK_IMPORTED_MODULE_1__),next_navigation__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_common_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./apps/web/src/common/utils/index.ts");const AuthStateContext=react__WEBPACK_IMPORTED_MODULE_3__.createContext({state:{},set_state:()=>{}}),AuthState=({children})=>{const search_params=(0,next_navigation__WEBPACK_IMPORTED_MODULE_2__.useSearchParams)(),segment=(()=>{if(search_params){const segment=search_params.get("segment")||"",token=search_params.get("token")||"";if(["reset-password","login","signup","recover"].includes(segment)){if("reset-password"===segment&&token)return"reset_base";if(["login","signup","recover"].includes(segment))return"login"===segment?"login":"recover"===segment?"recovery_base":"signup_base"}}return"base"})(),[state,set_state]=react__WEBPACK_IMPORTED_MODULE_3__.useState({segment,visited_segments:[segment],next_url:(()=>{if(!search_params)return null;const path=decodeURIComponent(search_params.get("to")||""),blog=decodeURIComponent(search_params.get("blog")||""),is_blog_custom_domain=blog.includes(".");return path.length&&"/"!==path?path.startsWith("/")?path:`/${path}`:blog.length?(0,_common_utils__WEBPACK_IMPORTED_MODULE_4__.b_)(is_blog_custom_domain?blog:`${blog}.storiny.com`):null})(),blog_domain:(()=>{if(!search_params)return null;const blog=decodeURIComponent(search_params.get("blog")||"");return blog.includes(".")?blog:null})(),reset_password:{token:null},login_data:null,mfa_code:null,recovery:{email:""},signup:{email:"",name:"",password:"",username:"",wpm:null},signup_errors:{}});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(AuthStateContext.Provider,{value:{state,set_state:payload=>{set_state((prev_state=>{const next_state="object"==typeof payload?payload:payload(prev_state);if(next_state.segment)if("base"===next_state.segment)next_state.visited_segments=["base"];else if(prev_state.segment!==next_state.segment)next_state.visited_segments=Array.from(new Set([...prev_state.visited_segments,next_state.segment]));else{const visited_segments=prev_state.visited_segments;visited_segments.length&&(next_state.visited_segments=visited_segments.filter((item=>item!==next_state.segment)))}return deepmerge__WEBPACK_IMPORTED_MODULE_1___default()(prev_state,next_state,{arrayMerge:(_,source_array)=>source_array})}))}},children})},use_auth_state=()=>react__WEBPACK_IMPORTED_MODULE_3__.useContext(AuthStateContext),__WEBPACK_DEFAULT_EXPORT__=AuthState;AuthState.__docgenInfo={description:"",methods:[],displayName:"AuthState",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}}},"./packages/shared/src/enums/content-type/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>ContentType});var ContentType=function(ContentType){return ContentType.JSON="application/json; charset=UTF-8",ContentType}({})},"./packages/ui/src/components/toast/use-toast/use-toast.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>use_toast});var _redux_features_toast_slice__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/ui/src/redux/features/toast/slice.ts"),_redux_hooks__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/ui/src/redux/hooks/index.ts");const use_toast=()=>{const dispatch=(0,_redux_hooks__WEBPACK_IMPORTED_MODULE_0__.f)();return(message,severity)=>{dispatch((0,_redux_features_toast_slice__WEBPACK_IMPORTED_MODULE_1__.nT)({message,severity}))}}},"./packages/ui/src/redux/features/api/endpoints/auth/login/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>use_login_mutation});var _storiny_shared__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/shared/src/enums/content-type/index.ts"),_redux_features_api_slice__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/ui/src/redux/features/api/slice.ts");const{useLoginMutation:use_login_mutation}=_redux_features_api_slice__WEBPACK_IMPORTED_MODULE_0__.Qo.injectEndpoints({endpoints:builder=>({login:builder.mutation({query:({bypass,...rest})=>({url:`/auth/login?bypass=${Boolean(bypass)}`,method:"POST",body:rest,headers:{"Content-type":_storiny_shared__WEBPACK_IMPORTED_MODULE_1__.c.JSON}})})})})},"./packages/ui/src/utils/handle-api-error/handle-api-error.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>handle_api_error});var _storiny_shared_src_utils_dev_log__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/shared/src/utils/dev-log/index.ts"),_utils_is_form_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/ui/src/utils/is-form-error/is-form-error.ts");const handle_api_error=(error,toaster,form,default_message)=>{var _error_data,_error_data1,_error_data2;(_storiny_shared_src_utils_dev_log__WEBPACK_IMPORTED_MODULE_0__.y.error(error),form&&(0,_utils_is_form_error__WEBPACK_IMPORTED_MODULE_1__.H)(error))?handle_form_error(null===(_error_data=error.data)||void 0===_error_data?void 0:_error_data.errors,form.setError):toaster((null==error||null===(_error_data1=error.data)||void 0===_error_data1?void 0:_error_data1.error)||"string"==typeof(null==error?void 0:error.data)&&error.data||("FETCH_ERROR"===(null==error?void 0:error.status)?"Storiny is currently unavailable. Check your network connection or try again later.":default_message),(null==error||null===(_error_data2=error.data)||void 0===_error_data2?void 0:_error_data2.error)||"FETCH_ERROR"!==(null==error?void 0:error.status)?"error":"warning")},handle_form_error=(errors,set_error)=>errors.forEach((([field,message])=>{set_error(field,{type:"server",message})}))},"./packages/ui/src/utils/is-form-error/is-form-error.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>is_form_error});const is_form_error=error=>{var _error_data;return"form"===(null==error||null===(_error_data=error.data)||void 0===_error_data?void 0:_error_data.type)}},"./node_modules/deepmerge/dist/cjs.js":module=>{var isMergeableObject=function isMergeableObject(value){return function isNonNullObject(value){return!!value&&"object"==typeof value}(value)&&!function isSpecial(value){var stringValue=Object.prototype.toString.call(value);return"[object RegExp]"===stringValue||"[object Date]"===stringValue||function isReactElement(value){return value.$$typeof===REACT_ELEMENT_TYPE}(value)}(value)};var REACT_ELEMENT_TYPE="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(value,options){return!1!==options.clone&&options.isMergeableObject(value)?deepmerge(function emptyTarget(val){return Array.isArray(val)?[]:{}}(value),value,options):value}function defaultArrayMerge(target,source,options){return target.concat(source).map((function(element){return cloneUnlessOtherwiseSpecified(element,options)}))}function getKeys(target){return Object.keys(target).concat(function getEnumerableOwnPropertySymbols(target){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(target).filter((function(symbol){return Object.propertyIsEnumerable.call(target,symbol)})):[]}(target))}function propertyIsOnObject(object,property){try{return property in object}catch(_){return!1}}function mergeObject(target,source,options){var destination={};return options.isMergeableObject(target)&&getKeys(target).forEach((function(key){destination[key]=cloneUnlessOtherwiseSpecified(target[key],options)})),getKeys(source).forEach((function(key){(function propertyIsUnsafe(target,key){return propertyIsOnObject(target,key)&&!(Object.hasOwnProperty.call(target,key)&&Object.propertyIsEnumerable.call(target,key))})(target,key)||(propertyIsOnObject(target,key)&&options.isMergeableObject(source[key])?destination[key]=function getMergeFunction(key,options){if(!options.customMerge)return deepmerge;var customMerge=options.customMerge(key);return"function"==typeof customMerge?customMerge:deepmerge}(key,options)(target[key],source[key],options):destination[key]=cloneUnlessOtherwiseSpecified(source[key],options))})),destination}function deepmerge(target,source,options){(options=options||{}).arrayMerge=options.arrayMerge||defaultArrayMerge,options.isMergeableObject=options.isMergeableObject||isMergeableObject,options.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var sourceIsArray=Array.isArray(source);return sourceIsArray===Array.isArray(target)?sourceIsArray?options.arrayMerge(target,source,options):mergeObject(target,source,options):cloneUnlessOtherwiseSpecified(source,options)}deepmerge.all=function deepmergeAll(array,options){if(!Array.isArray(array))throw new Error("first argument should be an array");return array.reduce((function(prev,next){return deepmerge(prev,next,options)}),{})};var deepmerge_1=deepmerge;module.exports=deepmerge_1}}]);