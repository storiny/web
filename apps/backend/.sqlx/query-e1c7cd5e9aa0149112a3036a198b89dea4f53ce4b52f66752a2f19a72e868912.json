{
  "db_name": "PostgreSQL",
  "query": "SELECT\n    -- Story\n    s.id,\n    s.title,\n    s.slug,\n    s.description,\n    s.splash_id,\n    s.splash_hex,\n    s.category::text,\n    s.age_restriction,\n    s.license,\n    s.user_id,\n    -- Stats\n    s.word_count,\n    s.read_count,\n    s.like_count,\n    s.comment_count,\n    -- Timestamps\n    s.published_at,\n    s.edited_at,\n    -- User\n(u.id, u.name, u.username, u.avatar_id, u.avatar_hex, u.public_flags) AS \"user!: Json<User>\",\n    -- Tags\n    array_agg((t.id, t.name)) AS \"tags!: Vec<Tag>\"\nFROM\n    stories s\n    INNER JOIN users u ON u.id = s.user_id\n        AND u.deleted_at IS NULL\n        AND u.deactivated_at IS NULL\n        -- Join tags\n    LEFT OUTER JOIN story_tags st\nINNER JOIN tags t ON t.id = st.tag_id ON st.story_id = s.id\nWHERE\n    -- Public\n    s.visibility = 2\n    AND s.user_id IN (\n        -- Friends received by current user\n        SELECT\n            transmitter_id FROM friends f\n            WHERE\n                f.receiver_id = $1\n                AND f.accepted_at IS NOT NULL\n                AND f.deleted_at IS NULL\n            UNION\n            -- Friends transmitted by current user\n            SELECT\n                receiver_id FROM friends f\n                WHERE\n                    f.transmitter_id = $1\n                    AND f.accepted_at IS NOT NULL\n                    AND f.deleted_at IS NULL\n                UNION\n                -- Users being followed by the current user\n                SELECT\n                    followed_id FROM relations r\n                    -- Exclude private accounts as they would be included\n                    -- in the friends query above.\n                    INNER JOIN users ru ON ru.id = r.followed_id\n                        AND ru.is_private IS FALSE\n                        AND ru.deleted_at IS NULL\n                        AND ru.deactivated_at IS NULL\n                    WHERE\n                        r.follower_id = $1\n                        AND r.deleted_at IS NULL)\n    AND s.deleted_at IS NULL\n    AND s.published_at IS NOT NULL\nGROUP BY\n    s.id,\n    u.id\nORDER BY\n    -- Sort by `published_at` as the user usually would want to\n    -- see the latest stories from friends and following users.\n    s.published_at DESC\nLIMIT $2\n",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "id",
        "type_info": "Int8"
      },
      {
        "ordinal": 1,
        "name": "title",
        "type_info": "Text"
      },
      {
        "ordinal": 2,
        "name": "slug",
        "type_info": "Text"
      },
      {
        "ordinal": 3,
        "name": "description",
        "type_info": "Text"
      },
      {
        "ordinal": 4,
        "name": "splash_id",
        "type_info": "Text"
      },
      {
        "ordinal": 5,
        "name": "splash_hex",
        "type_info": "Bpchar"
      },
      {
        "ordinal": 6,
        "name": "category",
        "type_info": "Text"
      },
      {
        "ordinal": 7,
        "name": "age_restriction",
        "type_info": "Int2"
      },
      {
        "ordinal": 8,
        "name": "license",
        "type_info": "Int2"
      },
      {
        "ordinal": 9,
        "name": "user_id",
        "type_info": "Int8"
      },
      {
        "ordinal": 10,
        "name": "word_count",
        "type_info": "Int4"
      },
      {
        "ordinal": 11,
        "name": "read_count",
        "type_info": "Int8"
      },
      {
        "ordinal": 12,
        "name": "like_count",
        "type_info": "Int8"
      },
      {
        "ordinal": 13,
        "name": "comment_count",
        "type_info": "Int4"
      },
      {
        "ordinal": 14,
        "name": "published_at",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 15,
        "name": "edited_at",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 16,
        "name": "user!: Json<User>",
        "type_info": "Record"
      },
      {
        "ordinal": 17,
        "name": "tags!: Vec<Tag>",
        "type_info": "RecordArray"
      }
    ],
    "parameters": {
      "Left": [
        "Int8",
        "Int8"
      ]
    },
    "nullable": [
      false,
      false,
      true,
      true,
      true,
      true,
      null,
      false,
      false,
      false,
      false,
      false,
      false,
      false,
      true,
      true,
      null,
      null
    ]
  },
  "hash": "e1c7cd5e9aa0149112a3036a198b89dea4f53ce4b52f66752a2f19a72e868912"
}
