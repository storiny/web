syntax = "proto3";

package story_def.v1;

import "tag_def/v1/def.proto";
import "user_def/v1/def.proto";

enum StoryAgeRestriction {
  STORY_AGE_RESTRICTION_UNSPECIFIED /**/ = 0;
  STORY_AGE_RESTRICTION_NOT_RATED /*  */ = 1;
  STORY_AGE_RESTRICTION_RATED /*      */ = 2;
}

enum StoryVisibility {
  STORY_VISIBILITY_UNSPECIFIED /**/ = 0;
  STORY_VISIBILITY_UNLISTED /*   */ = 1;
  STORY_VISIBILITY_PUBLIC /*     */ = 2;
}

enum StoryLicense {
  STORY_LICENSE_UNSPECIFIED /**/ = 0;
  STORY_LICENSE_RESERVED /*   */ = 1;
  STORY_LICENSE_CC_ZERO /*    */ = 2;
  STORY_LICENSE_CC_BY /*      */ = 3;
  STORY_LICENSE_CC_BY_SA /*   */ = 4;
  STORY_LICENSE_CC_BY_ND /*   */ = 5;
  STORY_LICENSE_CC_BY_NC /*   */ = 6;
  STORY_LICENSE_CC_BY_NC_SA /**/ = 7;
  STORY_LICENSE_CC_BY_NC_ND /**/ = 8;
}

message Draft {
  string id /*                   */ = 1;
  string title /*                */ = 2;
  optional string splash_id /*   */ = 3;
  optional string splash_hex /*  */ = 4;
  uint32 word_count /*           */ = 5;
  string created_at /*           */ = 6;
  optional string edited_at /*   */ = 7;
}

// Story validation request

message ValidateStoryRequest {
  string user_id /* */ = 1;
  string story_id /**/ = 2;
}

message ValidateStoryResponse {}

// Create draft request

message CreateDraftRequest {
  string user_id = 1;
}

message CreateDraftResponse {
  string draft_id = 1;
}

// Drafts information request

message GetDraftsInfoRequest {
  string user_id = 1;
}

message GetDraftsInfoResponse {
  uint32 pending_draft_count = 1;
  uint32 deleted_draft_count = 2;
  optional Draft latest_draft = 3;
}

// Stories information request

message GetStoriesInfoRequest {
  string user_id = 1;
}

message GetStoriesInfoResponse {
  uint32 published_story_count /**/ = 1;
  uint32 deleted_story_count /*  */ = 2;
}

// Main story request

message GetStoryRequest {
  string id_or_slug /*              */ = 1;
  optional string current_user_id /**/ = 2;
}

message GetStoryResponse {
  string id /*                           */ = 1;
  string title /*                        */ = 2;
  optional string slug /*                */ = 3;
  optional string description /*         */ = 4;
  optional string splash_id /*           */ = 5;
  optional string splash_hex /*          */ = 6;
  string doc_key /*                      */ = 7;
  string category /*                     */ = 8;
  string user_id /*                      */ = 9;
  // Replace `uint32` with `uint64` when the read count overflows.
  uint32 like_count /*                   */ = 10;
  uint32 read_count /*                   */ = 11;
  uint32 word_count /*                   */ = 12;
  uint32 comment_count /*                */ = 13;
  StoryAgeRestriction age_restriction /* */ = 14;
  StoryLicense license /*                */ = 15;
  StoryVisibility visibility /*          */ = 16;
  bool disable_comments /*               */ = 17;
  bool disable_public_revision_history /**/ = 18;
  bool disable_toc /*                    */ = 19;
  // SEO
  optional string canonical_url /*       */ = 20;
  optional string seo_description /*     */ = 21;
  optional string seo_title /*           */ = 22;
  optional string preview_image /*       */ = 23;
  string created_at /*                   */ = 24;
  optional string edited_at /*           */ = 25;
  optional string published_at /*        */ = 26;
  optional string first_published_at /*  */ = 27;
  optional string deleted_at /*          */ = 28;
  // Joins
  user_def.v1.ExtendedUser user /*       */ = 29;
  repeated tag_def.v1.Tag tags /*        */ = 30;
  // User specific props
  bool is_bookmarked /*                  */ = 31;
  bool is_liked /*                       */ = 32;
  // Reading session token
  string reading_session_token /*        */ = 33;
}

// Story metadata request

message GetStoryMetadataRequest {
  string id_or_slug /**/ = 1;
  string user_id /*   */ = 2;
}

message GetStoryMetadataResponse {
  string id /*                           */ = 1;
  string title /*                        */ = 2;
  optional string slug /*                */ = 3;
  optional string description /*         */ = 4;
  optional string splash_id /*           */ = 5;
  optional string splash_hex /*          */ = 6;
  string doc_key /*                      */ = 7;
  string category /*                     */ = 8;
  string user_id /*                      */ = 9;
  StoryAgeRestriction age_restriction /* */ = 10;
  StoryLicense license /*                */ = 11;
  StoryVisibility visibility /*          */ = 12;
  bool disable_comments /*               */ = 13;
  bool disable_public_revision_history /**/ = 14;
  bool disable_toc /*                    */ = 15;
  // SEO
  optional string canonical_url /*       */ = 16;
  optional string seo_description /*     */ = 17;
  optional string seo_title /*           */ = 18;
  optional string preview_image /*       */ = 19;
  string created_at /*                   */ = 20;
  optional string edited_at /*           */ = 21;
  optional string published_at /*        */ = 22;
  optional string first_published_at /*  */ = 23;
  optional string deleted_at /*          */ = 24;
  // Joins
  user_def.v1.BareUser user /*           */ = 25;
  repeated tag_def.v1.Tag tags /*        */ = 26;
}
