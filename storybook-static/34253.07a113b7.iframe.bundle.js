"use strict";(self.webpackChunk_storiny_monorepo=self.webpackChunk_storiny_monorepo||[]).push([[34253],{"./packages/ui/src/entities/gallery/core/components/uploads/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>uploads});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),image_size=__webpack_require__("./packages/shared/src/enums/image-size/index.ts"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js"),react=__webpack_require__("./node_modules/jotai/esm/react.mjs"),compiled_react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),es=__webpack_require__("./node_modules/react-dropzone/dist/es/index.js"),utils=__webpack_require__("./node_modules/react-dropzone/dist/es/utils/index.js"),button_button=__webpack_require__("./packages/ui/src/components/button/button.tsx"),input=__webpack_require__("./packages/ui/src/components/input/input.tsx"),spacer=__webpack_require__("./packages/ui/src/components/spacer/spacer.tsx"),use_toast=__webpack_require__("./packages/ui/src/components/toast/use-toast/use-toast.tsx"),typography=__webpack_require__("./packages/ui/src/components/typography/typography.tsx");const CameraIllustration=props=>(0,jsx_runtime.jsxs)("svg",{...props,fill:"none",role:"presentation",viewBox:"0 0 259 162",children:[(0,jsx_runtime.jsx)("path",{d:"M1.56 160.87h245.65",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M233.78 146.05H14.43v15.11h219.35v-15.11Z",fill:"#000"}),(0,jsx_runtime.jsx)("path",{d:"M246.93 113.03v20.98c.26 6.82-5.25 12.39-12.07 12.32H14.05c-6.75 0-12.22-5.47-12.22-12.22V54.93c0-6.7 5.42-12.14 12.12-12.69l86.29.56h113.5l19.18.17c7.79-.01 13.77 6.27 14.01 14.07l-.2 55.99",fill:"#3E4146"}),(0,jsx_runtime.jsx)("path",{d:"M246.93 113.03v20.98c.26 6.82-5.25 12.39-12.07 12.32H14.05c-6.75 0-12.22-5.47-12.22-12.22V54.93c0-6.7 5.42-12.14 12.12-12.69l86.29.56h113.5l19.18.17c7.79-.01 13.77 6.27 14.01 14.07l-.2 55.99",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M219.51 76.38V56.5c0-7.56-6.13-13.7-13.7-13.7h-63.98c6.84.93 9.88 3.45 11.38 5.72 4.11 6.26-.26 14.96 3.68 21.7 1.59 2.71 4.64 4.56 13.29 6.16h49.33Z",fill:"#4F535C",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"m232.71 98.2-7.04-.06.32-42.54c-.02-6.69-5.51-12.69-12.02-12.8l18.97.17-.23 55.22v.01Z",fill:"#1F2124",stroke:"#000",strokeMiterlimit:"10",strokeWidth:".56"}),(0,jsx_runtime.jsx)("path",{d:"M257.56 101.48v9.73c0 1.47-1.19 2.66-2.66 2.66h-8.31l-16.29-.31c-2.27-.05-4.08-1.93-4.08-4.23V98.21l28.57.3c1.54.09 2.76 1.39 2.76 2.99l.01-.02Z",fill:"#B8BABD",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M194.92 47.28h-7.89a3.33 3.33 0 0 0-3.33 3.33v6.77a3.33 3.33 0 0 0 3.33 3.33h7.89a3.33 3.33 0 0 0 3.33-3.33v-6.77a3.33 3.33 0 0 0-3.33-3.33Z",fill:"#71767C"}),(0,jsx_runtime.jsx)("path",{d:"M194.92 47.28h-7.89a3.33 3.33 0 0 0-3.33 3.33v6.77a3.33 3.33 0 0 0 3.33 3.33h7.89a3.33 3.33 0 0 0 3.33-3.33v-6.77a3.33 3.33 0 0 0-3.33-3.33Z",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M121.03 76.06c-7.39-.04-13.5-6.12-13.59-13.5l-.08-6.32c-.09-7.39-6.2-13.43-13.59-13.43h-78.5c-7.39 0-13.43 6.04-13.43 13.43v76.66c0 7.39 6.04 13.43 13.43 13.43h148.84c7.39 0 13.43-6.04 13.43-13.43V89.81c0-7.39-6.04-13.46-13.43-13.51l-43.09-.24h.01Zm-26.84 65.23H16.3c-3.66 0-6.63-2.97-6.63-6.63V56.78c0-3.7 3-6.7 6.7-6.7h77.84c3.69 0 6.67 2.99 6.67 6.67v77.84c0 3.7-3 6.7-6.7 6.7h.01Z",fill:"#71767C"}),(0,jsx_runtime.jsx)("path",{d:"M121.03 76.06c-7.39-.04-13.5-6.12-13.59-13.5l-.08-6.32c-.09-7.39-6.2-13.43-13.59-13.43h-78.5c-7.39 0-13.43 6.04-13.43 13.43v76.66c0 7.39 6.04 13.43 13.43 13.43h148.84c7.39 0 13.43-6.04 13.43-13.43V89.81c0-7.39-6.04-13.46-13.43-13.51l-43.09-.24h.01Zm-26.84 65.23H16.3c-3.66 0-6.63-2.97-6.63-6.63V56.78c0-3.7 3-6.7 6.7-6.7h77.84c3.69 0 6.67 2.99 6.67 6.67v77.84c0 3.7-3 6.7-6.7 6.7h.01Z",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M100.25 55.68H28.59c-3.34 0-6.05 2.71-6.05 6.05v65.69c0 3.32 2.72 6.04 6.04 6.04h71.67s.07-.03.07-.07V55.75s-.03-.07-.07-.07Zm-38.04 69.56c-17.76.56-32.28-13.95-31.71-31.71.52-16.08 13.61-29.18 29.69-29.69 17.76-.57 32.27 13.94 31.71 31.71-.51 16.08-13.61 29.19-29.7 29.7l.01-.01Z",fill:"#B8BABD",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M91.87 94.85c0 16.96-13.75 30.71-30.71 30.71s-30.72-13.75-30.72-30.71 13.75-30.72 30.72-30.72 30.71 13.75 30.71 30.72Z",fill:"#000"}),(0,jsx_runtime.jsx)("path",{d:"M61.71 114.71c10.968 0 19.86-8.892 19.86-19.86s-8.892-19.86-19.86-19.86-19.86 8.892-19.86 19.86 8.892 19.86 19.86 19.86Z",fill:"#71767C",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.12"}),(0,jsx_runtime.jsx)("path",{d:"M61.43 102.68a7.55 7.55 0 1 0 0-15.1 7.55 7.55 0 0 0 0 15.1ZM213.91 93.17a5.04 5.04 0 1 0 0-10.08 5.04 5.04 0 0 0 0 10.08ZM148.71 98.56a6.44 6.44 0 0 0-8.79-2.36 6.44 6.44 0 0 0-2.36 8.79 6.425 6.425 0 0 0 7.2 3.01l4.51 7.81a6.405 6.405 0 0 0-1.86 4.52c0 3.55 2.88 6.43 6.43 6.43s6.43-2.88 6.43-6.43a6.432 6.432 0 0 0-8.06-6.22l-4.51-7.81a6.421 6.421 0 0 0 .99-7.74h.02ZM132.4 126.81c3.55 0 6.43-2.88 6.43-6.43s-2.88-6.43-6.43-6.43-6.43 2.88-6.43 6.43 2.88 6.43 6.43 6.43Z",fill:"#B8BABD",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M86.61.84H59.95c-3.64 0-6.91 2.2-8.28 5.58C47.78 16 43.9 25.57 40.01 35.15a8.986 8.986 0 0 1-2.94 3.82c-1.71 1.28-3.42 2.56-5.13 3.85l68.37.19V6.66A5.82 5.82 0 0 0 94.49.84H86.6h.01Z",fill:"#71767C",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M100.32 6.71v36.1H61.26c1.12-.96 2.24-1.91 3.35-2.87 1.11-.96 2.07-2.2 2.71-3.57 5.06-10.8 8.27-20.7 13.28-31.47C81.64 2.67 84.5.84 86.96.84h7.48c3.24 0 5.87 2.63 5.87 5.87h.01Z",fill:"#4F535C",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"}),(0,jsx_runtime.jsx)("path",{d:"M63.67 17.63a4.76 4.76 0 1 0 0-9.52 4.76 4.76 0 0 0 0 9.52Z",fill:"#B8BABD",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"1.68"})]}),camera=CameraIllustration;CameraIllustration.__docgenInfo={description:"",methods:[],displayName:"CameraIllustration"};var upload=__webpack_require__("./packages/ui/src/redux/features/api/endpoints/me/assets/upload/index.ts"),main_module=__webpack_require__("./packages/ui/src/theme/main.module.scss"),get_cdn_url=__webpack_require__("./packages/ui/src/utils/get-cdn-url/get-cdn-url.ts"),selected=__webpack_require__("./packages/ui/src/entities/gallery/core/atoms/selected/index.ts"),uploading=__webpack_require__("./packages/ui/src/entities/gallery/core/atoms/uploading/index.ts"),upload_progress=__webpack_require__("./packages/ui/src/entities/gallery/core/components/upload-progress/upload-progress.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),uploads_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/ui/src/entities/gallery/core/components/uploads/uploads.module.scss"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(uploads_module.A,options);const uploads_uploads_module=uploads_module.A&&uploads_module.A.locals?uploads_module.A.locals:void 0,UploadsTab=props=>{var _result_error_data,_result_error,_result_error1;const{on_open_in_whiteboard,disable_whiteboard_prompt}=props,toast=(0,use_toast.w)(),set_selected=(0,react.Xr)(selected.q),set_uploading=(0,react.Xr)(uploading.M),[file,set_file]=compiled_react.useState(null),[alt,set_alt]=compiled_react.useState(""),[upload_image,result]=(0,upload.t)(),{getRootProps:get_root_props,getInputProps:get_input_props,isDragActive:is_drag_active}=(0,es.VB)({maxFiles:1,maxSize:10485760,multiple:!1,autoFocus:!0,accept:{"image/jpeg":[],"image/apng":[],"image/png":[],"image/gif":[],"image/webp":[]},onError:()=>toast("Unable to import the image file","error"),onDrop:(accepted_files,file_rejections)=>{if(file_rejections.length){let error_message="";for(const rejection of file_rejections)for(const error of rejection.errors)switch(error.code){case utils.O4.FileInvalidType:error_message="Unsupported image file";break;case utils.O4.FileTooLarge:error_message="Image file is too large";break;case utils.O4.TooManyFiles:error_message="Only a single image file can be uploaded at a time";break;default:error_message="Unable to import the image file"}toast(error_message,"error")}else{const accepted_file=accepted_files[0];accepted_file?(Object.assign(accepted_file,{preview:URL.createObjectURL(accepted_file)}),set_file(accepted_file)):toast("No file selected","error")}}}),handle_upload=compiled_react.useCallback((()=>{file&&(set_uploading(!0),upload_image({file,alt}).unwrap().then((uploaded=>{set_alt(""),set_selected({src:(0,get_cdn_url.p)(uploaded.key,image_size.h.W_320),key:uploaded.key,hex:uploaded.hex,alt:uploaded.alt,width:uploaded.width,height:uploaded.height,rating:uploaded.rating,source:"native"})})).catch((()=>{})).finally((()=>set_uploading(!1))))}),[alt,file,set_selected,set_uploading,upload_image]),reset=compiled_react.useCallback((()=>{set_file(null),set_selected(null),result.reset()}),[result,set_selected]);return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.A)(main_module.A["flex-col"],main_module.A["flex-center"],uploads_uploads_module.uploads),"data-has-file":String(Boolean(result.isLoading||result.isSuccess||file)),tabIndex:-1,children:result.isLoading?(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.A)(main_module.A["flex-col"],main_module.A["flex-center"]),children:[(0,jsx_runtime.jsx)(typography.A,{level:"body3",weight:"medium",children:"Uploading image..."}),(0,jsx_runtime.jsx)(spacer.A,{orientation:"vertical",size:1.5}),(0,jsx_runtime.jsx)(upload_progress.A,{})]}):result.isError?(0,jsx_runtime.jsxs)(compiled_react.Fragment,{children:[(0,jsx_runtime.jsx)(typography.A,{className:main_module.A["t-center"],color:"minor",level:"body2",children:"data"in result.error&&"string"==typeof(null===(_result_error=result.error)||void 0===_result_error||null===(_result_error_data=_result_error.data)||void 0===_result_error_data?void 0:_result_error_data.error)?result.error.data.error:"Failed to upload your image"}),429===(null===(_result_error1=result.error)||void 0===_result_error1?void 0:_result_error1.status)?null:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(spacer.A,{orientation:"vertical",size:2.25}),(0,jsx_runtime.jsx)("div",{className:main_module.A["flex-center"],children:(0,jsx_runtime.jsx)(button_button.A,{onClick:handle_upload,children:"Try again"})})]})]}):result.isSuccess&&file?(0,jsx_runtime.jsxs)(compiled_react.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:uploads_uploads_module["preview-wrapper"],children:(0,jsx_runtime.jsx)("img",{alt:"",className:uploads_uploads_module.preview,onLoad:()=>URL.revokeObjectURL(file.preview),src:file.preview})}),(0,jsx_runtime.jsx)(spacer.A,{className:main_module.A["f-grow"],orientation:"vertical",size:2.25}),(0,jsx_runtime.jsx)(typography.A,{className:main_module.A["t-center"],color:"minor",level:"body2",children:"Image uploaded"}),(0,jsx_runtime.jsx)(spacer.A,{orientation:"vertical",size:2.25}),(0,jsx_runtime.jsx)("div",{className:main_module.A["flex-center"],children:(0,jsx_runtime.jsx)(button_button.A,{onClick:reset,variant:"hollow",children:"Upload another"})})]}):file?(0,jsx_runtime.jsxs)(compiled_react.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:uploads_uploads_module["preview-wrapper"],children:(0,jsx_runtime.jsx)("img",{alt:"",className:uploads_uploads_module.preview,src:file.preview})}),(0,jsx_runtime.jsx)(spacer.A,{className:main_module.A["f-grow"],orientation:"vertical",size:3}),(0,jsx_runtime.jsx)(input.A,{"aria-label":"Alt text for the image",onChange:event=>set_alt(event.target.value),placeholder:"Add an alt text",value:alt}),(0,jsx_runtime.jsx)(spacer.A,{orientation:"vertical",size:1.5}),(0,jsx_runtime.jsxs)("div",{className:main_module.A["flex-center"],children:[!disable_whiteboard_prompt&&(0,jsx_runtime.jsxs)(compiled_react.Fragment,{children:[(0,jsx_runtime.jsx)(button_button.A,{onClick:()=>null==on_open_in_whiteboard?void 0:on_open_in_whiteboard(file.preview),variant:"hollow",children:"Open in whiteboard"}),(0,jsx_runtime.jsx)(spacer.A,{})]}),(0,jsx_runtime.jsx)(button_button.A,{onClick:handle_upload,children:"Upload"})]})]}):(0,jsx_runtime.jsxs)("div",{...get_root_props({className:(0,clsx_m.A)(main_module.A.focusable,main_module.A["focus-invert"],main_module.A["flex-col"],main_module.A["flex-center"],uploads_uploads_module.dropzone,is_drag_active&&uploads_uploads_module.focused)}),children:[(0,jsx_runtime.jsx)("input",{...get_input_props()}),(0,jsx_runtime.jsx)(camera,{className:uploads_uploads_module.illustration}),(0,jsx_runtime.jsx)(typography.A,{level:"body2",children:is_drag_active?"Drop it!":"Drop file here or click to upload"})]})})},uploads=UploadsTab;UploadsTab.__docgenInfo={description:"",methods:[],displayName:"UploadsTab",props:{disable_whiteboard_prompt:{required:!1,tsType:{name:"boolean"},description:"Disables whiteboard prompt (for smaller screens)"},on_open_in_whiteboard:{required:!1,tsType:{name:"signature",type:"function",raw:"(blob_url: string) => void",signature:{arguments:[{type:{name:"string"},name:"blob_url"}],return:{name:"void"}}},description:"Callback called when the user wants the image to open\nin the whiteboard\n@param blob_url Image blob URL"}}}},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[14].use[3]!./packages/ui/src/entities/gallery/core/components/uploads/uploads.module.scss":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".L4sqG1x7Qa7_bMDRQq77,.Axm2Bu5PqK3tVtZR6o8o{height:100%;width:100%}.L4sqG1x7Qa7_bMDRQq77[data-has-file=true]{padding:24px}.Axm2Bu5PqK3tVtZR6o8o{text-align:center;cursor:copy;gap:16px}.KgFmnrX2pdNY1YXKndm5{max-width:236px}.wKMvOKsVDigWT1cMDyAD{outline:3px solid var(--focus);outline-offset:-3px}.aEbCdSjuRjiLBoT8ioDp{max-height:100%;max-width:100%;overflow:hidden}.MXTj7qGxWxc6FWDnK1lw{height:100%;width:100%;object-fit:cover;border:1px solid var(--divider);border-radius:var(--radius-sm)}","",{version:3,sources:["webpack://./packages/ui/src/entities/gallery/core/components/uploads/uploads.module.scss"],names:[],mappings:"AAAA,4CAEE,WAAA,CACA,UAAA,CAIA,0CACE,YAAA,CAIJ,sBACE,iBAAA,CACA,WAAA,CACA,QAAA,CAGF,sBACE,eAAA,CAGF,sBACE,8BAAA,CACA,mBAAA,CAGF,sBACE,eAAA,CACA,cAAA,CACA,eAAA,CAGF,sBACE,WAAA,CACA,UAAA,CACA,gBAAA,CACA,+BAAA,CACA,8BAAA",sourcesContent:['.uploads,\n.dropzone {\n  height: 100%;\n  width: 100%;\n}\n\n.uploads {\n  &[data-has-file="true"] {\n    padding: 24px;\n  }\n}\n\n.dropzone {\n  text-align: center;\n  cursor: copy;\n  gap: 16px;\n}\n\n.illustration {\n  max-width: 236px;\n}\n\n.focused {\n  outline: 3px solid var(--focus);\n  outline-offset: -3px;\n}\n\n.preview-wrapper {\n  max-height: 100%;\n  max-width: 100%;\n  overflow: hidden;\n}\n\n.preview {\n  height: 100%;\n  width: 100%;\n  object-fit: cover;\n  border: 1px solid var(--divider);\n  border-radius: var(--radius-sm);\n}\n'],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={uploads:"L4sqG1x7Qa7_bMDRQq77",dropzone:"Axm2Bu5PqK3tVtZR6o8o",illustration:"KgFmnrX2pdNY1YXKndm5",focused:"wKMvOKsVDigWT1cMDyAD","preview-wrapper":"aEbCdSjuRjiLBoT8ioDp",preview:"MXTj7qGxWxc6FWDnK1lw"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);