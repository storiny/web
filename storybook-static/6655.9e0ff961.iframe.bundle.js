"use strict";(self.webpackChunk_storiny_monorepo=self.webpackChunk_storiny_monorepo||[]).push([[6655],{"./node_modules/@codemirror/language/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>delimitedIndent,EI:()=>indentString,KB:()=>IndentContext,Lv:()=>foldGutter,Oh:()=>indentNodeProp,Q0:()=>sublanguageProp,Q_:()=>bracketMatchingHandle,SG:()=>bracketMatching,TM:()=>Language,Tg:()=>StreamLanguage,WD:()=>indentOnInput,Xt:()=>indentUnit,Yy:()=>LanguageSupport,Zt:()=>defaultHighlightStyle,_Y:()=>flatIndent,_v:()=>getIndentation,b_:()=>foldNodeProp,bj:()=>LRLanguage,cr:()=>HighlightStyle,f7:()=>foldKeymap,iB:()=>languageDataProp,jU:()=>matchBrackets,mv:()=>syntaxTree,mz:()=>continuedIndent,nq:()=>ParseContext,p9:()=>defineLanguageFacet,t:()=>foldService,t$:()=>LanguageDescription,tp:()=>getIndentUnit,y9:()=>syntaxHighlighting,yd:()=>foldInside});var _a,_lezer_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@lezer/common/dist/index.js"),_codemirror_state__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@codemirror/state/dist/index.js"),_codemirror_view__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@codemirror/view/dist/index.js"),_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@lezer/highlight/dist/index.js"),style_mod__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/style-mod/src/style-mod.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");const languageDataProp=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY;function defineLanguageFacet(baseData){return _codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define({combine:baseData?values=>values.concat(baseData):void 0})}const sublanguageProp=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY;class Language{constructor(data,parser,extraExtensions=[],name=""){this.data=data,this.name=name,_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.$t.prototype.hasOwnProperty("tree")||Object.defineProperty(_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.$t.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=parser,this.extension=[language.of(this),_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.$t.languageData.of(((state,pos,side)=>{let top=topNodeAt(state,pos,side),data=top.type.prop(languageDataProp);if(!data)return[];let base=state.facet(data),sub=top.type.prop(sublanguageProp);if(sub){let innerNode=top.resolve(pos-top.from,side);for(let sublang of sub)if(sublang.test(innerNode,state)){let data=state.facet(sublang.facet);return"replace"==sublang.type?data:data.concat(base)}}return base}))].concat(extraExtensions)}isActiveAt(state,pos,side=-1){return topNodeAt(state,pos,side).type.prop(languageDataProp)==this.data}findRegions(state){let lang=state.facet(language);if((null==lang?void 0:lang.data)==this.data)return[{from:0,to:state.doc.length}];if(!lang||!lang.allowsNesting)return[];let result=[],explore=(tree,from)=>{if(tree.prop(languageDataProp)==this.data)return void result.push({from,to:from+tree.length});let mount=tree.prop(_lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY.mounted);if(mount){if(mount.tree.prop(languageDataProp)==this.data){if(mount.overlay)for(let r of mount.overlay)result.push({from:r.from+from,to:r.to+from});else result.push({from,to:from+tree.length});return}if(mount.overlay){let size=result.length;if(explore(mount.tree,mount.overlay[0].from+from),result.length>size)return}}for(let i=0;i<tree.children.length;i++){let ch=tree.children[i];ch instanceof _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH&&explore(ch,tree.positions[i]+from)}};return explore(syntaxTree(state),0),result}get allowsNesting(){return!0}}function topNodeAt(state,pos,side){let topLang=state.facet(language),tree=syntaxTree(state).topNode;if(!topLang||topLang.allowsNesting)for(let node=tree;node;node=node.enter(pos,side,_lezer_common__WEBPACK_IMPORTED_MODULE_0__.Qj.ExcludeBuffers))node.type.isTop&&(tree=node);return tree}Language.setState=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.Pe.define();class LRLanguage extends Language{constructor(data,parser,name){super(data,parser,[],name),this.parser=parser}static define(spec){let data=defineLanguageFacet(spec.languageData);return new LRLanguage(data,spec.parser.configure({props:[languageDataProp.add((type=>type.isTop?data:void 0))]}),spec.name)}configure(options,name){return new LRLanguage(this.data,this.parser.configure(options),name||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function syntaxTree(state){let field=state.field(Language.state,!1);return field?field.tree:_lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH.empty}class DocInput{constructor(doc){this.doc=doc,this.cursorPos=0,this.string="",this.cursor=doc.iter()}get length(){return this.doc.length}syncTo(pos){return this.string=this.cursor.next(pos-this.cursorPos).value,this.cursorPos=pos+this.string.length,this.cursorPos-this.string.length}chunk(pos){return this.syncTo(pos),this.string}get lineChunks(){return!0}read(from,to){let stringStart=this.cursorPos-this.string.length;return from<stringStart||to>=this.cursorPos?this.doc.sliceString(from,to):this.string.slice(from-stringStart,to-stringStart)}}let currentContext=null;class ParseContext{constructor(parser,state,fragments=[],tree,treeLen,viewport,skipped,scheduleOn){this.parser=parser,this.state=state,this.fragments=fragments,this.tree=tree,this.treeLen=treeLen,this.viewport=viewport,this.skipped=skipped,this.scheduleOn=scheduleOn,this.parse=null,this.tempSkipped=[]}static create(parser,state,viewport){return new ParseContext(parser,state,[],_lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH.empty,0,viewport,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(until,upto){return null!=upto&&upto>=this.state.doc.length&&(upto=void 0),this.tree!=_lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH.empty&&this.isDone(null!=upto?upto:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var _a;if("number"==typeof until){let endTime=Date.now()+until;until=()=>Date.now()>endTime}for(this.parse||(this.parse=this.startParse()),null!=upto&&(null==this.parse.stoppedAt||this.parse.stoppedAt>upto)&&upto<this.state.doc.length&&this.parse.stopAt(upto);;){let done=this.parse.advance();if(done){if(this.fragments=this.withoutTempSkipped(_lezer_common__WEBPACK_IMPORTED_MODULE_0__.rr.addTree(done,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(_a=this.parse.stoppedAt)&&void 0!==_a?_a:this.state.doc.length,this.tree=done,this.parse=null,!(this.treeLen<(null!=upto?upto:this.state.doc.length)))return!0;this.parse=this.startParse()}if(until())return!1}}))}takeTree(){let pos,tree;this.parse&&(pos=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>pos)&&this.parse.stopAt(pos),this.withContext((()=>{for(;!(tree=this.parse.advance()););})),this.treeLen=pos,this.tree=tree,this.fragments=this.withoutTempSkipped(_lezer_common__WEBPACK_IMPORTED_MODULE_0__.rr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(f){let prev=currentContext;currentContext=this;try{return f()}finally{currentContext=prev}}withoutTempSkipped(fragments){for(let r;r=this.tempSkipped.pop();)fragments=cutFragments(fragments,r.from,r.to);return fragments}changes(changes,newState){let{fragments,tree,treeLen,viewport,skipped}=this;if(this.takeTree(),!changes.empty){let ranges=[];if(changes.iterChangedRanges(((fromA,toA,fromB,toB)=>ranges.push({fromA,toA,fromB,toB}))),fragments=_lezer_common__WEBPACK_IMPORTED_MODULE_0__.rr.applyChanges(fragments,ranges),tree=_lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH.empty,treeLen=0,viewport={from:changes.mapPos(viewport.from,-1),to:changes.mapPos(viewport.to,1)},this.skipped.length){skipped=[];for(let r of this.skipped){let from=changes.mapPos(r.from,1),to=changes.mapPos(r.to,-1);from<to&&skipped.push({from,to})}}}return new ParseContext(this.parser,newState,fragments,tree,treeLen,viewport,skipped,this.scheduleOn)}updateViewport(viewport){if(this.viewport.from==viewport.from&&this.viewport.to==viewport.to)return!1;this.viewport=viewport;let startLen=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from,to}=this.skipped[i];from<viewport.to&&to>viewport.from&&(this.fragments=cutFragments(this.fragments,from,to),this.skipped.splice(i--,1))}return!(this.skipped.length>=startLen)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(from,to){this.skipped.push({from,to})}static getSkippingParser(until){return new class extends _lezer_common__WEBPACK_IMPORTED_MODULE_0__.iX{createParse(input,fragments,ranges){let from=ranges[0].from,to=ranges[ranges.length-1].to;return{parsedPos:from,advance(){let cx=currentContext;if(cx){for(let r of ranges)cx.tempSkipped.push(r);until&&(cx.scheduleOn=cx.scheduleOn?Promise.all([cx.scheduleOn,until]):until)}return this.parsedPos=to,new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH(_lezer_common__WEBPACK_IMPORTED_MODULE_0__.Z6.none,[],[],to-from)},stoppedAt:null,stopAt(){}}}}}isDone(upto){upto=Math.min(upto,this.state.doc.length);let frags=this.fragments;return this.treeLen>=upto&&frags.length&&0==frags[0].from&&frags[0].to>=upto}static get(){return currentContext}}function cutFragments(fragments,from,to){return _lezer_common__WEBPACK_IMPORTED_MODULE_0__.rr.applyChanges(fragments,[{fromA:from,toA:to,fromB:from,toB:to}])}class LanguageState{constructor(context){this.context=context,this.tree=context.tree}apply(tr){if(!tr.docChanged&&this.tree==this.context.tree)return this;let newCx=this.context.changes(tr.changes,tr.state),upto=this.context.treeLen==tr.startState.doc.length?void 0:Math.max(tr.changes.mapPos(this.context.treeLen),newCx.viewport.to);return newCx.work(20,upto)||newCx.takeTree(),new LanguageState(newCx)}static init(state){let vpTo=Math.min(3e3,state.doc.length),parseState=ParseContext.create(state.facet(language).parser,state,{from:0,to:vpTo});return parseState.work(20,vpTo)||parseState.takeTree(),new LanguageState(parseState)}}Language.state=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sU.define({create:LanguageState.init,update(value,tr){for(let e of tr.effects)if(e.is(Language.setState))return e.value;return tr.startState.facet(language)!=tr.state.facet(language)?LanguageState.init(tr.state):value.apply(tr)}});let requestIdle=callback=>{let timeout=setTimeout((()=>callback()),500);return()=>clearTimeout(timeout)};"undefined"!=typeof requestIdleCallback&&(requestIdle=callback=>{let idle=-1,timeout=setTimeout((()=>{idle=requestIdleCallback(callback,{timeout:400})}),100);return()=>idle<0?clearTimeout(timeout):cancelIdleCallback(idle)});const isInputPending="undefined"!=typeof navigator&&(null===(_a=navigator.scheduling)||void 0===_a?void 0:_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Z9.fromClass(class ParseWorker{constructor(view){this.view=view,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(update){let cx=this.view.state.field(Language.state).context;(cx.updateViewport(update.view.viewport)||this.view.viewport.to>cx.treeLen)&&this.scheduleWork(),(update.docChanged||update.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(cx)}scheduleWork(){if(this.working)return;let{state}=this.view,field=state.field(Language.state);field.tree==field.context.tree&&field.context.isDone(state.doc.length)||(this.working=requestIdle(this.work))}work(deadline){this.working=null;let now=Date.now();if(this.chunkEnd<now&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=now+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state,viewport:{to:vpTo}}=this.view,field=state.field(Language.state);if(field.tree==field.context.tree&&field.context.isDone(vpTo+1e5))return;let endTime=Date.now()+Math.min(this.chunkBudget,100,deadline&&!isInputPending?Math.max(25,deadline.timeRemaining()-5):1e9),viewportFirst=field.context.treeLen<vpTo&&state.doc.length>vpTo+1e3,done=field.context.work((()=>isInputPending&&isInputPending()||Date.now()>endTime),vpTo+(viewportFirst?0:1e5));this.chunkBudget-=Date.now()-now,(done||this.chunkBudget<=0)&&(field.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(field.context))})),this.chunkBudget>0&&(!done||viewportFirst)&&this.scheduleWork(),this.checkAsyncSchedule(field.context)}checkAsyncSchedule(cx){cx.scheduleOn&&(this.workScheduled++,cx.scheduleOn.then((()=>this.scheduleWork())).catch((err=>(0,_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.c_)(this.view.state,err))).then((()=>this.workScheduled--)),cx.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define({combine:languages=>languages.length?languages[0]:null,enables:language=>[Language.state,parseWorker,_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.contentAttributes.compute([language],(state=>{let lang=state.facet(language);return lang&&lang.name?{"data-language":lang.name}:{}}))]});class LanguageSupport{constructor(language,support=[]){this.language=language,this.support=support,this.extension=[language,support]}}class LanguageDescription{constructor(name,alias,extensions,filename,loadFunc,support=void 0){this.name=name,this.alias=alias,this.extensions=extensions,this.filename=filename,this.loadFunc=loadFunc,this.support=support,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then((support=>this.support=support),(err=>{throw this.loading=null,err})))}static of(spec){let{load,support}=spec;if(!load){if(!support)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");load=()=>Promise.resolve(support)}return new LanguageDescription(spec.name,(spec.alias||[]).concat(spec.name).map((s=>s.toLowerCase())),spec.extensions||[],spec.filename,load,support)}static matchFilename(descs,filename){for(let d of descs)if(d.filename&&d.filename.test(filename))return d;let ext=/\.([^.]+)$/.exec(filename);if(ext)for(let d of descs)if(d.extensions.indexOf(ext[1])>-1)return d;return null}static matchLanguageName(descs,name,fuzzy=!0){name=name.toLowerCase();for(let d of descs)if(d.alias.some((a=>a==name)))return d;if(fuzzy)for(let d of descs)for(let a of d.alias){let found=name.indexOf(a);if(found>-1&&(a.length>2||!/\w/.test(name[found-1])&&!/\w/.test(name[found+a.length])))return d}return null}}const indentService=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define(),indentUnit=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define({combine:values=>{if(!values.length)return"  ";let unit=values[0];if(!unit||/\S/.test(unit)||Array.from(unit).some((e=>e!=unit[0])))throw new Error("Invalid indent unit: "+JSON.stringify(values[0]));return unit}});function getIndentUnit(state){let unit=state.facet(indentUnit);return 9==unit.charCodeAt(0)?state.tabSize*unit.length:unit.length}function indentString(state,cols){let result="",ts=state.tabSize,ch=state.facet(indentUnit)[0];if("\t"==ch){for(;cols>=ts;)result+="\t",cols-=ts;ch=" "}for(let i=0;i<cols;i++)result+=ch;return result}function getIndentation(context,pos){context instanceof _codemirror_state__WEBPACK_IMPORTED_MODULE_3__.$t&&(context=new IndentContext(context));for(let service of context.state.facet(indentService)){let result=service(context,pos);if(void 0!==result)return result}let tree=syntaxTree(context.state);return tree.length>=pos?function syntaxIndentation(cx,ast,pos){let stack=ast.resolveStack(pos),inner=ast.resolveInner(pos,-1).resolve(pos,0).enterUnfinishedNodesBefore(pos);if(inner!=stack.node){let add=[];for(let cur=inner;cur&&(cur.from!=stack.node.from||cur.type!=stack.node.type);cur=cur.parent)add.push(cur);for(let i=add.length-1;i>=0;i--)stack={node:add[i],next:stack}}return indentFor(stack,cx,pos)}(context,tree,pos):null}class IndentContext{constructor(state,options={}){this.state=state,this.options=options,this.unit=getIndentUnit(state)}lineAt(pos,bias=1){let line=this.state.doc.lineAt(pos),{simulateBreak,simulateDoubleBreak}=this.options;return null!=simulateBreak&&simulateBreak>=line.from&&simulateBreak<=line.to?simulateDoubleBreak&&simulateBreak==pos?{text:"",from:pos}:(bias<0?simulateBreak<pos:simulateBreak<=pos)?{text:line.text.slice(simulateBreak-line.from),from:simulateBreak}:{text:line.text.slice(0,simulateBreak-line.from),from:line.from}:line}textAfterPos(pos,bias=1){if(this.options.simulateDoubleBreak&&pos==this.options.simulateBreak)return"";let{text,from}=this.lineAt(pos,bias);return text.slice(pos-from,Math.min(text.length,pos+100-from))}column(pos,bias=1){let{text,from}=this.lineAt(pos,bias),result=this.countColumn(text,pos-from),override=this.options.overrideIndentation?this.options.overrideIndentation(from):-1;return override>-1&&(result+=override-this.countColumn(text,text.search(/\S|$/))),result}countColumn(line,pos=line.length){return(0,_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.y$)(line,this.state.tabSize,pos)}lineIndent(pos,bias=1){let{text,from}=this.lineAt(pos,bias),override=this.options.overrideIndentation;if(override){let overriden=override(from);if(overriden>-1)return overriden}return this.countColumn(text,text.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY;function indentFor(stack,cx,pos){for(let cur=stack;cur;cur=cur.next){let strategy=indentStrategy(cur.node);if(strategy)return strategy(TreeIndentContext.create(cx,pos,cur))}return 0}function indentStrategy(tree){let strategy=tree.type.prop(indentNodeProp);if(strategy)return strategy;let close,first=tree.firstChild;if(first&&(close=first.type.prop(_lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY.closedBy))){let last=tree.lastChild,closed=last&&close.indexOf(last.name)>-1;return cx=>delimitedStrategy(cx,!0,1,void 0,closed&&!function ignoreClosed(cx){return cx.pos==cx.options.simulateBreak&&cx.options.simulateDoubleBreak}(cx)?last.from:void 0)}return null==tree.parent?topIndent:null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(base,pos,context){super(base.state,base.options),this.base=base,this.pos=pos,this.context=context}get node(){return this.context.node}static create(base,pos,context){return new TreeIndentContext(base,pos,context)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(node){let line=this.state.doc.lineAt(node.from);for(;;){let atBreak=node.resolve(line.from);for(;atBreak.parent&&atBreak.parent.from==atBreak.from;)atBreak=atBreak.parent;if(isParent(atBreak,node))break;line=this.state.doc.lineAt(atBreak.from)}return this.lineIndent(line.from)}continue(){return indentFor(this.context.next,this.base,this.pos)}}function isParent(parent,of){for(let cur=of;cur;cur=cur.parent)if(parent==cur)return!0;return!1}function delimitedIndent({closing,align=!0,units=1}){return context=>delimitedStrategy(context,align,units,closing)}function delimitedStrategy(context,align,units,closing,closedAt){let after=context.textAfter,space=after.match(/^\s*/)[0].length,closed=closing&&after.slice(space,space+closing.length)==closing||closedAt==context.pos+space,aligned=align?function bracketedAligned(context){let tree=context.node,openToken=tree.childAfter(tree.from),last=tree.lastChild;if(!openToken)return null;let sim=context.options.simulateBreak,openLine=context.state.doc.lineAt(openToken.from),lineEnd=null==sim||sim<=openLine.from?openLine.to:Math.min(openLine.to,sim);for(let pos=openToken.to;;){let next=tree.childAfter(pos);if(!next||next==last)return null;if(!next.type.isSkipped){if(next.from>=lineEnd)return null;let space=/^ */.exec(openLine.text.slice(openToken.to-openLine.from))[0].length;return{from:openToken.from,to:openToken.to+space}}pos=next.to}}(context):null;return aligned?closed?context.column(aligned.from):context.column(aligned.to):context.baseIndent+(closed?0:context.unit*units)}const flatIndent=context=>context.baseIndent;function continuedIndent({except,units=1}={}){return context=>{let matchExcept=except&&except.test(context.textAfter);return context.baseIndent+(matchExcept?0:units*context.unit)}}const DontIndentBeyond=200;function indentOnInput(){return _codemirror_state__WEBPACK_IMPORTED_MODULE_3__.$t.transactionFilter.of((tr=>{if(!tr.docChanged||!tr.isUserEvent("input.type")&&!tr.isUserEvent("input.complete"))return tr;let rules=tr.startState.languageDataAt("indentOnInput",tr.startState.selection.main.head);if(!rules.length)return tr;let doc=tr.newDoc,{head}=tr.newSelection.main,line=doc.lineAt(head);if(head>line.from+DontIndentBeyond)return tr;let lineStart=doc.sliceString(line.from,head);if(!rules.some((r=>r.test(lineStart))))return tr;let{state}=tr,last=-1,changes=[];for(let{head}of state.selection.ranges){let line=state.doc.lineAt(head);if(line.from==last)continue;last=line.from;let indent=getIndentation(state,line.from);if(null==indent)continue;let cur=/^\s*/.exec(line.text)[0],norm=indentString(state,indent);cur!=norm&&changes.push({from:line.from,to:line.from+cur.length,insert:norm})}return changes.length?[tr,{changes,sequential:!0}]:tr}))}const foldService=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define(),foldNodeProp=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY;function foldInside(node){let first=node.firstChild,last=node.lastChild;return first&&first.to<last.from?{from:first.to,to:last.type.isError?node.to:last.from}:null}function isUnfinished(node){let ch=node.lastChild;return ch&&ch.to==node.to&&ch.type.isError}function foldable(state,lineStart,lineEnd){for(let service of state.facet(foldService)){let result=service(state,lineStart,lineEnd);if(result)return result}return function syntaxFolding(state,start,end){let tree=syntaxTree(state);if(tree.length<end)return null;let found=null;for(let iter=tree.resolveStack(end,1);iter;iter=iter.next){let cur=iter.node;if(cur.to<=end||cur.from>end)continue;if(found&&cur.from<start)break;let prop=cur.type.prop(foldNodeProp);if(prop&&(cur.to<tree.length-50||tree.length==state.doc.length||!isUnfinished(cur))){let value=prop(cur,state);value&&value.from<=end&&value.from>=start&&value.to>end&&(found=value)}}return found}(state,lineStart,lineEnd)}function mapRange(range,mapping){let from=mapping.mapPos(range.from,1),to=mapping.mapPos(range.to,-1);return from>=to?void 0:{from,to}}const foldEffect=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.Pe.define({map:mapRange}),unfoldEffect=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.Pe.define({map:mapRange});function selectedLines(view){let lines=[];for(let{head}of view.state.selection.ranges)lines.some((l=>l.from<=head&&l.to>=head))||lines.push(view.lineBlockAt(head));return lines}const foldState=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sU.define({create:()=>_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.none,update(folded,tr){folded=folded.map(tr.changes);for(let e of tr.effects)if(e.is(foldEffect)&&!foldExists(folded,e.value.from,e.value.to)){let{preparePlaceholder}=tr.state.facet(foldConfig),widget=preparePlaceholder?_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.replace({widget:new PreparedFoldWidget(preparePlaceholder(tr.state,e.value))}):foldWidget;folded=folded.update({add:[widget.range(e.value.from,e.value.to)]})}else e.is(unfoldEffect)&&(folded=folded.update({filter:(from,to)=>e.value.from!=from||e.value.to!=to,filterFrom:e.value.from,filterTo:e.value.to}));if(tr.selection){let onSelection=!1,{head}=tr.selection.main;folded.between(head,head,((a,b)=>{a<head&&b>head&&(onSelection=!0)})),onSelection&&(folded=folded.update({filterFrom:head,filterTo:head,filter:(a,b)=>b<=head||a>=head}))}return folded},provide:f=>_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.decorations.from(f),toJSON(folded,state){let ranges=[];return folded.between(0,state.doc.length,((from,to)=>{ranges.push(from,to)})),ranges},fromJSON(value){if(!Array.isArray(value)||value.length%2)throw new RangeError("Invalid JSON for fold state");let ranges=[];for(let i=0;i<value.length;){let from=value[i++],to=value[i++];if("number"!=typeof from||"number"!=typeof to)throw new RangeError("Invalid JSON for fold state");ranges.push(foldWidget.range(from,to))}return _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.set(ranges,!0)}});function findFold(state,from,to){var _a;let found=null;return null===(_a=state.field(foldState,!1))||void 0===_a||_a.between(from,to,((from,to)=>{(!found||found.from>from)&&(found={from,to})})),found}function foldExists(folded,from,to){let found=!1;return folded.between(from,from,((a,b)=>{a==from&&b==to&&(found=!0)})),found}function maybeEnable(state,other){return state.field(foldState,!1)?other:other.concat(_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.Pe.appendConfig.of(codeFolding()))}function announceFold(view,range,fold=!0){let lineFrom=view.state.doc.lineAt(range.from).number,lineTo=view.state.doc.lineAt(range.to).number;return _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.announce.of(`${view.state.phrase(fold?"Folded lines":"Unfolded lines")} ${lineFrom} ${view.state.phrase("to")} ${lineTo}.`)}const foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:view=>{for(let line of selectedLines(view)){let range=foldable(view.state,line.from,line.to);if(range)return view.dispatch({effects:maybeEnable(view.state,[foldEffect.of(range),announceFold(view,range)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:view=>{if(!view.state.field(foldState,!1))return!1;let effects=[];for(let line of selectedLines(view)){let folded=findFold(view.state,line.from,line.to);folded&&effects.push(unfoldEffect.of(folded),announceFold(view,folded,!1))}return effects.length&&view.dispatch({effects}),effects.length>0}},{key:"Ctrl-Alt-[",run:view=>{let{state}=view,effects=[];for(let pos=0;pos<state.doc.length;){let line=view.lineBlockAt(pos),range=foldable(state,line.from,line.to);range&&effects.push(foldEffect.of(range)),pos=(range?view.lineBlockAt(range.to):line).to+1}return effects.length&&view.dispatch({effects:maybeEnable(view.state,effects)}),!!effects.length}},{key:"Ctrl-Alt-]",run:view=>{let field=view.state.field(foldState,!1);if(!field||!field.size)return!1;let effects=[];return field.between(0,view.state.doc.length,((from,to)=>{effects.push(unfoldEffect.of({from,to}))})),view.dispatch({effects}),!0}}],defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},foldConfig=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define({combine:values=>(0,_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.QR)(values,defaultConfig)});function codeFolding(config){let result=[foldState,baseTheme$1];return config&&result.push(foldConfig.of(config)),result}function widgetToDOM(view,prepared){let{state}=view,conf=state.facet(foldConfig),onclick=event=>{let line=view.lineBlockAt(view.posAtDOM(event.target)),folded=findFold(view.state,line.from,line.to);folded&&view.dispatch({effects:unfoldEffect.of(folded)}),event.preventDefault()};if(conf.placeholderDOM)return conf.placeholderDOM(view,onclick,prepared);let element=document.createElement("span");return element.textContent=conf.placeholderText,element.setAttribute("aria-label",state.phrase("folded code")),element.title=state.phrase("unfold"),element.className="cm-foldPlaceholder",element.onclick=onclick,element}const foldWidget=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.replace({widget:new class extends _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.xO{toDOM(view){return widgetToDOM(view,null)}}});class PreparedFoldWidget extends _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.xO{constructor(value){super(),this.value=value}eq(other){return this.value==other.value}toDOM(view){return widgetToDOM(view,this.value)}}const foldGutterDefaults={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.wJ{constructor(config,open){super(),this.config=config,this.open=open}eq(other){return this.config==other.config&&this.open==other.open}toDOM(view){if(this.config.markerDOM)return this.config.markerDOM(this.open);let span=document.createElement("span");return span.textContent=this.open?this.config.openText:this.config.closedText,span.title=view.state.phrase(this.open?"Fold line":"Unfold line"),span}}function foldGutter(config={}){let fullConfig=Object.assign(Object.assign({},foldGutterDefaults),config),canFold=new FoldMarker(fullConfig,!0),canUnfold=new FoldMarker(fullConfig,!1),markers=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Z9.fromClass(class{constructor(view){this.from=view.viewport.from,this.markers=this.buildMarkers(view)}update(update){(update.docChanged||update.viewportChanged||update.startState.facet(language)!=update.state.facet(language)||update.startState.field(foldState,!1)!=update.state.field(foldState,!1)||syntaxTree(update.startState)!=syntaxTree(update.state)||fullConfig.foldingChanged(update))&&(this.markers=this.buildMarkers(update.view))}buildMarkers(view){let builder=new _codemirror_state__WEBPACK_IMPORTED_MODULE_3__.vB;for(let line of view.viewportLineBlocks){let mark=findFold(view.state,line.from,line.to)?canUnfold:foldable(view.state,line.from,line.to)?canFold:null;mark&&builder.add(line.from,line.from,mark)}return builder.finish()}}),{domEventHandlers}=fullConfig;return[markers,(0,_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.cU)({class:"cm-foldGutter",markers(view){var _a;return(null===(_a=view.plugin(markers))||void 0===_a?void 0:_a.markers)||_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.om.empty},initialSpacer:()=>new FoldMarker(fullConfig,!1),domEventHandlers:Object.assign(Object.assign({},domEventHandlers),{click:(view,line,event)=>{if(domEventHandlers.click&&domEventHandlers.click(view,line,event))return!0;let folded=findFold(view.state,line.from,line.to);if(folded)return view.dispatch({effects:unfoldEffect.of(folded)}),!0;let range=foldable(view.state,line.from,line.to);return!!range&&(view.dispatch({effects:foldEffect.of(range)}),!0)}})}),codeFolding()]}const baseTheme$1=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(specs,options){let modSpec;function def(spec){let cls=style_mod__WEBPACK_IMPORTED_MODULE_2__.G.newName();return(modSpec||(modSpec=Object.create(null)))["."+cls]=spec,cls}this.specs=specs;const all="string"==typeof options.all?options.all:options.all?def(options.all):void 0,scopeOpt=options.scope;this.scope=scopeOpt instanceof Language?type=>type.prop(languageDataProp)==scopeOpt.data:scopeOpt?type=>type==scopeOpt:void 0,this.style=(0,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__.az)(specs.map((style=>({tag:style.tag,class:style.class||def(Object.assign({},style,{tag:null}))}))),{all}).style,this.module=modSpec?new style_mod__WEBPACK_IMPORTED_MODULE_2__.G(modSpec):null,this.themeType=options.themeType}static define(specs,options){return new HighlightStyle(specs,options||{})}}const highlighterFacet=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define(),fallbackHighlighter=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define({combine:values=>values.length?[values[0]]:null});function getHighlighters(state){let main=state.facet(highlighterFacet);return main.length?main:state.facet(fallbackHighlighter)}function syntaxHighlighting(highlighter,options){let themeType,ext=[treeHighlighter];return highlighter instanceof HighlightStyle&&(highlighter.module&&ext.push(_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.styleModule.of(highlighter.module)),themeType=highlighter.themeType),(null==options?void 0:options.fallback)?ext.push(fallbackHighlighter.of(highlighter)):themeType?ext.push(highlighterFacet.computeN([_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.darkTheme],(state=>state.facet(_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.darkTheme)==("dark"==themeType)?[highlighter]:[]))):ext.push(highlighterFacet.of(highlighter)),ext}class TreeHighlighter{constructor(view){this.markCache=Object.create(null),this.tree=syntaxTree(view.state),this.decorations=this.buildDeco(view,getHighlighters(view.state)),this.decoratedTo=view.viewport.to}update(update){let tree=syntaxTree(update.state),highlighters=getHighlighters(update.state),styleChange=highlighters!=getHighlighters(update.startState),{viewport}=update.view,decoratedToMapped=update.changes.mapPos(this.decoratedTo,1);tree.length<viewport.to&&!styleChange&&tree.type==this.tree.type&&decoratedToMapped>=viewport.to?(this.decorations=this.decorations.map(update.changes),this.decoratedTo=decoratedToMapped):(tree!=this.tree||update.viewportChanged||styleChange)&&(this.tree=tree,this.decorations=this.buildDeco(update.view,highlighters),this.decoratedTo=viewport.to)}buildDeco(view,highlighters){if(!highlighters||!this.tree.length)return _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.none;let builder=new _codemirror_state__WEBPACK_IMPORTED_MODULE_3__.vB;for(let{from,to}of view.visibleRanges)(0,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__.DM)(this.tree,highlighters,((from,to,style)=>{builder.add(from,to,this.markCache[style]||(this.markCache[style]=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.mark({class:style})))}),from,to);return builder.finish()}}const treeHighlighter=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.Nb.high(_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Z9.fromClass(TreeHighlighter,{decorations:v=>v.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.meta,color:"#404740"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.link,textDecoration:"underline"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.heading,textDecoration:"underline",fontWeight:"bold"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.emphasis,fontStyle:"italic"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.strong,fontWeight:"bold"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.strikethrough,textDecoration:"line-through"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.keyword,color:"#708"},{tag:[_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.atom,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.bool,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.url,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.contentSeparator,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.labelName],color:"#219"},{tag:[_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.literal,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.inserted],color:"#164"},{tag:[_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.string,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.deleted],color:"#a11"},{tag:[_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.regexp,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.escape,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.special(_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.string)],color:"#e40"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.definition(_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.variableName),color:"#00f"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.local(_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.variableName),color:"#30a"},{tag:[_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.typeName,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.namespace],color:"#085"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.className,color:"#167"},{tag:[_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.special(_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.variableName),_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.macroName],color:"#256"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.definition(_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.propertyName),color:"#00c"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.comment,color:"#940"},{tag:_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A.invalid,color:"#f00"}]),baseTheme=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sj.define({combine:configs=>(0,_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.QR)(configs,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}),matchingMark=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.mark({class:"cm-matchingBracket"}),nonmatchingMark=_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(match){let decorations=[],mark=match.matched?matchingMark:nonmatchingMark;return decorations.push(mark.range(match.start.from,match.start.to)),match.end&&decorations.push(mark.range(match.end.from,match.end.to)),decorations}const bracketMatchingUnique=[_codemirror_state__WEBPACK_IMPORTED_MODULE_3__.sU.define({create:()=>_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.none,update(deco,tr){if(!tr.docChanged&&!tr.selection)return deco;let decorations=[],config=tr.state.facet(bracketMatchingConfig);for(let range of tr.state.selection.ranges){if(!range.empty)continue;let match=matchBrackets(tr.state,range.head,-1,config)||range.head>0&&matchBrackets(tr.state,range.head-1,1,config)||config.afterCursor&&(matchBrackets(tr.state,range.head,1,config)||range.head<tr.state.doc.length&&matchBrackets(tr.state,range.head+1,-1,config));match&&(decorations=decorations.concat(config.renderMatch(match,tr.state)))}return _codemirror_view__WEBPACK_IMPORTED_MODULE_4__.NZ.set(decorations,!0)},provide:f=>_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.Lz.decorations.from(f)}),baseTheme];function bracketMatching(config={}){return[bracketMatchingConfig.of(config),bracketMatchingUnique]}const bracketMatchingHandle=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY;function matchingNodes(node,dir,brackets){let byProp=node.prop(dir<0?_lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY.openedBy:_lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY.closedBy);if(byProp)return byProp;if(1==node.name.length){let index=brackets.indexOf(node.name);if(index>-1&&index%2==(dir<0?1:0))return[brackets[index+dir]]}return null}function findHandle(node){let hasHandle=node.type.prop(bracketMatchingHandle);return hasHandle?hasHandle(node.node):node}function matchBrackets(state,pos,dir,config={}){let maxScanDistance=config.maxScanDistance||DefaultScanDist,brackets=config.brackets||DefaultBrackets,tree=syntaxTree(state),node=tree.resolveInner(pos,dir);for(let cur=node;cur;cur=cur.parent){let matches=matchingNodes(cur.type,dir,brackets);if(matches&&cur.from<cur.to){let handle=findHandle(cur);if(handle&&(dir>0?pos>=handle.from&&pos<handle.to:pos>handle.from&&pos<=handle.to))return matchMarkedBrackets(state,pos,dir,cur,handle,matches,brackets)}}return function matchPlainBrackets(state,pos,dir,tree,tokenType,maxScanDistance,brackets){let startCh=dir<0?state.sliceDoc(pos-1,pos):state.sliceDoc(pos,pos+1),bracket=brackets.indexOf(startCh);if(bracket<0||bracket%2==0!=dir>0)return null;let startToken={from:dir<0?pos-1:pos,to:dir>0?pos+1:pos},iter=state.doc.iterRange(pos,dir>0?state.doc.length:0),depth=0;for(let distance=0;!iter.next().done&&distance<=maxScanDistance;){let text=iter.value;dir<0&&(distance+=text.length);let basePos=pos+distance*dir;for(let pos=dir>0?0:text.length-1,end=dir>0?text.length:-1;pos!=end;pos+=dir){let found=brackets.indexOf(text[pos]);if(!(found<0||tree.resolveInner(basePos+pos,1).type!=tokenType))if(found%2==0==dir>0)depth++;else{if(1==depth)return{start:startToken,end:{from:basePos+pos,to:basePos+pos+1},matched:found>>1==bracket>>1};depth--}}dir>0&&(distance+=text.length)}return iter.done?{start:startToken,matched:!1}:null}(state,pos,dir,tree,node.type,maxScanDistance,brackets)}function matchMarkedBrackets(_state,_pos,dir,token,handle,matching,brackets){let parent=token.parent,firstToken={from:handle.from,to:handle.to},depth=0,cursor=null==parent?void 0:parent.cursor();if(cursor&&(dir<0?cursor.childBefore(token.from):cursor.childAfter(token.to)))do{if(dir<0?cursor.to<=token.from:cursor.from>=token.to){if(0==depth&&matching.indexOf(cursor.type.name)>-1&&cursor.from<cursor.to){let endHandle=findHandle(cursor);return{start:firstToken,end:endHandle?{from:endHandle.from,to:endHandle.to}:void 0,matched:!0}}if(matchingNodes(cursor.type,dir,brackets))depth++;else if(matchingNodes(cursor.type,-dir,brackets)){if(0==depth){let endHandle=findHandle(cursor);return{start:firstToken,end:endHandle&&endHandle.from<endHandle.to?{from:endHandle.from,to:endHandle.to}:void 0,matched:!1}}depth--}}}while(dir<0?cursor.prevSibling():cursor.nextSibling());return{start:firstToken,matched:!1}}function countCol(string,end,tabSize,startIndex=0,startValue=0){null==end&&-1==(end=string.search(/[^\s\u00a0]/))&&(end=string.length);let n=startValue;for(let i=startIndex;i<end;i++)9==string.charCodeAt(i)?n+=tabSize-n%tabSize:n++;return n}class StringStream{constructor(string,tabSize,indentUnit,overrideIndent){this.string=string,this.tabSize=tabSize,this.indentUnit=indentUnit,this.overrideIndent=overrideIndent,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(match){let ok,ch=this.string.charAt(this.pos);if(ok="string"==typeof match?ch==match:ch&&(match instanceof RegExp?match.test(ch):match(ch)),ok)return++this.pos,ch}eatWhile(match){let start=this.pos;for(;this.eat(match););return this.pos>start}eatSpace(){let start=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>start}skipToEnd(){this.pos=this.string.length}skipTo(ch){let found=this.string.indexOf(ch,this.pos);if(found>-1)return this.pos=found,!0}backUp(n){this.pos-=n}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countCol(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var _a;return null!==(_a=this.overrideIndent)&&void 0!==_a?_a:countCol(this.string,null,this.tabSize)}match(pattern,consume,caseInsensitive){if("string"==typeof pattern){let cased=str=>caseInsensitive?str.toLowerCase():str;return cased(this.string.substr(this.pos,pattern.length))==cased(pattern)?(!1!==consume&&(this.pos+=pattern.length),!0):null}{let match=this.string.slice(this.pos).match(pattern);return match&&match.index>0?null:(match&&!1!==consume&&(this.pos+=match[0].length),match)}}current(){return this.string.slice(this.start,this.pos)}}function defaultCopyState(state){if("object"!=typeof state)return state;let newState={};for(let prop in state){let val=state[prop];newState[prop]=val instanceof Array?val.slice():val}return newState}const IndentedFrom=new WeakMap;class StreamLanguage extends Language{constructor(parser){let self,data=defineLanguageFacet(parser.languageData),p=function fullParser(spec){return{name:spec.name||"",token:spec.token,blankLine:spec.blankLine||(()=>{}),startState:spec.startState||(()=>!0),copyState:spec.copyState||defaultCopyState,indent:spec.indent||(()=>null),languageData:spec.languageData||{},tokenTable:spec.tokenTable||noTokens}}(parser);super(data,new class extends _lezer_common__WEBPACK_IMPORTED_MODULE_0__.iX{createParse(input,fragments,ranges){return new Parse(self,input,fragments,ranges)}},[],parser.name),this.topNode=function docID(data,lang){let type=_lezer_common__WEBPACK_IMPORTED_MODULE_0__.Z6.define({id:typeArray.length,name:"Document",props:[languageDataProp.add((()=>data)),indentNodeProp.add((()=>cx=>lang.getIndent(cx)))],top:!0});return typeArray.push(type),type}(data,this),self=this,this.streamParser=p,this.stateAfter=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY({perNode:!0}),this.tokenTable=parser.tokenTable?new TokenTable(p.tokenTable):defaultTokenTable}static define(spec){return new StreamLanguage(spec)}getIndent(cx){let from,{overrideIndentation}=cx.options;overrideIndentation&&(from=IndentedFrom.get(cx.state),null!=from&&from<cx.pos-1e4&&(from=void 0));let statePos,state,start=findState(this,cx.node.tree,cx.node.from,cx.node.from,null!=from?from:cx.pos);if(start?(state=start.state,statePos=start.pos+1):(state=this.streamParser.startState(cx.unit),statePos=cx.node.from),cx.pos-statePos>1e4)return null;for(;statePos<cx.pos;){let line=cx.state.doc.lineAt(statePos),end=Math.min(cx.pos,line.to);if(line.length){let indentation=overrideIndentation?overrideIndentation(line.from):-1,stream=new StringStream(line.text,cx.state.tabSize,cx.unit,indentation<0?void 0:indentation);for(;stream.pos<end-line.from;)readToken(this.streamParser.token,stream,state)}else this.streamParser.blankLine(state,cx.unit);if(end==cx.pos)break;statePos=line.to+1}let line=cx.lineAt(cx.pos);return overrideIndentation&&null==from&&IndentedFrom.set(cx.state,line.from),this.streamParser.indent(state,/^\s*(.*)/.exec(line.text)[1],cx)}get allowsNesting(){return!1}}function findState(lang,tree,off,startPos,before){let state=off>=startPos&&off+tree.length<=before&&tree.prop(lang.stateAfter);if(state)return{state:lang.streamParser.copyState(state),pos:off+tree.length};for(let i=tree.children.length-1;i>=0;i--){let child=tree.children[i],pos=off+tree.positions[i],found=child instanceof _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH&&pos<before&&findState(lang,child,pos,startPos,before);if(found)return found}return null}function cutTree(lang,tree,from,to,inside){if(inside&&from<=0&&to>=tree.length)return tree;inside||0!=from||tree.type!=lang.topNode||(inside=!0);for(let i=tree.children.length-1;i>=0;i--){let inner,pos=tree.positions[i],child=tree.children[i];if(pos<to&&child instanceof _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH){if(!(inner=cutTree(lang,child,from-pos,to-pos,inside)))break;return inside?new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH(tree.type,tree.children.slice(0,i).concat(inner),tree.positions.slice(0,i+1),pos+inner.length):inner}}return null}class Parse{constructor(lang,input,fragments,ranges){this.lang=lang,this.input=input,this.fragments=fragments,this.ranges=ranges,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=ranges[ranges.length-1].to;let context=ParseContext.get(),from=ranges[0].from,{state,tree}=function findStartInFragments(lang,fragments,startPos,endPos,editorState){for(let f of fragments){let tree,from=f.from+(f.openStart?25:0),to=f.to-(f.openEnd?25:0),found=from<=startPos&&to>startPos&&findState(lang,f.tree,0-f.offset,startPos,to);if(found&&found.pos<=endPos&&(tree=cutTree(lang,f.tree,startPos+f.offset,found.pos+f.offset,!1)))return{state:found.state,tree}}return{state:lang.streamParser.startState(editorState?getIndentUnit(editorState):4),tree:_lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH.empty}}(lang,fragments,from,this.to,null==context?void 0:context.state);this.state=state,this.parsedPos=this.chunkStart=from+tree.length;for(let i=0;i<tree.children.length;i++)this.chunks.push(tree.children[i]),this.chunkPos.push(tree.positions[i]);context&&this.parsedPos<context.viewport.from-1e5&&ranges.some((r=>r.from<=context.viewport.from&&r.to>=context.viewport.from))&&(this.state=this.lang.streamParser.startState(getIndentUnit(context.state)),context.skipUntilInView(this.parsedPos,context.viewport.from),this.parsedPos=context.viewport.from),this.moveRangeIndex()}advance(){let context=ParseContext.get(),parseEnd=null==this.stoppedAt?this.to:Math.min(this.to,this.stoppedAt),end=Math.min(parseEnd,this.chunkStart+2048);for(context&&(end=Math.min(end,context.viewport.to));this.parsedPos<end;)this.parseLine(context);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=parseEnd?this.finish():context&&this.parsedPos>=context.viewport.to?(context.skipUntilInView(this.parsedPos,parseEnd),this.finish()):null}stopAt(pos){this.stoppedAt=pos}lineAfter(pos){let chunk=this.input.chunk(pos);if(this.input.lineChunks)"\n"==chunk&&(chunk="");else{let eol=chunk.indexOf("\n");eol>-1&&(chunk=chunk.slice(0,eol))}return pos+chunk.length<=this.to?chunk:chunk.slice(0,this.to-pos)}nextLine(){let from=this.parsedPos,line=this.lineAfter(from),end=from+line.length;for(let index=this.rangeIndex;;){let rangeEnd=this.ranges[index].to;if(rangeEnd>=end)break;if(line=line.slice(0,rangeEnd-(end-line.length)),index++,index==this.ranges.length)break;let rangeStart=this.ranges[index].from,after=this.lineAfter(rangeStart);line+=after,end=rangeStart+after.length}return{line,end}}skipGapsTo(pos,offset,side){for(;;){let end=this.ranges[this.rangeIndex].to,offPos=pos+offset;if(side>0?end>offPos:end>=offPos)break;offset+=this.ranges[++this.rangeIndex].from-end}return offset}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(id,from,to,offset){let size=4;if(this.ranges.length>1){from+=offset=this.skipGapsTo(from,offset,1);let len0=this.chunk.length;to+=offset=this.skipGapsTo(to,offset,-1),size+=this.chunk.length-len0}let last=this.chunk.length-4;return 4==size&&last>=0&&this.chunk[last]==id&&this.chunk[last+2]==from?this.chunk[last+2]=to:this.chunk.push(id,from,to,size),offset}parseLine(context){let{line,end}=this.nextLine(),offset=0,{streamParser}=this.lang,stream=new StringStream(line,context?context.state.tabSize:4,context?getIndentUnit(context.state):2);if(stream.eol())streamParser.blankLine(this.state,stream.indentUnit);else for(;!stream.eol();){let token=readToken(streamParser.token,stream,this.state);if(token&&(offset=this.emitToken(this.lang.tokenTable.resolve(token),this.parsedPos+stream.start,this.parsedPos+stream.pos,offset)),stream.start>1e4)break}this.parsedPos=end,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let tree=_lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet,topID:0,maxBufferLength:2048,reused:this.chunkReused});tree=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH(tree.type,tree.children,tree.positions,tree.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(tree),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.PH(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function readToken(token,stream,state){stream.start=stream.pos;for(let i=0;i<10;i++){let result=token(stream,state);if(stream.pos>stream.start)return result}throw new Error("Stream parser failed to advance stream.")}const noTokens=Object.create(null),typeArray=[_lezer_common__WEBPACK_IMPORTED_MODULE_0__.Z6.none],nodeSet=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.fI(typeArray),warned=[],byTag=Object.create(null),defaultTable=Object.create(null);for(let[legacyName,name]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[legacyName]=createTokenType(noTokens,name);class TokenTable{constructor(extra){this.extra=extra,this.table=Object.assign(Object.create(null),defaultTable)}resolve(tag){return tag?this.table[tag]||(this.table[tag]=createTokenType(this.extra,tag)):0}}const defaultTokenTable=new TokenTable(noTokens);function warnForPart(part,msg){warned.indexOf(part)>-1||(warned.push(part),console.warn(msg))}function createTokenType(extra,tagStr){let tags$1=[];for(let name of tagStr.split(" ")){let found=[];for(let part of name.split(".")){let value=extra[part]||_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__._A[part];value?"function"==typeof value?found.length?found=found.map(value):warnForPart(part,`Modifier ${part} used at start of tag`):found.length?warnForPart(part,`Tag ${part} used as modifier`):found=Array.isArray(value)?value:[value]:warnForPart(part,`Unknown highlighting tag ${part}`)}for(let tag of found)tags$1.push(tag)}if(!tags$1.length)return 0;let name=tagStr.replace(/ /g,"_"),key=name+" "+tags$1.map((t=>t.id)),known=byTag[key];if(known)return known.id;let type=byTag[key]=_lezer_common__WEBPACK_IMPORTED_MODULE_0__.Z6.define({id:typeArray.length,name,props:[(0,_lezer_highlight__WEBPACK_IMPORTED_MODULE_1__.pn)({[name]:tags$1})]});return typeArray.push(type),type.id}_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.OP.RTL,_codemirror_view__WEBPACK_IMPORTED_MODULE_4__.OP.LTR},"./node_modules/@codemirror/state/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{YH:()=>Annotation,Gu:()=>ChangeDesc,VR:()=>ChangeSet,Je:()=>CharCategory,xx:()=>Compartment,OF:()=>EditorSelection,$t:()=>EditorState,sj:()=>Facet,iR:()=>MapMode,Nb:()=>Prec,om:()=>RangeSet,vB:()=>RangeSetBuilder,FB:()=>RangeValue,Pe:()=>StateEffect,sU:()=>StateField,EY:()=>Text,ZX:()=>Transaction,vS:()=>dist_codePointAt,Fh:()=>dist_codePointSize,QR:()=>combineConfig,y$:()=>countColumn,zK:()=>dist_findClusterBreak,kn:()=>findColumn,MK:()=>fromCodePoint});let rangeFrom=[],rangeTo=[];function isExtendingChar(code){if(code<768)return!1;for(let from=0,to=rangeFrom.length;;){let mid=from+to>>1;if(code<rangeFrom[mid])to=mid;else{if(!(code>=rangeTo[mid]))return!0;from=mid+1}if(from==to)return!1}}function isRegionalIndicator(code){return code>=127462&&code<=127487}(()=>{let numbers="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((s=>s?parseInt(s,36):1));for(let i=0,n=0;i<numbers.length;i++)(i%2?rangeTo:rangeFrom).push(n+=numbers[i])})();const ZWJ=8205;function findClusterBreak(str,pos,forward=!0,includeExtending=!0){return(forward?nextClusterBreak:prevClusterBreak)(str,pos,includeExtending)}function nextClusterBreak(str,pos,includeExtending){if(pos==str.length)return pos;pos&&surrogateLow(str.charCodeAt(pos))&&surrogateHigh(str.charCodeAt(pos-1))&&pos--;let prev=codePointAt(str,pos);for(pos+=codePointSize(prev);pos<str.length;){let next=codePointAt(str,pos);if(prev==ZWJ||next==ZWJ||includeExtending&&isExtendingChar(next))pos+=codePointSize(next),prev=next;else{if(!isRegionalIndicator(next))break;{let countBefore=0,i=pos-2;for(;i>=0&&isRegionalIndicator(codePointAt(str,i));)countBefore++,i-=2;if(countBefore%2==0)break;pos+=2}}}return pos}function prevClusterBreak(str,pos,includeExtending){for(;pos>0;){let found=nextClusterBreak(str,pos-2,includeExtending);if(found<pos)return found;pos--}return 0}function codePointAt(str,pos){let code0=str.charCodeAt(pos);if(!surrogateHigh(code0)||pos+1==str.length)return code0;let code1=str.charCodeAt(pos+1);return surrogateLow(code1)?code1-56320+(code0-55296<<10)+65536:code0}function surrogateLow(ch){return ch>=56320&&ch<57344}function surrogateHigh(ch){return ch>=55296&&ch<56320}function codePointSize(code){return code<65536?1:2}class Text{lineAt(pos){if(pos<0||pos>this.length)throw new RangeError(`Invalid position ${pos} in document of length ${this.length}`);return this.lineInner(pos,!1,1,0)}line(n){if(n<1||n>this.lines)throw new RangeError(`Invalid line number ${n} in ${this.lines}-line document`);return this.lineInner(n,!0,1,0)}replace(from,to,text){[from,to]=clip(this,from,to);let parts=[];return this.decompose(0,from,parts,2),text.length&&text.decompose(0,text.length,parts,3),this.decompose(to,this.length,parts,1),TextNode.from(parts,this.length-(to-from)+text.length)}append(other){return this.replace(this.length,this.length,other)}slice(from,to=this.length){[from,to]=clip(this,from,to);let parts=[];return this.decompose(from,to,parts,0),TextNode.from(parts,to-from)}eq(other){if(other==this)return!0;if(other.length!=this.length||other.lines!=this.lines)return!1;let start=this.scanIdentical(other,1),end=this.length-this.scanIdentical(other,-1),a=new RawTextCursor(this),b=new RawTextCursor(other);for(let skip=start,pos=start;;){if(a.next(skip),b.next(skip),skip=0,a.lineBreak!=b.lineBreak||a.done!=b.done||a.value!=b.value)return!1;if(pos+=a.value.length,a.done||pos>=end)return!0}}iter(dir=1){return new RawTextCursor(this,dir)}iterRange(from,to=this.length){return new PartialTextCursor(this,from,to)}iterLines(from,to){let inner;if(null==from)inner=this.iter();else{null==to&&(to=this.lines+1);let start=this.line(from).from;inner=this.iterRange(start,Math.max(start,to==this.lines+1?this.length:to<=1?0:this.line(to-1).to))}return new LineCursor(inner)}toString(){return this.sliceString(0)}toJSON(){let lines=[];return this.flatten(lines),lines}constructor(){}static of(text){if(0==text.length)throw new RangeError("A document must have at least one line");return 1!=text.length||text[0]?text.length<=32?new TextLeaf(text):TextNode.from(TextLeaf.split(text,[])):Text.empty}}class TextLeaf extends Text{constructor(text,length=function textLength(text){let length=-1;for(let line of text)length+=line.length+1;return length}(text)){super(),this.text=text,this.length=length}get lines(){return this.text.length}get children(){return null}lineInner(target,isLine,line,offset){for(let i=0;;i++){let string=this.text[i],end=offset+string.length;if((isLine?line:end)>=target)return new Line(offset,end,line,string);offset=end+1,line++}}decompose(from,to,target,open){let text=from<=0&&to>=this.length?this:new TextLeaf(sliceText(this.text,from,to),Math.min(to,this.length)-Math.max(0,from));if(1&open){let prev=target.pop(),joined=appendText(text.text,prev.text.slice(),0,text.length);if(joined.length<=32)target.push(new TextLeaf(joined,prev.length+text.length));else{let mid=joined.length>>1;target.push(new TextLeaf(joined.slice(0,mid)),new TextLeaf(joined.slice(mid)))}}else target.push(text)}replace(from,to,text){if(!(text instanceof TextLeaf))return super.replace(from,to,text);[from,to]=clip(this,from,to);let lines=appendText(this.text,appendText(text.text,sliceText(this.text,0,from)),to),newLen=this.length+text.length-(to-from);return lines.length<=32?new TextLeaf(lines,newLen):TextNode.from(TextLeaf.split(lines,[]),newLen)}sliceString(from,to=this.length,lineSep="\n"){[from,to]=clip(this,from,to);let result="";for(let pos=0,i=0;pos<=to&&i<this.text.length;i++){let line=this.text[i],end=pos+line.length;pos>from&&i&&(result+=lineSep),from<end&&to>pos&&(result+=line.slice(Math.max(0,from-pos),to-pos)),pos=end+1}return result}flatten(target){for(let line of this.text)target.push(line)}scanIdentical(){return 0}static split(text,target){let part=[],len=-1;for(let line of text)part.push(line),len+=line.length+1,32==part.length&&(target.push(new TextLeaf(part,len)),part=[],len=-1);return len>-1&&target.push(new TextLeaf(part,len)),target}}class TextNode extends Text{constructor(children,length){super(),this.children=children,this.length=length,this.lines=0;for(let child of children)this.lines+=child.lines}lineInner(target,isLine,line,offset){for(let i=0;;i++){let child=this.children[i],end=offset+child.length,endLine=line+child.lines-1;if((isLine?endLine:end)>=target)return child.lineInner(target,isLine,line,offset);offset=end+1,line=endLine+1}}decompose(from,to,target,open){for(let i=0,pos=0;pos<=to&&i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(from<=end&&to>=pos){let childOpen=open&((pos<=from?1:0)|(end>=to?2:0));pos>=from&&end<=to&&!childOpen?target.push(child):child.decompose(from-pos,to-pos,target,childOpen)}pos=end+1}}replace(from,to,text){if([from,to]=clip(this,from,to),text.lines<this.lines)for(let i=0,pos=0;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(from>=pos&&to<=end){let updated=child.replace(from-pos,to-pos,text),totalLines=this.lines-child.lines+updated.lines;if(updated.lines<totalLines>>4&&updated.lines>totalLines>>6){let copy=this.children.slice();return copy[i]=updated,new TextNode(copy,this.length-(to-from)+text.length)}return super.replace(pos,end,updated)}pos=end+1}return super.replace(from,to,text)}sliceString(from,to=this.length,lineSep="\n"){[from,to]=clip(this,from,to);let result="";for(let i=0,pos=0;i<this.children.length&&pos<=to;i++){let child=this.children[i],end=pos+child.length;pos>from&&i&&(result+=lineSep),from<end&&to>pos&&(result+=child.sliceString(from-pos,to-pos,lineSep)),pos=end+1}return result}flatten(target){for(let child of this.children)child.flatten(target)}scanIdentical(other,dir){if(!(other instanceof TextNode))return 0;let length=0,[iA,iB,eA,eB]=dir>0?[0,0,this.children.length,other.children.length]:[this.children.length-1,other.children.length-1,-1,-1];for(;;iA+=dir,iB+=dir){if(iA==eA||iB==eB)return length;let chA=this.children[iA],chB=other.children[iB];if(chA!=chB)return length+chA.scanIdentical(chB,dir);length+=chA.length+1}}static from(children,length=children.reduce(((l,ch)=>l+ch.length+1),-1)){let lines=0;for(let ch of children)lines+=ch.lines;if(lines<32){let flat=[];for(let ch of children)ch.flatten(flat);return new TextLeaf(flat,length)}let chunk=Math.max(32,lines>>5),maxChunk=chunk<<1,minChunk=chunk>>1,chunked=[],currentLines=0,currentLen=-1,currentChunk=[];function add(child){let last;if(child.lines>maxChunk&&child instanceof TextNode)for(let node of child.children)add(node);else child.lines>minChunk&&(currentLines>minChunk||!currentLines)?(flush(),chunked.push(child)):child instanceof TextLeaf&&currentLines&&(last=currentChunk[currentChunk.length-1])instanceof TextLeaf&&child.lines+last.lines<=32?(currentLines+=child.lines,currentLen+=child.length+1,currentChunk[currentChunk.length-1]=new TextLeaf(last.text.concat(child.text),last.length+1+child.length)):(currentLines+child.lines>chunk&&flush(),currentLines+=child.lines,currentLen+=child.length+1,currentChunk.push(child))}function flush(){0!=currentLines&&(chunked.push(1==currentChunk.length?currentChunk[0]:TextNode.from(currentChunk,currentLen)),currentLen=-1,currentLines=currentChunk.length=0)}for(let child of children)add(child);return flush(),1==chunked.length?chunked[0]:new TextNode(chunked,length)}}function appendText(text,target,from=0,to=1e9){for(let pos=0,i=0,first=!0;i<text.length&&pos<=to;i++){let line=text[i],end=pos+line.length;end>=from&&(end>to&&(line=line.slice(0,to-pos)),pos<from&&(line=line.slice(from-pos)),first?(target[target.length-1]+=line,first=!1):target.push(line)),pos=end+1}return target}function sliceText(text,from,to){return appendText(text,[""],from,to)}Text.empty=new TextLeaf([""],0);class RawTextCursor{constructor(text,dir=1){this.dir=dir,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[text],this.offsets=[dir>0?1:(text instanceof TextLeaf?text.text.length:text.children.length)<<1]}nextInner(skip,dir){for(this.done=this.lineBreak=!1;;){let last=this.nodes.length-1,top=this.nodes[last],offsetValue=this.offsets[last],offset=offsetValue>>1,size=top instanceof TextLeaf?top.text.length:top.children.length;if(offset==(dir>0?size:0)){if(0==last)return this.done=!0,this.value="",this;dir>0&&this.offsets[last-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&offsetValue)==(dir>0?0:1)){if(this.offsets[last]+=dir,0==skip)return this.lineBreak=!0,this.value="\n",this;skip--}else if(top instanceof TextLeaf){let next=top.text[offset+(dir<0?-1:0)];if(this.offsets[last]+=dir,next.length>Math.max(0,skip))return this.value=0==skip?next:dir>0?next.slice(skip):next.slice(0,next.length-skip),this;skip-=next.length}else{let next=top.children[offset+(dir<0?-1:0)];skip>next.length?(skip-=next.length,this.offsets[last]+=dir):(dir<0&&this.offsets[last]--,this.nodes.push(next),this.offsets.push(dir>0?1:(next instanceof TextLeaf?next.text.length:next.children.length)<<1))}}}next(skip=0){return skip<0&&(this.nextInner(-skip,-this.dir),skip=this.value.length),this.nextInner(skip,this.dir)}}class PartialTextCursor{constructor(text,start,end){this.value="",this.done=!1,this.cursor=new RawTextCursor(text,start>end?-1:1),this.pos=start>end?text.length:0,this.from=Math.min(start,end),this.to=Math.max(start,end)}nextInner(skip,dir){if(dir<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;skip+=Math.max(0,dir<0?this.pos-this.to:this.from-this.pos);let limit=dir<0?this.pos-this.from:this.to-this.pos;skip>limit&&(skip=limit),limit-=skip;let{value}=this.cursor.next(skip);return this.pos+=(value.length+skip)*dir,this.value=value.length<=limit?value:dir<0?value.slice(value.length-limit):value.slice(0,limit),this.done=!this.value,this}next(skip=0){return skip<0?skip=Math.max(skip,this.from-this.pos):skip>0&&(skip=Math.min(skip,this.to-this.pos)),this.nextInner(skip,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class LineCursor{constructor(inner){this.inner=inner,this.afterBreak=!0,this.value="",this.done=!1}next(skip=0){let{done,lineBreak,value}=this.inner.next(skip);return done&&this.afterBreak?(this.value="",this.afterBreak=!1):done?(this.done=!0,this.value=""):lineBreak?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=value,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(from,to,number,text){this.from=from,this.to=to,this.number=number,this.text=text}get length(){return this.to-this.from}}function clip(text,from,to){return[from=Math.max(0,Math.min(text.length,from)),Math.max(from,Math.min(text.length,to))]}function dist_findClusterBreak(str,pos,forward=!0,includeExtending=!0){return findClusterBreak(str,pos,forward,includeExtending)}function dist_codePointAt(str,pos){let code0=str.charCodeAt(pos);if(!function dist_surrogateHigh(ch){return ch>=55296&&ch<56320}(code0)||pos+1==str.length)return code0;let code1=str.charCodeAt(pos+1);return function dist_surrogateLow(ch){return ch>=56320&&ch<57344}(code1)?code1-56320+(code0-55296<<10)+65536:code0}function fromCodePoint(code){return code<=65535?String.fromCharCode(code):(code-=65536,String.fromCharCode(55296+(code>>10),56320+(1023&code)))}function dist_codePointSize(code){return code<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(MapMode){return MapMode[MapMode.Simple=0]="Simple",MapMode[MapMode.TrackDel=1]="TrackDel",MapMode[MapMode.TrackBefore=2]="TrackBefore",MapMode[MapMode.TrackAfter=3]="TrackAfter",MapMode}(MapMode||(MapMode={}));class ChangeDesc{constructor(sections){this.sections=sections}get length(){let result=0;for(let i=0;i<this.sections.length;i+=2)result+=this.sections[i];return result}get newLength(){let result=0;for(let i=0;i<this.sections.length;i+=2){let ins=this.sections[i+1];result+=ins<0?this.sections[i]:ins}return result}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(f){for(let i=0,posA=0,posB=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++];ins<0?(f(posA,posB,len),posB+=len):posB+=ins,posA+=len}}iterChangedRanges(f,individual=!1){iterChanges(this,f,individual)}get invertedDesc(){let sections=[];for(let i=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++];ins<0?sections.push(len,ins):sections.push(ins,len)}return new ChangeDesc(sections)}composeDesc(other){return this.empty?other:other.empty?this:composeSets(this,other)}mapDesc(other,before=!1){return other.empty?this:mapSet(this,other,before)}mapPos(pos,assoc=-1,mode=MapMode.Simple){let posA=0,posB=0;for(let i=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++],endA=posA+len;if(ins<0){if(endA>pos)return posB+(pos-posA);posB+=len}else{if(mode!=MapMode.Simple&&endA>=pos&&(mode==MapMode.TrackDel&&posA<pos&&endA>pos||mode==MapMode.TrackBefore&&posA<pos||mode==MapMode.TrackAfter&&endA>pos))return null;if(endA>pos||endA==pos&&assoc<0&&!len)return pos==posA||assoc<0?posB:posB+ins;posB+=ins}posA=endA}if(pos>posA)throw new RangeError(`Position ${pos} is out of range for changeset of length ${posA}`);return posB}touchesRange(from,to=from){for(let i=0,pos=0;i<this.sections.length&&pos<=to;){let end=pos+this.sections[i++];if(this.sections[i++]>=0&&pos<=to&&end>=from)return!(pos<from&&end>to)||"cover";pos=end}return!1}toString(){let result="";for(let i=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++];result+=(result?" ":"")+len+(ins>=0?":"+ins:"")}return result}toJSON(){return this.sections}static fromJSON(json){if(!Array.isArray(json)||json.length%2||json.some((a=>"number"!=typeof a)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(json)}static create(sections){return new ChangeDesc(sections)}}class ChangeSet extends ChangeDesc{constructor(sections,inserted){super(sections),this.inserted=inserted}apply(doc){if(this.length!=doc.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,((fromA,toA,fromB,_toB,text)=>doc=doc.replace(fromB,fromB+(toA-fromA),text)),!1),doc}mapDesc(other,before=!1){return mapSet(this,other,before,!0)}invert(doc){let sections=this.sections.slice(),inserted=[];for(let i=0,pos=0;i<sections.length;i+=2){let len=sections[i],ins=sections[i+1];if(ins>=0){sections[i]=ins,sections[i+1]=len;let index=i>>1;for(;inserted.length<index;)inserted.push(Text.empty);inserted.push(len?doc.slice(pos,pos+len):Text.empty)}pos+=len}return new ChangeSet(sections,inserted)}compose(other){return this.empty?other:other.empty?this:composeSets(this,other,!0)}map(other,before=!1){return other.empty?this:mapSet(this,other,before,!0)}iterChanges(f,individual=!1){iterChanges(this,f,individual)}get desc(){return ChangeDesc.create(this.sections)}filter(ranges){let resultSections=[],resultInserted=[],filteredSections=[],iter=new SectionIter(this);done:for(let i=0,pos=0;;){let next=i==ranges.length?1e9:ranges[i++];for(;pos<next||pos==next&&0==iter.len;){if(iter.done)break done;let len=Math.min(iter.len,next-pos);addSection(filteredSections,len,-1);let ins=-1==iter.ins?-1:0==iter.off?iter.ins:0;addSection(resultSections,len,ins),ins>0&&addInsert(resultInserted,resultSections,iter.text),iter.forward(len),pos+=len}let end=ranges[i++];for(;pos<end;){if(iter.done)break done;let len=Math.min(iter.len,end-pos);addSection(resultSections,len,-1),addSection(filteredSections,len,-1==iter.ins?-1:0==iter.off?iter.ins:0),iter.forward(len),pos+=len}}return{changes:new ChangeSet(resultSections,resultInserted),filtered:ChangeDesc.create(filteredSections)}}toJSON(){let parts=[];for(let i=0;i<this.sections.length;i+=2){let len=this.sections[i],ins=this.sections[i+1];ins<0?parts.push(len):0==ins?parts.push([len]):parts.push([len].concat(this.inserted[i>>1].toJSON()))}return parts}static of(changes,length,lineSep){let sections=[],inserted=[],pos=0,total=null;function flush(force=!1){if(!force&&!sections.length)return;pos<length&&addSection(sections,length-pos,-1);let set=new ChangeSet(sections,inserted);total=total?total.compose(set.map(total)):set,sections=[],inserted=[],pos=0}return function process(spec){if(Array.isArray(spec))for(let sub of spec)process(sub);else if(spec instanceof ChangeSet){if(spec.length!=length)throw new RangeError(`Mismatched change set length (got ${spec.length}, expected ${length})`);flush(),total=total?total.compose(spec.map(total)):spec}else{let{from,to=from,insert}=spec;if(from>to||from<0||to>length)throw new RangeError(`Invalid change range ${from} to ${to} (in doc of length ${length})`);let insText=insert?"string"==typeof insert?Text.of(insert.split(lineSep||DefaultSplit)):insert:Text.empty,insLen=insText.length;if(from==to&&0==insLen)return;from<pos&&flush(),from>pos&&addSection(sections,from-pos,-1),addSection(sections,to-from,insLen),addInsert(inserted,sections,insText),pos=to}}(changes),flush(!total),total}static empty(length){return new ChangeSet(length?[length,-1]:[],[])}static fromJSON(json){if(!Array.isArray(json))throw new RangeError("Invalid JSON representation of ChangeSet");let sections=[],inserted=[];for(let i=0;i<json.length;i++){let part=json[i];if("number"==typeof part)sections.push(part,-1);else{if(!Array.isArray(part)||"number"!=typeof part[0]||part.some(((e,i)=>i&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==part.length)sections.push(part[0],0);else{for(;inserted.length<i;)inserted.push(Text.empty);inserted[i]=Text.of(part.slice(1)),sections.push(part[0],inserted[i].length)}}}return new ChangeSet(sections,inserted)}static createSet(sections,inserted){return new ChangeSet(sections,inserted)}}function addSection(sections,len,ins,forceJoin=!1){if(0==len&&ins<=0)return;let last=sections.length-2;last>=0&&ins<=0&&ins==sections[last+1]?sections[last]+=len:last>=0&&0==len&&0==sections[last]?sections[last+1]+=ins:forceJoin?(sections[last]+=len,sections[last+1]+=ins):sections.push(len,ins)}function addInsert(values,sections,value){if(0==value.length)return;let index=sections.length-2>>1;if(index<values.length)values[values.length-1]=values[values.length-1].append(value);else{for(;values.length<index;)values.push(Text.empty);values.push(value)}}function iterChanges(desc,f,individual){let inserted=desc.inserted;for(let posA=0,posB=0,i=0;i<desc.sections.length;){let len=desc.sections[i++],ins=desc.sections[i++];if(ins<0)posA+=len,posB+=len;else{let endA=posA,endB=posB,text=Text.empty;for(;endA+=len,endB+=ins,ins&&inserted&&(text=text.append(inserted[i-2>>1])),!(individual||i==desc.sections.length||desc.sections[i+1]<0);)len=desc.sections[i++],ins=desc.sections[i++];f(posA,endA,posB,endB,text),posA=endA,posB=endB}}}function mapSet(setA,setB,before,mkSet=!1){let sections=[],insert=mkSet?[]:null,a=new SectionIter(setA),b=new SectionIter(setB);for(let inserted=-1;;){if(a.done&&b.len||b.done&&a.len)throw new Error("Mismatched change set lengths");if(-1==a.ins&&-1==b.ins){let len=Math.min(a.len,b.len);addSection(sections,len,-1),a.forward(len),b.forward(len)}else if(b.ins>=0&&(a.ins<0||inserted==a.i||0==a.off&&(b.len<a.len||b.len==a.len&&!before))){let len=b.len;for(addSection(sections,b.ins,-1);len;){let piece=Math.min(a.len,len);a.ins>=0&&inserted<a.i&&a.len<=piece&&(addSection(sections,0,a.ins),insert&&addInsert(insert,sections,a.text),inserted=a.i),a.forward(piece),len-=piece}b.next()}else{if(!(a.ins>=0)){if(a.done&&b.done)return insert?ChangeSet.createSet(sections,insert):ChangeDesc.create(sections);throw new Error("Mismatched change set lengths")}{let len=0,left=a.len;for(;left;)if(-1==b.ins){let piece=Math.min(left,b.len);len+=piece,left-=piece,b.forward(piece)}else{if(!(0==b.ins&&b.len<left))break;left-=b.len,b.next()}addSection(sections,len,inserted<a.i?a.ins:0),insert&&inserted<a.i&&addInsert(insert,sections,a.text),inserted=a.i,a.forward(a.len-left)}}}}function composeSets(setA,setB,mkSet=!1){let sections=[],insert=mkSet?[]:null,a=new SectionIter(setA),b=new SectionIter(setB);for(let open=!1;;){if(a.done&&b.done)return insert?ChangeSet.createSet(sections,insert):ChangeDesc.create(sections);if(0==a.ins)addSection(sections,a.len,0,open),a.next();else if(0!=b.len||b.done){if(a.done||b.done)throw new Error("Mismatched change set lengths");{let len=Math.min(a.len2,b.len),sectionLen=sections.length;if(-1==a.ins){let insB=-1==b.ins?-1:b.off?0:b.ins;addSection(sections,len,insB,open),insert&&insB&&addInsert(insert,sections,b.text)}else-1==b.ins?(addSection(sections,a.off?0:a.len,len,open),insert&&addInsert(insert,sections,a.textBit(len))):(addSection(sections,a.off?0:a.len,b.off?0:b.ins,open),insert&&!b.off&&addInsert(insert,sections,b.text));open=(a.ins>len||b.ins>=0&&b.len>len)&&(open||sections.length>sectionLen),a.forward2(len),b.forward(len)}}else addSection(sections,0,b.ins,open),insert&&addInsert(insert,sections,b.text),b.next()}}class SectionIter{constructor(set){this.set=set,this.i=0,this.next()}next(){let{sections}=this.set;this.i<sections.length?(this.len=sections[this.i++],this.ins=sections[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted}=this.set,index=this.i-2>>1;return index>=inserted.length?Text.empty:inserted[index]}textBit(len){let{inserted}=this.set,index=this.i-2>>1;return index>=inserted.length&&!len?Text.empty:inserted[index].slice(this.off,null==len?void 0:this.off+len)}forward(len){len==this.len?this.next():(this.len-=len,this.off+=len)}forward2(len){-1==this.ins?this.forward(len):len==this.ins?this.next():(this.ins-=len,this.off+=len)}}class SelectionRange{constructor(from,to,flags){this.from=from,this.to=to,this.flags=flags}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let level=7&this.flags;return 7==level?null:level}get goalColumn(){let value=this.flags>>6;return 16777215==value?void 0:value}map(change,assoc=-1){let from,to;return this.empty?from=to=change.mapPos(this.from,assoc):(from=change.mapPos(this.from,1),to=change.mapPos(this.to,-1)),from==this.from&&to==this.to?this:new SelectionRange(from,to,this.flags)}extend(from,to=from){if(from<=this.anchor&&to>=this.anchor)return EditorSelection.range(from,to);let head=Math.abs(from-this.anchor)>Math.abs(to-this.anchor)?from:to;return EditorSelection.range(this.anchor,head)}eq(other,includeAssoc=!1){return!(this.anchor!=other.anchor||this.head!=other.head||includeAssoc&&this.empty&&this.assoc!=other.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(json){if(!json||"number"!=typeof json.anchor||"number"!=typeof json.head)throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(json.anchor,json.head)}static create(from,to,flags){return new SelectionRange(from,to,flags)}}class EditorSelection{constructor(ranges,mainIndex){this.ranges=ranges,this.mainIndex=mainIndex}map(change,assoc=-1){return change.empty?this:EditorSelection.create(this.ranges.map((r=>r.map(change,assoc))),this.mainIndex)}eq(other,includeAssoc=!1){if(this.ranges.length!=other.ranges.length||this.mainIndex!=other.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(other.ranges[i],includeAssoc))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new EditorSelection([this.main],0)}addRange(range,main=!0){return EditorSelection.create([range].concat(this.ranges),main?0:this.mainIndex+1)}replaceRange(range,which=this.mainIndex){let ranges=this.ranges.slice();return ranges[which]=range,EditorSelection.create(ranges,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((r=>r.toJSON())),main:this.mainIndex}}static fromJSON(json){if(!json||!Array.isArray(json.ranges)||"number"!=typeof json.main||json.main>=json.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(json.ranges.map((r=>SelectionRange.fromJSON(r))),json.main)}static single(anchor,head=anchor){return new EditorSelection([EditorSelection.range(anchor,head)],0)}static create(ranges,mainIndex=0){if(0==ranges.length)throw new RangeError("A selection needs at least one range");for(let pos=0,i=0;i<ranges.length;i++){let range=ranges[i];if(range.empty?range.from<=pos:range.from<pos)return EditorSelection.normalized(ranges.slice(),mainIndex);pos=range.to}return new EditorSelection(ranges,mainIndex)}static cursor(pos,assoc=0,bidiLevel,goalColumn){return SelectionRange.create(pos,pos,(0==assoc?0:assoc<0?8:16)|(null==bidiLevel?7:Math.min(6,bidiLevel))|(null!=goalColumn?goalColumn:16777215)<<6)}static range(anchor,head,goalColumn,bidiLevel){let flags=(null!=goalColumn?goalColumn:16777215)<<6|(null==bidiLevel?7:Math.min(6,bidiLevel));return head<anchor?SelectionRange.create(head,anchor,48|flags):SelectionRange.create(anchor,head,(head>anchor?8:0)|flags)}static normalized(ranges,mainIndex=0){let main=ranges[mainIndex];ranges.sort(((a,b)=>a.from-b.from)),mainIndex=ranges.indexOf(main);for(let i=1;i<ranges.length;i++){let range=ranges[i],prev=ranges[i-1];if(range.empty?range.from<=prev.to:range.from<prev.to){let from=prev.from,to=Math.max(range.to,prev.to);i<=mainIndex&&mainIndex--,ranges.splice(--i,2,range.anchor>range.head?EditorSelection.range(to,from):EditorSelection.range(from,to))}}return new EditorSelection(ranges,mainIndex)}}function checkSelection(selection,docLength){for(let range of selection.ranges)if(range.to>docLength)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(combine,compareInput,compare,isStatic,enables){this.combine=combine,this.compareInput=compareInput,this.compare=compare,this.isStatic=isStatic,this.id=nextID++,this.default=combine([]),this.extensions="function"==typeof enables?enables(this):enables}get reader(){return this}static define(config={}){return new Facet(config.combine||(a=>a),config.compareInput||((a,b)=>a===b),config.compare||(config.combine?(a,b)=>a===b:sameArray),!!config.static,config.enables)}of(value){return new FacetProvider([],this,0,value)}compute(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,1,get)}computeN(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,2,get)}from(field,get){return get||(get=x=>x),this.compute([field],(state=>get(state.field(field))))}}function sameArray(a,b){return a==b||a.length==b.length&&a.every(((e,i)=>e===b[i]))}class FacetProvider{constructor(dependencies,facet,type,value){this.dependencies=dependencies,this.facet=facet,this.type=type,this.value=value,this.id=nextID++}dynamicSlot(addresses){var _a;let getter=this.value,compare=this.facet.compareInput,id=this.id,idx=addresses[id]>>1,multi=2==this.type,depDoc=!1,depSel=!1,depAddrs=[];for(let dep of this.dependencies)"doc"==dep?depDoc=!0:"selection"==dep?depSel=!0:1&(null!==(_a=addresses[dep.id])&&void 0!==_a?_a:1)||depAddrs.push(addresses[dep.id]);return{create:state=>(state.values[idx]=getter(state),1),update(state,tr){if(depDoc&&tr.docChanged||depSel&&(tr.docChanged||tr.selection)||ensureAll(state,depAddrs)){let newVal=getter(state);if(multi?!compareArray(newVal,state.values[idx],compare):!compare(newVal,state.values[idx]))return state.values[idx]=newVal,1}return 0},reconfigure:(state,oldState)=>{let newVal,oldAddr=oldState.config.address[id];if(null!=oldAddr){let oldVal=getAddr(oldState,oldAddr);if(this.dependencies.every((dep=>dep instanceof Facet?oldState.facet(dep)===state.facet(dep):!(dep instanceof StateField)||oldState.field(dep,!1)==state.field(dep,!1)))||(multi?compareArray(newVal=getter(state),oldVal,compare):compare(newVal=getter(state),oldVal)))return state.values[idx]=oldVal,0}else newVal=getter(state);return state.values[idx]=newVal,1}}}}function compareArray(a,b,compare){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compare(a[i],b[i]))return!1;return!0}function ensureAll(state,addrs){let changed=!1;for(let addr of addrs)1&ensureAddr(state,addr)&&(changed=!0);return changed}function dynamicFacetSlot(addresses,facet,providers){let providerAddrs=providers.map((p=>addresses[p.id])),providerTypes=providers.map((p=>p.type)),dynamic=providerAddrs.filter((p=>!(1&p))),idx=addresses[facet.id]>>1;function get(state){let values=[];for(let i=0;i<providerAddrs.length;i++){let value=getAddr(state,providerAddrs[i]);if(2==providerTypes[i])for(let val of value)values.push(val);else values.push(value)}return facet.combine(values)}return{create(state){for(let addr of providerAddrs)ensureAddr(state,addr);return state.values[idx]=get(state),1},update(state,tr){if(!ensureAll(state,dynamic))return 0;let value=get(state);return facet.compare(value,state.values[idx])?0:(state.values[idx]=value,1)},reconfigure(state,oldState){let depChanged=ensureAll(state,providerAddrs),oldProviders=oldState.config.facets[facet.id],oldValue=oldState.facet(facet);if(oldProviders&&!depChanged&&sameArray(providers,oldProviders))return state.values[idx]=oldValue,0;let value=get(state);return facet.compare(value,oldValue)?(state.values[idx]=oldValue,0):(state.values[idx]=value,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(id,createF,updateF,compareF,spec){this.id=id,this.createF=createF,this.updateF=updateF,this.compareF=compareF,this.spec=spec,this.provides=void 0}static define(config){let field=new StateField(nextID++,config.create,config.update,config.compare||((a,b)=>a===b),config);return config.provide&&(field.provides=config.provide(field)),field}create(state){let init=state.facet(initField).find((i=>i.field==this));return((null==init?void 0:init.create)||this.createF)(state)}slot(addresses){let idx=addresses[this.id]>>1;return{create:state=>(state.values[idx]=this.create(state),1),update:(state,tr)=>{let oldVal=state.values[idx],value=this.updateF(oldVal,tr);return this.compareF(oldVal,value)?0:(state.values[idx]=value,1)},reconfigure:(state,oldState)=>{let reInit,init=state.facet(initField),oldInit=oldState.facet(initField);return(reInit=init.find((i=>i.field==this)))&&reInit!=oldInit.find((i=>i.field==this))?(state.values[idx]=reInit.create(state),1):null!=oldState.config.address[this.id]?(state.values[idx]=oldState.field(this),0):(state.values[idx]=this.create(state),1)}}}init(create){return[this,initField.of({field:this,create})]}get extension(){return this}}const Prec__lowest=4,Prec__low=3,Prec__default=2,Prec__high=1;function prec(value){return ext=>new PrecExtension(ext,value)}const Prec={highest:prec(0),high:prec(Prec__high),default:prec(Prec__default),low:prec(Prec__low),lowest:prec(Prec__lowest)};class PrecExtension{constructor(inner,prec){this.inner=inner,this.prec=prec}}class Compartment{of(ext){return new CompartmentInstance(this,ext)}reconfigure(content){return Compartment.reconfigure.of({compartment:this,extension:content})}get(state){return state.config.compartments.get(this)}}class CompartmentInstance{constructor(compartment,inner){this.compartment=compartment,this.inner=inner}}class Configuration{constructor(base,compartments,dynamicSlots,address,staticValues,facets){for(this.base=base,this.compartments=compartments,this.dynamicSlots=dynamicSlots,this.address=address,this.staticValues=staticValues,this.facets=facets,this.statusTemplate=[];this.statusTemplate.length<dynamicSlots.length;)this.statusTemplate.push(0)}staticFacet(facet){let addr=this.address[facet.id];return null==addr?facet.default:this.staticValues[addr>>1]}static resolve(base,compartments,oldState){let fields=[],facets=Object.create(null),newCompartments=new Map;for(let ext of function flatten(extension,compartments,newCompartments){let result=[[],[],[],[],[]],seen=new Map;function inner(ext,prec){let known=seen.get(ext);if(null!=known){if(known<=prec)return;let found=result[known].indexOf(ext);found>-1&&result[known].splice(found,1),ext instanceof CompartmentInstance&&newCompartments.delete(ext.compartment)}if(seen.set(ext,prec),Array.isArray(ext))for(let e of ext)inner(e,prec);else if(ext instanceof CompartmentInstance){if(newCompartments.has(ext.compartment))throw new RangeError("Duplicate use of compartment in extensions");let content=compartments.get(ext.compartment)||ext.inner;newCompartments.set(ext.compartment,content),inner(content,prec)}else if(ext instanceof PrecExtension)inner(ext.inner,ext.prec);else if(ext instanceof StateField)result[prec].push(ext),ext.provides&&inner(ext.provides,prec);else if(ext instanceof FacetProvider)result[prec].push(ext),ext.facet.extensions&&inner(ext.facet.extensions,Prec__default);else{let content=ext.extension;if(!content)throw new Error(`Unrecognized extension value in extension set (${ext}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);inner(content,prec)}}return inner(extension,Prec__default),result.reduce(((a,b)=>a.concat(b)))}(base,compartments,newCompartments))ext instanceof StateField?fields.push(ext):(facets[ext.facet.id]||(facets[ext.facet.id]=[])).push(ext);let address=Object.create(null),staticValues=[],dynamicSlots=[];for(let field of fields)address[field.id]=dynamicSlots.length<<1,dynamicSlots.push((a=>field.slot(a)));let oldFacets=null==oldState?void 0:oldState.config.facets;for(let id in facets){let providers=facets[id],facet=providers[0].facet,oldProviders=oldFacets&&oldFacets[id]||[];if(providers.every((p=>0==p.type)))if(address[facet.id]=staticValues.length<<1|1,sameArray(oldProviders,providers))staticValues.push(oldState.facet(facet));else{let value=facet.combine(providers.map((p=>p.value)));staticValues.push(oldState&&facet.compare(value,oldState.facet(facet))?oldState.facet(facet):value)}else{for(let p of providers)0==p.type?(address[p.id]=staticValues.length<<1|1,staticValues.push(p.value)):(address[p.id]=dynamicSlots.length<<1,dynamicSlots.push((a=>p.dynamicSlot(a))));address[facet.id]=dynamicSlots.length<<1,dynamicSlots.push((a=>dynamicFacetSlot(a,facet,providers)))}}let dynamic=dynamicSlots.map((f=>f(address)));return new Configuration(base,newCompartments,dynamic,address,staticValues,facets)}}function ensureAddr(state,addr){if(1&addr)return 2;let idx=addr>>1,status=state.status[idx];if(4==status)throw new Error("Cyclic dependency between fields and/or facets");if(2&status)return status;state.status[idx]=4;let changed=state.computeSlot(state,state.config.dynamicSlots[idx]);return state.status[idx]=2|changed}function getAddr(state,addr){return 1&addr?state.config.staticValues[addr>>1]:state.values[addr>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:values=>values.some((v=>v)),static:!0}),lineSeparator=Facet.define({combine:values=>values.length?values[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:values=>!!values.length&&values[0]});class Annotation{constructor(type,value){this.type=type,this.value=value}static define(){return new AnnotationType}}class AnnotationType{of(value){return new Annotation(this,value)}}class StateEffectType{constructor(map){this.map=map}of(value){return new StateEffect(this,value)}}class StateEffect{constructor(type,value){this.type=type,this.value=value}map(mapping){let mapped=this.type.map(this.value,mapping);return void 0===mapped?void 0:mapped==this.value?this:new StateEffect(this.type,mapped)}is(type){return this.type==type}static define(spec={}){return new StateEffectType(spec.map||(v=>v))}static mapEffects(effects,mapping){if(!effects.length)return effects;let result=[];for(let effect of effects){let mapped=effect.map(mapping);mapped&&result.push(mapped)}return result}}StateEffect.reconfigure=StateEffect.define(),StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(startState,changes,selection,effects,annotations,scrollIntoView){this.startState=startState,this.changes=changes,this.selection=selection,this.effects=effects,this.annotations=annotations,this.scrollIntoView=scrollIntoView,this._doc=null,this._state=null,selection&&checkSelection(selection,changes.newLength),annotations.some((a=>a.type==Transaction.time))||(this.annotations=annotations.concat(Transaction.time.of(Date.now())))}static create(startState,changes,selection,effects,annotations,scrollIntoView){return new Transaction(startState,changes,selection,effects,annotations,scrollIntoView)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(type){for(let ann of this.annotations)if(ann.type==type)return ann.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(event){let e=this.annotation(Transaction.userEvent);return!(!e||!(e==event||e.length>event.length&&e.slice(0,event.length)==event&&"."==e[event.length]))}}function joinRanges(a,b){let result=[];for(let iA=0,iB=0;;){let from,to;if(iA<a.length&&(iB==b.length||b[iB]>=a[iA]))from=a[iA++],to=a[iA++];else{if(!(iB<b.length))return result;from=b[iB++],to=b[iB++]}!result.length||result[result.length-1]<from?result.push(from,to):result[result.length-1]<to&&(result[result.length-1]=to)}}function mergeTransaction(a,b,sequential){var _a;let mapForA,mapForB,changes;return sequential?(mapForA=b.changes,mapForB=ChangeSet.empty(b.changes.length),changes=a.changes.compose(b.changes)):(mapForA=b.changes.map(a.changes),mapForB=a.changes.mapDesc(b.changes,!0),changes=a.changes.compose(mapForA)),{changes,selection:b.selection?b.selection.map(mapForB):null===(_a=a.selection)||void 0===_a?void 0:_a.map(mapForA),effects:StateEffect.mapEffects(a.effects,mapForA).concat(StateEffect.mapEffects(b.effects,mapForB)),annotations:a.annotations.length?a.annotations.concat(b.annotations):b.annotations,scrollIntoView:a.scrollIntoView||b.scrollIntoView}}function resolveTransactionInner(state,spec,docSize){let sel=spec.selection,annotations=asArray(spec.annotations);return spec.userEvent&&(annotations=annotations.concat(Transaction.userEvent.of(spec.userEvent))),{changes:spec.changes instanceof ChangeSet?spec.changes:ChangeSet.of(spec.changes||[],docSize,state.facet(lineSeparator)),selection:sel&&(sel instanceof EditorSelection?sel:EditorSelection.single(sel.anchor,sel.head)),effects:asArray(spec.effects),annotations,scrollIntoView:!!spec.scrollIntoView}}function resolveTransaction(state,specs,filter){let s=resolveTransactionInner(state,specs.length?specs[0]:{},state.doc.length);specs.length&&!1===specs[0].filter&&(filter=!1);for(let i=1;i<specs.length;i++){!1===specs[i].filter&&(filter=!1);let seq=!!specs[i].sequential;s=mergeTransaction(s,resolveTransactionInner(state,specs[i],seq?s.changes.newLength:state.doc.length),seq)}let tr=Transaction.create(state,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function extendTransaction(tr){let state=tr.startState,extenders=state.facet(transactionExtender),spec=tr;for(let i=extenders.length-1;i>=0;i--){let extension=extenders[i](tr);extension&&Object.keys(extension).length&&(spec=mergeTransaction(spec,resolveTransactionInner(state,extension,tr.changes.newLength),!0))}return spec==tr?tr:Transaction.create(state,tr.changes,tr.selection,spec.effects,spec.annotations,spec.scrollIntoView)}(filter?function filterTransaction(tr){let state=tr.startState,result=!0;for(let filter of state.facet(changeFilter)){let value=filter(tr);if(!1===value){result=!1;break}Array.isArray(value)&&(result=!0===result?value:joinRanges(result,value))}if(!0!==result){let changes,back;if(!1===result)back=tr.changes.invertedDesc,changes=ChangeSet.empty(state.doc.length);else{let filtered=tr.changes.filter(result);changes=filtered.changes,back=filtered.filtered.mapDesc(filtered.changes).invertedDesc}tr=Transaction.create(state,changes,tr.selection&&tr.selection.map(back),StateEffect.mapEffects(tr.effects,back),tr.annotations,tr.scrollIntoView)}let filters=state.facet(transactionFilter);for(let i=filters.length-1;i>=0;i--){let filtered=filters[i](tr);tr=filtered instanceof Transaction?filtered:Array.isArray(filtered)&&1==filtered.length&&filtered[0]instanceof Transaction?filtered[0]:resolveTransaction(state,asArray(filtered),!1)}return tr}(tr):tr)}Transaction.time=Annotation.define(),Transaction.userEvent=Annotation.define(),Transaction.addToHistory=Annotation.define(),Transaction.remote=Annotation.define();const none=[];function asArray(value){return null==value?none:Array.isArray(value)?value:[value]}var CharCategory=function(CharCategory){return CharCategory[CharCategory.Word=0]="Word",CharCategory[CharCategory.Space=1]="Space",CharCategory[CharCategory.Other=2]="Other",CharCategory}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(_){}function makeCategorizer(wordChars){return char=>{if(!/\S/.test(char))return CharCategory.Space;if(function hasWordChar(str){if(wordChar)return wordChar.test(str);for(let i=0;i<str.length;i++){let ch=str[i];if(/\w/.test(ch)||ch>""&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch)))return!0}return!1}(char))return CharCategory.Word;for(let i=0;i<wordChars.length;i++)if(char.indexOf(wordChars[i])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(config,doc,selection,values,computeSlot,tr){this.config=config,this.doc=doc,this.selection=selection,this.values=values,this.status=config.statusTemplate.slice(),this.computeSlot=computeSlot,tr&&(tr._state=this);for(let i=0;i<this.config.dynamicSlots.length;i++)ensureAddr(this,i<<1);this.computeSlot=null}field(field,require=!0){let addr=this.config.address[field.id];if(null!=addr)return ensureAddr(this,addr),getAddr(this,addr);if(require)throw new RangeError("Field is not present in this state")}update(...specs){return resolveTransaction(this,specs,!0)}applyTransaction(tr){let startValues,conf=this.config,{base,compartments}=conf;for(let effect of tr.effects)effect.is(Compartment.reconfigure)?(conf&&(compartments=new Map,conf.compartments.forEach(((val,key)=>compartments.set(key,val))),conf=null),compartments.set(effect.value.compartment,effect.value.extension)):effect.is(StateEffect.reconfigure)?(conf=null,base=effect.value):effect.is(StateEffect.appendConfig)&&(conf=null,base=asArray(base).concat(effect.value));if(conf)startValues=tr.startState.values.slice();else{conf=Configuration.resolve(base,compartments,this),startValues=new EditorState(conf,this.doc,this.selection,conf.dynamicSlots.map((()=>null)),((state,slot)=>slot.reconfigure(state,this)),null).values}let selection=tr.startState.facet(allowMultipleSelections)?tr.newSelection:tr.newSelection.asSingle();new EditorState(conf,tr.newDoc,selection,startValues,((state,slot)=>slot.update(state,tr)),tr)}replaceSelection(text){return"string"==typeof text&&(text=this.toText(text)),this.changeByRange((range=>({changes:{from:range.from,to:range.to,insert:text},range:EditorSelection.cursor(range.from+text.length)})))}changeByRange(f){let sel=this.selection,result1=f(sel.ranges[0]),changes=this.changes(result1.changes),ranges=[result1.range],effects=asArray(result1.effects);for(let i=1;i<sel.ranges.length;i++){let result=f(sel.ranges[i]),newChanges=this.changes(result.changes),newMapped=newChanges.map(changes);for(let j=0;j<i;j++)ranges[j]=ranges[j].map(newMapped);let mapBy=changes.mapDesc(newChanges,!0);ranges.push(result.range.map(mapBy)),changes=changes.compose(newMapped),effects=StateEffect.mapEffects(effects,newMapped).concat(StateEffect.mapEffects(asArray(result.effects),mapBy))}return{changes,selection:EditorSelection.create(ranges,sel.mainIndex),effects}}changes(spec=[]){return spec instanceof ChangeSet?spec:ChangeSet.of(spec,this.doc.length,this.facet(EditorState.lineSeparator))}toText(string){return Text.of(string.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(from=0,to=this.doc.length){return this.doc.sliceString(from,to,this.lineBreak)}facet(facet){let addr=this.config.address[facet.id];return null==addr?facet.default:(ensureAddr(this,addr),getAddr(this,addr))}toJSON(fields){let result={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(fields)for(let prop in fields){let value=fields[prop];value instanceof StateField&&null!=this.config.address[value.id]&&(result[prop]=value.spec.toJSON(this.field(fields[prop]),this))}return result}static fromJSON(json,config={},fields){if(!json||"string"!=typeof json.doc)throw new RangeError("Invalid JSON representation for EditorState");let fieldInit=[];if(fields)for(let prop in fields)if(Object.prototype.hasOwnProperty.call(json,prop)){let field=fields[prop],value=json[prop];fieldInit.push(field.init((state=>field.spec.fromJSON(value,state))))}return EditorState.create({doc:json.doc,selection:EditorSelection.fromJSON(json.selection),extensions:config.extensions?fieldInit.concat([config.extensions]):fieldInit})}static create(config={}){let configuration=Configuration.resolve(config.extensions||[],new Map),doc=config.doc instanceof Text?config.doc:Text.of((config.doc||"").split(configuration.staticFacet(EditorState.lineSeparator)||DefaultSplit)),selection=config.selection?config.selection instanceof EditorSelection?config.selection:EditorSelection.single(config.selection.anchor,config.selection.head):EditorSelection.single(0);return checkSelection(selection,doc.length),configuration.staticFacet(allowMultipleSelections)||(selection=selection.asSingle()),new EditorState(configuration,doc,selection,configuration.dynamicSlots.map((()=>null)),((state,slot)=>slot.create(state)),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||"\n"}get readOnly(){return this.facet(readOnly)}phrase(phrase,...insert){for(let map of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(map,phrase)){phrase=map[phrase];break}return insert.length&&(phrase=phrase.replace(/\$(\$|\d*)/g,((m,i)=>{if("$"==i)return"$";let n=+(i||1);return!n||n>insert.length?m:insert[n-1]}))),phrase}languageDataAt(name,pos,side=-1){let values=[];for(let provider of this.facet(languageData))for(let result of provider(this,pos,side))Object.prototype.hasOwnProperty.call(result,name)&&values.push(result[name]);return values}charCategorizer(at){return makeCategorizer(this.languageDataAt("wordChars",at).join(""))}wordAt(pos){let{text,from,length}=this.doc.lineAt(pos),cat=this.charCategorizer(pos),start=pos-from,end=pos-from;for(;start>0;){let prev=dist_findClusterBreak(text,start,!1);if(cat(text.slice(prev,start))!=CharCategory.Word)break;start=prev}for(;end<length;){let next=dist_findClusterBreak(text,end);if(cat(text.slice(end,next))!=CharCategory.Word)break;end=next}return start==end?null:EditorSelection.range(start+from,end+from)}}function combineConfig(configs,defaults,combine={}){let result={};for(let config of configs)for(let key of Object.keys(config)){let value=config[key],current=result[key];if(void 0===current)result[key]=value;else if(current===value||void 0===value);else{if(!Object.hasOwnProperty.call(combine,key))throw new Error("Config merge conflict for field "+key);result[key]=combine[key](current,value)}}for(let key in defaults)void 0===result[key]&&(result[key]=defaults[key]);return result}EditorState.allowMultipleSelections=allowMultipleSelections,EditorState.tabSize=Facet.define({combine:values=>values.length?values[0]:4}),EditorState.lineSeparator=lineSeparator,EditorState.readOnly=readOnly,EditorState.phrases=Facet.define({compare(a,b){let kA=Object.keys(a),kB=Object.keys(b);return kA.length==kB.length&&kA.every((k=>a[k]==b[k]))}}),EditorState.languageData=languageData,EditorState.changeFilter=changeFilter,EditorState.transactionFilter=transactionFilter,EditorState.transactionExtender=transactionExtender,Compartment.reconfigure=StateEffect.define();class RangeValue{eq(other){return this==other}range(from,to=from){return Range.create(from,to,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0,RangeValue.prototype.point=!1,RangeValue.prototype.mapMode=MapMode.TrackDel;class Range{constructor(from,to,value){this.from=from,this.to=to,this.value=value}static create(from,to,value){return new Range(from,to,value)}}function cmpRange(a,b){return a.from-b.from||a.value.startSide-b.value.startSide}class Chunk{constructor(from,to,value,maxPoint){this.from=from,this.to=to,this.value=value,this.maxPoint=maxPoint}get length(){return this.to[this.to.length-1]}findIndex(pos,side,end,startAt=0){let arr=end?this.to:this.from;for(let lo=startAt,hi=arr.length;;){if(lo==hi)return lo;let mid=lo+hi>>1,diff=arr[mid]-pos||(end?this.value[mid].endSide:this.value[mid].startSide)-side;if(mid==lo)return diff>=0?lo:hi;diff>=0?hi=mid:lo=mid+1}}between(offset,from,to,f){for(let i=this.findIndex(from,-1e9,!0),e=this.findIndex(to,1e9,!1,i);i<e;i++)if(!1===f(this.from[i]+offset,this.to[i]+offset,this.value[i]))return!1}map(offset,changes){let value=[],from=[],to=[],newPos=-1,maxPoint=-1;for(let i=0;i<this.value.length;i++){let newFrom,newTo,val=this.value[i],curFrom=this.from[i]+offset,curTo=this.to[i]+offset;if(curFrom==curTo){let mapped=changes.mapPos(curFrom,val.startSide,val.mapMode);if(null==mapped)continue;if(newFrom=newTo=mapped,val.startSide!=val.endSide&&(newTo=changes.mapPos(curFrom,val.endSide),newTo<newFrom))continue}else if(newFrom=changes.mapPos(curFrom,val.startSide),newTo=changes.mapPos(curTo,val.endSide),newFrom>newTo||newFrom==newTo&&val.startSide>0&&val.endSide<=0)continue;(newTo-newFrom||val.endSide-val.startSide)<0||(newPos<0&&(newPos=newFrom),val.point&&(maxPoint=Math.max(maxPoint,newTo-newFrom)),value.push(val),from.push(newFrom-newPos),to.push(newTo-newPos))}return{mapped:value.length?new Chunk(from,to,value,maxPoint):null,pos:newPos}}}class RangeSet{constructor(chunkPos,chunk,nextLayer,maxPoint){this.chunkPos=chunkPos,this.chunk=chunk,this.nextLayer=nextLayer,this.maxPoint=maxPoint}static create(chunkPos,chunk,nextLayer,maxPoint){return new RangeSet(chunkPos,chunk,nextLayer,maxPoint)}get length(){let last=this.chunk.length-1;return last<0?0:Math.max(this.chunkEnd(last),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let size=this.nextLayer.size;for(let chunk of this.chunk)size+=chunk.value.length;return size}chunkEnd(index){return this.chunkPos[index]+this.chunk[index].length}update(updateSpec){let{add=[],sort=!1,filterFrom=0,filterTo=this.length}=updateSpec,filter=updateSpec.filter;if(0==add.length&&!filter)return this;if(sort&&(add=add.slice().sort(cmpRange)),this.isEmpty)return add.length?RangeSet.of(add):this;let cur=new LayerCursor(this,null,-1).goto(0),i=0,spill=[],builder=new RangeSetBuilder;for(;cur.value||i<add.length;)if(i<add.length&&(cur.from-add[i].from||cur.startSide-add[i].value.startSide)>=0){let range=add[i++];builder.addInner(range.from,range.to,range.value)||spill.push(range)}else 1==cur.rangeIndex&&cur.chunkIndex<this.chunk.length&&(i==add.length||this.chunkEnd(cur.chunkIndex)<add[i].from)&&(!filter||filterFrom>this.chunkEnd(cur.chunkIndex)||filterTo<this.chunkPos[cur.chunkIndex])&&builder.addChunk(this.chunkPos[cur.chunkIndex],this.chunk[cur.chunkIndex])?cur.nextChunk():((!filter||filterFrom>cur.to||filterTo<cur.from||filter(cur.from,cur.to,cur.value))&&(builder.addInner(cur.from,cur.to,cur.value)||spill.push(Range.create(cur.from,cur.to,cur.value))),cur.next());return builder.finishInner(this.nextLayer.isEmpty&&!spill.length?RangeSet.empty:this.nextLayer.update({add:spill,filter,filterFrom,filterTo}))}map(changes){if(changes.empty||this.isEmpty)return this;let chunks=[],chunkPos=[],maxPoint=-1;for(let i=0;i<this.chunk.length;i++){let start=this.chunkPos[i],chunk=this.chunk[i],touch=changes.touchesRange(start,start+chunk.length);if(!1===touch)maxPoint=Math.max(maxPoint,chunk.maxPoint),chunks.push(chunk),chunkPos.push(changes.mapPos(start));else if(!0===touch){let{mapped,pos}=chunk.map(start,changes);mapped&&(maxPoint=Math.max(maxPoint,mapped.maxPoint),chunks.push(mapped),chunkPos.push(pos))}}let next=this.nextLayer.map(changes);return 0==chunks.length?next:new RangeSet(chunkPos,chunks,next||RangeSet.empty,maxPoint)}between(from,to,f){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let start=this.chunkPos[i],chunk=this.chunk[i];if(to>=start&&from<=start+chunk.length&&!1===chunk.between(start,from-start,to-start,f))return}this.nextLayer.between(from,to,f)}}iter(from=0){return HeapCursor.from([this]).goto(from)}get isEmpty(){return this.nextLayer==this}static iter(sets,from=0){return HeapCursor.from(sets).goto(from)}static compare(oldSets,newSets,textDiff,comparator,minPointSize=-1){let a=oldSets.filter((set=>set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize)),b=newSets.filter((set=>set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize)),sharedChunks=findSharedChunks(a,b,textDiff),sideA=new SpanCursor(a,sharedChunks,minPointSize),sideB=new SpanCursor(b,sharedChunks,minPointSize);textDiff.iterGaps(((fromA,fromB,length)=>compare(sideA,fromA,sideB,fromB,length,comparator))),textDiff.empty&&0==textDiff.length&&compare(sideA,0,sideB,0,0,comparator)}static eq(oldSets,newSets,from=0,to){null==to&&(to=999999999);let a=oldSets.filter((set=>!set.isEmpty&&newSets.indexOf(set)<0)),b=newSets.filter((set=>!set.isEmpty&&oldSets.indexOf(set)<0));if(a.length!=b.length)return!1;if(!a.length)return!0;let sharedChunks=findSharedChunks(a,b),sideA=new SpanCursor(a,sharedChunks,0).goto(from),sideB=new SpanCursor(b,sharedChunks,0).goto(from);for(;;){if(sideA.to!=sideB.to||!sameValues(sideA.active,sideB.active)||sideA.point&&(!sideB.point||!sideA.point.eq(sideB.point)))return!1;if(sideA.to>to)return!0;sideA.next(),sideB.next()}}static spans(sets,from,to,iterator,minPointSize=-1){let cursor=new SpanCursor(sets,null,minPointSize).goto(from),pos=from,openRanges=cursor.openStart;for(;;){let curTo=Math.min(cursor.to,to);if(cursor.point){let active=cursor.activeForPoint(cursor.to),openCount=cursor.pointFrom<from?active.length+1:cursor.point.startSide<0?active.length:Math.min(active.length,openRanges);iterator.point(pos,curTo,cursor.point,active,openCount,cursor.pointRank),openRanges=Math.min(cursor.openEnd(curTo),active.length)}else curTo>pos&&(iterator.span(pos,curTo,cursor.active,openRanges),openRanges=cursor.openEnd(curTo));if(cursor.to>to)return openRanges+(cursor.point&&cursor.to>to?1:0);pos=cursor.to,cursor.next()}}static of(ranges,sort=!1){let build=new RangeSetBuilder;for(let range of ranges instanceof Range?[ranges]:sort?function lazySort(ranges){if(ranges.length>1)for(let prev=ranges[0],i=1;i<ranges.length;i++){let cur=ranges[i];if(cmpRange(prev,cur)>0)return ranges.slice().sort(cmpRange);prev=cur}return ranges}(ranges):ranges)build.add(range.from,range.to,range.value);return build.finish()}static join(sets){if(!sets.length)return RangeSet.empty;let result=sets[sets.length-1];for(let i=sets.length-2;i>=0;i--)for(let layer=sets[i];layer!=RangeSet.empty;layer=layer.nextLayer)result=new RangeSet(layer.chunkPos,layer.chunk,result,Math.max(layer.maxPoint,result.maxPoint));return result}}RangeSet.empty=new RangeSet([],[],null,-1),RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(newArrays){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,newArrays&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(from,to,value){this.addInner(from,to,value)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(from,to,value)}addInner(from,to,value){let diff=from-this.lastTo||value.startSide-this.last.endSide;if(diff<=0&&(from-this.lastFrom||value.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(diff<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=from),this.from.push(from-this.chunkStart),this.to.push(to-this.chunkStart),this.last=value,this.lastFrom=from,this.lastTo=to,this.value.push(value),value.point&&(this.maxPoint=Math.max(this.maxPoint,to-from)),!0)}addChunk(from,chunk){if((from-this.lastTo||chunk.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,chunk.maxPoint),this.chunks.push(chunk),this.chunkPos.push(from);let last=chunk.value.length-1;return this.last=chunk.value[last],this.lastFrom=chunk.from[last]+from,this.lastTo=chunk.to[last]+from,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(next){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return next;let result=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(next):next,this.setMaxPoint);return this.from=null,result}}function findSharedChunks(a,b,textDiff){let inA=new Map;for(let set of a)for(let i=0;i<set.chunk.length;i++)set.chunk[i].maxPoint<=0&&inA.set(set.chunk[i],set.chunkPos[i]);let shared=new Set;for(let set of b)for(let i=0;i<set.chunk.length;i++){let known=inA.get(set.chunk[i]);null==known||(textDiff?textDiff.mapPos(known):known)!=set.chunkPos[i]||(null==textDiff?void 0:textDiff.touchesRange(known,known+set.chunk[i].length))||shared.add(set.chunk[i])}return shared}class LayerCursor{constructor(layer,skip,minPoint,rank=0){this.layer=layer,this.skip=skip,this.minPoint=minPoint,this.rank=rank}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(pos,side=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(pos,side,!1),this}gotoInner(pos,side,forward){for(;this.chunkIndex<this.layer.chunk.length;){let next=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(next)||this.layer.chunkEnd(this.chunkIndex)<pos||next.maxPoint<this.minPoint))break;this.chunkIndex++,forward=!1}if(this.chunkIndex<this.layer.chunk.length){let rangeIndex=this.layer.chunk[this.chunkIndex].findIndex(pos-this.layer.chunkPos[this.chunkIndex],side,!0);(!forward||this.rangeIndex<rangeIndex)&&this.setRangeIndex(rangeIndex)}this.next()}forward(pos,side){(this.to-pos||this.endSide-side)<0&&this.gotoInner(pos,side,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let chunkPos=this.layer.chunkPos[this.chunkIndex],chunk=this.layer.chunk[this.chunkIndex],from=chunkPos+chunk.from[this.rangeIndex];if(this.from=from,this.to=chunkPos+chunk.to[this.rangeIndex],this.value=chunk.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(index){if(index==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=index}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(other){return this.from-other.from||this.startSide-other.startSide||this.rank-other.rank||this.to-other.to||this.endSide-other.endSide}}class HeapCursor{constructor(heap){this.heap=heap}static from(sets,skip=null,minPoint=-1){let heap=[];for(let i=0;i<sets.length;i++)for(let cur=sets[i];!cur.isEmpty;cur=cur.nextLayer)cur.maxPoint>=minPoint&&heap.push(new LayerCursor(cur,skip,minPoint,i));return 1==heap.length?heap[0]:new HeapCursor(heap)}get startSide(){return this.value?this.value.startSide:0}goto(pos,side=-1e9){for(let cur of this.heap)cur.goto(pos,side);for(let i=this.heap.length>>1;i>=0;i--)heapBubble(this.heap,i);return this.next(),this}forward(pos,side){for(let cur of this.heap)cur.forward(pos,side);for(let i=this.heap.length>>1;i>=0;i--)heapBubble(this.heap,i);(this.to-pos||this.value.endSide-side)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let top=this.heap[0];this.from=top.from,this.to=top.to,this.value=top.value,this.rank=top.rank,top.value&&top.next(),heapBubble(this.heap,0)}}}function heapBubble(heap,index){for(let cur=heap[index];;){let childIndex=1+(index<<1);if(childIndex>=heap.length)break;let child=heap[childIndex];if(childIndex+1<heap.length&&child.compare(heap[childIndex+1])>=0&&(child=heap[childIndex+1],childIndex++),cur.compare(child)<0)break;heap[childIndex]=cur,heap[index]=child,index=childIndex}}class SpanCursor{constructor(sets,skip,minPoint){this.minPoint=minPoint,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(sets,skip,minPoint)}goto(pos,side=-1e9){return this.cursor.goto(pos,side),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=pos,this.endSide=side,this.openStart=-1,this.next(),this}forward(pos,side){for(;this.minActive>-1&&(this.activeTo[this.minActive]-pos||this.active[this.minActive].endSide-side)<0;)this.removeActive(this.minActive);this.cursor.forward(pos,side)}removeActive(index){remove(this.active,index),remove(this.activeTo,index),remove(this.activeRank,index),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(trackOpen){let i=0,{value,to,rank}=this.cursor;for(;i<this.activeRank.length&&(rank-this.activeRank[i]||to-this.activeTo[i])>0;)i++;insert(this.active,i,value),insert(this.activeTo,i,to),insert(this.activeRank,i,rank),trackOpen&&insert(trackOpen,i,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let from=this.to,wasPoint=this.point;this.point=null;let trackOpen=this.openStart<0?[]:null;for(;;){let a=this.minActive;if(a>-1&&(this.activeTo[a]-this.cursor.from||this.active[a].endSide-this.cursor.startSide)<0){if(this.activeTo[a]>from){this.to=this.activeTo[a],this.endSide=this.active[a].endSide;break}this.removeActive(a),trackOpen&&remove(trackOpen,a)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>from){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let nextVal=this.cursor.value;if(nextVal.point){if(!(wasPoint&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=nextVal,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=nextVal.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(trackOpen),this.cursor.next()}}}if(trackOpen){this.openStart=0;for(let i=trackOpen.length-1;i>=0&&trackOpen[i]<from;i--)this.openStart++}}activeForPoint(to){if(!this.active.length)return this.active;let active=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>to||this.activeTo[i]==to&&this.active[i].endSide>=this.point.endSide)&&active.push(this.active[i]);return active.reverse()}openEnd(to){let open=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>to;i--)open++;return open}}function compare(a,startA,b,startB,length,comparator){a.goto(startA),b.goto(startB);let endB=startB+length,pos=startB,dPos=startB-startA;for(;;){let dEnd=a.to+dPos-b.to,diff=dEnd||a.endSide-b.endSide,end=diff<0?a.to+dPos:b.to,clipEnd=Math.min(end,endB);if(a.point||b.point?a.point&&b.point&&(a.point==b.point||a.point.eq(b.point))&&sameValues(a.activeForPoint(a.to),b.activeForPoint(b.to))||comparator.comparePoint(pos,clipEnd,a.point,b.point):clipEnd>pos&&!sameValues(a.active,b.active)&&comparator.compareRange(pos,clipEnd,a.active,b.active),end>endB)break;(dEnd||a.openEnd!=b.openEnd)&&comparator.boundChange&&comparator.boundChange(end),pos=end,diff<=0&&a.next(),diff>=0&&b.next()}}function sameValues(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(a[i]!=b[i]&&!a[i].eq(b[i]))return!1;return!0}function remove(array,index){for(let i=index,e=array.length-1;i<e;i++)array[i]=array[i+1];array.pop()}function insert(array,index,value){for(let i=array.length-1;i>=index;i--)array[i+1]=array[i];array[index]=value}function findMinIndex(value,array){let found=-1,foundPos=1e9;for(let i=0;i<array.length;i++)(array[i]-foundPos||value[i].endSide-value[found].endSide)<0&&(found=i,foundPos=array[i]);return found}function countColumn(string,tabSize,to=string.length){let n=0;for(let i=0;i<to&&i<string.length;)9==string.charCodeAt(i)?(n+=tabSize-n%tabSize,i++):(n++,i=dist_findClusterBreak(string,i));return n}function findColumn(string,col,tabSize,strict){for(let i=0,n=0;;){if(n>=col)return i;if(i==string.length)break;n+=9==string.charCodeAt(i)?tabSize-n%tabSize:1,i=dist_findClusterBreak(string,i)}return!0===strict?-1:string.length}},"./node_modules/@codemirror/view/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{NZ:()=>Decoration,OP:()=>Direction,Lz:()=>EditorView,wJ:()=>GutterMarker,Z9:()=>ViewPlugin,xO:()=>WidgetType,VH:()=>drawSelection,A:()=>dropCursor,ld:()=>getPanel,Eg:()=>getTooltip,cU:()=>gutter,Wu:()=>highlightActiveLineGutter,N$:()=>highlightSpecialChars,Ux:()=>hoverTooltip,w4:()=>keymap,$K:()=>lineNumbers,c_:()=>logException,TS:()=>runScopeHandlers,S7:()=>showPanel,DK:()=>showTooltip});for(var state_dist=__webpack_require__("./node_modules/@codemirror/state/dist/index.js"),style_mod=__webpack_require__("./node_modules/style-mod/src/style-mod.js"),base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ie="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(i=1;i<=24;i++)base[i+111]="F"+i;for(i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);var console=__webpack_require__("./node_modules/console-browserify/index.js");function getSelection(root){let target;return target=11==root.nodeType?root.getSelection?root:root.ownerDocument:root,target.getSelection()}function contains(dom,node){return!!node&&(dom==node||dom.contains(1!=node.nodeType?node.parentNode:node))}function hasSelection(dom,selection){if(!selection.anchorNode)return!1;try{return contains(dom,selection.anchorNode)}catch(_){return!1}}function clientRectsFor(dom){return 3==dom.nodeType?textRange(dom,0,dom.nodeValue.length).getClientRects():1==dom.nodeType?dom.getClientRects():[]}function isEquivalentPosition(node,off,targetNode,targetOff){return!!targetNode&&(scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1))}function domIndex(node){for(var index=0;;index++)if(!(node=node.previousSibling))return index}function isBlockElement(node){return 1==node.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName)}function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(dir<0?0:maxOffset(node))){if("DIV"==node.nodeName)return!1;let parent=node.parentNode;if(!parent||1!=parent.nodeType)return!1;off=domIndex(node)+(dir<0?0:1),node=parent}else{if(1!=node.nodeType)return!1;if(1==(node=node.childNodes[off+(dir<0?-1:0)]).nodeType&&"false"==node.contentEditable)return!1;off=dir<0?maxOffset(node):0}}}function maxOffset(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function flattenRect(rect,left){let x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom}}function windowRect(win){let vp=win.visualViewport;return vp?{left:0,right:vp.width,top:0,bottom:vp.height}:{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight}}function getScale(elt,rect){let scaleX=rect.width/elt.offsetWidth,scaleY=rect.height/elt.offsetHeight;return(scaleX>.995&&scaleX<1.005||!isFinite(scaleX)||Math.abs(rect.width-elt.offsetWidth)<1)&&(scaleX=1),(scaleY>.995&&scaleY<1.005||!isFinite(scaleY)||Math.abs(rect.height-elt.offsetHeight)<1)&&(scaleY=1),{scaleX,scaleY}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset}setRange(range){let{anchorNode,focusNode}=range;this.set(anchorNode,Math.min(range.anchorOffset,anchorNode?maxOffset(anchorNode):0),focusNode,Math.min(range.focusOffset,focusNode?maxOffset(focusNode):0))}set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode,this.anchorOffset=anchorOffset,this.focusNode=focusNode,this.focusOffset=focusOffset}}let scratchRange,preventScrollSupported=null;function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);let stack=[];for(let cur=dom;cur&&(stack.push(cur,cur.scrollTop,cur.scrollLeft),cur!=cur.ownerDocument);cur=cur.parentNode);if(dom.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let i=0;i<stack.length;){let elt=stack[i++],top=stack[i++],left=stack[i++];elt.scrollTop!=top&&(elt.scrollTop=top),elt.scrollLeft!=left&&(elt.scrollLeft=left)}}}function textRange(node,from,to=from){let range=scratchRange||(scratchRange=document.createRange());return range.setEnd(node,to),range.setStart(node,from),range}function dispatchKey(elt,name,code,mods){let options={key:name,code:name,keyCode:code,which:code,cancelable:!0};mods&&({altKey:options.altKey,ctrlKey:options.ctrlKey,shiftKey:options.shiftKey,metaKey:options.metaKey}=mods);let down=new KeyboardEvent("keydown",options);down.synthetic=!0,elt.dispatchEvent(down);let up=new KeyboardEvent("keyup",options);return up.synthetic=!0,elt.dispatchEvent(up),down.defaultPrevented||up.defaultPrevented}function clearAttributes(node){for(;node.attributes.length;)node.removeAttributeNode(node.attributes[0])}function isScrolledToBottom(elt){return elt.scrollTop>Math.max(1,elt.scrollHeight-elt.clientHeight-4)}function textNodeBefore(startNode,startOffset){for(let node=startNode,offset=startOffset;;){if(3==node.nodeType&&offset>0)return{node,offset};if(1==node.nodeType&&offset>0){if("false"==node.contentEditable)return null;node=node.childNodes[offset-1],offset=maxOffset(node)}else{if(!node.parentNode||isBlockElement(node))return null;offset=domIndex(node),node=node.parentNode}}}function textNodeAfter(startNode,startOffset){for(let node=startNode,offset=startOffset;;){if(3==node.nodeType&&offset<node.nodeValue.length)return{node,offset};if(1==node.nodeType&&offset<node.childNodes.length){if("false"==node.contentEditable)return null;node=node.childNodes[offset],offset=0}else{if(!node.parentNode||isBlockElement(node))return null;offset=domIndex(node)+1,node=node.parentNode}}}class DOMPos{constructor(node,offset,precise=!0){this.node=node,this.offset=offset,this.precise=precise}static before(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom),precise)}static after(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom)+1,precise)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(view){let pos=this.posAtStart;for(let child of this.children){if(child==view)return pos;pos+=child.length+child.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(view){return this.posBefore(view)+view.length}sync(view,track){if(2&this.flags){let next,parent=this.dom,prev=null;for(let child of this.children){if(7&child.flags){if(!child.dom&&(next=prev?prev.nextSibling:parent.firstChild)){let contentView=ContentView.get(next);(!contentView||!contentView.parent&&contentView.canReuseDOM(child))&&child.reuseDOM(next)}child.sync(view,track),child.flags&=-8}if(next=prev?prev.nextSibling:parent.firstChild,track&&!track.written&&track.node==parent&&next!=child.dom&&(track.written=!0),child.dom.parentNode==parent)for(;next&&next!=child.dom;)next=rm$1(next);else parent.insertBefore(child.dom,next);prev=child.dom}for(next=prev?prev.nextSibling:parent.firstChild,next&&track&&track.node==parent&&(track.written=!0);next;)next=rm$1(next)}else if(1&this.flags)for(let child of this.children)7&child.flags&&(child.sync(view,track),child.flags&=-8)}reuseDOM(_dom){}localPosFromDOM(node,offset){let after;if(node==this.dom)after=this.dom.childNodes[offset];else{let bias=0==maxOffset(node)?0:0==offset?-1:1;for(;;){let parent=node.parentNode;if(parent==this.dom)break;0==bias&&parent.firstChild!=parent.lastChild&&(bias=node==parent.firstChild?-1:1),node=parent}after=bias<0?node:node.nextSibling}if(after==this.dom.firstChild)return 0;for(;after&&!ContentView.get(after);)after=after.nextSibling;if(!after)return this.length;for(let i=0,pos=0;;i++){let child=this.children[i];if(child.dom==after)return pos;pos+=child.length+child.breakAfter}}domBoundsAround(from,to,offset=0){let fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(let i=0,pos=offset,prevEnd=offset;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&-1==fromI&&(fromI=i,fromStart=pos),pos>to&&child.dom.parentNode==this.dom){toI=i,toEnd=prevEnd;break}prevEnd=end,pos=end+child.breakAfter}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null}}markDirty(andParent=!1){this.flags|=2,this.markParentsDirty(andParent)}markParentsDirty(childList){for(let parent=this.parent;parent;parent=parent.parent){if(childList&&(parent.flags|=2),1&parent.flags)return;parent.flags|=1,childList=!1}}setParent(parent){this.parent!=parent&&(this.parent=parent,7&this.flags&&this.markParentsDirty(!0))}setDOM(dom){this.dom!=dom&&(this.dom&&(this.dom.cmView=null),this.dom=dom,dom.cmView=this)}get rootView(){for(let v=this;;){let parent=v.parent;if(!parent)return v;v=parent}}replaceChildren(from,to,children=noChildren){this.markDirty();for(let i=from;i<to;i++){let child=this.children[i];child.parent==this&&children.indexOf(child)<0&&child.destroy()}children.length<250?this.children.splice(from,to-from,...children):this.children=[].concat(this.children.slice(0,from),children,this.children.slice(to));for(let i=0;i<children.length;i++)children[i].setParent(this)}ignoreMutation(_rec){return!1}ignoreEvent(_event){return!1}childCursor(pos=this.length){return new ChildCursor(this.children,pos,this.children.length)}childPos(pos,bias=1){return this.childCursor().findPos(pos,bias)}toString(){let name=this.constructor.name.replace("View","");return name+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==name?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(node){return node.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(from,to,source,hasStart,openStart,openEnd){return!1}become(other){return!1}canReuseDOM(other){return other.constructor==this.constructor&&!(8&(this.flags|other.flags))}getSide(){return 0}destroy(){for(let child of this.children)child.parent==this&&child.destroy();this.parent=null}}function rm$1(dom){let next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}ContentView.prototype.breakAfter=0;class ChildCursor{constructor(children,pos,i){this.children=children,this.pos=pos,this.i=i,this.off=0}findPos(pos,bias=1){for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=pos-this.pos,this;let next=this.children[--this.i];this.pos-=next.length+next.breakAfter}}}function replaceRange(parent,fromI,fromOff,toI,toOff,insert,breakAtStart,openStart,openEnd){let{children}=parent,before=children.length?children[fromI]:null,last=insert.length?insert[insert.length-1]:null,breakAtEnd=last?last.breakAfter:breakAtStart;if(!(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert.length<2&&before.merge(fromOff,toOff,insert.length?last:null,0==fromOff,openStart,openEnd))){if(toI<children.length){let after=children[toI];after&&(toOff<after.length||after.breakAfter&&(null==last?void 0:last.breakAfter))?(fromI==toI&&(after=after.split(toOff),toOff=0),!breakAtEnd&&last&&after.merge(0,toOff,last,!0,0,openEnd)?insert[insert.length-1]=after:((toOff||after.children.length&&!after.children[0].length)&&after.merge(0,toOff,null,!1,0,openEnd),insert.push(after))):(null==after?void 0:after.breakAfter)&&(last?last.breakAfter=1:breakAtStart=1),toI++}for(before&&(before.breakAfter=breakAtStart,fromOff>0&&(!breakAtStart&&insert.length&&before.merge(fromOff,before.length,insert[0],!1,openStart,0)?before.breakAfter=insert.shift().breakAfter:(fromOff<before.length||before.children.length&&0==before.children[before.children.length-1].length)&&before.merge(fromOff,before.length,null,!1,openStart,0),fromI++));fromI<toI&&insert.length;)if(children[toI-1].become(insert[insert.length-1]))toI--,insert.pop(),openEnd=insert.length?0:openStart;else{if(!children[fromI].become(insert[0]))break;fromI++,insert.shift(),openStart=insert.length?0:openEnd}!insert.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],!1,openStart,openEnd)&&fromI--,(fromI<toI||insert.length)&&parent.replaceChildren(fromI,toI,insert)}}function mergeChildrenInto(parent,from,to,insert,openStart,openEnd){let cur=parent.childCursor(),{i:toI,off:toOff}=cur.findPos(to,1),{i:fromI,off:fromOff}=cur.findPos(from,-1),dLen=from-to;for(let view of insert)dLen+=view.length;parent.length+=dLen,replaceRange(parent,fromI,fromOff,toI,toOff,insert,0,openStart,openEnd)}let nav="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},doc="undefined"!=typeof document?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),dist_ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!dist_ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!dist_ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!dist_ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:dist_ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,tabSize:null!=doc.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class TextView extends ContentView{constructor(text){super(),this.text=text}get length(){return this.text.length}createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text))}sync(view,track){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(track&&track.node==this.dom&&(track.written=!0),this.dom.nodeValue=this.text)}reuseDOM(dom){3==dom.nodeType&&this.createDOM(dom)}merge(from,to,source){return!(8&this.flags||source&&(!(source instanceof TextView)||this.length-(to-from)+source.length>256||8&source.flags))&&(this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to),this.markDirty(),!0)}split(from){let result=new TextView(this.text.slice(from));return this.text=this.text.slice(0,from),this.markDirty(),result.flags|=8&this.flags,result}localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0}domAtPos(pos){return new DOMPos(this.dom,pos)}domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(pos,side){return function textCoords(text,pos,side){let length=text.nodeValue.length;pos>length&&(pos=length);let from=pos,to=pos,flatten=0;0==pos&&side<0||pos==length&&side>=0?browser.chrome||browser.gecko||(pos?(from--,flatten=1):to<length&&(to++,flatten=-1)):side<0?from--:to<length&&to++;let rects=textRange(text,from,to).getClientRects();if(!rects.length)return null;let rect=rects[(flatten?flatten<0:side>=0)?0:rects.length-1];browser.safari&&!flatten&&0==rect.width&&(rect=Array.prototype.find.call(rects,(r=>r.width))||rect);return flatten?flattenRect(rect,flatten<0):rect||null}(this.dom,pos,side)}}class MarkView extends ContentView{constructor(mark,children=[],length=0){super(),this.mark=mark,this.children=children,this.length=length;for(let ch of children)ch.setParent(this)}setAttrs(dom){if(clearAttributes(dom),this.mark.class&&(dom.className=this.mark.class),this.mark.attrs)for(let name in this.mark.attrs)dom.setAttribute(name,this.mark.attrs[name]);return dom}canReuseDOM(other){return super.canReuseDOM(other)&&!(8&(this.flags|other.flags))}reuseDOM(node){node.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(node),this.flags|=6)}sync(view,track){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(view,track)}merge(from,to,source,_hasStart,openStart,openEnd){return(!source||!(!(source instanceof MarkView&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))&&(mergeChildrenInto(this,from,to,source?source.children.slice():[],openStart-1,openEnd-1),this.markDirty(),!0)}split(from){let result=[],off=0,detachFrom=-1,i=0;for(let elt of this.children){let end=off+elt.length;end>from&&result.push(off<from?elt.split(from-off):elt),detachFrom<0&&off>=from&&(detachFrom=i),off=end,i++}let length=this.length-from;return this.length=from,detachFrom>-1&&(this.children.length=detachFrom,this.markDirty()),new MarkView(this.mark,result,length)}domAtPos(pos){return inlineDOMAtPos(this,pos)}coordsAt(pos,side){return coordsInChildren(this,pos,side)}}class WidgetView extends ContentView{static create(widget,length,side){return new WidgetView(widget,length,side)}constructor(widget,length,side){super(),this.widget=widget,this.length=length,this.side=side,this.prevWidget=null}split(from){let result=WidgetView.create(this.widget,this.length-from,this.side);return this.length-=from,result}sync(view){this.dom&&this.widget.updateDOM(this.dom,view)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(view)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(from,to,source,hasStart,openStart,openEnd){return!(source&&(!(source instanceof WidgetView&&this.widget.compare(source.widget))||from>0&&openStart<=0||to<this.length&&openEnd<=0))&&(this.length=from+(source?source.length:0)+(this.length-to),!0)}become(other){return other instanceof WidgetView&&other.side==this.side&&this.widget.constructor==other.widget.constructor&&(this.widget.compare(other.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=other.widget,this.length=other.length,!0)}ignoreMutation(){return!0}ignoreEvent(event){return this.widget.ignoreEvent(event)}get overrideDOMText(){if(0==this.length)return state_dist.EY.empty;let top=this;for(;top.parent;)top=top.parent;let{view}=top,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):state_dist.EY.empty}domAtPos(pos){return(this.length?0==pos:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}domBoundsAround(){return null}coordsAt(pos,side){let custom=this.widget.coordsAt(this.dom,pos,side);if(custom)return custom;let rects=this.dom.getClientRects(),rect=null;if(!rects.length)return null;let fromBack=this.side?this.side<0:pos>0;for(let i=fromBack?rects.length-1:0;rect=rects[i],!(pos>0?0==i:i==rects.length-1||rect.top<rect.bottom);i+=fromBack?-1:1);return flattenRect(rect,!fromBack)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(side){super(),this.side=side}get length(){return 0}merge(){return!1}become(other){return other instanceof WidgetBufferView&&other.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let dom=document.createElement("img");dom.className="cm-widgetBuffer",dom.setAttribute("aria-hidden","true"),this.setDOM(dom)}}getSide(){return this.side}domAtPos(pos){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(pos){return this.dom.getBoundingClientRect()}get overrideDOMText(){return state_dist.EY.empty}get isHidden(){return!0}}function inlineDOMAtPos(parent,pos){let dom=parent.dom,{children}=parent,i=0;for(let off=0;i<children.length;i++){let child=children[i],end=off+child.length;if(!(end==off&&child.getSide()<=0)){if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end}}for(let j=i;j>0;j--){let prev=children[j-1];if(prev.dom.parentNode==dom)return prev.domAtPos(prev.length)}for(let j=i;j<children.length;j++){let next=children[j];if(next.dom.parentNode==dom)return next.domAtPos(0)}return new DOMPos(dom,0)}function joinInlineInto(parent,view,open){let last,{children}=parent;open>0&&view instanceof MarkView&&children.length&&(last=children[children.length-1])instanceof MarkView&&last.mark.eq(view.mark)?joinInlineInto(last,view.children[0],open-1):(children.push(view),view.setParent(parent)),parent.length+=view.length}function coordsInChildren(view,pos,side){let before=null,beforePos=-1,after=null,afterPos=-1;!function scan(view,pos){for(let i=0,off=0;i<view.children.length&&off<=pos;i++){let child=view.children[i],end=off+child.length;end>=pos&&(child.children.length?scan(child,pos-off):(!after||after.isHidden&&side>0)&&(end>pos||off==end&&child.getSide()>0)?(after=child,afterPos=pos-off):(off<pos||off==end&&child.getSide()<0&&!child.isHidden)&&(before=child,beforePos=pos-off)),off=end}}(view,pos);let target=(side<0?before:after)||before||after;return target?target.coordsAt(Math.max(0,target==before?beforePos:afterPos),side):function fallbackRect(view){let last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();let rects=clientRectsFor(last);return rects[rects.length-1]||null}(view)}function combineAttrs(source,target){for(let name in source)"class"==name&&target.class?target.class+=" "+source.class:"style"==name&&target.style?target.style+=";"+source.style:target[name]=source[name];return target}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;const noAttrs=Object.create(null);function attrsEq(a,b,ignore){if(a==b)return!0;a||(a=noAttrs),b||(b=noAttrs);let keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length-(ignore&&keysA.indexOf(ignore)>-1?1:0)!=keysB.length-(ignore&&keysB.indexOf(ignore)>-1?1:0))return!1;for(let key of keysA)if(key!=ignore&&(-1==keysB.indexOf(key)||a[key]!==b[key]))return!1;return!0}function updateAttrs(dom,prev,attrs){let changed=!1;if(prev)for(let name in prev)attrs&&name in attrs||(changed=!0,"style"==name?dom.style.cssText="":dom.removeAttribute(name));if(attrs)for(let name in attrs)prev&&prev[name]==attrs[name]||(changed=!0,"style"==name?dom.style.cssText=attrs[name]:dom.setAttribute(name,attrs[name]));return changed}function getAttrs(dom){let attrs=Object.create(null);for(let i=0;i<dom.attributes.length;i++){let attr=dom.attributes[i];attrs[attr.name]=attr.value}return attrs}class WidgetType{eq(widget){return!1}updateDOM(dom,view){return!1}compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(event){return!0}coordsAt(dom,pos,side){return null}get isHidden(){return!1}get editable(){return!1}destroy(dom){}}var BlockType=function(BlockType){return BlockType[BlockType.Text=0]="Text",BlockType[BlockType.WidgetBefore=1]="WidgetBefore",BlockType[BlockType.WidgetAfter=2]="WidgetAfter",BlockType[BlockType.WidgetRange=3]="WidgetRange",BlockType}(BlockType||(BlockType={}));class Decoration extends state_dist.FB{constructor(startSide,endSide,widget,spec){super(),this.startSide=startSide,this.endSide=endSide,this.widget=widget,this.spec=spec}get heightRelevant(){return!1}static mark(spec){return new MarkDecoration(spec)}static widget(spec){let side=Math.max(-1e4,Math.min(1e4,spec.side||0)),block=!!spec.block;return side+=block&&!spec.inlineOrder?side>0?3e8:-4e8:side>0?1e8:-1e8,new PointDecoration(spec,side,side,block,spec.widget||null,!1)}static replace(spec){let startSide,endSide,block=!!spec.block;if(spec.isBlockGap)startSide=-5e8,endSide=4e8;else{let{start,end}=getInclusive(spec,block);startSide=(start?block?-3e8:-1:5e8)-1,endSide=1+(end?block?2e8:1:-6e8)}return new PointDecoration(spec,startSide,endSide,block,spec.widget||null,!0)}static line(spec){return new LineDecoration(spec)}static set(of,sort=!1){return state_dist.om.of(of,sort)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Decoration.none=state_dist.om.empty;class MarkDecoration extends Decoration{constructor(spec){let{start,end}=getInclusive(spec);super(start?-1:5e8,end?1:-6e8,null,spec),this.tagName=spec.tagName||"span",this.class=spec.class||"",this.attrs=spec.attributes||null}eq(other){var _a,_b;return this==other||other instanceof MarkDecoration&&this.tagName==other.tagName&&(this.class||(null===(_a=this.attrs)||void 0===_a?void 0:_a.class))==(other.class||(null===(_b=other.attrs)||void 0===_b?void 0:_b.class))&&attrsEq(this.attrs,other.attrs,"class")}range(from,to=from){if(from>=to)throw new RangeError("Mark decorations may not be empty");return super.range(from,to)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(spec){super(-2e8,-2e8,null,spec)}eq(other){return other instanceof LineDecoration&&this.spec.class==other.spec.class&&attrsEq(this.spec.attributes,other.spec.attributes)}range(from,to=from){if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return super.range(from,to)}}LineDecoration.prototype.mapMode=state_dist.iR.TrackBefore,LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(spec,startSide,endSide,block,widget,isReplace){super(startSide,endSide,widget,spec),this.block=block,this.isReplace=isReplace,this.mapMode=block?startSide<=0?state_dist.iR.TrackBefore:state_dist.iR.TrackAfter:state_dist.iR.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(other){return other instanceof PointDecoration&&function widgetsEq(a,b){return a==b||!!(a&&b&&a.compare(b))}(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide}range(from,to=from){if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(from,to)}}function getInclusive(spec,block=!1){let{inclusiveStart:start,inclusiveEnd:end}=spec;return null==start&&(start=spec.inclusive),null==end&&(end=spec.inclusive),{start:null!=start?start:block,end:null!=end?end:block}}function addRange(from,to,ranges,margin=0){let last=ranges.length-1;last>=0&&ranges[last]+margin>=from?ranges[last]=Math.max(ranges[last],to):ranges.push(from,to)}PointDecoration.prototype.point=!0;class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView))return!1;this.dom||source.transferDOM(this)}return hasStart&&this.setDeco(source?source.attrs:null),mergeChildrenInto(this,from,to,source?source.children.slice():[],openStart,openEnd),!0}split(at){let end=new LineView;if(end.breakAfter=this.breakAfter,0==this.length)return end;let{i,off}=this.childPos(at);off&&(end.append(this.children[i].split(off),0),this.children[i].merge(off,this.children[i].length,null,!1,0,0),i++);for(let j=i;j<this.children.length;j++)end.append(this.children[j],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=at,end}transferDOM(other){this.dom&&(this.markDirty(),other.setDOM(this.dom),other.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(attrs){attrsEq(this.attrs,attrs)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=attrs)}append(child,openStart){joinInlineInto(this,child,openStart)}addLineDeco(deco){let attrs=deco.spec.attributes,cls=deco.spec.class;attrs&&(this.attrs=combineAttrs(attrs,this.attrs||{})),cls&&(this.attrs=combineAttrs({class:cls},this.attrs||{}))}domAtPos(pos){return inlineDOMAtPos(this,pos)}reuseDOM(node){"DIV"==node.nodeName&&(this.setDOM(node),this.flags|=6)}sync(view,track){var _a;this.dom?4&this.flags&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(view,track);let last=this.dom.lastChild;for(;last&&ContentView.get(last)instanceof MarkView;)last=last.lastChild;if(!(last&&this.length&&("BR"==last.nodeName||0!=(null===(_a=ContentView.get(last))||void 0===_a?void 0:_a.isEditable)||browser.ios&&this.children.some((ch=>ch instanceof TextView))))){let hack=document.createElement("BR");hack.cmIgnore=!0,this.dom.appendChild(hack)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let textHeight,totalWidth=0;for(let child of this.children){if(!(child instanceof TextView)||/[^ -~]/.test(child.text))return null;let rects=clientRectsFor(child.dom);if(1!=rects.length)return null;totalWidth+=rects[0].width,textHeight=rects[0].height}return totalWidth?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length,textHeight}:null}coordsAt(pos,side){let rect=coordsInChildren(this,pos,side);if(!this.children.length&&rect&&this.parent){let{heightOracle}=this.parent.view.viewState,height=rect.bottom-rect.top;if(Math.abs(height-heightOracle.lineHeight)<2&&heightOracle.textHeight<height){let dist=(height-heightOracle.textHeight)/2;return{top:rect.top+dist,bottom:rect.bottom-dist,left:rect.left,right:rect.left}}}return rect}become(other){return other instanceof LineView&&0==this.children.length&&0==other.children.length&&attrsEq(this.attrs,other.attrs)&&this.breakAfter==other.breakAfter}covers(){return!0}static find(docView,pos){for(let i=0,off=0;i<docView.children.length;i++){let block=docView.children[i],end=off+block.length;if(end>=pos){if(block instanceof LineView)return block;if(end>pos)break}off=end+block.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(widget,length,deco){super(),this.widget=widget,this.length=length,this.deco=deco,this.breakAfter=0,this.prevWidget=null}merge(from,to,source,_takeDeco,openStart,openEnd){return!(source&&(!(source instanceof BlockWidgetView&&this.widget.compare(source.widget))||from>0&&openStart<=0||to<this.length&&openEnd<=0))&&(this.length=from+(source?source.length:0)+(this.length-to),!0)}domAtPos(pos){return 0==pos?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}split(at){let len=this.length-at;this.length=at;let end=new BlockWidgetView(this.widget,len,this.deco);return end.breakAfter=this.breakAfter,end}get children(){return noChildren}sync(view){this.dom&&this.widget.updateDOM(this.dom,view)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(view)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):state_dist.EY.empty}domBoundsAround(){return null}become(other){return other instanceof BlockWidgetView&&other.widget.constructor==this.widget.constructor&&(other.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=other.widget,this.length=other.length,this.deco=other.deco,this.breakAfter=other.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(event){return this.widget.ignoreEvent(event)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(pos,side){let custom=this.widget.coordsAt(this.dom,pos,side);return custom||(this.widget instanceof BlockGapWidget?null:flattenRect(this.dom.getBoundingClientRect(),this.length?0==pos:side<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(side){let{startSide,endSide}=this.deco;return startSide!=endSide&&(side<0?startSide<0:endSide>0)}}class BlockGapWidget extends WidgetType{constructor(height){super(),this.height=height}toDOM(){let elt=document.createElement("div");return elt.className="cm-gap",this.updateDOM(elt),elt}eq(other){return other.height==this.height}updateDOM(elt){return elt.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class ContentBuilder{constructor(doc,pos,end,disallowBlockEffectsFor){this.doc=doc,this.pos=pos,this.end=end,this.disallowBlockEffectsFor=disallowBlockEffectsFor,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=doc.iter(),this.skip=pos}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let last=this.content[this.content.length-1];return!(last.breakAfter||last instanceof BlockWidgetView&&last.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(active=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),active),active.length),this.pendingBuffer=0)}addBlockWidget(view){this.flushBuffer(),this.curLine=null,this.content.push(view)}finish(openEnd){this.pendingBuffer&&openEnd<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||openEnd&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView||this.getLine()}buildText(length,active,openStart){for(;length>0;){if(this.textOff==this.text.length){let{value,lineBreak,done}=this.cursor.next(this.skip);if(this.skip=0,done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,length--;continue}this.text=value,this.textOff=0}let take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(active.length-openStart)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+take)),active),openStart),this.atCursorPos=!0,this.textOff+=take,length-=take,openStart=0}}span(from,to,active,openStart){this.buildText(to-from,active,openStart),this.pos=to,this.openStart<0&&(this.openStart=openStart)}point(from,to,deco,active,openStart,index){if(this.disallowBlockEffectsFor[index]&&deco instanceof PointDecoration){if(deco.block)throw new RangeError("Block decorations may not be specified via plugins");if(to>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let len=to-from;if(deco instanceof PointDecoration)if(deco.block)deco.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(deco.widget||NullWidget.block,len,deco));else{let view=WidgetView.create(deco.widget||NullWidget.inline,len,len?0:deco.startSide),cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0),cursorAfter=!view.isEditable&&(from<to||openStart>active.length||deco.startSide<=0),line=this.getLine();2!=this.pendingBuffer||cursorBefore||view.isEditable||(this.pendingBuffer=0),this.flushBuffer(active),cursorBefore&&(line.append(wrapMarks(new WidgetBufferView(1),active),openStart),openStart=active.length+Math.max(0,openStart-active.length)),line.append(wrapMarks(view,active),openStart),this.atCursorPos=cursorAfter,this.pendingBuffer=cursorAfter?from<to||openStart>active.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=active.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(deco);len&&(this.textOff+len<=this.text.length?this.textOff+=len:(this.skip+=len-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=to),this.openStart<0&&(this.openStart=openStart)}static build(text,from,to,decorations,dynamicDecorationMap){let builder=new ContentBuilder(text,from,to,dynamicDecorationMap);return builder.openEnd=state_dist.om.spans(decorations,from,to,builder),builder.openStart<0&&(builder.openStart=builder.openEnd),builder.finish(builder.openEnd),builder}}function wrapMarks(view,active){for(let mark of active)view=new MarkView(mark,[view],view.length);return view}class NullWidget extends WidgetType{constructor(tag){super(),this.tag=tag}eq(other){return other.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span"),NullWidget.block=new NullWidget("div");var Direction=function(Direction){return Direction[Direction.LTR=0]="LTR",Direction[Direction.RTL=1]="RTL",Direction}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(str){let result=[];for(let i=0;i<str.length;i++)result.push(1<<+str[i]);return result}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let p of["()","[]","{}"]){let l=p.charCodeAt(0),r=p.charCodeAt(1);Brackets[l]=r,Brackets[r]=-l}function charType(ch){return ch<=247?LowTypes[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8204?256:64336<=ch&&ch<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(from,to,level){this.from=from,this.to=to,this.level=level}side(end,dir){return this.dir==dir==end?this.to:this.from}forward(forward,dir){return forward==(this.dir==dir)}static find(order,index,level,assoc){let maybe=-1;for(let i=0;i<order.length;i++){let span=order[i];if(span.from<=index&&span.to>=index){if(span.level==level)return i;(maybe<0||(0!=assoc?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))&&(maybe=i)}}if(maybe<0)throw new RangeError("Index out of range");return maybe}}function isolatesEq(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++){let iA=a[i],iB=b[i];if(iA.from!=iB.from||iA.to!=iB.to||iA.direction!=iB.direction||!isolatesEq(iA.inner,iB.inner))return!1}return!0}const types=[];function emitSpans(line,from,to,level,baseLevel,isolates,order){let ourType=level%2?2:1;if(level%2==baseLevel%2)for(let iCh=from,iI=0;iCh<to;){let sameDir=!0,isNum=!1;if(iI==isolates.length||iCh<isolates[iI].from){let next=types[iCh];next!=ourType&&(sameDir=!1,isNum=16==next)}let recurse=sameDir||1!=ourType?null:[],localLevel=sameDir?level:level+1,iScan=iCh;run:for(;;)if(iI<isolates.length&&iScan==isolates[iI].from){if(isNum)break run;let iso=isolates[iI];if(!sameDir)for(let upto=iso.to,jI=iI+1;;){if(upto==to)break run;if(!(jI<isolates.length&&isolates[jI].from==upto)){if(types[upto]==ourType)break run;break}upto=isolates[jI++].to}if(iI++,recurse)recurse.push(iso);else{iso.from>iCh&&order.push(new BidiSpan(iCh,iso.from,localLevel)),computeSectionOrder(line,iso.direction==LTR!=!(localLevel%2)?level+1:level,baseLevel,iso.inner,iso.from,iso.to,order),iCh=iso.to}iScan=iso.to}else{if(iScan==to||(sameDir?types[iScan]!=ourType:types[iScan]==ourType))break;iScan++}recurse?emitSpans(line,iCh,iScan,level+1,baseLevel,recurse,order):iCh<iScan&&order.push(new BidiSpan(iCh,iScan,localLevel)),iCh=iScan}else for(let iCh=to,iI=isolates.length;iCh>from;){let sameDir=!0,isNum=!1;if(!iI||iCh>isolates[iI-1].to){let next=types[iCh-1];next!=ourType&&(sameDir=!1,isNum=16==next)}let recurse=sameDir||1!=ourType?null:[],localLevel=sameDir?level:level+1,iScan=iCh;run:for(;;)if(iI&&iScan==isolates[iI-1].to){if(isNum)break run;let iso=isolates[--iI];if(!sameDir)for(let upto=iso.from,jI=iI;;){if(upto==from)break run;if(!jI||isolates[jI-1].to!=upto){if(types[upto-1]==ourType)break run;break}upto=isolates[--jI].from}if(recurse)recurse.push(iso);else{iso.to<iCh&&order.push(new BidiSpan(iso.to,iCh,localLevel)),computeSectionOrder(line,iso.direction==LTR!=!(localLevel%2)?level+1:level,baseLevel,iso.inner,iso.from,iso.to,order),iCh=iso.from}iScan=iso.from}else{if(iScan==from||(sameDir?types[iScan-1]!=ourType:types[iScan-1]==ourType))break;iScan--}recurse?emitSpans(line,iScan,iCh,level+1,baseLevel,recurse,order):iScan<iCh&&order.push(new BidiSpan(iScan,iCh,localLevel)),iCh=iScan}}function computeSectionOrder(line,level,baseLevel,isolates,from,to,order){let outerType=level%2?2:1;!function computeCharTypes(line,rFrom,rTo,isolates,outerType){for(let iI=0;iI<=isolates.length;iI++){let from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo,prevType=iI?256:outerType;for(let i=from,prev=prevType,prevStrong=prevType;i<to;i++){let type=charType(line.charCodeAt(i));512==type?type=prev:8==type&&4==prevStrong&&(type=16),types[i]=4==type?2:type,7&type&&(prevStrong=type),prev=type}for(let i=from,prev=prevType,prevStrong=prevType;i<to;i++){let type=types[i];if(128==type)i<to-1&&prev==types[i+1]&&24&prev?type=types[i]=prev:types[i]=256;else if(64==type){let end=i+1;for(;end<to&&64==types[end];)end++;let replace=i&&8==prev||end<rTo&&8==types[end]?1==prevStrong?1:8:256;for(let j=i;j<end;j++)types[j]=replace;i=end-1}else 8==type&&1==prevStrong&&(types[i]=1);prev=type,7&type&&(prevStrong=type)}}}(line,from,to,isolates,outerType),function processBracketPairs(line,rFrom,rTo,isolates,outerType){let oppositeType=1==outerType?2:1;for(let iI=0,sI=0,context=0;iI<=isolates.length;iI++){let from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;for(let ch,br,type,i=from;i<to;i++)if(br=Brackets[ch=line.charCodeAt(i)])if(br<0){for(let sJ=sI-3;sJ>=0;sJ-=3)if(BracketStack[sJ+1]==-br){let flags=BracketStack[sJ+2],type=2&flags?outerType:4&flags?1&flags?oppositeType:outerType:0;type&&(types[i]=types[BracketStack[sJ]]=type),sI=sJ;break}}else{if(189==BracketStack.length)break;BracketStack[sI++]=i,BracketStack[sI++]=ch,BracketStack[sI++]=context}else if(2==(type=types[i])||1==type){let embed=type==outerType;context=embed?0:1;for(let sJ=sI-3;sJ>=0;sJ-=3){let cur=BracketStack[sJ+2];if(2&cur)break;if(embed)BracketStack[sJ+2]|=2;else{if(4&cur)break;BracketStack[sJ+2]|=4}}}}}(line,from,to,isolates,outerType),function processNeutrals(rFrom,rTo,isolates,outerType){for(let iI=0,prev=outerType;iI<=isolates.length;iI++){let from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;for(let i=from;i<to;){let type=types[i];if(256==type){let end=i+1;for(;;)if(end==to){if(iI==isolates.length)break;end=isolates[iI++].to,to=iI<isolates.length?isolates[iI].from:rTo}else{if(256!=types[end])break;end++}let beforeL=1==prev,replace=beforeL==(1==(end<rTo?types[end]:outerType))?beforeL?1:2:outerType;for(let j=end,jI=iI,fromJ=jI?isolates[jI-1].to:rFrom;j>i;)j==fromJ&&(j=isolates[--jI].from,fromJ=jI?isolates[jI-1].to:rFrom),types[--j]=replace;i=end}else prev=type,i++}}}(from,to,isolates,outerType),emitSpans(line,from,to,level,baseLevel,isolates,order)}function computeOrder(line,direction,isolates){if(!line)return[new BidiSpan(0,0,direction==RTL?1:0)];if(direction==LTR&&!isolates.length&&!BidiRE.test(line))return trivialOrder(line.length);if(isolates.length)for(;line.length>types.length;)types[types.length]=256;let order=[],level=direction==LTR?0:1;return computeSectionOrder(line,level,level,isolates,0,line.length,order),order}function trivialOrder(length){return[new BidiSpan(0,length,0)]}let movedOver="";function moveVisually(line,order,dir,start,forward){var _a;let startIndex=start.head-line.from,spanI=BidiSpan.find(order,startIndex,null!==(_a=start.bidiLevel)&&void 0!==_a?_a:-1,start.assoc),span=order[spanI],spanEnd=span.side(forward,dir);if(startIndex==spanEnd){let nextI=spanI+=forward?1:-1;if(nextI<0||nextI>=order.length)return null;span=order[spanI=nextI],startIndex=span.side(!forward,dir),spanEnd=span.side(forward,dir)}let nextIndex=(0,state_dist.zK)(line.text,startIndex,span.forward(forward,dir));(nextIndex<span.from||nextIndex>span.to)&&(nextIndex=spanEnd),movedOver=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));let nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];return nextSpan&&nextIndex==spanEnd&&nextSpan.level+(forward?0:1)<span.level?state_dist.OF.cursor(nextSpan.side(!forward,dir)+line.from,nextSpan.forward(forward,dir)?1:-1,nextSpan.level):state_dist.OF.cursor(nextIndex+line.from,span.forward(forward,dir)?-1:1,span.level)}function autoDirection(text,from,to){for(let i=from;i<to;i++){let type=charType(text.charCodeAt(i));if(1==type)return LTR;if(2==type||4==type)return RTL}return LTR}const clickAddsSelectionRange=state_dist.sj.define(),dragMovesSelection$1=state_dist.sj.define(),mouseSelectionStyle=state_dist.sj.define(),exceptionSink=state_dist.sj.define(),updateListener=state_dist.sj.define(),inputHandler=state_dist.sj.define(),focusChangeEffect=state_dist.sj.define(),clipboardInputFilter=state_dist.sj.define(),clipboardOutputFilter=state_dist.sj.define(),perLineTextDirection=state_dist.sj.define({combine:values=>values.some((x=>x))}),nativeSelectionHidden=state_dist.sj.define({combine:values=>values.some((x=>x))}),scrollHandler=state_dist.sj.define();class ScrollTarget{constructor(range,y="nearest",x="nearest",yMargin=5,xMargin=5,isSnapshot=!1){this.range=range,this.y=y,this.x=x,this.yMargin=yMargin,this.xMargin=xMargin,this.isSnapshot=isSnapshot}map(changes){return changes.empty?this:new ScrollTarget(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(state){return this.range.to<=state.doc.length?this:new ScrollTarget(state_dist.OF.cursor(state.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView=state_dist.Pe.define({map:(t,ch)=>t.map(ch)}),setEditContextFormatting=state_dist.Pe.define();function logException(state,exception,context){let handler=state.facet(exceptionSink);handler.length?handler[0](exception):window.onerror?window.onerror(String(exception),context,void 0,void 0,exception):context?console.error(context+":",exception):console.error(exception)}const editable=state_dist.sj.define({combine:values=>!values.length||values[0]});let nextPluginID=0;const viewPlugin=state_dist.sj.define();class ViewPlugin{constructor(id,create,domEventHandlers,domEventObservers,buildExtensions){this.id=id,this.create=create,this.domEventHandlers=domEventHandlers,this.domEventObservers=domEventObservers,this.extension=buildExtensions(this)}static define(create,spec){const{eventHandlers,eventObservers,provide,decorations:deco}=spec||{};return new ViewPlugin(nextPluginID++,create,eventHandlers,eventObservers,(plugin=>{let ext=[viewPlugin.of(plugin)];return deco&&ext.push(decorations.of((view=>{let pluginInst=view.plugin(plugin);return pluginInst?deco(pluginInst):Decoration.none}))),provide&&ext.push(provide(plugin)),ext}))}static fromClass(cls,spec){return ViewPlugin.define((view=>new cls(view)),spec)}}class PluginInstance{constructor(spec){this.spec=spec,this.mustUpdate=null,this.value=null}update(view){if(this.value){if(this.mustUpdate){let update=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(update)}catch(e){if(logException(update.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(_){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(view)}catch(e){logException(view.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(view){var _a;if(null===(_a=this.value)||void 0===_a?void 0:_a.destroy)try{this.value.destroy()}catch(e){logException(view.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=state_dist.sj.define(),contentAttributes=state_dist.sj.define(),decorations=state_dist.sj.define(),outerDecorations=state_dist.sj.define(),atomicRanges=state_dist.sj.define(),bidiIsolatedRanges=state_dist.sj.define();function getIsolatedRanges(view,line){let isolates=view.state.facet(bidiIsolatedRanges);if(!isolates.length)return isolates;let sets=isolates.map((i=>i instanceof Function?i(view):i)),result=[];return state_dist.om.spans(sets,line.from,line.to,{point(){},span(fromDoc,toDoc,active,open){let from=fromDoc-line.from,to=toDoc-line.from,level=result;for(let i=active.length-1;i>=0;i--,open--){let update,direction=active[i].spec.bidiIsolate;if(null==direction&&(direction=autoDirection(line.text,from,to)),open>0&&level.length&&(update=level[level.length-1]).to==from&&update.direction==direction)update.to=to,level=update.inner;else{let add={from,to,direction,inner:[]};level.push(add),level=add.inner}}}}),result}const scrollMargins=state_dist.sj.define();function getScrollMargins(view){let left=0,right=0,top=0,bottom=0;for(let source of view.state.facet(scrollMargins)){let m=source(view);m&&(null!=m.left&&(left=Math.max(left,m.left)),null!=m.right&&(right=Math.max(right,m.right)),null!=m.top&&(top=Math.max(top,m.top)),null!=m.bottom&&(bottom=Math.max(bottom,m.bottom)))}return{left,right,top,bottom}}const styleModule=state_dist.sj.define();class ChangedRange{constructor(fromA,toA,fromB,toB){this.fromA=fromA,this.toA=toA,this.fromB=fromB,this.toB=toB}join(other){return new ChangedRange(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB))}addToSet(set){let i=set.length,me=this;for(;i>0;i--){let range=set[i-1];if(!(range.fromA>me.toA)){if(range.toA<me.fromA)break;me=me.join(range),set.splice(i-1,1)}}return set.splice(i,0,me),set}static extendWithRanges(diff,ranges){if(0==ranges.length)return diff;let result=[];for(let dI=0,rI=0,posA=0,posB=0;;dI++){let next=dI==diff.length?null:diff[dI],off=posA-posB,end=next?next.fromB:1e9;for(;rI<ranges.length&&ranges[rI]<end;){let from=ranges[rI],to=ranges[rI+1],fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB&&new ChangedRange(fromB+off,toB+off,fromB,toB).addToSet(result),to>end)break;rI+=2}if(!next)return result;new ChangedRange(next.fromA,next.toA,next.fromB,next.toB).addToSet(result),posA=next.toA,posB=next.toB}}}class ViewUpdate{constructor(view,state,transactions){this.view=view,this.state=state,this.transactions=transactions,this.flags=0,this.startState=view.state,this.changes=state_dist.VR.empty(this.startState.doc.length);for(let tr of transactions)this.changes=this.changes.compose(tr.changes);let changedRanges=[];this.changes.iterChangedRanges(((fromA,toA,fromB,toB)=>changedRanges.push(new ChangedRange(fromA,toA,fromB,toB)))),this.changedRanges=changedRanges}static create(view,state,transactions){return new ViewUpdate(view,state,transactions)}get viewportChanged(){return(4&this.flags)>0}get viewportMoved(){return(8&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(18&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((tr=>tr.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(view){super(),this.view=view,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Decoration.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(view.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,view.state.doc.length)],0,null)}update(update){var _a;let changedRanges=update.changedRanges;this.minWidth>0&&changedRanges.length&&(changedRanges.every((({fromA,toA})=>toA<this.minWidthFrom||fromA>this.minWidthTo))?(this.minWidthFrom=update.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=update.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(update);let readCompositionAt=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&((null===(_a=this.domChanged)||void 0===_a?void 0:_a.newSel)?readCompositionAt=this.domChanged.newSel.head:function touchesComposition(changes,composition){let touched=!1;composition&&changes.iterChangedRanges(((from,to)=>{from<composition.to&&to>composition.from&&(touched=!0)}));return touched}(update.changes,this.hasComposition)||update.selectionSet||(readCompositionAt=update.state.selection.main.head));let composition=readCompositionAt>-1?function findCompositionRange(view,changes,headPos){let found=findCompositionNode(view,headPos);if(!found)return null;let{node:textNode,from,to}=found,text=textNode.nodeValue;if(/[\n\r]/.test(text))return null;if(view.state.doc.sliceString(found.from,found.to)!=text)return null;let inv=changes.invertedDesc,range=new ChangedRange(inv.mapPos(from),inv.mapPos(to),from,to),marks=[];for(let parent=textNode.parentNode;;parent=parent.parentNode){let parentView=ContentView.get(parent);if(parentView instanceof MarkView)marks.push({node:parent,deco:parentView.mark});else{if(parentView instanceof LineView||"DIV"==parent.nodeName&&parent.parentNode==view.contentDOM)return{range,text:textNode,marks,line:parent};if(parent==view.contentDOM)return null;marks.push({node:parent,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs(parent),tagName:parent.tagName.toLowerCase()})})}}}(this.view,update.changes,readCompositionAt):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from,to}=this.hasComposition;changedRanges=new ChangedRange(from,to,update.changes.mapPos(from,-1),update.changes.mapPos(to,1)).addToSet(changedRanges.slice())}this.hasComposition=composition?{from:composition.range.fromB,to:composition.range.toB}:null,(browser.ie||browser.chrome)&&!composition&&update&&update.state.doc.lines!=update.startState.doc.lines&&(this.forceSelection=!0);let decoDiff=function findChangedDeco(a,b,diff){let comp=new DecorationComparator$1;return state_dist.om.compare(a,b,diff,comp),comp.changes}(this.decorations,this.updateDeco(),update.changes);return changedRanges=ChangedRange.extendWithRanges(changedRanges,decoDiff),!!(7&this.flags||0!=changedRanges.length)&&(this.updateInner(changedRanges,update.startState.doc.length,composition),update.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(changes,oldLength,composition){this.view.viewState.mustMeasureContent=!0,this.updateChildren(changes,oldLength,composition);let{observer}=this.view;observer.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let track=browser.chrome||browser.ios?{node:observer.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,track),this.flags&=-8,track&&(track.written||observer.selectionRange.focusNode!=track.node)&&(this.forceSelection=!0),this.dom.style.height=""})),this.markedForComposition.forEach((cView=>cView.flags&=-9));let gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let child of this.children)child instanceof BlockWidgetView&&child.widget instanceof BlockGapWidget&&gaps.push(child.dom);observer.updateGaps(gaps)}updateChildren(changes,oldLength,composition){let ranges=composition?composition.range.addToSet(changes.slice()):changes,cursor=this.childCursor(oldLength);for(let i=ranges.length-1;;i--){let next=i>=0?ranges[i]:null;if(!next)break;let content,breakAtStart,openStart,openEnd,{fromA,toA,fromB,toB}=next;if(composition&&composition.range.fromB<toB&&composition.range.toB>fromB){let before=ContentBuilder.build(this.view.state.doc,fromB,composition.range.fromB,this.decorations,this.dynamicDecorationMap),after=ContentBuilder.build(this.view.state.doc,composition.range.toB,toB,this.decorations,this.dynamicDecorationMap);breakAtStart=before.breakAtStart,openStart=before.openStart,openEnd=after.openEnd;let compLine=this.compositionView(composition);after.breakAtStart?compLine.breakAfter=1:after.content.length&&compLine.merge(compLine.length,compLine.length,after.content[0],!1,after.openStart,0)&&(compLine.breakAfter=after.content[0].breakAfter,after.content.shift()),before.content.length&&compLine.merge(0,0,before.content[before.content.length-1],!0,0,before.openEnd)&&before.content.pop(),content=before.content.concat(compLine).concat(after.content)}else({content,breakAtStart,openStart,openEnd}=ContentBuilder.build(this.view.state.doc,fromB,toB,this.decorations,this.dynamicDecorationMap));let{i:toI,off:toOff}=cursor.findPos(toA,1),{i:fromI,off:fromOff}=cursor.findPos(fromA,-1);replaceRange(this,fromI,fromOff,toI,toOff,content,breakAtStart,openStart,openEnd)}composition&&this.fixCompositionDOM(composition)}updateEditContextFormatting(update){this.editContextFormatting=this.editContextFormatting.map(update.changes);for(let tr of update.transactions)for(let effect of tr.effects)effect.is(setEditContextFormatting)&&(this.editContextFormatting=effect.value)}compositionView(composition){let cur=new TextView(composition.text.nodeValue);cur.flags|=8;for(let{deco}of composition.marks)cur=new MarkView(deco,[cur],cur.length);let line=new LineView;return line.append(cur,0),line}fixCompositionDOM(composition){let fix=(dom,cView)=>{cView.flags|=8|(cView.children.some((c=>7&c.flags))?1:0),this.markedForComposition.add(cView);let prev=ContentView.get(dom);prev&&prev!=cView&&(prev.dom=null),cView.setDOM(dom)},pos=this.childPos(composition.range.fromB,1),cView=this.children[pos.i];fix(composition.line,cView);for(let i=composition.marks.length-1;i>=-1;i--)pos=cView.childPos(pos.off,1),cView=cView.children[pos.i],fix(i>=0?composition.marks[i].node:composition.text,cView)}updateSelection(mustRead=!1,fromPointer=!1){!mustRead&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let activeElt=this.view.root.activeElement,focused=activeElt==this.dom,selectionNotFocus=!focused&&!(this.view.state.facet(editable)||this.dom.tabIndex>-1)&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(activeElt&&this.dom.contains(activeElt));if(!(focused||fromPointer||selectionNotFocus))return;let force=this.forceSelection;this.forceSelection=!1;let main=this.view.state.selection.main,anchor=this.moveToLine(this.domAtPos(main.anchor)),head=main.empty?anchor:this.moveToLine(this.domAtPos(main.head));if(browser.gecko&&main.empty&&!this.hasComposition&&function betweenUneditable(pos){return 1==pos.node.nodeType&&pos.node.firstChild&&(0==pos.offset||"false"==pos.node.childNodes[pos.offset-1].contentEditable)&&(pos.offset==pos.node.childNodes.length||"false"==pos.node.childNodes[pos.offset].contentEditable)}(anchor)){let dummy=document.createTextNode("");this.view.observer.ignore((()=>anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null))),anchor=head=new DOMPos(dummy,0),force=!0}let domSel=this.view.observer.selectionRange;!force&&domSel.focusNode&&(isEquivalentPosition(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)&&isEquivalentPosition(head.node,head.offset,domSel.focusNode,domSel.focusOffset)||this.suppressWidgetCursorChange(domSel,main))||(this.view.observer.ignore((()=>{browser.android&&browser.chrome&&this.dom.contains(domSel.focusNode)&&function inUneditable(node,inside){for(let cur=node;cur&&cur!=inside;cur=cur.assignedSlot||cur.parentNode)if(1==cur.nodeType&&"false"==cur.contentEditable)return!0;return!1}(domSel.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let rawSel=getSelection(this.view.root);if(rawSel)if(main.empty){if(browser.gecko){let nextTo=function nextToUneditable(node,offset){return 1!=node.nodeType?0:(offset&&"false"==node.childNodes[offset-1].contentEditable?1:0)|(offset<node.childNodes.length&&"false"==node.childNodes[offset].contentEditable?2:0)}(anchor.node,anchor.offset);if(nextTo&&3!=nextTo){let text=(1==nextTo?textNodeBefore:textNodeAfter)(anchor.node,anchor.offset);text&&(anchor=new DOMPos(text.node,text.offset))}}rawSel.collapse(anchor.node,anchor.offset),null!=main.bidiLevel&&void 0!==rawSel.caretBidiLevel&&(rawSel.caretBidiLevel=main.bidiLevel)}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);try{rawSel.extend(head.node,head.offset)}catch(_){}}else{let range=document.createRange();main.anchor>main.head&&([anchor,head]=[head,anchor]),range.setEnd(head.node,head.offset),range.setStart(anchor.node,anchor.offset),rawSel.removeAllRanges(),rawSel.addRange(range)}else;selectionNotFocus&&this.view.root.activeElement==this.dom&&(this.dom.blur(),activeElt&&activeElt.focus())})),this.view.observer.setSelectionRange(anchor,head)),this.impreciseAnchor=anchor.precise?null:new DOMPos(domSel.anchorNode,domSel.anchorOffset),this.impreciseHead=head.precise?null:new DOMPos(domSel.focusNode,domSel.focusOffset)}suppressWidgetCursorChange(sel,cursor){return this.hasComposition&&cursor.empty&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)&&this.posFromDOM(sel.focusNode,sel.focusOffset)==cursor.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view}=this,cursor=view.state.selection.main,sel=getSelection(view.root),{anchorNode,anchorOffset}=view.observer.selectionRange;if(!(sel&&cursor.empty&&cursor.assoc&&sel.modify))return;let line=LineView.find(this,cursor.head);if(!line)return;let lineStart=line.posAtStart;if(cursor.head==lineStart||cursor.head==lineStart+line.length)return;let before=this.coordsAt(cursor.head,-1),after=this.coordsAt(cursor.head,1);if(!before||!after||before.bottom>after.top)return;let dom=this.domAtPos(cursor.head+cursor.assoc);sel.collapse(dom.node,dom.offset),sel.modify("move",cursor.assoc<0?"forward":"backward","lineboundary"),view.observer.readSelectionRange();let newRange=view.observer.selectionRange;view.docView.posFromDOM(newRange.anchorNode,newRange.anchorOffset)!=cursor.from&&sel.collapse(anchorNode,anchorOffset)}moveToLine(pos){let newPos,dom=this.dom;if(pos.node!=dom)return pos;for(let i=pos.offset;!newPos&&i<dom.childNodes.length;i++){let view=ContentView.get(dom.childNodes[i]);view instanceof LineView&&(newPos=view.domAtPos(0))}for(let i=pos.offset-1;!newPos&&i>=0;i--){let view=ContentView.get(dom.childNodes[i]);view instanceof LineView&&(newPos=view.domAtPos(view.length))}return newPos?new DOMPos(newPos.node,newPos.offset,!0):pos}nearest(dom){for(let cur=dom;cur;){let domView=ContentView.get(cur);if(domView&&domView.rootView==this)return domView;cur=cur.parentNode}return null}posFromDOM(node,offset){let view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart}domAtPos(pos){let{i,off}=this.childCursor().findPos(pos,-1);for(;i<this.children.length-1;){let child=this.children[i];if(off<child.length||child instanceof LineView)break;i++,off=0}return this.children[i].domAtPos(off)}coordsAt(pos,side){let best=null,bestPos=0;for(let off=this.length,i=this.children.length-1;i>=0;i--){let child=this.children[i],end=off-child.breakAfter,start=end-child.length;if(end<pos)break;if(start<=pos&&(start<pos||child.covers(-1))&&(end>pos||child.covers(1))&&(!best||child instanceof LineView&&!(best instanceof LineView&&side>=0)))best=child,bestPos=start;else if(best&&start==pos&&end==pos&&child instanceof BlockWidgetView&&Math.abs(side)<2){if(child.deco.startSide<0)break;i&&(best=null)}off=start}return best?best.coordsAt(pos-bestPos,side):null}coordsForChar(pos){let{i,off}=this.childPos(pos,1),child=this.children[i];if(!(child instanceof LineView))return null;for(;child.children.length;){let{i,off:childOff}=child.childPos(off,1);for(;;i++){if(i==child.children.length)return null;if((child=child.children[i]).length)break}off=childOff}if(!(child instanceof TextView))return null;let end=(0,state_dist.zK)(child.text,off);if(end==off)return null;let rects=textRange(child.dom,off,end).getClientRects();for(let i=0;i<rects.length;i++){let rect=rects[i];if(i==rects.length-1||rect.top<rect.bottom&&rect.left<rect.right)return rect}return null}measureVisibleLineHeights(viewport){let result=[],{from,to}=viewport,contentWidth=this.view.contentDOM.clientWidth,isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,widest=-1,ltr=this.view.textDirection==Direction.LTR;for(let pos=0,i=0;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(end>to)break;if(pos>=from){let childRect=child.dom.getBoundingClientRect();if(result.push(childRect.height),isWider){let last=child.dom.lastChild,rects=last?clientRectsFor(last):[];if(rects.length){let rect=rects[rects.length-1],width=ltr?rect.right-childRect.left:childRect.right-rect.left;width>widest&&(widest=width,this.minWidth=contentWidth,this.minWidthFrom=pos,this.minWidthTo=end)}}}pos=end+child.breakAfter}return result}textDirectionAt(pos){let{i}=this.childPos(pos,1);return"rtl"==getComputedStyle(this.children[i].dom).direction?Direction.RTL:Direction.LTR}measureTextSize(){for(let child of this.children)if(child instanceof LineView){let measure=child.measureTextSize();if(measure)return measure}let lineHeight,charWidth,textHeight,dummy=document.createElement("div");return dummy.className="cm-line",dummy.style.width="99999px",dummy.style.position="absolute",dummy.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(dummy);let rect=clientRectsFor(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height,charWidth=rect?rect.width/27:7,textHeight=rect?rect.height:lineHeight,dummy.remove()})),{lineHeight,charWidth,textHeight}}childCursor(pos=this.length){let i=this.children.length;return i&&(pos-=this.children[--i].length),new ChildCursor(this.children,pos,i)}computeBlockGapDeco(){let deco=[],vs=this.view.viewState;for(let pos=0,i=0;;i++){let next=i==vs.viewports.length?null:vs.viewports[i],end=next?next.from-1:this.length;if(end>pos){let height=(vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top)/this.view.scaleY;deco.push(Decoration.replace({widget:new BlockGapWidget(height),block:!0,inclusive:!0,isBlockGap:!0}).range(pos,end))}if(!next)break;pos=next.to+1}return Decoration.set(deco)}updateDeco(){let i=1,allDeco=this.view.state.facet(decorations).map((d=>(this.dynamicDecorationMap[i++]="function"==typeof d)?d(this.view):d)),dynamicOuter=!1,outerDeco=this.view.state.facet(outerDecorations).map(((d,i)=>{let dynamic="function"==typeof d;return dynamic&&(dynamicOuter=!0),dynamic?d(this.view):d}));for(outerDeco.length&&(this.dynamicDecorationMap[i++]=dynamicOuter,allDeco.push(state_dist.om.join(outerDeco))),this.decorations=[this.editContextFormatting,...allDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];i<this.decorations.length;)this.dynamicDecorationMap[i++]=!1;return this.decorations}scrollIntoView(target){if(target.isSnapshot){let ref=this.view.viewState.lineBlockAt(target.range.head);return this.view.scrollDOM.scrollTop=ref.top-target.yMargin,void(this.view.scrollDOM.scrollLeft=target.xMargin)}for(let handler of this.view.state.facet(scrollHandler))try{if(handler(this.view,target.range,target))return!0}catch(e){logException(this.view.state,e,"scroll handler")}let other,{range}=target,rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1);if(!rect)return;!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1))&&(rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)});let margins=getScrollMargins(this.view),targetRect={left:rect.left-margins.left,top:rect.top-margins.top,right:rect.right+margins.right,bottom:rect.bottom+margins.bottom},{offsetWidth,offsetHeight}=this.view.scrollDOM;!function scrollRectIntoView(dom,rect,side,x,y,xMargin,yMargin,ltr){let doc=dom.ownerDocument,win=doc.defaultView||window;for(let cur=dom,stop=!1;cur&&!stop;)if(1==cur.nodeType){let bounding,top=cur==doc.body,scaleX=1,scaleY=1;if(top)bounding=windowRect(win);else{if(/^(fixed|sticky)$/.test(getComputedStyle(cur).position)&&(stop=!0),cur.scrollHeight<=cur.clientHeight&&cur.scrollWidth<=cur.clientWidth){cur=cur.assignedSlot||cur.parentNode;continue}let rect=cur.getBoundingClientRect();({scaleX,scaleY}=getScale(cur,rect)),bounding={left:rect.left,right:rect.left+cur.clientWidth*scaleX,top:rect.top,bottom:rect.top+cur.clientHeight*scaleY}}let moveX=0,moveY=0;if("nearest"==y)rect.top<bounding.top?(moveY=-(bounding.top-rect.top+yMargin),side>0&&rect.bottom>bounding.bottom+moveY&&(moveY=rect.bottom-bounding.bottom+moveY+yMargin)):rect.bottom>bounding.bottom&&(moveY=rect.bottom-bounding.bottom+yMargin,side<0&&rect.top-moveY<bounding.top&&(moveY=-(bounding.top+moveY-rect.top+yMargin)));else{let rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;moveY=("center"==y&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:"start"==y||"center"==y&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin)-bounding.top}if("nearest"==x?rect.left<bounding.left?(moveX=-(bounding.left-rect.left+xMargin),side>0&&rect.right>bounding.right+moveX&&(moveX=rect.right-bounding.right+moveX+xMargin)):rect.right>bounding.right&&(moveX=rect.right-bounding.right+xMargin,side<0&&rect.left<bounding.left+moveX&&(moveX=-(bounding.left+moveX-rect.left+xMargin))):moveX=("center"==x?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:"start"==x==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin)-bounding.left,moveX||moveY)if(top)win.scrollBy(moveX,moveY);else{let movedX=0,movedY=0;if(moveY){let start=cur.scrollTop;cur.scrollTop+=moveY/scaleY,movedY=(cur.scrollTop-start)*scaleY}if(moveX){let start=cur.scrollLeft;cur.scrollLeft+=moveX/scaleX,movedX=(cur.scrollLeft-start)*scaleX}rect={left:rect.left-movedX,top:rect.top-movedY,right:rect.right-movedX,bottom:rect.bottom-movedY},movedX&&Math.abs(movedX-moveX)<1&&(x="nearest"),movedY&&Math.abs(movedY-moveY)<1&&(y="nearest")}if(top)break;cur=cur.assignedSlot||cur.parentNode}else{if(11!=cur.nodeType)break;cur=cur.host}}(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,Math.max(Math.min(target.xMargin,offsetWidth),-offsetWidth),Math.max(Math.min(target.yMargin,offsetHeight),-offsetHeight),this.view.textDirection==Direction.LTR)}}function findCompositionNode(view,headPos){let sel=view.observer.selectionRange;if(!sel.focusNode)return null;let textBefore=textNodeBefore(sel.focusNode,sel.focusOffset),textAfter=textNodeAfter(sel.focusNode,sel.focusOffset),textNode=textBefore||textAfter;if(textAfter&&textBefore&&textAfter.node!=textBefore.node){let descAfter=ContentView.get(textAfter.node);if(!descAfter||descAfter instanceof TextView&&descAfter.text!=textAfter.node.nodeValue)textNode=textAfter;else if(view.docView.lastCompositionAfterCursor){let descBefore=ContentView.get(textBefore.node);!descBefore||descBefore instanceof TextView&&descBefore.text!=textBefore.node.nodeValue||(textNode=textAfter)}}if(view.docView.lastCompositionAfterCursor=textNode!=textBefore,!textNode)return null;let from=headPos-textNode.offset;return{from,to:from+textNode.node.nodeValue.length,node:textNode.node}}let DecorationComparator$1=class DecorationComparator{constructor(){this.changes=[]}compareRange(from,to){addRange(from,to,this.changes)}comparePoint(from,to){addRange(from,to,this.changes)}boundChange(pos){addRange(pos,pos,this.changes)}};function getdx(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right)}function getdy(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom)}function yOverlap(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1}function upTop(rect,top){return top<rect.top?{top,left:rect.left,right:rect.right,bottom:rect.bottom}:rect}function upBot(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom}:rect}function domPosAtCoords(parent,x,y){let closest,closestRect,closestX,closestY,above,below,aboveRect,belowRect,closestOverlap=!1;for(let child=parent.firstChild;child;child=child.nextSibling){let rects=clientRectsFor(child);for(let i=0;i<rects.length;i++){let rect=rects[i];closestRect&&yOverlap(closestRect,rect)&&(rect=upTop(upBot(rect,closestRect.bottom),closestRect.top));let dx=getdx(x,rect),dy=getdy(y,rect);if(0==dx&&0==dy)return 3==child.nodeType?domPosInText(child,x,y):domPosAtCoords(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child,closestRect=rect,closestX=dx,closestY=dy;let side=dy?y<rect.top?-1:1:dx?x<rect.left?-1:1:0;closestOverlap=!side||(side>0?i<rects.length-1:i>0)}0==dx?y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)?(above=child,aboveRect=rect):y<rect.top&&(!belowRect||belowRect.top>rect.top)&&(below=child,belowRect=rect):aboveRect&&yOverlap(aboveRect,rect)?aboveRect=upBot(aboveRect,rect.bottom):belowRect&&yOverlap(belowRect,rect)&&(belowRect=upTop(belowRect,rect.top))}}if(aboveRect&&aboveRect.bottom>=y?(closest=above,closestRect=aboveRect):belowRect&&belowRect.top<=y&&(closest=below,closestRect=belowRect),!closest)return{node:parent,offset:0};let clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));return 3==closest.nodeType?domPosInText(closest,clipX,y):closestOverlap&&"false"!=closest.contentEditable?domPosAtCoords(closest,clipX,y):{node:parent,offset:Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0)}}function domPosInText(node,x,y){let len=node.nodeValue.length,closestOffset=-1,closestDY=1e9,generalSide=0;for(let i=0;i<len;i++){let rects=textRange(node,i,i+1).getClientRects();for(let j=0;j<rects.length;j++){let rect=rects[j];if(rect.top==rect.bottom)continue;generalSide||(generalSide=x-rect.left);let dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){let right=x>=(rect.left+rect.right)/2,after=right;if(browser.chrome||browser.gecko){textRange(node,i).getBoundingClientRect().left==rect.right&&(after=!right)}if(dy<=0)return{node,offset:i+(after?1:0)};closestOffset=i+(after?1:0),closestDY=dy}}}return{node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0}}function posAtCoords(view,coords,precise,bias=-1){var _a,_b;let block,content=view.contentDOM.getBoundingClientRect(),docTop=content.top+view.viewState.paddingTop,{docHeight}=view.viewState,{x,y}=coords,yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(let halfLine=view.viewState.heightOracle.textHeight/2,bounced=!1;block=view.elementAtHeight(yOffset),block.type!=BlockType.Text;)for(;yOffset=bias>0?block.bottom+halfLine:block.top-halfLine,!(yOffset>=0&&yOffset<=docHeight);){if(bounced)return precise?null:0;bounced=!0,bias=-bias}y=docTop+yOffset;let lineStart=block.from;if(lineStart<view.viewport.from)return 0==view.viewport.from?0:precise?null:posAtCoordsImprecise(view,content,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise(view,content,block,x,y);let doc=view.dom.ownerDocument,root=view.root.elementFromPoint?view.root:doc,element=root.elementFromPoint(x,y);element&&!view.contentDOM.contains(element)&&(element=null),element||(x=Math.max(content.left+1,Math.min(content.right-1,x)),element=root.elementFromPoint(x,y),element&&!view.contentDOM.contains(element)&&(element=null));let node,offset=-1;if(element&&0!=(null===(_a=view.docView.nearest(element))||void 0===_a?void 0:_a.isEditable)){if(doc.caretPositionFromPoint){let pos=doc.caretPositionFromPoint(x,y);pos&&({offsetNode:node,offset}=pos)}else if(doc.caretRangeFromPoint){let range=doc.caretRangeFromPoint(x,y);range&&(({startContainer:node,startOffset:offset}=range),(!view.contentDOM.contains(node)||browser.safari&&function isSuspiciousSafariCaretResult(node,offset,x){let len;if(3!=node.nodeType||offset!=(len=node.nodeValue.length))return!1;for(let next=node.nextSibling;next;next=next.nextSibling)if(1!=next.nodeType||"BR"!=next.nodeName)return!1;return textRange(node,len-1,len).getBoundingClientRect().left>x}(node,offset,x)||browser.chrome&&function isSuspiciousChromeCaretResult(node,offset,x){if(0!=offset)return!1;for(let cur=node;;){let parent=cur.parentNode;if(!parent||1!=parent.nodeType||parent.firstChild!=cur)return!1;if(parent.classList.contains("cm-line"))break;cur=parent}let rect=1==node.nodeType?node.getBoundingClientRect():textRange(node,0,Math.max(node.nodeValue.length,1)).getBoundingClientRect();return x-rect.left>5}(node,offset,x))&&(node=void 0))}node&&(offset=Math.min(maxOffset(node),offset))}if(!node||!view.docView.dom.contains(node)){let line=LineView.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;({node,offset}=domPosAtCoords(line.dom,x,y))}let nearest=view.docView.nearest(node);if(!nearest)return null;if(nearest.isWidget&&1==(null===(_b=nearest.dom)||void 0===_b?void 0:_b.nodeType)){let rect=nearest.dom.getBoundingClientRect();return coords.y<rect.top||coords.y<=rect.bottom&&coords.x<=(rect.left+rect.right)/2?nearest.posAtStart:nearest.posAtEnd}return nearest.localPosFromDOM(node,offset)+nearest.posAtStart}function posAtCoordsImprecise(view,contentRect,block,x,y){let into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>1.5*view.defaultLineHeight){let textHeight=view.viewState.heightOracle.textHeight;into+=Math.floor((y-block.top-.5*(view.defaultLineHeight-textHeight))/textHeight)*view.viewState.heightOracle.lineLength}let content=view.state.sliceDoc(block.from,block.to);return block.from+(0,state_dist.kn)(content,into,view.state.tabSize)}function blockAt(view,pos){let line=view.lineBlockAt(pos);if(Array.isArray(line.type))for(let l of line.type)if(l.to>pos||l.to==pos&&(l.to==line.to||l.type==BlockType.Text))return l;return line}function moveByChar(view,start,forward,by){let line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line),direction=view.textDirectionAt(line.from);for(let cur=start,check=null;;){let next=moveVisually(line,spans,direction,cur,forward),char=movedOver;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur;char="\n",line=view.state.doc.line(line.number+(forward?1:-1)),spans=view.bidiSpans(line),next=view.visualLineSide(line,!forward)}if(check){if(!check(char))return cur}else{if(!by)return next;check=by(char)}cur=next}}function skipAtomicRanges(atoms,pos,bias){for(;;){let moved=0;for(let set of atoms)set.between(pos-1,pos+1,((from,to,value)=>{if(pos>from&&pos<to){let side=moved||bias||(pos-from<to-pos?-1:1);pos=side<0?from:to,moved=side}}));if(!moved)return pos}}function skipAtoms(view,oldPos,pos){let newPos=skipAtomicRanges(view.state.facet(atomicRanges).map((f=>f(view))),pos.from,oldPos.head>pos.from?-1:1);return newPos==pos.from?pos:state_dist.OF.cursor(newPos,newPos<pos.from?1:-1)}class DOMReader{constructor(points,state){this.points=points,this.text="",this.lineSeparator=state.facet(state_dist.$t.lineSeparator)}append(text){this.text+=text}lineBreak(){this.text+="￿"}readRange(start,end){if(!start)return this;let parent=start.parentNode;for(let cur=start;;){this.findPointBefore(parent,cur);let oldLen=this.text.length;this.readNode(cur);let next=cur.nextSibling;if(next==end)break;let view=ContentView.get(cur),nextView=ContentView.get(next);(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement(cur))||isBlockElement(next)&&("BR"!=cur.nodeName||cur.cmIgnore)&&this.text.length>oldLen)&&this.lineBreak(),cur=next}return this.findPointBefore(parent,end),this}readTextNode(node){let text=node.nodeValue;for(let point of this.points)point.node==node&&(point.pos=this.text.length+Math.min(point.offset,text.length));for(let off=0,re=this.lineSeparator?null:/\r\n?|\n/g;;){let m,nextBreak=-1,breakSize=1;if(this.lineSeparator?(nextBreak=text.indexOf(this.lineSeparator,off),breakSize=this.lineSeparator.length):(m=re.exec(text))&&(nextBreak=m.index,breakSize=m[0].length),this.append(text.slice(off,nextBreak<0?text.length:nextBreak)),nextBreak<0)break;if(this.lineBreak(),breakSize>1)for(let point of this.points)point.node==node&&point.pos>this.text.length&&(point.pos-=breakSize-1);off=nextBreak+breakSize}}readNode(node){if(node.cmIgnore)return;let view=ContentView.get(node),fromView=view&&view.overrideDOMText;if(null!=fromView){this.findPointInside(node,fromView.length);for(let i=fromView.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else 3==node.nodeType?this.readTextNode(node):"BR"==node.nodeName?node.nextSibling&&this.lineBreak():1==node.nodeType&&this.readRange(node.firstChild,null)}findPointBefore(node,next){for(let point of this.points)point.node==node&&node.childNodes[point.offset]==next&&(point.pos=this.text.length)}findPointInside(node,length){for(let point of this.points)(3==node.nodeType?point.node==node:node.contains(point.node))&&(point.pos=this.text.length+(isAtEnd(node,point.node,point.offset)?length:0))}}function isAtEnd(parent,node,offset){for(;;){if(!node||offset<maxOffset(node))return!1;if(node==parent)return!0;offset=domIndex(node)+1,node=node.parentNode}}class DOMPoint{constructor(node,offset){this.node=node,this.offset=offset,this.pos=-1}}class DOMChange{constructor(view,start,end,typeOver){this.typeOver=typeOver,this.bounds=null,this.text="",this.domChanged=start>-1;let{impreciseHead:iHead,impreciseAnchor:iAnchor}=view.docView;if(view.state.readOnly&&start>-1)this.newSel=null;else if(start>-1&&(this.bounds=view.docView.domBoundsAround(start,end,0))){let selPoints=iHead||iAnchor?[]:function selectionPoints(view){let result=[];if(view.root.activeElement!=view.contentDOM)return result;let{anchorNode,anchorOffset,focusNode,focusOffset}=view.observer.selectionRange;anchorNode&&(result.push(new DOMPoint(anchorNode,anchorOffset)),focusNode==anchorNode&&focusOffset==anchorOffset||result.push(new DOMPoint(focusNode,focusOffset)));return result}(view),reader=new DOMReader(selPoints,view.state);reader.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=reader.text,this.newSel=function selectionFromPoints(points,base){if(0==points.length)return null;let anchor=points[0].pos,head=2==points.length?points[1].pos:anchor;return anchor>-1&&head>-1?state_dist.OF.single(anchor+base,head+base):null}(selPoints,this.bounds.from)}else{let domSel=view.observer.selectionRange,head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset),anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset),vp=view.viewport;if((browser.ios||browser.chrome)&&view.state.selection.main.empty&&head!=anchor&&(vp.from>0||vp.to<view.state.doc.length)){let from=Math.min(head,anchor),to=Math.max(head,anchor),offFrom=vp.from-from,offTo=vp.to-to;0!=offFrom&&1!=offFrom&&0!=from||0!=offTo&&-1!=offTo&&to!=view.state.doc.length||(head=0,anchor=view.state.doc.length)}this.newSel=state_dist.OF.single(anchor,head)}}}function applyDOMChange(view,domChange){let change,{newSel}=domChange,sel=view.state.selection.main,lastKey=view.inputState.lastKeyTime>Date.now()-100?view.inputState.lastKeyCode:-1;if(domChange.bounds){let{from,to}=domChange.bounds,preferredPos=sel.from,preferredSide=null;(8===lastKey||browser.android&&domChange.text.length<to-from)&&(preferredPos=sel.to,preferredSide="end");let diff=function findDiff(a,b,preferredPos,preferredSide){let minLen=Math.min(a.length,b.length),from=0;for(;from<minLen&&a.charCodeAt(from)==b.charCodeAt(from);)from++;if(from==minLen&&a.length==b.length)return null;let toA=a.length,toB=b.length;for(;toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1);)toA--,toB--;if("end"==preferredSide){preferredPos-=toA+Math.max(0,from-Math.min(toA,toB))-from}if(toA<from&&a.length<b.length){from-=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0,toB=from+(toB-toA),toA=from}else if(toB<from){from-=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0,toA=from+(toA-toB),toB=from}return{from,toA,toB}}(view.state.doc.sliceString(from,to,"￿"),domChange.text,preferredPos-from,preferredSide);diff&&(browser.chrome&&13==lastKey&&diff.toB==diff.from+2&&"￿￿"==domChange.text.slice(diff.from,diff.toB)&&diff.toB--,change={from:from+diff.from,to:from+diff.toA,insert:state_dist.EY.of(domChange.text.slice(diff.from,diff.toB).split("￿"))})}else newSel&&(!view.hasFocus&&view.state.facet(editable)||newSel.main.eq(sel))&&(newSel=null);if(!change&&!newSel)return!1;if(!change&&domChange.typeOver&&!sel.empty&&newSel&&newSel.main.empty?change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)}:(browser.mac||browser.android)&&change&&change.from==change.to&&change.from==sel.head-1&&/^\. ?$/.test(change.insert.toString())&&"off"==view.contentDOM.getAttribute("autocorrect")?(newSel&&2==change.insert.length&&(newSel=state_dist.OF.single(newSel.main.anchor-1,newSel.main.head-1)),change={from:change.from,to:change.to,insert:state_dist.EY.of([change.insert.toString().replace("."," ")])}):change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4?change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))}:browser.chrome&&change&&change.from==change.to&&change.from==sel.head&&"\n "==change.insert.toString()&&view.lineWrapping&&(newSel&&(newSel=state_dist.OF.single(newSel.main.anchor-1,newSel.main.head-1)),change={from:sel.from,to:sel.to,insert:state_dist.EY.of([" "])}),change)return applyDOMChangeInner(view,change,newSel,lastKey);if(newSel&&!newSel.main.eq(sel)){let scrollIntoView=!1,userEvent="select";return view.inputState.lastSelectionTime>Date.now()-50&&("select"==view.inputState.lastSelectionOrigin&&(scrollIntoView=!0),userEvent=view.inputState.lastSelectionOrigin),view.dispatch({selection:newSel,scrollIntoView,userEvent}),!0}return!1}function applyDOMChangeInner(view,change,newSel,lastKey=-1){if(browser.ios&&view.inputState.flushIOSKey(change))return!0;let sel=view.state.selection.main;if(browser.android&&(change.to==sel.to&&(change.from==sel.from||change.from==sel.from-1&&" "==view.state.sliceDoc(change.from,sel.from))&&1==change.insert.length&&2==change.insert.lines&&dispatchKey(view.contentDOM,"Enter",13)||(change.from==sel.from-1&&change.to==sel.to&&0==change.insert.length||8==lastKey&&change.insert.length<change.to-change.from&&change.to>sel.head)&&dispatchKey(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&0==change.insert.length&&dispatchKey(view.contentDOM,"Delete",46)))return!0;let defaultTr,text=change.insert.toString();view.inputState.composing>=0&&view.inputState.composing++;let defaultInsert=()=>defaultTr||(defaultTr=function applyDefaultInsert(view,change,newSel){let tr,startState=view.state,sel=startState.selection.main;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){let before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"",after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after))}else{let changes=startState.changes(change),mainSel=newSel&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){let compositionRange,replaced=view.state.sliceDoc(change.from,change.to),composition=newSel&&findCompositionNode(view,newSel.main.head);if(composition){let dLen=change.insert.length-(change.to-change.from);compositionRange={from:composition.from,to:composition.to-dLen}}else compositionRange=view.state.doc.lineAt(sel.head);let offset=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange((range=>{if(range.from==sel.from&&range.to==sel.to)return{changes,range:mainSel||range.map(changes)};let to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range};let rangeChanges=startState.changes({from,to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:mainSel?state_dist.OF.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff)):range.map(rangeChanges)}}))}else tr={changes,selection:mainSel&&startState.selection.replaceRange(mainSel)}}let userEvent="input.type";(view.composing||view.inputState.compositionPendingChange&&view.inputState.compositionEndedAt>Date.now()-50)&&(view.inputState.compositionPendingChange=!1,userEvent+=".compose",view.inputState.compositionFirstChange&&(userEvent+=".start",view.inputState.compositionFirstChange=!1));return startState.update(tr,{userEvent,scrollIntoView:!0})}(view,change,newSel));return view.state.facet(inputHandler).some((h=>h(view,change.from,change.to,text,defaultInsert)))||view.dispatch(defaultInsert()),!0}class InputState{setSelectionOrigin(origin){this.lastSelectionOrigin=origin,this.lastSelectionTime=Date.now()}constructor(view){this.view=view,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=view.hasFocus,browser.safari&&view.contentDOM.addEventListener("input",(()=>null)),browser.gecko&&function firefoxCopyCutHack(doc){appliedFirefoxHack.has(doc)||(appliedFirefoxHack.add(doc),doc.addEventListener("copy",(()=>{})),doc.addEventListener("cut",(()=>{})))}(view.contentDOM.ownerDocument)}handleEvent(event){(function eventBelongsToEditor(view,event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(let cView,node=event.target;node!=view.contentDOM;node=node.parentNode)if(!node||11==node.nodeType||(cView=ContentView.get(node))&&cView.ignoreEvent(event))return!1;return!0})(this.view,event)&&!this.ignoreDuringComposition(event)&&("keydown"==event.type&&this.keydown(event)||this.runHandlers(event.type,event))}runHandlers(type,event){let handlers=this.handlers[type];if(handlers){for(let observer of handlers.observers)observer(this.view,event);for(let handler of handlers.handlers){if(event.defaultPrevented)break;if(handler(this.view,event)){event.preventDefault();break}}}}ensureHandlers(plugins){let handlers=computeHandlers(plugins),prev=this.handlers,dom=this.view.contentDOM;for(let type in handlers)if("scroll"!=type){let passive=!handlers[type].handlers.length,exists=prev[type];exists&&passive!=!exists.handlers.length&&(dom.removeEventListener(type,this.handleEvent),exists=null),exists||dom.addEventListener(type,this.handleEvent,{passive})}for(let type in prev)"scroll"==type||handlers[type]||dom.removeEventListener(type,this.handleEvent);this.handlers=handlers}keydown(event){if(this.lastKeyCode=event.keyCode,this.lastKeyTime=Date.now(),9==event.keyCode&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&27!=event.keyCode&&modifierCodes.indexOf(event.keyCode)<0&&(this.tabFocusMode=-1),browser.android&&browser.chrome&&!event.synthetic&&(13==event.keyCode||8==event.keyCode))return this.view.observer.delayAndroidKey(event.key,event.keyCode),!0;let pending;return!browser.ios||event.synthetic||event.altKey||event.metaKey||!((pending=PendingKeys.find((key=>key.keyCode==event.keyCode)))&&!event.ctrlKey||EmacsyPendingKeys.indexOf(event.key)>-1&&event.ctrlKey&&!event.shiftKey)?(229!=event.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=pending||event,setTimeout((()=>this.flushIOSKey()),250),!0)}flushIOSKey(change){let key=this.pendingIOSKey;return!!key&&(!("Enter"==key.key&&change&&change.from<change.to&&/^\S+$/.test(change.insert.toString()))&&(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,key.key,key.keyCode,key instanceof KeyboardEvent?key:void 0)))}ignoreDuringComposition(event){return!!/^key/.test(event.type)&&(this.composing>0||!!(browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(mouseSelection){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=mouseSelection}update(update){this.view.observer.update(update),this.mouseSelection&&this.mouseSelection.update(update),this.draggedContent&&update.docChanged&&(this.draggedContent=this.draggedContent.map(update.changes)),update.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(plugin,handler){return(view,event)=>{try{return handler.call(plugin,event,view)}catch(e){logException(view.state,e)}}}function computeHandlers(plugins){let result=Object.create(null);function record(type){return result[type]||(result[type]={observers:[],handlers:[]})}for(let plugin of plugins){let spec=plugin.spec;if(spec&&spec.domEventHandlers)for(let type in spec.domEventHandlers){let f=spec.domEventHandlers[type];f&&record(type).handlers.push(bindHandler(plugin.value,f))}if(spec&&spec.domEventObservers)for(let type in spec.domEventObservers){let f=spec.domEventObservers[type];f&&record(type).observers.push(bindHandler(plugin.value,f))}}for(let type in handlers)record(type).handlers.push(handlers[type]);for(let type in observers)record(type).observers.push(observers[type]);return result}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225];function dragScrollSpeed(dist){return.7*Math.max(0,dist)+8}class MouseSelection{constructor(view,startEvent,style,mustSelect){this.view=view,this.startEvent=startEvent,this.style=style,this.mustSelect=mustSelect,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=startEvent,this.scrollParents=function scrollableParents(dom){let x,y,doc=dom.ownerDocument;for(let cur=dom.parentNode;cur&&!(cur==doc.body||x&&y);)if(1==cur.nodeType)!y&&cur.scrollHeight>cur.clientHeight&&(y=cur),!x&&cur.scrollWidth>cur.clientWidth&&(x=cur),cur=cur.assignedSlot||cur.parentNode;else{if(11!=cur.nodeType)break;cur=cur.host}return{x,y}}(view.contentDOM),this.atoms=view.state.facet(atomicRanges).map((f=>f(view)));let doc=view.contentDOM.ownerDocument;doc.addEventListener("mousemove",this.move=this.move.bind(this)),doc.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=startEvent.shiftKey,this.multiple=view.state.facet(state_dist.$t.allowMultipleSelections)&&function addsSelectionRange(view,event){let facet=view.state.facet(clickAddsSelectionRange);return facet.length?facet[0](event):browser.mac?event.metaKey:event.ctrlKey}(view,startEvent),this.dragging=!(!function isInPrimarySelection(view,event){let{main}=view.state.selection;if(main.empty)return!1;let sel=getSelection(view.root);if(!sel||0==sel.rangeCount)return!0;let rects=sel.getRangeAt(0).getClientRects();for(let i=0;i<rects.length;i++){let rect=rects[i];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return!0}return!1}(view,startEvent)||1!=getClickType(startEvent))&&null}start(event){!1===this.dragging&&this.select(event)}move(event){if(0==event.buttons)return this.destroy();if(this.dragging||null==this.dragging&&function dist(a,b){return Math.max(Math.abs(a.clientX-b.clientX),Math.abs(a.clientY-b.clientY))}(this.startEvent,event)<10)return;this.select(this.lastEvent=event);let sx=0,sy=0,left=0,top=0,right=this.view.win.innerWidth,bottom=this.view.win.innerHeight;this.scrollParents.x&&({left,right}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top,bottom}=this.scrollParents.y.getBoundingClientRect());let margins=getScrollMargins(this.view);event.clientX-margins.left<=left+6?sx=-dragScrollSpeed(left-event.clientX):event.clientX+margins.right>=right-6&&(sx=dragScrollSpeed(event.clientX-right)),event.clientY-margins.top<=top+6?sy=-dragScrollSpeed(top-event.clientY):event.clientY+margins.bottom>=bottom-6&&(sy=dragScrollSpeed(event.clientY-bottom)),this.setScrollSpeed(sx,sy)}up(event){null==this.dragging&&this.select(this.lastEvent),this.dragging||event.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let doc=this.view.contentDOM.ownerDocument;doc.removeEventListener("mousemove",this.move),doc.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(sx,sy){this.scrollSpeed={x:sx,y:sy},sx||sy?this.scrolling<0&&(this.scrolling=setInterval((()=>this.scroll()),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x,y}=this.scrollSpeed;x&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=x,x=0),y&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=y,y=0),(x||y)&&this.view.win.scrollBy(x,y),!1===this.dragging&&this.select(this.lastEvent)}skipAtoms(sel){let ranges=null;for(let i=0;i<sel.ranges.length;i++){let range=sel.ranges[i],updated=null;if(range.empty){let pos=skipAtomicRanges(this.atoms,range.from,0);pos!=range.from&&(updated=state_dist.OF.cursor(pos,-1))}else{let from=skipAtomicRanges(this.atoms,range.from,-1),to=skipAtomicRanges(this.atoms,range.to,1);from==range.from&&to==range.to||(updated=state_dist.OF.range(range.from==range.anchor?from:to,range.from==range.head?from:to))}updated&&(ranges||(ranges=sel.ranges.slice()),ranges[i]=updated)}return ranges?state_dist.OF.create(ranges,sel.mainIndex):sel}select(event){let{view}=this,selection=this.skipAtoms(this.style.get(event,this.extend,this.multiple));!this.mustSelect&&selection.eq(view.state.selection,!1===this.dragging)||this.view.dispatch({selection,userEvent:"select.pointer"}),this.mustSelect=!1}update(update){update.transactions.some((tr=>tr.isUserEvent("input.type")))?this.destroy():this.style.update(update)&&setTimeout((()=>this.select(this.lastEvent)),20)}}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function textFilter(state,facet,text){for(let filter of state.facet(facet))text=filter(text,state);return text}function doPaste(view,input){input=textFilter(view.state,clipboardInputFilter,input);let changes,{state}=view,i=1,text=state.toText(input),byLine=text.lines==state.selection.ranges.length;if(null!=lastLinewiseCopy&&state.selection.ranges.every((r=>r.empty))&&lastLinewiseCopy==text.toString()){let lastLine=-1;changes=state.changeByRange((range=>{let line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range};lastLine=line.from;let insert=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert},range:state_dist.OF.cursor(range.from+insert.length)}}))}else changes=byLine?state.changeByRange((range=>{let line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:state_dist.OF.cursor(range.from+line.length)}})):state.replaceSelection(text);view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:!0})}function rangeForClick(view,pos,bias,type){if(1==type)return state_dist.OF.cursor(pos,bias);if(2==type)return function groupAt(state,pos,bias=1){let categorize=state.charCategorizer(pos),line=state.doc.lineAt(pos),linePos=pos-line.from;if(0==line.length)return state_dist.OF.cursor(pos);0==linePos?bias=1:linePos==line.length&&(bias=-1);let from=linePos,to=linePos;bias<0?from=(0,state_dist.zK)(line.text,linePos,!1):to=(0,state_dist.zK)(line.text,linePos);let cat=categorize(line.text.slice(from,to));for(;from>0;){let prev=(0,state_dist.zK)(line.text,from,!1);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev}for(;to<line.length;){let next=(0,state_dist.zK)(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next}return state_dist.OF.range(from+line.from,to+line.from)}(view.state,pos,bias);{let visual=LineView.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos),from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;return to<view.state.doc.length&&to==line.to&&to++,state_dist.OF.range(from,to)}}observers.scroll=view=>{view.inputState.lastScrollTop=view.scrollDOM.scrollTop,view.inputState.lastScrollLeft=view.scrollDOM.scrollLeft},handlers.keydown=(view,event)=>(view.inputState.setSelectionOrigin("select"),27==event.keyCode&&0!=view.inputState.tabFocusMode&&(view.inputState.tabFocusMode=Date.now()+2e3),!1),observers.touchstart=(view,e)=>{view.inputState.lastTouchTime=Date.now(),view.inputState.setSelectionOrigin("select.pointer")},observers.touchmove=view=>{view.inputState.setSelectionOrigin("select.pointer")},handlers.mousedown=(view,event)=>{if(view.observer.flush(),view.inputState.lastTouchTime>Date.now()-2e3)return!1;let style=null;for(let makeStyle of view.state.facet(mouseSelectionStyle))if(style=makeStyle(view,event),style)break;if(style||0!=event.button||(style=function basicMouseSelection(view,event){let start=queryPos(view,event),type=getClickType(event),startSel=view.state.selection;return{update(update){update.docChanged&&(start.pos=update.changes.mapPos(start.pos),startSel=startSel.map(update.changes))},get(event,extend,multiple){let removed,cur=queryPos(view,event),range=rangeForClick(view,cur.pos,cur.bias,type);if(start.pos!=cur.pos&&!extend){let startRange=rangeForClick(view,start.pos,start.bias,type),from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?state_dist.OF.range(from,to):state_dist.OF.range(to,from)}return extend?startSel.replaceRange(startSel.main.extend(range.from,range.to)):multiple&&1==type&&startSel.ranges.length>1&&(removed=function removeRangeAround(sel,pos){for(let i=0;i<sel.ranges.length;i++){let{from,to}=sel.ranges[i];if(from<=pos&&to>=pos)return state_dist.OF.create(sel.ranges.slice(0,i).concat(sel.ranges.slice(i+1)),sel.mainIndex==i?0:sel.mainIndex-(sel.mainIndex>i?1:0))}return null}(startSel,cur.pos))?removed:multiple?startSel.addRange(range):state_dist.OF.create([range])}}}(view,event)),style){let mustFocus=!view.hasFocus;view.inputState.startMouseSelection(new MouseSelection(view,event,style,mustFocus)),mustFocus&&view.observer.ignore((()=>{focusPreventScroll(view.contentDOM);let active=view.root.activeElement;active&&!active.contains(view.contentDOM)&&active.blur()}));let mouseSel=view.inputState.mouseSelection;if(mouseSel)return mouseSel.start(event),!1===mouseSel.dragging}return!1};let inside=(x,y,rect)=>y>=rect.top&&y<=rect.bottom&&x>=rect.left&&x<=rect.right;function findPositionSide(view,pos,x,y){let line=LineView.find(view.docView,pos);if(!line)return 1;let off=pos-line.posAtStart;if(0==off)return 1;if(off==line.length)return-1;let before=line.coordsAt(off,-1);if(before&&inside(x,y,before))return-1;let after=line.coordsAt(off,1);return after&&inside(x,y,after)?1:before&&before.bottom>=y?-1:1}function queryPos(view,event){let pos=view.posAtCoords({x:event.clientX,y:event.clientY},!1);return{pos,bias:findPositionSide(view,pos,event.clientX,event.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(event){if(!BadMouseDetail)return event.detail;let last=lastMouseDown,lastTime=lastMouseDownTime;return lastMouseDown=event,lastMouseDownTime=Date.now(),lastMouseDownCount=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount+1)%3:1}function dropText(view,event,text,direct){if(!(text=textFilter(view.state,clipboardInputFilter,text)))return;let dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},!1),{draggedContent}=view.inputState,del=direct&&draggedContent&&function dragMovesSelection(view,event){let facet=view.state.facet(dragMovesSelection$1);return facet.length?facet[0](event):browser.mac?!event.altKey:!event.ctrlKey}(view,event)?{from:draggedContent.from,to:draggedContent.to}:null,ins={from:dropPos,insert:text},changes=view.state.changes(del?[del,ins]:ins);view.focus(),view.dispatch({changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"}),view.inputState.draggedContent=null}handlers.dragstart=(view,event)=>{let{selection:{main:range}}=view.state;if(event.target.draggable){let cView=view.docView.nearest(event.target);if(cView&&cView.isWidget){let from=cView.posAtStart,to=from+cView.length;(from>=range.to||to<=range.from)&&(range=state_dist.OF.range(from,to))}}let{inputState}=view;return inputState.mouseSelection&&(inputState.mouseSelection.dragging=!0),inputState.draggedContent=range,event.dataTransfer&&(event.dataTransfer.setData("Text",textFilter(view.state,clipboardOutputFilter,view.state.sliceDoc(range.from,range.to))),event.dataTransfer.effectAllowed="copyMove"),!1},handlers.dragend=view=>(view.inputState.draggedContent=null,!1),handlers.drop=(view,event)=>{if(!event.dataTransfer)return!1;if(view.state.readOnly)return!0;let files=event.dataTransfer.files;if(files&&files.length){let text=Array(files.length),read=0,finishFile=()=>{++read==files.length&&dropText(view,event,text.filter((s=>null!=s)).join(view.state.lineBreak),!1)};for(let i=0;i<files.length;i++){let reader=new FileReader;reader.onerror=finishFile,reader.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result)||(text[i]=reader.result),finishFile()},reader.readAsText(files[i])}return!0}{let text=event.dataTransfer.getData("Text");if(text)return dropText(view,event,text,!0),!0}return!1},handlers.paste=(view,event)=>{if(view.state.readOnly)return!0;view.observer.flush();let data=brokenClipboardAPI?null:event.clipboardData;return data?(doPaste(view,data.getData("text/plain")||data.getData("text/uri-list")),!0):(function capturePaste(view){let parent=view.dom.parentNode;if(!parent)return;let target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px",target.focus(),setTimeout((()=>{view.focus(),target.remove(),doPaste(view,target.value)}),50)}(view),!1)};let lastLinewiseCopy=null;handlers.copy=handlers.cut=(view,event)=>{let{text,ranges,linewise}=function copiedRange(state){let content=[],ranges=[],linewise=!1;for(let range of state.selection.ranges)range.empty||(content.push(state.sliceDoc(range.from,range.to)),ranges.push(range));if(!content.length){let upto=-1;for(let{from}of state.selection.ranges){let line=state.doc.lineAt(from);line.number>upto&&(content.push(line.text),ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)})),upto=line.number}linewise=!0}return{text:textFilter(state,clipboardOutputFilter,content.join(state.lineBreak)),ranges,linewise}}(view.state);if(!text&&!linewise)return!1;lastLinewiseCopy=linewise?text:null,"cut"!=event.type||view.state.readOnly||view.dispatch({changes:ranges,scrollIntoView:!0,userEvent:"delete.cut"});let data=brokenClipboardAPI?null:event.clipboardData;return data?(data.clearData(),data.setData("text/plain",text),!0):(function captureCopy(view,text){let parent=view.dom.parentNode;if(!parent)return;let target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px",target.value=text,target.focus(),target.selectionEnd=text.length,target.selectionStart=0,setTimeout((()=>{target.remove(),view.focus()}),50)}(view,text),!1)};const isFocusChange=state_dist.YH.define();function focusChangeTransaction(state,focus){let effects=[];for(let getEffect of state.facet(focusChangeEffect)){let effect=getEffect(state,focus);effect&&effects.push(effect)}return effects?state.update({effects,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(view){setTimeout((()=>{let focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){let tr=focusChangeTransaction(view.state,focus);tr?view.dispatch(tr):view.update([])}}),10)}observers.focus=view=>{view.inputState.lastFocusTime=Date.now(),view.scrollDOM.scrollTop||!view.inputState.lastScrollTop&&!view.inputState.lastScrollLeft||(view.scrollDOM.scrollTop=view.inputState.lastScrollTop,view.scrollDOM.scrollLeft=view.inputState.lastScrollLeft),updateForFocusChange(view)},observers.blur=view=>{view.observer.clearSelectionRange(),updateForFocusChange(view)},observers.compositionstart=observers.compositionupdate=view=>{view.observer.editContext||(null==view.inputState.compositionFirstChange&&(view.inputState.compositionFirstChange=!0),view.inputState.composing<0&&(view.inputState.composing=0))},observers.compositionend=view=>{view.observer.editContext||(view.inputState.composing=-1,view.inputState.compositionEndedAt=Date.now(),view.inputState.compositionPendingKey=!0,view.inputState.compositionPendingChange=view.observer.pendingRecords().length>0,view.inputState.compositionFirstChange=null,browser.chrome&&browser.android?view.observer.flushSoon():view.inputState.compositionPendingChange?Promise.resolve().then((()=>view.observer.flush())):setTimeout((()=>{view.inputState.composing<0&&view.docView.hasComposition&&view.update([])}),50))},observers.contextmenu=view=>{view.inputState.lastContextMenu=Date.now()},handlers.beforeinput=(view,event)=>{var _a,_b;if("insertReplacementText"==event.inputType&&view.observer.editContext){let text=null===(_a=event.dataTransfer)||void 0===_a?void 0:_a.getData("text/plain"),ranges=event.getTargetRanges();if(text&&ranges.length){let r=ranges[0],from=view.posAtDOM(r.startContainer,r.startOffset),to=view.posAtDOM(r.endContainer,r.endOffset);return applyDOMChangeInner(view,{from,to,insert:view.state.toText(text)},null),!0}}let pending;if(browser.chrome&&browser.android&&(pending=PendingKeys.find((key=>key.inputType==event.inputType)))&&(view.observer.delayAndroidKey(pending.key,pending.keyCode),"Backspace"==pending.key||"Delete"==pending.key)){let startViewHeight=(null===(_b=window.visualViewport)||void 0===_b?void 0:_b.height)||0;setTimeout((()=>{var _a;((null===(_a=window.visualViewport)||void 0===_a?void 0:_a.height)||0)>startViewHeight+10&&view.hasFocus&&(view.contentDOM.blur(),view.focus())}),100)}return browser.ios&&"deleteContentForward"==event.inputType&&view.observer.flushSoon(),browser.safari&&"insertText"==event.inputType&&view.inputState.composing>=0&&setTimeout((()=>observers.compositionend(view,event)),20),!1};const appliedFirefoxHack=new Set;const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];let heightChangeFlag=!1;function clearHeightChangeFlag(){heightChangeFlag=!1}class HeightOracle{constructor(lineWrapping){this.lineWrapping=lineWrapping,this.doc=state_dist.EY.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(from,to){let lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;return this.lineWrapping&&(lines+=Math.max(0,Math.ceil((to-from-lines*this.lineLength*.5)/this.lineLength))),this.lineHeight*lines}heightForLine(length){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(doc){return this.doc=doc,this}mustRefreshForWrapping(whiteSpace){return wrappingWhiteSpace.indexOf(whiteSpace)>-1!=this.lineWrapping}mustRefreshForHeights(lineHeights){let newHeight=!1;for(let i=0;i<lineHeights.length;i++){let h=lineHeights[i];h<0?i++:this.heightSamples[Math.floor(10*h)]||(newHeight=!0,this.heightSamples[Math.floor(10*h)]=!0)}return newHeight}refresh(whiteSpace,lineHeight,charWidth,textHeight,lineLength,knownHeights){let lineWrapping=wrappingWhiteSpace.indexOf(whiteSpace)>-1,changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping;if(this.lineWrapping=lineWrapping,this.lineHeight=lineHeight,this.charWidth=charWidth,this.textHeight=textHeight,this.lineLength=lineLength,changed){this.heightSamples={};for(let i=0;i<knownHeights.length;i++){let h=knownHeights[i];h<0?i++:this.heightSamples[Math.floor(10*h)]=!0}}return changed}}class MeasuredHeights{constructor(from,heights){this.from=from,this.heights=heights,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(from,length,top,height,_content){this.from=from,this.length=length,this.top=top,this.height=height,this._content=_content}get type(){return"number"==typeof this._content?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(other){let content=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(other._content)?other._content:[other]);return new BlockInfo(this.from,this.length+other.length,this.top,this.height+other.height,content)}}var QueryType=function(QueryType){return QueryType[QueryType.ByPos=0]="ByPos",QueryType[QueryType.ByHeight=1]="ByHeight",QueryType[QueryType.ByPosNoHeight=2]="ByPosNoHeight",QueryType}(QueryType||(QueryType={}));class HeightMap{constructor(length,height,flags=2){this.length=length,this.height=height,this.flags=flags}get outdated(){return(2&this.flags)>0}set outdated(value){this.flags=(value?2:0)|-3&this.flags}setHeight(height){this.height!=height&&(Math.abs(this.height-height)>.001&&(heightChangeFlag=!0),this.height=height)}replace(_from,_to,nodes){return HeightMap.of(nodes)}decomposeLeft(_to,result){result.push(this)}decomposeRight(_from,result){result.push(this)}applyChanges(decorations,oldDoc,oracle,changes){let me=this,doc=oracle.doc;for(let i=changes.length-1;i>=0;i--){let{fromA,toA,fromB,toB}=changes[i],start=me.lineAt(fromA,QueryType.ByPosNoHeight,oracle.setDoc(oldDoc),0,0),end=start.to>=toA?start:me.lineAt(toA,QueryType.ByPosNoHeight,oracle,0,0);for(toB+=end.to-toA,toA=end.to;i>0&&start.from<=changes[i-1].toA;)fromA=changes[i-1].fromA,fromB=changes[i-1].fromB,i--,fromA<start.from&&(start=me.lineAt(fromA,QueryType.ByPosNoHeight,oracle,0,0));fromB+=start.from-fromA,fromA=start.from;let nodes=NodeBuilder.build(oracle.setDoc(doc),decorations,fromB,toB);me=replace(me,me.replace(fromA,toA,nodes))}return me.updateHeight(oracle,0)}static empty(){return new HeightMapText(0,0)}static of(nodes){if(1==nodes.length)return nodes[0];let i=0,j=nodes.length,before=0,after=0;for(;;)if(i==j)if(before>2*after){let split=nodes[i-1];split.break?nodes.splice(--i,1,split.left,null,split.right):nodes.splice(--i,1,split.left,split.right),j+=1+split.break,before-=split.size}else{if(!(after>2*before))break;{let split=nodes[j];split.break?nodes.splice(j,1,split.left,null,split.right):nodes.splice(j,1,split.left,split.right),j+=2+split.break,after-=split.size}}else if(before<after){let next=nodes[i++];next&&(before+=next.size)}else{let next=nodes[--j];next&&(after+=next.size)}let brk=0;return null==nodes[i-1]?(brk=1,i--):null==nodes[i]&&(brk=1,j++),new HeightMapBranch(HeightMap.of(nodes.slice(0,i)),brk,HeightMap.of(nodes.slice(j)))}}function replace(old,val){return old==val?old:(old.constructor!=val.constructor&&(heightChangeFlag=!0),val)}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(length,height,deco){super(length,height),this.deco=deco}blockAt(_height,_oracle,top,offset){return new BlockInfo(offset,this.length,top,this.height,this.deco||0)}lineAt(_value,_type,oracle,top,offset){return this.blockAt(0,oracle,top,offset)}forEachLine(from,to,oracle,top,offset,f){from<=offset+this.length&&to>=offset&&f(this.blockAt(0,oracle,top,offset))}updateHeight(oracle,offset=0,_force=!1,measured){return measured&&measured.from<=offset&&measured.more&&this.setHeight(measured.heights[measured.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(length,height){super(length,height,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(_height,_oracle,top,offset){return new BlockInfo(offset,this.length,top,this.height,this.breaks)}replace(_from,_to,nodes){let node=nodes[0];return 1==nodes.length&&(node instanceof HeightMapText||node instanceof HeightMapGap&&4&node.flags)&&Math.abs(this.length-node.length)<10?(node instanceof HeightMapGap?node=new HeightMapText(node.length,this.height):node.height=this.height,this.outdated||(node.outdated=!1),node):HeightMap.of(nodes)}updateHeight(oracle,offset=0,force=!1,measured){return measured&&measured.from<=offset&&measured.more?this.setHeight(measured.heights[measured.index++]):(force||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed))+this.breaks*oracle.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(length){super(length,0)}heightMetrics(oracle,offset){let perLine,firstLine=oracle.doc.lineAt(offset).number,lastLine=oracle.doc.lineAt(offset+this.length).number,lines=lastLine-firstLine+1,perChar=0;if(oracle.lineWrapping){let totalPerLine=Math.min(this.height,oracle.lineHeight*lines);perLine=totalPerLine/lines,this.length>lines+1&&(perChar=(this.height-totalPerLine)/(this.length-lines-1))}else perLine=this.height/lines;return{firstLine,lastLine,perLine,perChar}}blockAt(height,oracle,top,offset){let{firstLine,lastLine,perLine,perChar}=this.heightMetrics(oracle,offset);if(oracle.lineWrapping){let guess=offset+(height<oracle.lineHeight?0:Math.round(Math.max(0,Math.min(1,(height-top)/this.height))*this.length)),line=oracle.doc.lineAt(guess),lineHeight=perLine+line.length*perChar,lineTop=Math.max(top,height-lineHeight/2);return new BlockInfo(line.from,line.length,lineTop,lineHeight,0)}{let line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top)/perLine))),{from,length}=oracle.doc.line(firstLine+line);return new BlockInfo(from,length,top+perLine*line,perLine,0)}}lineAt(value,type,oracle,top,offset){if(type==QueryType.ByHeight)return this.blockAt(value,oracle,top,offset);if(type==QueryType.ByPosNoHeight){let{from,to}=oracle.doc.lineAt(value);return new BlockInfo(from,to-from,0,0,0)}let{firstLine,perLine,perChar}=this.heightMetrics(oracle,offset),line=oracle.doc.lineAt(value),lineHeight=perLine+line.length*perChar,linesAbove=line.number-firstLine,lineTop=top+perLine*linesAbove+perChar*(line.from-offset-linesAbove);return new BlockInfo(line.from,line.length,Math.max(top,Math.min(lineTop,top+this.height-lineHeight)),lineHeight,0)}forEachLine(from,to,oracle,top,offset,f){from=Math.max(from,offset),to=Math.min(to,offset+this.length);let{firstLine,perLine,perChar}=this.heightMetrics(oracle,offset);for(let pos=from,lineTop=top;pos<=to;){let line=oracle.doc.lineAt(pos);if(pos==from){let linesAbove=line.number-firstLine;lineTop+=perLine*linesAbove+perChar*(from-offset-linesAbove)}let lineHeight=perLine+perChar*line.length;f(new BlockInfo(line.from,line.length,lineTop,lineHeight,0)),lineTop+=lineHeight,pos=line.to+1}}replace(from,to,nodes){let after=this.length-to;if(after>0){let last=nodes[nodes.length-1];last instanceof HeightMapGap?nodes[nodes.length-1]=new HeightMapGap(last.length+after):nodes.push(null,new HeightMapGap(after-1))}if(from>0){let first=nodes[0];first instanceof HeightMapGap?nodes[0]=new HeightMapGap(from+first.length):nodes.unshift(new HeightMapGap(from-1),null)}return HeightMap.of(nodes)}decomposeLeft(to,result){result.push(new HeightMapGap(to-1),null)}decomposeRight(from,result){result.push(null,new HeightMapGap(this.length-from-1))}updateHeight(oracle,offset=0,force=!1,measured){let end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){let nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;for(measured.from>offset&&nodes.push(new HeightMapGap(measured.from-offset-1).updateHeight(oracle,offset));pos<=end&&measured.more;){let len=oracle.doc.lineAt(pos).length;nodes.length&&nodes.push(null);let height=measured.heights[measured.index++];-1==singleHeight?singleHeight=height:Math.abs(height-singleHeight)>=.001&&(singleHeight=-2);let line=new HeightMapText(len,height);line.outdated=!1,nodes.push(line),pos+=len+1}pos<=end&&nodes.push(null,new HeightMapGap(end-pos).updateHeight(oracle,pos));let result=HeightMap.of(nodes);return(singleHeight<0||Math.abs(result.height-this.height)>=.001||Math.abs(singleHeight-this.heightMetrics(oracle,offset).perLine)>=.001)&&(heightChangeFlag=!0),replace(this,result)}return(force||this.outdated)&&(this.setHeight(oracle.heightForGap(offset,offset+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(left,brk,right){super(left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0)),this.left=left,this.right=right,this.size=left.size+right.size}get break(){return 1&this.flags}blockAt(height,oracle,top,offset){let mid=top+this.left.height;return height<mid?this.left.blockAt(height,oracle,top,offset):this.right.blockAt(height,oracle,mid,offset+this.left.length+this.break)}lineAt(value,type,oracle,top,offset){let rightTop=top+this.left.height,rightOffset=offset+this.left.length+this.break,left=type==QueryType.ByHeight?value<rightTop:value<rightOffset,base=left?this.left.lineAt(value,type,oracle,top,offset):this.right.lineAt(value,type,oracle,rightTop,rightOffset);if(this.break||(left?base.to<rightOffset:base.from>rightOffset))return base;let subQuery=type==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;return left?base.join(this.right.lineAt(rightOffset,subQuery,oracle,rightTop,rightOffset)):this.left.lineAt(rightOffset,subQuery,oracle,top,offset).join(base)}forEachLine(from,to,oracle,top,offset,f){let rightTop=top+this.left.height,rightOffset=offset+this.left.length+this.break;if(this.break)from<rightOffset&&this.left.forEachLine(from,to,oracle,top,offset,f),to>=rightOffset&&this.right.forEachLine(from,to,oracle,rightTop,rightOffset,f);else{let mid=this.lineAt(rightOffset,QueryType.ByPos,oracle,top,offset);from<mid.from&&this.left.forEachLine(from,mid.from-1,oracle,top,offset,f),mid.to>=from&&mid.from<=to&&f(mid),to>mid.to&&this.right.forEachLine(mid.to+1,to,oracle,rightTop,rightOffset,f)}}replace(from,to,nodes){let rightStart=this.left.length+this.break;if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));let result=[];from>0&&this.decomposeLeft(from,result);let left=result.length;for(let node of nodes)result.push(node);if(from>0&&mergeGaps(result,left-1),to<this.length){let right=result.length;this.decomposeRight(to,result),mergeGaps(result,right)}return HeightMap.of(result)}decomposeLeft(to,result){let left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left),this.break&&(left++,to>=left&&result.push(null)),to>left&&this.right.decomposeLeft(to-left,result)}decomposeRight(from,result){let left=this.left.length,right=left+this.break;if(from>=right)return this.right.decomposeRight(from-right,result);from<left&&this.left.decomposeRight(from,result),this.break&&from<right&&result.push(null),result.push(this.right)}balanced(left,right){return left.size>2*right.size||right.size>2*left.size?HeightMap.of(this.break?[left,null,right]:[left,right]):(this.left=replace(this.left,left),this.right=replace(this.right,right),this.setHeight(left.height+right.height),this.outdated=left.outdated||right.outdated,this.size=left.size+right.size,this.length=left.length+this.break+right.length,this)}updateHeight(oracle,offset=0,force=!1,measured){let{left,right}=this,rightStart=offset+left.length+this.break,rebalance=null;return measured&&measured.from<=offset+left.length&&measured.more?rebalance=left=left.updateHeight(oracle,offset,force,measured):left.updateHeight(oracle,offset,force),measured&&measured.from<=rightStart+right.length&&measured.more?rebalance=right=right.updateHeight(oracle,rightStart,force,measured):right.updateHeight(oracle,rightStart,force),rebalance?this.balanced(left,right):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(nodes,around){let before,after;null==nodes[around]&&(before=nodes[around-1])instanceof HeightMapGap&&(after=nodes[around+1])instanceof HeightMapGap&&nodes.splice(around-1,3,new HeightMapGap(before.length+1+after.length))}class NodeBuilder{constructor(pos,oracle){this.pos=pos,this.oracle=oracle,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=pos}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(_from,to){if(this.lineStart>-1){let end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];last instanceof HeightMapText?last.length+=end-this.pos:(end>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(end-this.pos,-1)),this.writtenTo=end,to>end&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=to}point(from,to,deco){if(from<to||deco.heightRelevant){let height=deco.widget?deco.widget.estimatedHeight:0,breaks=deco.widget?deco.widget.lineBreaks:0;height<0&&(height=this.oracle.lineHeight);let len=to-from;deco.block?this.addBlock(new HeightMapBlock(len,height,deco)):(len||breaks||height>=5)&&this.addLineDeco(height,breaks,len)}else to>from&&this.span(from,to);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from,to}=this.oracle.doc.lineAt(this.pos);this.lineStart=from,this.lineEnd=to,this.writtenTo<from&&((this.writtenTo<from-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,from-1)),this.nodes.push(null)),this.pos>from&&this.nodes.push(new HeightMapText(this.pos-from,-1)),this.writtenTo=this.pos}blankContent(from,to){let gap=new HeightMapGap(to-from);return this.oracle.doc.lineAt(from).to==to&&(gap.flags|=4),gap}ensureLine(){this.enterLine();let last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText)return last;let line=new HeightMapText(0,-1);return this.nodes.push(line),line}addBlock(block){this.enterLine();let deco=block.deco;deco&&deco.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(block),this.writtenTo=this.pos=this.pos+block.length,deco&&deco.endSide>0&&(this.covering=block)}addLineDeco(height,breaks,length){let line=this.ensureLine();line.length+=length,line.collapsed+=length,line.widgetHeight=Math.max(line.widgetHeight,height),line.breaks+=breaks,this.writtenTo=this.pos=this.pos+length}finish(from){let last=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||last instanceof HeightMapText||this.isCovered?(this.writtenTo<this.pos||null==last)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new HeightMapText(0,-1));let pos=from;for(let node of this.nodes)node instanceof HeightMapText&&node.updateHeight(this.oracle,pos),pos+=node?node.length:1;return this.nodes}static build(oracle,decorations,from,to){let builder=new NodeBuilder(from,oracle);return state_dist.om.spans(decorations,from,to,builder,0),builder.finish(from)}}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(from,to,a,b){(from<to||a&&a.heightRelevant||b&&b.heightRelevant)&&addRange(from,to,this.changes,5)}}function visiblePixelRange(dom,paddingTop){let rect=dom.getBoundingClientRect(),doc=dom.ownerDocument,win=doc.defaultView||window,left=Math.max(0,rect.left),right=Math.min(win.innerWidth,rect.right),top=Math.max(0,rect.top),bottom=Math.min(win.innerHeight,rect.bottom);for(let parent=dom.parentNode;parent&&parent!=doc.body;)if(1==parent.nodeType){let elt=parent,style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&"visible"!=style.overflow){let parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left),right=Math.min(right,parentRect.right),top=Math.max(top,parentRect.top),bottom=Math.min(parent==dom.parentNode?win.innerHeight:bottom,parentRect.bottom)}parent="absolute"==style.position||"fixed"==style.position?elt.offsetParent:elt.parentNode}else{if(11!=parent.nodeType)break;parent=parent.host}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top-(rect.top+paddingTop),bottom:Math.max(top,bottom)-(rect.top+paddingTop)}}function fullPixelRange(dom,paddingTop){let rect=dom.getBoundingClientRect();return{left:0,right:rect.right-rect.left,top:paddingTop,bottom:rect.bottom-(rect.top+paddingTop)}}class LineGap{constructor(from,to,size,displaySize){this.from=from,this.to=to,this.size=size,this.displaySize=displaySize}static same(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++){let gA=a[i],gB=b[i];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return!1}return!0}draw(viewState,wrapping){return Decoration.replace({widget:new LineGapWidget(this.displaySize*(wrapping?viewState.scaleY:viewState.scaleX),wrapping)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(size,vertical){super(),this.size=size,this.vertical=vertical}eq(other){return other.size==this.size&&other.vertical==this.vertical}toDOM(){let elt=document.createElement("div");return this.vertical?elt.style.height=this.size+"px":(elt.style.width=this.size+"px",elt.style.height="2px",elt.style.display="inline-block"),elt}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(state){this.state=state,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let guessWrapping=state.facet(contentAttributes).some((v=>"function"!=typeof v&&"cm-lineWrapping"==v.class));this.heightOracle=new HeightOracle(guessWrapping),this.stateDeco=state.facet(decorations).filter((d=>"function"!=typeof d)),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,state_dist.EY.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange(0,0,0,state.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map((gap=>gap.draw(this,!1)))),this.computeVisibleRanges()}updateForViewport(){let viewports=[this.viewport],{main}=this.state.selection;for(let i=0;i<=1;i++){let pos=i?main.head:main.anchor;if(!viewports.some((({from,to})=>pos>=from&&pos<=to))){let{from,to}=this.lineBlockAt(pos);viewports.push(new Viewport(from,to))}}return this.viewports=viewports.sort(((a,b)=>a.from-b.from)),this.updateScaler()}updateScaler(){let scaler=this.scaler;return this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports),scaler.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,(block=>{this.viewportLines.push(scaleBlock(block,this.scaler))}))}update(update,scrollTarget=null){this.state=update.state;let prevDeco=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter((d=>"function"!=typeof d));let contentChanges=update.changedRanges,heightChanges=ChangedRange.extendWithRanges(contentChanges,function heightRelevantDecoChanges(a,b,diff){let comp=new DecorationComparator;return state_dist.om.compare(a,b,diff,comp,0),comp.changes}(prevDeco,this.stateDeco,update?update.changes:state_dist.VR.empty(this.state.doc.length))),prevHeight=this.heightMap.height,scrollAnchor=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);clearHeightChangeFlag(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,update.startState.doc,this.heightOracle.setDoc(this.state.doc),heightChanges),(this.heightMap.height!=prevHeight||heightChangeFlag)&&(update.flags|=2),scrollAnchor?(this.scrollAnchorPos=update.changes.mapPos(scrollAnchor.from,-1),this.scrollAnchorHeight=scrollAnchor.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let viewport=heightChanges.length?this.mapViewport(this.viewport,update.changes):this.viewport;(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))&&(viewport=this.getViewport(0,scrollTarget));let viewportChange=viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport,update.flags|=this.updateForViewport(),(viewportChange||!update.changes.empty||2&update.flags)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,update.changes))),update.flags|=this.computeVisibleRanges(update.changes),scrollTarget&&(this.scrollTarget=scrollTarget),!this.mustEnforceCursorAssoc&&update.selectionSet&&update.view.lineWrapping&&update.state.selection.main.empty&&update.state.selection.main.assoc&&!update.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(view){let dom=view.contentDOM,style=window.getComputedStyle(dom),oracle=this.heightOracle,whiteSpace=style.whiteSpace;this.defaultTextDirection="rtl"==style.direction?Direction.RTL:Direction.LTR;let refresh=this.heightOracle.mustRefreshForWrapping(whiteSpace),domRect=dom.getBoundingClientRect(),measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=domRect.height;this.contentDOMHeight=domRect.height,this.mustMeasureContent=!1;let result=0,bias=0;if(domRect.width&&domRect.height){let{scaleX,scaleY}=getScale(dom,domRect);(scaleX>.005&&Math.abs(this.scaleX-scaleX)>.005||scaleY>.005&&Math.abs(this.scaleY-scaleY)>.005)&&(this.scaleX=scaleX,this.scaleY=scaleY,result|=16,refresh=measureContent=!0)}let paddingTop=(parseInt(style.paddingTop)||0)*this.scaleY,paddingBottom=(parseInt(style.paddingBottom)||0)*this.scaleY;this.paddingTop==paddingTop&&this.paddingBottom==paddingBottom||(this.paddingTop=paddingTop,this.paddingBottom=paddingBottom,result|=18),this.editorWidth!=view.scrollDOM.clientWidth&&(oracle.lineWrapping&&(measureContent=!0),this.editorWidth=view.scrollDOM.clientWidth,result|=16);let scrollTop=view.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=scrollTop&&(this.scrollAnchorHeight=-1,this.scrollTop=scrollTop),this.scrolledToBottom=isScrolledToBottom(view.scrollDOM);let pixelViewport=(this.printing?fullPixelRange:visiblePixelRange)(dom,this.paddingTop),dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;let inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView&&(this.inView=inView,inView&&(measureContent=!0)),!this.inView&&!this.scrollTarget&&!function inWindow(elt){let rect=elt.getBoundingClientRect(),win=elt.ownerDocument.defaultView||window;return rect.left<win.innerWidth&&rect.right>0&&rect.top<win.innerHeight&&rect.bottom>0}(view.dom))return 0;let contentWidth=domRect.width;if(this.contentDOMWidth==contentWidth&&this.editorHeight==view.scrollDOM.clientHeight||(this.contentDOMWidth=domRect.width,this.editorHeight=view.scrollDOM.clientHeight,result|=16),measureContent){let lineHeights=view.docView.measureVisibleLineHeights(this.viewport);if(oracle.mustRefreshForHeights(lineHeights)&&(refresh=!0),refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){let{lineHeight,charWidth,textHeight}=view.docView.measureTextSize();refresh=lineHeight>0&&oracle.refresh(whiteSpace,lineHeight,charWidth,textHeight,contentWidth/charWidth,lineHeights),refresh&&(view.docView.minWidth=0,result|=16)}dTop>0&&dBottom>0?bias=Math.max(dTop,dBottom):dTop<0&&dBottom<0&&(bias=Math.min(dTop,dBottom)),clearHeightChangeFlag();for(let vp of this.viewports){let heights=vp.from==this.viewport.from?lineHeights:view.docView.measureVisibleLineHeights(vp);this.heightMap=(refresh?HeightMap.empty().applyChanges(this.stateDeco,state_dist.EY.empty,this.heightOracle,[new ChangedRange(0,0,0,view.state.doc.length)]):this.heightMap).updateHeight(oracle,0,refresh,new MeasuredHeights(vp.from,heights))}heightChangeFlag&&(result|=2)}let viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return viewportChange&&(2&result&&(result|=this.updateScaler()),this.viewport=this.getViewport(bias,this.scrollTarget),result|=this.updateForViewport()),(2&result||viewportChange)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps,view)),result|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,view.docView.enforceCursorAssoc()),result}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(bias,scrollTarget){let marginTop=.5-Math.max(-.5,Math.min(.5,bias/1e3/2)),map=this.heightMap,oracle=this.heightOracle,{visibleTop,visibleBottom}=this,viewport=new Viewport(map.lineAt(visibleTop-1e3*marginTop,QueryType.ByHeight,oracle,0,0).from,map.lineAt(visibleBottom+1e3*(1-marginTop),QueryType.ByHeight,oracle,0,0).to);if(scrollTarget){let{head}=scrollTarget.range;if(head<viewport.from||head>viewport.to){let topPos,viewHeight=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),block=map.lineAt(head,QueryType.ByPos,oracle,0,0);topPos="center"==scrollTarget.y?(block.top+block.bottom)/2-viewHeight/2:"start"==scrollTarget.y||"nearest"==scrollTarget.y&&head<viewport.from?block.top:block.bottom-viewHeight,viewport=new Viewport(map.lineAt(topPos-500,QueryType.ByHeight,oracle,0,0).from,map.lineAt(topPos+viewHeight+500,QueryType.ByHeight,oracle,0,0).to)}}return viewport}mapViewport(viewport,changes){let from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport(this.heightMap.lineAt(from,QueryType.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(to,QueryType.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from,to},bias=0){if(!this.inView)return!0;let{top}=this.heightMap.lineAt(from,QueryType.ByPos,this.heightOracle,0,0),{bottom}=this.heightMap.lineAt(to,QueryType.ByPos,this.heightOracle,0,0),{visibleTop,visibleBottom}=this;return(0==from||top<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top>visibleTop-2e3&&bottom<visibleBottom+2e3}mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;let mapped=[];for(let gap of gaps)changes.touchesRange(gap.from,gap.to)||mapped.push(new LineGap(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size,gap.displaySize));return mapped}ensureLineGaps(current,mayMeasure){let wrapping=this.heightOracle.lineWrapping,margin=wrapping?1e4:2e3,halfMargin=margin>>1,doubleMargin=margin<<1;if(this.defaultTextDirection!=Direction.LTR&&!wrapping)return[];let gaps=[],addGap=(from,to,line,structure)=>{if(to-from<halfMargin)return;let sel=this.state.selection.main,avoid=[sel.from];sel.empty||avoid.push(sel.to);for(let pos of avoid)if(pos>from&&pos<to)return addGap(from,pos-10,line,structure),void addGap(pos+10,to,line,structure);let gap=function find(array,f){for(let val of array)if(f(val))return val;return}(current,(gap=>gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<halfMargin&&Math.abs(gap.to-to)<halfMargin&&!avoid.some((pos=>gap.from<pos&&gap.to>pos))));if(!gap){if(to<line.to&&mayMeasure&&wrapping&&mayMeasure.visibleRanges.some((r=>r.from<=to&&r.to>=to))){let lineStart=mayMeasure.moveToLineBoundary(state_dist.OF.cursor(to),!1,!0).head;lineStart>from&&(to=lineStart)}let size=this.gapSize(line,from,to,structure);gap=new LineGap(from,to,size,wrapping||size<2e6?size:2e6)}gaps.push(gap)},checkLine=line=>{if(line.length<doubleMargin||line.type!=BlockType.Text)return;let structure=function lineStructure(from,to,stateDeco){let ranges=[],pos=from,total=0;state_dist.om.spans(stateDeco,from,to,{span(){},point(from,to){from>pos&&(ranges.push({from:pos,to:from}),total+=from-pos),pos=to}},20),pos<to&&(ranges.push({from:pos,to}),total+=to-pos);return{total,ranges}}(line.from,line.to,this.stateDeco);if(structure.total<doubleMargin)return;let viewFrom,viewTo,target=this.scrollTarget?this.scrollTarget.range.head:null;if(wrapping){let top,bot,marginHeight=margin/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=target){let targetFrac=findFraction(structure,target),spaceFrac=((this.visibleBottom-this.visibleTop)/2+marginHeight)/line.height;top=targetFrac-spaceFrac,bot=targetFrac+spaceFrac}else top=(this.visibleTop-line.top-marginHeight)/line.height,bot=(this.visibleBottom-line.top+marginHeight)/line.height;viewFrom=findPosition(structure,top),viewTo=findPosition(structure,bot)}else{let totalWidth=structure.total*this.heightOracle.charWidth,marginWidth=margin*this.heightOracle.charWidth,horizOffset=0;if(totalWidth>2e6)for(let old of current)old.from>=line.from&&old.from<line.to&&old.size!=old.displaySize&&old.from*this.heightOracle.charWidth+horizOffset<this.pixelViewport.left&&(horizOffset=old.size-old.displaySize);let left,right,pxLeft=this.pixelViewport.left+horizOffset,pxRight=this.pixelViewport.right+horizOffset;if(null!=target){let targetFrac=findFraction(structure,target),spaceFrac=((pxRight-pxLeft)/2+marginWidth)/totalWidth;left=targetFrac-spaceFrac,right=targetFrac+spaceFrac}else left=(pxLeft-marginWidth)/totalWidth,right=(pxRight+marginWidth)/totalWidth;viewFrom=findPosition(structure,left),viewTo=findPosition(structure,right)}viewFrom>line.from&&addGap(line.from,viewFrom,line,structure),viewTo<line.to&&addGap(viewTo,line.to,line,structure)};for(let line of this.viewportLines)Array.isArray(line.type)?line.type.forEach(checkLine):checkLine(line);return gaps}gapSize(line,from,to,structure){let fraction=findFraction(structure,to)-findFraction(structure,from);return this.heightOracle.lineWrapping?line.height*fraction:structure.total*this.heightOracle.charWidth*fraction}updateLineGaps(gaps){LineGap.same(gaps,this.lineGaps)||(this.lineGaps=gaps,this.lineGapDeco=Decoration.set(gaps.map((gap=>gap.draw(this,this.heightOracle.lineWrapping)))))}computeVisibleRanges(changes){let deco=this.stateDeco;this.lineGaps.length&&(deco=deco.concat(this.lineGapDeco));let ranges=[];state_dist.om.spans(deco,this.viewport.from,this.viewport.to,{span(from,to){ranges.push({from,to})},point(){}},20);let changed=0;if(ranges.length!=this.visibleRanges.length)changed=12;else for(let i=0;i<ranges.length&&!(8&changed);i++){let old=this.visibleRanges[i],nw=ranges[i];old.from==nw.from&&old.to==nw.to||(changed|=4,changes&&changes.mapPos(old.from,-1)==nw.from&&changes.mapPos(old.to,1)==nw.to||(changed|=8))}return this.visibleRanges=ranges,changed}lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find((b=>b.from<=pos&&b.to>=pos))||scaleBlock(this.heightMap.lineAt(pos,QueryType.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(height){return height>=this.viewportLines[0].top&&height<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find((l=>l.top<=height&&l.bottom>=height))||scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(scrollTop){let block=this.lineBlockAtHeight(scrollTop+8);return block.from>=this.viewport.from||this.viewportLines[0].top-scrollTop>200?block:this.viewportLines[0]}elementAtHeight(height){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(height),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(from,to){this.from=from,this.to=to}}function findPosition({total,ranges},ratio){if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;let dist=Math.floor(total*ratio);for(let i=0;;i++){let{from,to}=ranges[i],size=to-from;if(dist<=size)return from+dist;dist-=size}}function findFraction(structure,pos){let counted=0;for(let{from,to}of structure.ranges){if(pos<=to){counted+=pos-from;break}counted+=to-from}return counted/structure.total}const IdScaler={toDOM:n=>n,fromDOM:n=>n,scale:1,eq(other){return other==this}};class BigScaler{constructor(oracle,heightMap,viewports){let vpHeight=0,base=0,domBase=0;this.viewports=viewports.map((({from,to})=>{let top=heightMap.lineAt(from,QueryType.ByPos,oracle,0,0).top,bottom=heightMap.lineAt(to,QueryType.ByPos,oracle,0,0).bottom;return vpHeight+=bottom-top,{from,to,top,bottom,domTop:0,domBottom:0}})),this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);for(let obj of this.viewports)obj.domTop=domBase+(obj.top-base)*this.scale,domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top),base=obj.bottom}toDOM(n){for(let i=0,base=0,domBase=0;;i++){let vp=i<this.viewports.length?this.viewports[i]:null;if(!vp||n<vp.top)return domBase+(n-base)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base=vp.bottom,domBase=vp.domBottom}}fromDOM(n){for(let i=0,base=0,domBase=0;;i++){let vp=i<this.viewports.length?this.viewports[i]:null;if(!vp||n<vp.domTop)return base+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base=vp.bottom,domBase=vp.domBottom}}eq(other){return other instanceof BigScaler&&(this.scale==other.scale&&this.viewports.length==other.viewports.length&&this.viewports.every(((vp,i)=>vp.from==other.viewports[i].from&&vp.to==other.viewports[i].to)))}}function scaleBlock(block,scaler){if(1==scaler.scale)return block;let bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block._content)?block._content.map((b=>scaleBlock(b,scaler))):block._content)}const theme=state_dist.sj.define({combine:strs=>strs.join(" ")}),darkTheme=state_dist.sj.define({combine:values=>values.indexOf(!0)>-1}),baseThemeID=style_mod.G.newName(),baseLightID=style_mod.G.newName(),baseDarkID=style_mod.G.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(main,spec,scopes){return new style_mod.G(spec,{finish:sel=>/&/.test(sel)?sel.replace(/&\w*/,(m=>{if("&"==m)return main;if(!scopes||!scopes[m])throw new RangeError(`Unsupported selector: ${m}`);return scopes[m]})):main+" "+sel})}const baseTheme$1=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(view){this.view=view,this.active=!1,this.editContext=null,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=view.contentDOM,this.observer=new MutationObserver((mutations=>{for(let mut of mutations)this.queue.push(mut);(browser.ie&&browser.ie_version<=11||browser.ios&&view.composing)&&mutations.some((m=>"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length))?this.flushSoon():this.flush()})),!window.EditContext||!1===view.constructor.EDIT_CONTEXT||browser.chrome&&browser.chrome_version<126||(this.editContext=new EditContextManager(view),view.state.facet(editable)&&(view.contentDOM.editContext=this.editContext.editContext)),useCharData&&(this.onCharData=event=>{this.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver((()=>{var _a;(null===(_a=this.view.docView)||void 0===_a?void 0:_a.lastUpdate)<Date.now()-75&&this.onResize()})),this.resizeScroll.observe(view.scrollDOM)),this.addWindowListeners(this.win=view.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((entries=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),entries.length>0&&entries[entries.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((entries=>{entries.length>0&&entries[entries.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(event){("change"!=event.type&&event.type||event.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500))}updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(((g,i)=>g!=gaps[i])))){this.gapIntersection.disconnect();for(let gap of gaps)this.gapIntersection.observe(gap);this.gaps=gaps}}onSelectionChange(event){let wasChanged=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view}=this,sel=this.selectionRange;if(view.state.facet(editable)?view.root.activeElement!=this.dom:!hasSelection(this.dom,sel))return;let context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);context&&context.ignoreEvent(event)?wasChanged||(this.selectionChanged=!1):(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view}=this,selection=getSelection(view.root);if(!selection)return!1;let range=browser.safari&&11==view.root.nodeType&&view.root.activeElement==this.dom&&function safariSelectionRangeHack(view,selection){if(selection.getComposedRanges){let range=selection.getComposedRanges(view.root)[0];if(range)return buildSelectionRangeFromRange(view,range)}let found=null;function read(event){event.preventDefault(),event.stopImmediatePropagation(),found=event.getTargetRanges()[0]}return view.contentDOM.addEventListener("beforeinput",read,!0),view.dom.ownerDocument.execCommand("indent"),view.contentDOM.removeEventListener("beforeinput",read,!0),found?buildSelectionRangeFromRange(view,found):null}(this.view,selection)||selection;if(!range||this.selectionRange.eq(range))return!1;let local=hasSelection(this.dom,range);return local&&!this.selectionChanged&&view.inputState.lastFocusTime>Date.now()-200&&view.inputState.lastTouchTime<Date.now()-300&&function atElementStart(doc,selection){let node=selection.focusNode,offset=selection.focusOffset;if(!node||selection.anchorNode!=node||selection.anchorOffset!=offset)return!1;for(offset=Math.min(offset,maxOffset(node));;)if(offset){if(1!=node.nodeType)return!1;let prev=node.childNodes[offset-1];"false"==prev.contentEditable?offset--:(node=prev,offset=maxOffset(node))}else{if(node==doc)return!0;offset=domIndex(node),node=node.parentNode}}(this.dom,range)?(this.view.inputState.lastFocusTime=0,view.docView.updateSelection(),!1):(this.selectionRange.setRange(range),local&&(this.selectionChanged=!0),!0)}setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let i=0,changed=null;for(let dom=this.dom;dom;)if(1==dom.nodeType)!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom?i++:changed||(changed=this.scrollTargets.slice(0,i)),changed&&changed.push(dom),dom=dom.assignedSlot||dom.parentNode;else{if(11!=dom.nodeType)break;dom=dom.host}if(i<this.scrollTargets.length&&!changed&&(changed=this.scrollTargets.slice(0,i)),changed){for(let dom of this.scrollTargets)dom.removeEventListener("scroll",this.onScroll);for(let dom of this.scrollTargets=changed)dom.addEventListener("scroll",this.onScroll)}}ignore(f){if(!this.active)return f();try{return this.stop(),f()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(key,keyCode){var _a;if(!this.delayedAndroidKey){let flush=()=>{let key=this.delayedAndroidKey;if(key){this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=key.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&key.force&&dispatchKey(this.dom,key.key,key.keyCode)}};this.flushingAndroidKey=this.view.win.requestAnimationFrame(flush)}this.delayedAndroidKey&&"Enter"!=key||(this.delayedAndroidKey={key,keyCode,force:this.lastChange<Date.now()-50||!!(null===(_a=this.delayedAndroidKey)||void 0===_a?void 0:_a.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame((()=>{this.delayedFlush=-1,this.flush()})))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let mut of this.observer.takeRecords())this.queue.push(mut);return this.queue}processRecords(){let records=this.pendingRecords();records.length&&(this.queue=[]);let from=-1,to=-1,typeOver=!1;for(let record of records){let range=this.readMutation(record);range&&(range.typeOver&&(typeOver=!0),-1==from?({from,to}=range):(from=Math.min(range.from,from),to=Math.max(range.to,to)))}return{from,to,typeOver}}readChange(){let{from,to,typeOver}=this.processRecords(),newSel=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(from<0&&!newSel)return null;from>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let change=new DOMChange(this.view,from,to,typeOver);return this.view.docView.domChanged={newSel:change.newSel?change.newSel.main:null},change}flush(readSelection=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;readSelection&&this.readSelectionRange();let domChange=this.readChange();if(!domChange)return this.view.requestMeasure(),!1;let startState=this.view.state,handled=applyDOMChange(this.view,domChange);return this.view.state==startState&&(domChange.domChanged||domChange.newSel&&!domChange.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),handled}readMutation(rec){let cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;if(cView.markDirty("attributes"==rec.type),"attributes"==rec.type&&(cView.flags|=4),"childList"==rec.type){let childBefore=findChild(cView,rec.previousSibling||rec.target.previousSibling,-1),childAfter=findChild(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:!1}}return"characterData"==rec.type?{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue}:null}setWindow(win){win!=this.win&&(this.removeWindowListeners(this.win),this.win=win,this.addWindowListeners(this.win))}addWindowListeners(win){win.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):win.addEventListener("beforeprint",this.onPrint),win.addEventListener("scroll",this.onScroll),win.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(win){win.removeEventListener("scroll",this.onScroll),win.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):win.removeEventListener("beforeprint",this.onPrint),win.document.removeEventListener("selectionchange",this.onSelectionChange)}update(update){this.editContext&&(this.editContext.update(update),update.startState.facet(editable)!=update.state.facet(editable)&&(update.view.contentDOM.editContext=update.state.facet(editable)?this.editContext.editContext:null))}destroy(){var _a,_b,_c;this.stop(),null===(_a=this.intersection)||void 0===_a||_a.disconnect(),null===(_b=this.gapIntersection)||void 0===_b||_b.disconnect(),null===(_c=this.resizeScroll)||void 0===_c||_c.disconnect();for(let dom of this.scrollTargets)dom.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function findChild(cView,dom,dir){for(;dom;){let curView=ContentView.get(dom);if(curView&&curView.parent==cView)return curView;let parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling}return null}function buildSelectionRangeFromRange(view,range){let anchorNode=range.startContainer,anchorOffset=range.startOffset,focusNode=range.endContainer,focusOffset=range.endOffset,curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);return isEquivalentPosition(curAnchor.node,curAnchor.offset,focusNode,focusOffset)&&([anchorNode,anchorOffset,focusNode,focusOffset]=[focusNode,focusOffset,anchorNode,anchorOffset]),{anchorNode,anchorOffset,focusNode,focusOffset}}class EditContextManager{constructor(view){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(view.state);let context=this.editContext=new window.EditContext({text:view.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,view.state.selection.main.anchor))),selectionEnd:this.toContextPos(view.state.selection.main.head)});this.handlers.textupdate=e=>{let main=view.state.selection.main,{anchor,head}=main,from=this.toEditorPos(e.updateRangeStart),to=this.toEditorPos(e.updateRangeEnd);view.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:e.updateRangeStart,editorBase:from,drifted:!1});let change={from,to,insert:state_dist.EY.of(e.text.split("\n"))};if(change.from==this.from&&anchor<this.from?change.from=anchor:change.to==this.to&&anchor>this.to&&(change.to=anchor),change.from!=change.to||change.insert.length){if((browser.mac||browser.android)&&change.from==head-1&&/^\. ?$/.test(e.text)&&"off"==view.contentDOM.getAttribute("autocorrect")&&(change={from,to,insert:state_dist.EY.of([e.text.replace("."," ")])}),this.pendingContextChange=change,!view.state.readOnly){let newLen=this.to-this.from+(change.to-change.from+change.insert.length);applyDOMChangeInner(view,change,state_dist.OF.single(this.toEditorPos(e.selectionStart,newLen),this.toEditorPos(e.selectionEnd,newLen)))}this.pendingContextChange&&(this.revertPending(view.state),this.setSelection(view.state))}else{let newSel=state_dist.OF.single(this.toEditorPos(e.selectionStart),this.toEditorPos(e.selectionEnd));newSel.main.eq(main)||view.dispatch({selection:newSel,userEvent:"select"})}},this.handlers.characterboundsupdate=e=>{let rects=[],prev=null;for(let i=this.toEditorPos(e.rangeStart),end=this.toEditorPos(e.rangeEnd);i<end;i++){let rect=view.coordsForChar(i);prev=rect&&new DOMRect(rect.left,rect.top,rect.right-rect.left,rect.bottom-rect.top)||prev||new DOMRect,rects.push(prev)}context.updateCharacterBounds(e.rangeStart,rects)},this.handlers.textformatupdate=e=>{let deco=[];for(let format of e.getTextFormats()){let lineStyle=format.underlineStyle,thickness=format.underlineThickness;if("None"!=lineStyle&&"None"!=thickness){let from=this.toEditorPos(format.rangeStart),to=this.toEditorPos(format.rangeEnd);if(from<to){let style=`text-decoration: underline ${"Dashed"==lineStyle?"dashed ":"Squiggle"==lineStyle?"wavy ":""}${"Thin"==thickness?1:2}px`;deco.push(Decoration.mark({attributes:{style}}).range(from,to))}}}view.dispatch({effects:setEditContextFormatting.of(Decoration.set(deco))})},this.handlers.compositionstart=()=>{view.inputState.composing<0&&(view.inputState.composing=0,view.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(view.inputState.composing=-1,view.inputState.compositionFirstChange=null,this.composing){let{drifted}=this.composing;this.composing=null,drifted&&this.reset(view.state)}};for(let event in this.handlers)context.addEventListener(event,this.handlers[event]);this.measureReq={read:view=>{this.editContext.updateControlBounds(view.contentDOM.getBoundingClientRect());let sel=getSelection(view.root);sel&&sel.rangeCount&&this.editContext.updateSelectionBounds(sel.getRangeAt(0).getBoundingClientRect())}}}applyEdits(update){let off=0,abort=!1,pending=this.pendingContextChange;return update.changes.iterChanges(((fromA,toA,_fromB,_toB,insert)=>{if(abort)return;let dLen=insert.length-(toA-fromA);if(pending&&toA>=pending.to){if(pending.from==fromA&&pending.to==toA&&pending.insert.eq(insert))return pending=this.pendingContextChange=null,off+=dLen,void(this.to+=dLen);pending=null,this.revertPending(update.state)}if(fromA+=off,(toA+=off)<=this.from)this.from+=dLen,this.to+=dLen;else if(fromA<this.to){if(fromA<this.from||toA>this.to||this.to-this.from+insert.length>3e4)return void(abort=!0);this.editContext.updateText(this.toContextPos(fromA),this.toContextPos(toA),insert.toString()),this.to+=dLen}off+=dLen})),pending&&!abort&&this.revertPending(update.state),!abort}update(update){let reverted=this.pendingContextChange;this.composing&&(this.composing.drifted||update.transactions.some((tr=>!tr.isUserEvent("input.type")&&tr.changes.touchesRange(this.from,this.to))))?(this.composing.drifted=!0,this.composing.editorBase=update.changes.mapPos(this.composing.editorBase)):this.applyEdits(update)&&this.rangeIsValid(update.state)?(update.docChanged||update.selectionSet||reverted)&&this.setSelection(update.state):(this.pendingContextChange=null,this.reset(update.state)),(update.geometryChanged||update.docChanged||update.selectionSet)&&update.view.requestMeasure(this.measureReq)}resetRange(state){let{head}=state.selection.main;this.from=Math.max(0,head-1e4),this.to=Math.min(state.doc.length,head+1e4)}reset(state){this.resetRange(state),this.editContext.updateText(0,this.editContext.text.length,state.doc.sliceString(this.from,this.to)),this.setSelection(state)}revertPending(state){let pending=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(pending.from),this.toContextPos(pending.from+pending.insert.length),state.doc.sliceString(pending.from,pending.to))}setSelection(state){let{main}=state.selection,start=this.toContextPos(Math.max(this.from,Math.min(this.to,main.anchor))),end=this.toContextPos(main.head);this.editContext.selectionStart==start&&this.editContext.selectionEnd==end||this.editContext.updateSelection(start,end)}rangeIsValid(state){let{head}=state.selection.main;return!(this.from>0&&head-this.from<500||this.to<state.doc.length&&this.to-head<500||this.to-this.from>3e4)}toEditorPos(contextPos,clipLen=this.to-this.from){contextPos=Math.min(contextPos,clipLen);let c=this.composing;return c&&c.drifted?c.editorBase+(contextPos-c.contextBase):contextPos+this.from}toContextPos(editorPos){let c=this.composing;return c&&c.drifted?c.contextBase+(editorPos-c.editorBase):editorPos-this.from}destroy(){for(let event in this.handlers)this.editContext.removeEventListener(event,this.handlers[event])}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(config={}){var _a;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),config.parent&&config.parent.appendChild(this.dom);let{dispatch}=config;this.dispatchTransactions=config.dispatchTransactions||dispatch&&(trs=>trs.forEach((tr=>dispatch(tr,this))))||(trs=>this.update(trs)),this.dispatch=this.dispatch.bind(this),this._root=config.root||function getRoot(node){for(;node;){if(node&&(9==node.nodeType||11==node.nodeType&&node.host))return node;node=node.assignedSlot||node.parentNode}return null}(config.parent)||document,this.viewState=new ViewState(config.state||state_dist.$t.create(config)),config.scrollTo&&config.scrollTo.is(scrollIntoView)&&(this.viewState.scrollTarget=config.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map((spec=>new PluginInstance(spec)));for(let plugin of this.plugins)plugin.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),(null===(_a=document.fonts)||void 0===_a?void 0:_a.ready)&&document.fonts.ready.then((()=>this.requestMeasure()))}dispatch(...input){let trs=1==input.length&&input[0]instanceof state_dist.ZX?input:1==input.length&&Array.isArray(input[0])?input[0]:[this.state.update(...input)];this.dispatchTransactions(trs,this)}update(transactions){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let update,redrawn=!1,attrsChanged=!1,state=this.state;for(let tr of transactions){if(tr.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=tr.state}if(this.destroyed)return void(this.viewState.state=state);let focus=this.hasFocus,focusFlag=0,dispatchFocus=null;transactions.some((tr=>tr.annotation(isFocusChange)))?(this.inputState.notifiedFocused=focus,focusFlag=1):focus!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=focus,dispatchFocus=focusChangeTransaction(state,focus),dispatchFocus||(focusFlag=1));let pendingKey=this.observer.delayedAndroidKey,domChange=null;if(pendingKey?(this.observer.clearDelayedAndroidKey(),domChange=this.observer.readChange(),(domChange&&!this.state.doc.eq(state.doc)||!this.state.selection.eq(state.selection))&&(domChange=null)):this.observer.clear(),state.facet(state_dist.$t.phrases)!=this.state.facet(state_dist.$t.phrases))return this.setState(state);update=ViewUpdate.create(this,state,transactions),update.flags|=focusFlag;let scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;for(let tr of transactions){if(scrollTarget&&(scrollTarget=scrollTarget.map(tr.changes)),tr.scrollIntoView){let{main}=tr.state.selection;scrollTarget=new ScrollTarget(main.empty?main:state_dist.OF.cursor(main.head,main.head>main.anchor?-1:1))}for(let e of tr.effects)e.is(scrollIntoView)&&(scrollTarget=e.value.clip(this.state))}this.viewState.update(update,scrollTarget),this.bidiCache=CachedOrder.update(this.bidiCache,update.changes),update.empty||(this.updatePlugins(update),this.inputState.update(update)),redrawn=this.docView.update(update),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),attrsChanged=this.updateAttrs(),this.showAnnouncements(transactions),this.docView.updateSelection(redrawn,transactions.some((tr=>tr.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(update.startState.facet(theme)!=update.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(redrawn||attrsChanged||scrollTarget||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),redrawn&&this.docViewUpdate(),!update.empty)for(let listener of this.state.facet(updateListener))try{listener(update)}catch(e){logException(this.state,e,"update listener")}(dispatchFocus||domChange)&&Promise.resolve().then((()=>{dispatchFocus&&this.state==dispatchFocus.startState&&this.dispatch(dispatchFocus),domChange&&!applyDOMChange(this,domChange)&&pendingKey.force&&dispatchKey(this.contentDOM,pendingKey.key,pendingKey.keyCode)}))}setState(newState){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=newState);this.updateState=2;let hadFocus=this.hasFocus;try{for(let plugin of this.plugins)plugin.destroy(this);this.viewState=new ViewState(newState),this.plugins=newState.facet(viewPlugin).map((spec=>new PluginInstance(spec))),this.pluginMap.clear();for(let plugin of this.plugins)plugin.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}hadFocus&&this.focus(),this.requestMeasure()}updatePlugins(update){let prevSpecs=update.startState.facet(viewPlugin),specs=update.state.facet(viewPlugin);if(prevSpecs!=specs){let newPlugins=[];for(let spec of specs){let found=prevSpecs.indexOf(spec);if(found<0)newPlugins.push(new PluginInstance(spec));else{let plugin=this.plugins[found];plugin.mustUpdate=update,newPlugins.push(plugin)}}for(let plugin of this.plugins)plugin.mustUpdate!=update&&plugin.destroy(this);this.plugins=newPlugins,this.pluginMap.clear()}else for(let p of this.plugins)p.mustUpdate=update;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);prevSpecs!=specs&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let plugin of this.plugins){let val=plugin.value;if(val&&val.docViewUpdate)try{val.docViewUpdate(this)}catch(e){logException(this.state,e,"doc view update listener")}}}measure(flush=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,flush&&this.observer.forceFlush();let updated=null,sDOM=this.scrollDOM,scrollTop=sDOM.scrollTop*this.scaleY,{scrollAnchorPos,scrollAnchorHeight}=this.viewState;Math.abs(scrollTop-this.viewState.scrollTop)>1&&(scrollAnchorHeight=-1),this.viewState.scrollAnchorHeight=-1;try{for(let i=0;;i++){if(scrollAnchorHeight<0)if(isScrolledToBottom(sDOM))scrollAnchorPos=-1,scrollAnchorHeight=this.viewState.heightMap.height;else{let block=this.viewState.scrollAnchorAt(scrollTop);scrollAnchorPos=block.from,scrollAnchorHeight=block.top}this.updateState=1;let changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let measuring=[];4&changed||([this.measureRequests,measuring]=[measuring,this.measureRequests]);let measured=measuring.map((m=>{try{return m.read(this)}catch(e){return logException(this.state,e),BadMeasure}})),update=ViewUpdate.create(this,this.state,[]),redrawn=!1;update.flags|=changed,updated?updated.flags|=changed:updated=update,this.updateState=2,update.empty||(this.updatePlugins(update),this.inputState.update(update),this.updateAttrs(),redrawn=this.docView.update(update),redrawn&&this.docViewUpdate());for(let i=0;i<measuring.length;i++)if(measured[i]!=BadMeasure)try{let m=measuring[i];m.write&&m.write(measured[i],this)}catch(e){logException(this.state,e)}if(redrawn&&this.docView.updateSelection(!0),!update.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,scrollAnchorHeight=-1;continue}{let diff=(scrollAnchorPos<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(scrollAnchorPos).top)-scrollAnchorHeight;if(diff>1||diff<-1){scrollTop+=diff,sDOM.scrollTop=scrollTop/this.scaleY,scrollAnchorHeight=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(updated&&!updated.empty)for(let listener of this.state.facet(updateListener))listener(updated)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let editorAttrs=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(contentAttrs["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,contentAttrs);let changed=this.observer.ignore((()=>{let changedContent=updateAttrs(this.contentDOM,this.contentAttrs,contentAttrs),changedEditor=updateAttrs(this.dom,this.editorAttrs,editorAttrs);return changedContent||changedEditor}));return this.editorAttrs=editorAttrs,this.contentAttrs=contentAttrs,changed}showAnnouncements(trs){let first=!0;for(let tr of trs)for(let effect of tr.effects)if(effect.is(EditorView.announce)){first&&(this.announceDOM.textContent=""),first=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=effect.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let nonce=this.state.facet(EditorView.cspNonce);style_mod.G.mount(this.root,this.styleModules.concat(baseTheme$1).reverse(),nonce?{nonce}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(request){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame((()=>this.measure()))),request){if(this.measureRequests.indexOf(request)>-1)return;if(null!=request.key)for(let i=0;i<this.measureRequests.length;i++)if(this.measureRequests[i].key===request.key)return void(this.measureRequests[i]=request);this.measureRequests.push(request)}}plugin(plugin){let known=this.pluginMap.get(plugin);return(void 0===known||known&&known.spec!=plugin)&&this.pluginMap.set(plugin,known=this.plugins.find((p=>p.spec==plugin))||null),known&&known.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(height){return this.readMeasured(),this.viewState.elementAtHeight(height)}lineBlockAtHeight(height){return this.readMeasured(),this.viewState.lineBlockAtHeight(height)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(pos){return this.viewState.lineBlockAt(pos)}get contentHeight(){return this.viewState.contentHeight}moveByChar(start,forward,by){return skipAtoms(this,start,moveByChar(this,start,forward,by))}moveByGroup(start,forward){return skipAtoms(this,start,moveByChar(this,start,forward,(initial=>function byGroup(view,pos,start){let categorize=view.state.charCategorizer(pos),cat=categorize(start);return next=>{let nextCat=categorize(next);return cat==state_dist.Je.Space&&(cat=nextCat),cat==nextCat}}(this,start.head,initial))))}visualLineSide(line,end){let order=this.bidiSpans(line),dir=this.textDirectionAt(line.from),span=order[end?order.length-1:0];return state_dist.OF.cursor(span.side(end,dir)+line.from,span.forward(!end,dir)?1:-1)}moveToLineBoundary(start,forward,includeWrap=!0){return function moveToLineBoundary(view,start,forward,includeWrap){let line=blockAt(view,start.head),coords=includeWrap&&line.type==BlockType.Text&&(view.lineWrapping||line.widgetLineBreaks)?view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head):null;if(coords){let editorRect=view.dom.getBoundingClientRect(),direction=view.textDirectionAt(line.from),pos=view.posAtCoords({x:forward==(direction==Direction.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(null!=pos)return state_dist.OF.cursor(pos,forward?-1:1)}return state_dist.OF.cursor(forward?line.to:line.from,forward?-1:1)}(this,start,forward,includeWrap)}moveVertically(start,forward,distance){return skipAtoms(this,start,function moveVertically(view,start,forward,distance){let startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return state_dist.OF.cursor(startPos,start.assoc);let startY,goal=start.goalColumn,rect=view.contentDOM.getBoundingClientRect(),startCoords=view.coordsAtPos(startPos,start.assoc||-1),docTop=view.documentTop;if(startCoords)null==goal&&(goal=startCoords.left-rect.left),startY=dir<0?startCoords.top:startCoords.bottom;else{let line=view.viewState.lineBlockAt(startPos);null==goal&&(goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from))),startY=(dir<0?line.top:line.bottom)+docTop}let resolvedGoal=rect.left+goal,dist=null!=distance?distance:view.viewState.heightOracle.textHeight>>1;for(let extra=0;;extra+=10){let curY=startY+(dist+extra)*dir,pos=posAtCoords(view,{x:resolvedGoal,y:curY},!1,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos)){let charRect=view.docView.coordsForChar(pos),assoc=!charRect||curY<charRect.top?-1:1;return state_dist.OF.cursor(pos,assoc,void 0,goal)}}}(this,start,forward,distance))}domAtPos(pos){return this.docView.domAtPos(pos)}posAtDOM(node,offset=0){return this.docView.posFromDOM(node,offset)}posAtCoords(coords,precise=!0){return this.readMeasured(),posAtCoords(this,coords,precise)}coordsAtPos(pos,side=1){this.readMeasured();let rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;let line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);return flattenRect(rect,order[BidiSpan.find(order,pos-line.from,-1,side)].dir==Direction.LTR==side>0)}coordsForChar(pos){return this.readMeasured(),this.docView.coordsForChar(pos)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(pos){return!this.state.facet(perLineTextDirection)||pos<this.viewport.from||pos>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(pos))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(line){if(line.length>MaxBidiLine)return trivialOrder(line.length);let isolates,dir=this.textDirectionAt(line.from);for(let entry of this.bidiCache)if(entry.from==line.from&&entry.dir==dir&&(entry.fresh||isolatesEq(entry.isolates,isolates=getIsolatedRanges(this,line))))return entry.order;isolates||(isolates=getIsolatedRanges(this,line));let order=computeOrder(line.text,dir,isolates);return this.bidiCache.push(new CachedOrder(line.from,line.to,dir,isolates,!0,order)),order}get hasFocus(){var _a;return(this.dom.ownerDocument.hasFocus()||browser.safari&&(null===(_a=this.inputState)||void 0===_a?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()}))}setRoot(root){this._root!=root&&(this._root=root,this.observer.setWindow((9==root.nodeType?root:root.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let plugin of this.plugins)plugin.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(pos,options={}){return scrollIntoView.of(new ScrollTarget("number"==typeof pos?state_dist.OF.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin))}scrollSnapshot(){let{scrollTop,scrollLeft}=this.scrollDOM,ref=this.viewState.scrollAnchorAt(scrollTop);return scrollIntoView.of(new ScrollTarget(state_dist.OF.cursor(ref.from),"start","start",ref.top-scrollTop,scrollLeft,!0))}setTabFocusMode(to){null==to?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:"boolean"==typeof to?this.inputState.tabFocusMode=to?0:-1:0!=this.inputState.tabFocusMode&&(this.inputState.tabFocusMode=Date.now()+to)}static domEventHandlers(handlers){return ViewPlugin.define((()=>({})),{eventHandlers:handlers})}static domEventObservers(observers){return ViewPlugin.define((()=>({})),{eventObservers:observers})}static theme(spec,options){let prefix=style_mod.G.newName(),result=[theme.of(prefix),styleModule.of(buildTheme(`.${prefix}`,spec))];return options&&options.dark&&result.push(darkTheme.of(!0)),result}static baseTheme(spec){return state_dist.Nb.lowest(styleModule.of(buildTheme("."+baseThemeID,spec,lightDarkIDs)))}static findFromDOM(dom){var _a;let content=dom.querySelector(".cm-content"),cView=content&&ContentView.get(content)||ContentView.get(dom);return(null===(_a=null==cView?void 0:cView.rootView)||void 0===_a?void 0:_a.view)||null}}EditorView.styleModule=styleModule,EditorView.inputHandler=inputHandler,EditorView.clipboardInputFilter=clipboardInputFilter,EditorView.clipboardOutputFilter=clipboardOutputFilter,EditorView.scrollHandler=scrollHandler,EditorView.focusChangeEffect=focusChangeEffect,EditorView.perLineTextDirection=perLineTextDirection,EditorView.exceptionSink=exceptionSink,EditorView.updateListener=updateListener,EditorView.editable=editable,EditorView.mouseSelectionStyle=mouseSelectionStyle,EditorView.dragMovesSelection=dragMovesSelection$1,EditorView.clickAddsSelectionRange=clickAddsSelectionRange,EditorView.decorations=decorations,EditorView.outerDecorations=outerDecorations,EditorView.atomicRanges=atomicRanges,EditorView.bidiIsolatedRanges=bidiIsolatedRanges,EditorView.scrollMargins=scrollMargins,EditorView.darkTheme=darkTheme,EditorView.cspNonce=state_dist.sj.define({combine:values=>values.length?values[0]:""}),EditorView.contentAttributes=contentAttributes,EditorView.editorAttributes=editorAttributes,EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"}),EditorView.announce=state_dist.Pe.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(from,to,dir,isolates,fresh,order){this.from=from,this.to=to,this.dir=dir,this.isolates=isolates,this.fresh=fresh,this.order=order}static update(cache,changes){if(changes.empty&&!cache.some((c=>c.fresh)))return cache;let result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction.LTR;for(let i=Math.max(0,cache.length-10);i<cache.length;i++){let entry=cache[i];entry.dir!=lastDir||changes.touchesRange(entry.from,entry.to)||result.push(new CachedOrder(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.isolates,!1,entry.order))}return result}}function attrsFromFacet(view,facet,base){for(let sources=view.state.facet(facet),i=sources.length-1;i>=0;i--){let source=sources[i],value="function"==typeof source?source(view):source;value&&combineAttrs(value,base)}return base}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function modifiers(name,event,shift){return event.altKey&&(name="Alt-"+name),event.ctrlKey&&(name="Ctrl-"+name),event.metaKey&&(name="Meta-"+name),!1!==shift&&event.shiftKey&&(name="Shift-"+name),name}const handleKeyEvents=state_dist.Nb.default(EditorView.domEventHandlers({keydown:(event,view)=>runHandlers(getKeymap(view.state),event,view,"editor")})),keymap=state_dist.sj.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(state){let bindings=state.facet(keymap),map=Keymaps.get(bindings);return map||Keymaps.set(bindings,map=function buildKeymap(bindings,platform=currentPlatform){let bound=Object.create(null),isPrefix=Object.create(null),checkPrefix=(name,is)=>{let current=isPrefix[name];if(null==current)isPrefix[name]=is;else if(current!=is)throw new Error("Key binding "+name+" is used both as a regular binding and as a multi-stroke prefix")},add=(scope,key,command,preventDefault,stopPropagation)=>{var _a,_b;let scopeObj=bound[scope]||(bound[scope]=Object.create(null)),parts=key.split(/ (?!$)/).map((k=>function normalizeKeyName(name,platform){const parts=name.split(/-(?!$)/);let alt,ctrl,shift,meta,result=parts[parts.length-1];"Space"==result&&(result=" ");for(let i=0;i<parts.length-1;++i){const mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);"mac"==platform?meta=!0:ctrl=!0}}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),meta&&(result="Meta-"+result),shift&&(result="Shift-"+result),result}(k,platform)));for(let i=1;i<parts.length;i++){let prefix=parts.slice(0,i).join(" ");checkPrefix(prefix,!0),scopeObj[prefix]||(scopeObj[prefix]={preventDefault:!0,stopPropagation:!1,run:[view=>{let ourObj=storedPrefix={view,prefix,scope};return setTimeout((()=>{storedPrefix==ourObj&&(storedPrefix=null)}),PrefixTimeout),!0}]})}let full=parts.join(" ");checkPrefix(full,!1);let binding=scopeObj[full]||(scopeObj[full]={preventDefault:!1,stopPropagation:!1,run:(null===(_b=null===(_a=scopeObj._any)||void 0===_a?void 0:_a.run)||void 0===_b?void 0:_b.slice())||[]});command&&binding.run.push(command),preventDefault&&(binding.preventDefault=!0),stopPropagation&&(binding.stopPropagation=!0)};for(let b of bindings){let scopes=b.scope?b.scope.split(" "):["editor"];if(b.any)for(let scope of scopes){let scopeObj=bound[scope]||(bound[scope]=Object.create(null));scopeObj._any||(scopeObj._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any}=b;for(let key in scopeObj)scopeObj[key].run.push((view=>any(view,currentKeyEvent)))}let name=b[platform]||b.key;if(name)for(let scope of scopes)add(scope,name,b.run,b.preventDefault,b.stopPropagation),b.shift&&add(scope,"Shift-"+name,b.shift,b.preventDefault,b.stopPropagation)}return bound}(bindings.reduce(((a,b)=>a.concat(b)),[]))),map}function runScopeHandlers(view,event,scope){return runHandlers(getKeymap(view.state),event,view,scope)}let storedPrefix=null;const PrefixTimeout=4e3;let currentKeyEvent=null;function runHandlers(map,event,view,scope){currentKeyEvent=event;let name=function keyName(event){var name=!(mac&&event.metaKey&&event.shiftKey&&!event.ctrlKey&&!event.altKey||ie&&event.shiftKey&&event.key&&1==event.key.length||"Unidentified"==event.key)&&event.key||(event.shiftKey?shift:base)[event.keyCode]||event.key||"Unidentified";return"Esc"==name&&(name="Escape"),"Del"==name&&(name="Delete"),"Left"==name&&(name="ArrowLeft"),"Up"==name&&(name="ArrowUp"),"Right"==name&&(name="ArrowRight"),"Down"==name&&(name="ArrowDown"),name}(event),charCode=(0,state_dist.vS)(name,0),isChar=(0,state_dist.Fh)(charCode)==name.length&&" "!=name,prefix="",handled=!1,prevented=!1,stopPropagation=!1;storedPrefix&&storedPrefix.view==view&&storedPrefix.scope==scope&&(prefix=storedPrefix.prefix+" ",modifierCodes.indexOf(event.keyCode)<0&&(prevented=!0,storedPrefix=null));let baseName,shiftName,ran=new Set,runFor=binding=>{if(binding){for(let cmd of binding.run)if(!ran.has(cmd)&&(ran.add(cmd),cmd(view)))return binding.stopPropagation&&(stopPropagation=!0),!0;binding.preventDefault&&(binding.stopPropagation&&(stopPropagation=!0),prevented=!0)}return!1},scopeObj=map[scope];return scopeObj&&(runFor(scopeObj[prefix+modifiers(name,event,!isChar)])?handled=!0:isChar&&(event.altKey||event.metaKey||event.ctrlKey)&&!(browser.windows&&event.ctrlKey&&event.altKey)&&(baseName=base[event.keyCode])&&baseName!=name?(runFor(scopeObj[prefix+modifiers(baseName,event,!0)])||event.shiftKey&&(shiftName=shift[event.keyCode])!=name&&shiftName!=baseName&&runFor(scopeObj[prefix+modifiers(shiftName,event,!1)]))&&(handled=!0):isChar&&event.shiftKey&&runFor(scopeObj[prefix+modifiers(name,event,!0)])&&(handled=!0),!handled&&runFor(scopeObj._any)&&(handled=!0)),prevented&&(handled=!0),handled&&stopPropagation&&event.stopPropagation(),currentKeyEvent=null,handled}class RectangleMarker{constructor(className,left,top,width,height){this.className=className,this.left=left,this.top=top,this.width=width,this.height=height}draw(){let elt=document.createElement("div");return elt.className=this.className,this.adjust(elt),elt}update(elt,prev){return prev.className==this.className&&(this.adjust(elt),!0)}adjust(elt){elt.style.left=this.left+"px",elt.style.top=this.top+"px",null!=this.width&&(elt.style.width=this.width+"px"),elt.style.height=this.height+"px"}eq(p){return this.left==p.left&&this.top==p.top&&this.width==p.width&&this.height==p.height&&this.className==p.className}static forRange(view,className,range){if(range.empty){let pos=view.coordsAtPos(range.head,range.assoc||1);if(!pos)return[];let base=getBase(view);return[new RectangleMarker(className,pos.left-base.left,pos.top-base.top,null,pos.bottom-pos.top)]}return function rectanglesForRange(view,className,range){if(range.to<=view.viewport.from||range.from>=view.viewport.to)return[];let from=Math.max(range.from,view.viewport.from),to=Math.min(range.to,view.viewport.to),ltr=view.textDirection==Direction.LTR,content=view.contentDOM,contentRect=content.getBoundingClientRect(),base=getBase(view),lineElt=content.querySelector(".cm-line"),lineStyle=lineElt&&window.getComputedStyle(lineElt),leftSide=contentRect.left+(lineStyle?parseInt(lineStyle.paddingLeft)+Math.min(0,parseInt(lineStyle.textIndent)):0),rightSide=contentRect.right-(lineStyle?parseInt(lineStyle.paddingRight):0),startBlock=blockAt(view,from),endBlock=blockAt(view,to),visualStart=startBlock.type==BlockType.Text?startBlock:null,visualEnd=endBlock.type==BlockType.Text?endBlock:null;visualStart&&(view.lineWrapping||startBlock.widgetLineBreaks)&&(visualStart=wrappedLine(view,from,1,visualStart));visualEnd&&(view.lineWrapping||endBlock.widgetLineBreaks)&&(visualEnd=wrappedLine(view,to,-1,visualEnd));if(visualStart&&visualEnd&&visualStart.from==visualEnd.from&&visualStart.to==visualEnd.to)return pieces(drawForLine(range.from,range.to,visualStart));{let top=visualStart?drawForLine(range.from,null,visualStart):drawForWidget(startBlock,!1),bottom=visualEnd?drawForLine(null,range.to,visualEnd):drawForWidget(endBlock,!0),between=[];return(visualStart||startBlock).to<(visualEnd||endBlock).from-(visualStart&&visualEnd?1:0)||startBlock.widgetLineBreaks>1&&top.bottom+view.defaultLineHeight/2<bottom.top?between.push(piece(leftSide,top.bottom,rightSide,bottom.top)):top.bottom<bottom.top&&view.elementAtHeight((top.bottom+bottom.top)/2).type==BlockType.Text&&(top.bottom=bottom.top=(top.bottom+bottom.top)/2),pieces(top).concat(between).concat(pieces(bottom))}function piece(left,top,right,bottom){return new RectangleMarker(className,left-base.left,top-base.top,right-left,bottom-top)}function pieces({top,bottom,horizontal}){let pieces=[];for(let i=0;i<horizontal.length;i+=2)pieces.push(piece(horizontal[i],top,horizontal[i+1],bottom));return pieces}function drawForLine(from,to,line){let top=1e9,bottom=-1e9,horizontal=[];function addSpan(from,fromOpen,to,toOpen,dir){let fromCoords=view.coordsAtPos(from,from==line.to?-2:2),toCoords=view.coordsAtPos(to,to==line.from?2:-2);fromCoords&&toCoords&&(top=Math.min(fromCoords.top,toCoords.top,top),bottom=Math.max(fromCoords.bottom,toCoords.bottom,bottom),dir==Direction.LTR?horizontal.push(ltr&&fromOpen?leftSide:fromCoords.left,ltr&&toOpen?rightSide:toCoords.right):horizontal.push(!ltr&&toOpen?leftSide:toCoords.left,!ltr&&fromOpen?rightSide:fromCoords.right))}let start=null!=from?from:line.from,end=null!=to?to:line.to;for(let r of view.visibleRanges)if(r.to>start&&r.from<end)for(let pos=Math.max(r.from,start),endPos=Math.min(r.to,end);;){let docLine=view.state.doc.lineAt(pos);for(let span of view.bidiSpans(docLine)){let spanFrom=span.from+docLine.from,spanTo=span.to+docLine.from;if(spanFrom>=endPos)break;spanTo>pos&&addSpan(Math.max(spanFrom,pos),null==from&&spanFrom<=start,Math.min(spanTo,endPos),null==to&&spanTo>=end,span.dir)}if(pos=docLine.to+1,pos>=endPos)break}return 0==horizontal.length&&addSpan(start,null==from,end,null==to,view.textDirection),{top,bottom,horizontal}}function drawForWidget(block,top){let y=contentRect.top+(top?block.top:block.bottom);return{top:y,bottom:y,horizontal:[]}}}(view,className,range)}}function getBase(view){let rect=view.scrollDOM.getBoundingClientRect();return{left:(view.textDirection==Direction.LTR?rect.left:rect.right-view.scrollDOM.clientWidth*view.scaleX)-view.scrollDOM.scrollLeft*view.scaleX,top:rect.top-view.scrollDOM.scrollTop*view.scaleY}}function wrappedLine(view,pos,side,inside){let coords=view.coordsAtPos(pos,2*side);if(!coords)return inside;let editorRect=view.dom.getBoundingClientRect(),y=(coords.top+coords.bottom)/2,left=view.posAtCoords({x:editorRect.left+1,y}),right=view.posAtCoords({x:editorRect.right-1,y});return null==left||null==right?inside:{from:Math.max(inside.from,Math.min(left,right)),to:Math.min(inside.to,Math.max(left,right))}}class LayerView{constructor(view,layer){this.view=view,this.layer=layer,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=view.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),layer.above&&this.dom.classList.add("cm-layer-above"),layer.class&&this.dom.classList.add(layer.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(view.state),view.requestMeasure(this.measureReq),layer.mount&&layer.mount(this.dom,view)}update(update){update.startState.facet(layerOrder)!=update.state.facet(layerOrder)&&this.setOrder(update.state),(this.layer.update(update,this.dom)||update.geometryChanged)&&(this.scale(),update.view.requestMeasure(this.measureReq))}docViewUpdate(view){!1!==this.layer.updateOnDocViewUpdate&&view.requestMeasure(this.measureReq)}setOrder(state){let pos=0,order=state.facet(layerOrder);for(;pos<order.length&&order[pos]!=this.layer;)pos++;this.dom.style.zIndex=String((this.layer.above?150:-1)-pos)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX,scaleY}=this.view;scaleX==this.scaleX&&scaleY==this.scaleY||(this.scaleX=scaleX,this.scaleY=scaleY,this.dom.style.transform=`scale(${1/scaleX}, ${1/scaleY})`)}draw(markers){if(markers.length!=this.drawn.length||markers.some(((p,i)=>!function sameMarker(a,b){return a.constructor==b.constructor&&a.eq(b)}(p,this.drawn[i])))){let old=this.dom.firstChild,oldI=0;for(let marker of markers)marker.update&&old&&marker.constructor&&this.drawn[oldI].constructor&&marker.update(old,this.drawn[oldI])?(old=old.nextSibling,oldI++):this.dom.insertBefore(marker.draw(),old);for(;old;){let next=old.nextSibling;old.remove(),old=next}this.drawn=markers}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=state_dist.sj.define();function dist_layer(config){return[ViewPlugin.define((v=>new LayerView(v,config))),layerOrder.of(config)]}const CanHidePrimary=!(browser.ios&&browser.webkit&&browser.webkit_version<534),selectionConfig=state_dist.sj.define({combine:configs=>(0,state_dist.QR)(configs,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(a,b)=>Math.min(a,b),drawRangeCursor:(a,b)=>a||b})});function drawSelection(config={}){return[selectionConfig.of(config),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(update){return update.startState.facet(selectionConfig)!=update.state.facet(selectionConfig)}const cursorLayer=dist_layer({above:!0,markers(view){let{state}=view,conf=state.facet(selectionConfig),cursors=[];for(let r of state.selection.ranges){let prim=r==state.selection.main;if(r.empty?!prim||CanHidePrimary:conf.drawRangeCursor){let className=prim?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",cursor=r.empty?r:state_dist.OF.cursor(r.head,r.head>r.anchor?-1:1);for(let piece of RectangleMarker.forRange(view,className,cursor))cursors.push(piece)}}return cursors},update(update,dom){update.transactions.some((tr=>tr.selection))&&(dom.style.animationName="cm-blink"==dom.style.animationName?"cm-blink2":"cm-blink");let confChange=configChanged(update);return confChange&&setBlinkRate(update.state,dom),update.docChanged||update.selectionSet||confChange},mount(dom,view){setBlinkRate(view.state,dom)},class:"cm-cursorLayer"});function setBlinkRate(state,dom){dom.style.animationDuration=state.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=dist_layer({above:!1,markers:view=>view.state.selection.ranges.map((r=>r.empty?[]:RectangleMarker.forRange(view,"cm-selectionBackground",r))).reduce(((a,b)=>a.concat(b))),update:(update,dom)=>update.docChanged||update.selectionSet||update.viewportChanged||configChanged(update),class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor=themeSpec[".cm-content"].caretColor="transparent !important");const hideNativeSelection=state_dist.Nb.highest(EditorView.theme(themeSpec)),setDropCursorPos=state_dist.Pe.define({map:(pos,mapping)=>null==pos?null:mapping.mapPos(pos)}),dropCursorPos=state_dist.sU.define({create:()=>null,update:(pos,tr)=>(null!=pos&&(pos=tr.changes.mapPos(pos)),tr.effects.reduce(((pos,e)=>e.is(setDropCursorPos)?e.value:pos),pos))}),drawDropCursor=ViewPlugin.fromClass(class{constructor(view){this.view=view,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(update){var _a;let cursorPos=update.state.field(dropCursorPos);null==cursorPos?null!=this.cursor&&(null===(_a=this.cursor)||void 0===_a||_a.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(update.startState.field(dropCursorPos)!=cursorPos||update.docChanged||update.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view}=this,pos=view.state.field(dropCursorPos),rect=null!=pos&&view.coordsAtPos(pos);if(!rect)return null;let outer=view.scrollDOM.getBoundingClientRect();return{left:rect.left-outer.left+view.scrollDOM.scrollLeft*view.scaleX,top:rect.top-outer.top+view.scrollDOM.scrollTop*view.scaleY,height:rect.bottom-rect.top}}drawCursor(pos){if(this.cursor){let{scaleX,scaleY}=this.view;pos?(this.cursor.style.left=pos.left/scaleX+"px",this.cursor.style.top=pos.top/scaleY+"px",this.cursor.style.height=pos.height/scaleY+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(pos){this.view.state.field(dropCursorPos)!=pos&&this.view.dispatch({effects:setDropCursorPos.of(pos)})}},{eventObservers:{dragover(event){this.setDropPos(this.view.posAtCoords({x:event.clientX,y:event.clientY}))},dragleave(event){event.target!=this.view.contentDOM&&this.view.contentDOM.contains(event.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(doc,re,from,to,f){re.lastIndex=0;for(let m,cursor=doc.iterRange(from,to),pos=from;!cursor.next().done;pos+=cursor.value.length)if(!cursor.lineBreak)for(;m=re.exec(cursor.value);)f(pos+m.index,m)}class MatchDecorator{constructor(config){const{regexp,decoration,decorate,boundary,maxLength=1e3}=config;if(!regexp.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=regexp,decorate)this.addMatch=(match,view,from,add)=>decorate(add,from,from+match[0].length,match,view);else if("function"==typeof decoration)this.addMatch=(match,view,from,add)=>{let deco=decoration(match,view,from);deco&&add(from,from+match[0].length,deco)};else{if(!decoration)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(match,_view,from,add)=>add(from,from+match[0].length,decoration)}this.boundary=boundary,this.maxLength=maxLength}createDeco(view){let build=new state_dist.vB,add=build.add.bind(build);for(let{from,to}of function matchRanges(view,maxLength){let visible=view.visibleRanges;if(1==visible.length&&visible[0].from==view.viewport.from&&visible[0].to==view.viewport.to)return visible;let result=[];for(let{from,to}of visible)from=Math.max(view.state.doc.lineAt(from).from,from-maxLength),to=Math.min(view.state.doc.lineAt(to).to,to+maxLength),result.length&&result[result.length-1].to>=from?result[result.length-1].to=to:result.push({from,to});return result}(view,this.maxLength))iterMatches(view.state.doc,this.regexp,from,to,((from,m)=>this.addMatch(m,view,from,add)));return build.finish()}updateDeco(update,deco){let changeFrom=1e9,changeTo=-1;return update.docChanged&&update.changes.iterChanges(((_f,_t,from,to)=>{to>=update.view.viewport.from&&from<=update.view.viewport.to&&(changeFrom=Math.min(from,changeFrom),changeTo=Math.max(to,changeTo))})),update.viewportMoved||changeTo-changeFrom>1e3?this.createDeco(update.view):changeTo>-1?this.updateRange(update.view,deco.map(update.changes),changeFrom,changeTo):deco}updateRange(view,deco,updateFrom,updateTo){for(let r of view.visibleRanges){let from=Math.max(r.from,updateFrom),to=Math.min(r.to,updateTo);if(to>from){let fromLine=view.state.doc.lineAt(from),toLine=fromLine.to<to?view.state.doc.lineAt(to):fromLine,start=Math.max(r.from,fromLine.from),end=Math.min(r.to,toLine.to);if(this.boundary){for(;from>fromLine.from;from--)if(this.boundary.test(fromLine.text[from-1-fromLine.from])){start=from;break}for(;to<toLine.to;to++)if(this.boundary.test(toLine.text[to-toLine.from])){end=to;break}}let m,ranges=[],add=(from,to,deco)=>ranges.push(deco.range(from,to));if(fromLine==toLine)for(this.regexp.lastIndex=start-fromLine.from;(m=this.regexp.exec(fromLine.text))&&m.index<end-fromLine.from;)this.addMatch(m,view,m.index+fromLine.from,add);else iterMatches(view.state.doc,this.regexp,start,end,((from,m)=>this.addMatch(m,view,from,add)));deco=deco.update({filterFrom:start,filterTo:end,filter:(from,to)=>from<start||to>end,add:ranges})}}return deco}}const UnicodeRegexpSupport=null!=/x/.unicode?"gu":"g",Specials=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\ufeff￹-￼]",UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;const specialCharConfig=state_dist.sj.define({combine(configs){let config=(0,state_dist.QR)(configs,{render:null,specialChars:Specials,addSpecialChars:null});return(config.replaceTabs=!function supportsTabSize(){var _a;if(null==_supportsTabSize&&"undefined"!=typeof document&&document.body){let styles=document.body.style;_supportsTabSize=null!=(null!==(_a=styles.tabSize)&&void 0!==_a?_a:styles.MozTabSize)}return _supportsTabSize||!1}())&&(config.specialChars=new RegExp("\t|"+config.specialChars.source,UnicodeRegexpSupport)),config.addSpecialChars&&(config.specialChars=new RegExp(config.specialChars.source+"|"+config.addSpecialChars.source,UnicodeRegexpSupport)),config}});function highlightSpecialChars(config={}){return[specialCharConfig.of(config),_plugin||(_plugin=ViewPlugin.fromClass(class{constructor(view){this.view=view,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(view.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(view)}makeDecorator(conf){return new MatchDecorator({regexp:conf.specialChars,decoration:(m,view,pos)=>{let{doc}=view.state,code=(0,state_dist.vS)(m[0],0);if(9==code){let line=doc.lineAt(pos),size=view.state.tabSize,col=(0,state_dist.y$)(line.text,size,pos-line.from);return Decoration.replace({widget:new TabWidget((size-col%size)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[code]||(this.decorationCache[code]=Decoration.replace({widget:new SpecialCharWidget(conf,code)}))},boundary:conf.replaceTabs?void 0:/[^]/})}update(update){let conf=update.state.facet(specialCharConfig);update.startState.facet(specialCharConfig)!=conf?(this.decorator=this.makeDecorator(conf),this.decorations=this.decorator.createDeco(update.view)):this.decorations=this.decorator.updateDeco(update,this.decorations)}},{decorations:v=>v.decorations}))]}let _plugin=null;class SpecialCharWidget extends WidgetType{constructor(options,code){super(),this.options=options,this.code=code}eq(other){return other.code==this.code}toDOM(view){let ph=function placeholder$1(code){return code>=32?"•":10==code?"␤":String.fromCharCode(9216+code)}(this.code),desc=view.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),custom=this.options.render&&this.options.render(this.code,desc,ph);if(custom)return custom;let span=document.createElement("span");return span.textContent=ph,span.title=desc,span.setAttribute("aria-label",desc),span.className="cm-specialChar",span}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(width){super(),this.width=width}eq(other){return other.width==this.width}toDOM(){let span=document.createElement("span");return span.textContent="\t",span.className="cm-tab",span.style.width=this.width+"px",span}ignoreEvent(){return!1}}class TooltipViewManager{constructor(view,facet,createTooltipView,removeTooltipView){this.facet=facet,this.createTooltipView=createTooltipView,this.removeTooltipView=removeTooltipView,this.input=view.state.facet(facet),this.tooltips=this.input.filter((t=>t));let prev=null;this.tooltipViews=this.tooltips.map((t=>prev=createTooltipView(t,prev)))}update(update,above){var _a;let input=update.state.facet(this.facet),tooltips=input.filter((x=>x));if(input===this.input){for(let t of this.tooltipViews)t.update&&t.update(update);return!1}let tooltipViews=[],newAbove=above?[]:null;for(let i=0;i<tooltips.length;i++){let tip=tooltips[i],known=-1;if(tip){for(let i=0;i<this.tooltips.length;i++){let other=this.tooltips[i];other&&other.create==tip.create&&(known=i)}if(known<0)tooltipViews[i]=this.createTooltipView(tip,i?tooltipViews[i-1]:null),newAbove&&(newAbove[i]=!!tip.above);else{let tooltipView=tooltipViews[i]=this.tooltipViews[known];newAbove&&(newAbove[i]=above[known]),tooltipView.update&&tooltipView.update(update)}}}for(let t of this.tooltipViews)tooltipViews.indexOf(t)<0&&(this.removeTooltipView(t),null===(_a=t.destroy)||void 0===_a||_a.call(t));return above&&(newAbove.forEach(((val,i)=>above[i]=val)),above.length=newAbove.length),this.input=input,this.tooltips=tooltips,this.tooltipViews=tooltipViews,!0}}function windowSpace(view){let{win}=view;return{top:0,left:0,bottom:win.innerHeight,right:win.innerWidth}}const tooltipConfig=state_dist.sj.define({combine:values=>{var _a,_b,_c;return{position:browser.ios?"absolute":(null===(_a=values.find((conf=>conf.position)))||void 0===_a?void 0:_a.position)||"fixed",parent:(null===(_b=values.find((conf=>conf.parent)))||void 0===_b?void 0:_b.parent)||null,tooltipSpace:(null===(_c=values.find((conf=>conf.tooltipSpace)))||void 0===_c?void 0:_c.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(view){this.view=view,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let config=view.state.facet(tooltipConfig);this.position=config.position,this.parent=config.parent,this.classes=view.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver="function"==typeof ResizeObserver?new ResizeObserver((()=>this.measureSoon())):null,this.manager=new TooltipViewManager(view,showTooltip,((t,p)=>this.createTooltip(t,p)),(t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()})),this.above=this.manager.tooltips.map((t=>!!t.above)),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((entries=>{Date.now()>this.lastTransaction-50&&entries.length>0&&entries[entries.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),view.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let tooltip of this.manager.tooltipViews)this.intersectionObserver.observe(tooltip.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(update){update.transactions.length&&(this.lastTransaction=Date.now());let updated=this.manager.update(update,this.above);updated&&this.observeIntersection();let shouldMeasure=updated||update.geometryChanged,newConfig=update.state.facet(tooltipConfig);if(newConfig.position!=this.position&&!this.madeAbsolute){this.position=newConfig.position;for(let t of this.manager.tooltipViews)t.dom.style.position=this.position;shouldMeasure=!0}if(newConfig.parent!=this.parent){this.parent&&this.container.remove(),this.parent=newConfig.parent,this.createContainer();for(let t of this.manager.tooltipViews)this.container.appendChild(t.dom);shouldMeasure=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);shouldMeasure&&this.maybeMeasure()}createTooltip(tooltip,prev){let tooltipView=tooltip.create(this.view),before=prev?prev.dom:null;if(tooltipView.dom.classList.add("cm-tooltip"),tooltip.arrow&&!tooltipView.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let arrow=document.createElement("div");arrow.className="cm-tooltip-arrow",tooltipView.dom.appendChild(arrow)}return tooltipView.dom.style.position=this.position,tooltipView.dom.style.top="-10000px",tooltipView.dom.style.left="0px",this.container.insertBefore(tooltipView.dom,before),tooltipView.mount&&tooltipView.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(tooltipView.dom),tooltipView}destroy(){var _a,_b,_c;this.view.win.removeEventListener("resize",this.measureSoon);for(let tooltipView of this.manager.tooltipViews)tooltipView.dom.remove(),null===(_a=tooltipView.destroy)||void 0===_a||_a.call(tooltipView);this.parent&&this.container.remove(),null===(_b=this.resizeObserver)||void 0===_b||_b.disconnect(),null===(_c=this.intersectionObserver)||void 0===_c||_c.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let scaleX=1,scaleY=1,makeAbsolute=!1;if("fixed"==this.position&&this.manager.tooltipViews.length){let{dom}=this.manager.tooltipViews[0];if(browser.gecko)makeAbsolute=dom.offsetParent!=this.container.ownerDocument.body;else if("-10000px"==dom.style.top&&"0px"==dom.style.left){let rect=dom.getBoundingClientRect();makeAbsolute=Math.abs(rect.top+1e4)>1||Math.abs(rect.left)>1}}if(makeAbsolute||"absolute"==this.position)if(this.parent){let rect=this.parent.getBoundingClientRect();rect.width&&rect.height&&(scaleX=rect.width/this.parent.offsetWidth,scaleY=rect.height/this.parent.offsetHeight)}else({scaleX,scaleY}=this.view.viewState);let visible=this.view.scrollDOM.getBoundingClientRect(),margins=getScrollMargins(this.view);return{visible:{left:visible.left+margins.left,top:visible.top+margins.top,right:visible.right-margins.right,bottom:visible.bottom-margins.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map(((t,i)=>{let tv=this.manager.tooltipViews[i];return tv.getCoords?tv.getCoords(t.pos):this.view.coordsAtPos(t.pos)})),size:this.manager.tooltipViews.map((({dom})=>dom.getBoundingClientRect())),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX,scaleY,makeAbsolute}}writeMeasure(measured){var _a;if(measured.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let t of this.manager.tooltipViews)t.dom.style.position="absolute"}let{visible,space,scaleX,scaleY}=measured,others=[];for(let i=0;i<this.manager.tooltips.length;i++){let tooltip=this.manager.tooltips[i],tView=this.manager.tooltipViews[i],{dom}=tView,pos=measured.pos[i],size=measured.size[i];if(!pos||!1!==tooltip.clip&&(pos.bottom<=Math.max(visible.top,space.top)||pos.top>=Math.min(visible.bottom,space.bottom)||pos.right<Math.max(visible.left,space.left)-.1||pos.left>Math.min(visible.right,space.right)+.1)){dom.style.top="-10000px";continue}let arrow=tooltip.arrow?tView.dom.querySelector(".cm-tooltip-arrow"):null,arrowHeight=arrow?7:0,width=size.right-size.left,height=null!==(_a=knownHeight.get(tView))&&void 0!==_a?_a:size.bottom-size.top,offset=tView.offset||noOffset,ltr=this.view.textDirection==Direction.LTR,left=size.width>space.right-space.left?ltr?space.left:space.right-size.width:ltr?Math.max(space.left,Math.min(pos.left-(arrow?14:0)+offset.x,space.right-width)):Math.min(Math.max(space.left,pos.left-width+(arrow?14:0)-offset.x),space.right-width),above=this.above[i];!tooltip.strictSide&&(above?pos.top-height-arrowHeight-offset.y<space.top:pos.bottom+height+arrowHeight+offset.y>space.bottom)&&above==space.bottom-pos.bottom>pos.top-space.top&&(above=this.above[i]=!above);let spaceVert=(above?pos.top-space.top:space.bottom-pos.bottom)-arrowHeight;if(spaceVert<height&&!1!==tView.resize){if(spaceVert<this.view.defaultLineHeight){dom.style.top="-10000px";continue}knownHeight.set(tView,height),dom.style.height=(height=spaceVert)/scaleY+"px"}else dom.style.height&&(dom.style.height="");let top=above?pos.top-height-arrowHeight-offset.y:pos.bottom+arrowHeight+offset.y,right=left+width;if(!0!==tView.overlap)for(let r of others)r.left<right&&r.right>left&&r.top<top+height&&r.bottom>top&&(top=above?r.top-height-2-arrowHeight:r.bottom+arrowHeight+2);if("absolute"==this.position?(dom.style.top=(top-measured.parent.top)/scaleY+"px",setLeftStyle(dom,(left-measured.parent.left)/scaleX)):(dom.style.top=top/scaleY+"px",setLeftStyle(dom,left/scaleX)),arrow){let arrowLeft=pos.left+(ltr?offset.x:-offset.x)-(left+14-7);arrow.style.left=arrowLeft/scaleX+"px"}!0!==tView.overlap&&others.push({left,top,right,bottom:top+height}),dom.classList.toggle("cm-tooltip-above",above),dom.classList.toggle("cm-tooltip-below",!above),tView.positioned&&tView.positioned(measured.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let tv of this.manager.tooltipViews)tv.dom.style.top="-10000px"}},{eventObservers:{scroll(){this.maybeMeasure()}}});function setLeftStyle(elt,value){let current=parseInt(elt.style.left,10);(isNaN(current)||Math.abs(value-current)>1)&&(elt.style.left=value+"px")}const baseTheme=EditorView.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=state_dist.sj.define({enables:[tooltipPlugin,baseTheme]}),showHoverTooltip=state_dist.sj.define({combine:inputs=>inputs.reduce(((a,i)=>a.concat(i)),[])});class HoverTooltipHost{static create(view){return new HoverTooltipHost(view)}constructor(view){this.view=view,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new TooltipViewManager(view,showHoverTooltip,((t,p)=>this.createHostedView(t,p)),(t=>t.dom.remove()))}createHostedView(tooltip,prev){let hostedView=tooltip.create(this.view);return hostedView.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(hostedView.dom,prev?prev.dom.nextSibling:this.dom.firstChild),this.mounted&&hostedView.mount&&hostedView.mount(this.view),hostedView}mount(view){for(let hostedView of this.manager.tooltipViews)hostedView.mount&&hostedView.mount(view);this.mounted=!0}positioned(space){for(let hostedView of this.manager.tooltipViews)hostedView.positioned&&hostedView.positioned(space)}update(update){this.manager.update(update)}destroy(){var _a;for(let t of this.manager.tooltipViews)null===(_a=t.destroy)||void 0===_a||_a.call(t)}passProp(name){let value;for(let view of this.manager.tooltipViews){let given=view[name];if(void 0!==given)if(void 0===value)value=given;else if(value!==given)return}return value}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],(state=>{let tooltips=state.facet(showHoverTooltip);return 0===tooltips.length?null:{pos:Math.min(...tooltips.map((t=>t.pos))),end:Math.max(...tooltips.map((t=>{var _a;return null!==(_a=t.end)&&void 0!==_a?_a:t.pos}))),create:HoverTooltipHost.create,above:tooltips[0].above,arrow:tooltips.some((t=>t.arrow))}}));class HoverPlugin{constructor(view,source,field,setHover,hoverTime){this.view=view,this.source=source,this.field=field,this.setHover=setHover,this.hoverTime=hoverTime,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:view.dom,time:0},this.checkHover=this.checkHover.bind(this),view.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),view.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let hovered=Date.now()-this.lastMove.time;hovered<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-hovered):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view,lastMove}=this,desc=view.docView.nearest(lastMove.target);if(!desc)return;let pos,side=1;if(desc instanceof WidgetView)pos=desc.posAtStart;else{if(pos=view.posAtCoords(lastMove),null==pos)return;let posCoords=view.coordsAtPos(pos);if(!posCoords||lastMove.y<posCoords.top||lastMove.y>posCoords.bottom||lastMove.x<posCoords.left-view.defaultCharacterWidth||lastMove.x>posCoords.right+view.defaultCharacterWidth)return;let bidi=view.bidiSpans(view.state.doc.lineAt(pos)).find((s=>s.from<=pos&&s.to>=pos)),rtl=bidi&&bidi.dir==Direction.RTL?-1:1;side=lastMove.x<posCoords.left?-rtl:rtl}let open=this.source(view,pos,side);if(null==open?void 0:open.then){let pending=this.pending={pos};open.then((result=>{this.pending==pending&&(this.pending=null,!result||Array.isArray(result)&&!result.length||view.dispatch({effects:this.setHover.of(Array.isArray(result)?result:[result])}))}),(e=>logException(view.state,e,"hover tooltip")))}else!open||Array.isArray(open)&&!open.length||view.dispatch({effects:this.setHover.of(Array.isArray(open)?open:[open])})}get tooltip(){let plugin=this.view.plugin(tooltipPlugin),index=plugin?plugin.manager.tooltips.findIndex((t=>t.create==HoverTooltipHost.create)):-1;return index>-1?plugin.manager.tooltipViews[index]:null}mousemove(event){var _a,_b;this.lastMove={x:event.clientX,y:event.clientY,target:event.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active,tooltip}=this;if(active.length&&tooltip&&!function isInTooltip(tooltip,event){let arrow,{left,right,top,bottom}=tooltip.getBoundingClientRect();if(arrow=tooltip.querySelector(".cm-tooltip-arrow")){let arrowRect=arrow.getBoundingClientRect();top=Math.min(arrowRect.top,top),bottom=Math.max(arrowRect.bottom,bottom)}return event.clientX>=left-tooltipMargin&&event.clientX<=right+tooltipMargin&&event.clientY>=top-tooltipMargin&&event.clientY<=bottom+tooltipMargin}(tooltip.dom,event)||this.pending){let{pos}=active[0]||this.pending,end=null!==(_b=null===(_a=active[0])||void 0===_a?void 0:_a.end)&&void 0!==_b?_b:pos;(pos==end?this.view.posAtCoords(this.lastMove)==pos:function isOverRange(view,from,to,x,y,margin){let rect=view.scrollDOM.getBoundingClientRect(),docBottom=view.documentTop+view.documentPadding.top+view.contentHeight;if(rect.left>x||rect.right<x||rect.top>y||Math.min(rect.bottom,docBottom)<y)return!1;let pos=view.posAtCoords({x,y},!1);return pos>=from&&pos<=to}(this.view,pos,end,event.clientX,event.clientY))||(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(event){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active}=this;if(active.length){let{tooltip}=this;tooltip&&tooltip.dom.contains(event.relatedTarget)?this.watchTooltipLeave(tooltip.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(tooltip){let watch=event=>{tooltip.removeEventListener("mouseleave",watch),this.active.length&&!this.view.dom.contains(event.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};tooltip.addEventListener("mouseleave",watch)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const tooltipMargin=4;function hoverTooltip(source,options={}){let setHover=state_dist.Pe.define(),hoverState=state_dist.sU.define({create:()=>[],update(value,tr){if(value.length&&(options.hideOnChange&&(tr.docChanged||tr.selection)?value=[]:options.hideOn&&(value=value.filter((v=>!options.hideOn(tr,v)))),tr.docChanged)){let mapped=[];for(let tooltip of value){let newPos=tr.changes.mapPos(tooltip.pos,-1,state_dist.iR.TrackDel);if(null!=newPos){let copy=Object.assign(Object.create(null),tooltip);copy.pos=newPos,null!=copy.end&&(copy.end=tr.changes.mapPos(copy.end)),mapped.push(copy)}}value=mapped}for(let effect of tr.effects)effect.is(setHover)&&(value=effect.value),effect.is(closeHoverTooltipEffect)&&(value=[]);return value},provide:f=>showHoverTooltip.from(f)});return{active:hoverState,extension:[hoverState,ViewPlugin.define((view=>new HoverPlugin(view,source,hoverState,setHover,options.hoverTime||300))),showHoverTooltipHost]}}function getTooltip(view,tooltip){let plugin=view.plugin(tooltipPlugin);if(!plugin)return null;let found=plugin.manager.tooltips.indexOf(tooltip);return found<0?null:plugin.manager.tooltipViews[found]}const closeHoverTooltipEffect=state_dist.Pe.define();const panelConfig=state_dist.sj.define({combine(configs){let topContainer,bottomContainer;for(let c of configs)topContainer=topContainer||c.topContainer,bottomContainer=bottomContainer||c.bottomContainer;return{topContainer,bottomContainer}}});function getPanel(view,panel){let plugin=view.plugin(panelPlugin),index=plugin?plugin.specs.indexOf(panel):-1;return index>-1?plugin.panels[index]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(view){this.input=view.state.facet(showPanel),this.specs=this.input.filter((s=>s)),this.panels=this.specs.map((spec=>spec(view)));let conf=view.state.facet(panelConfig);this.top=new PanelGroup(view,!0,conf.topContainer),this.bottom=new PanelGroup(view,!1,conf.bottomContainer),this.top.sync(this.panels.filter((p=>p.top))),this.bottom.sync(this.panels.filter((p=>!p.top)));for(let p of this.panels)p.dom.classList.add("cm-panel"),p.mount&&p.mount()}update(update){let conf=update.state.facet(panelConfig);this.top.container!=conf.topContainer&&(this.top.sync([]),this.top=new PanelGroup(update.view,!0,conf.topContainer)),this.bottom.container!=conf.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(update.view,!1,conf.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let input=update.state.facet(showPanel);if(input!=this.input){let specs=input.filter((x=>x)),panels=[],top=[],bottom=[],mount=[];for(let spec of specs){let panel,known=this.specs.indexOf(spec);known<0?(panel=spec(update.view),mount.push(panel)):(panel=this.panels[known],panel.update&&panel.update(update)),panels.push(panel),(panel.top?top:bottom).push(panel)}this.specs=specs,this.panels=panels,this.top.sync(top),this.bottom.sync(bottom);for(let p of mount)p.dom.classList.add("cm-panel"),p.mount&&p.mount()}else for(let p of this.panels)p.update&&p.update(update)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:plugin=>EditorView.scrollMargins.of((view=>{let value=view.plugin(plugin);return value&&{top:value.top.scrollMargin(),bottom:value.bottom.scrollMargin()}}))});class PanelGroup{constructor(view,top,container){this.view=view,this.top=top,this.container=container,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(panels){for(let p of this.panels)p.destroy&&panels.indexOf(p)<0&&p.destroy();this.panels=panels,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let parent=this.container||this.view.dom;parent.insertBefore(this.dom,this.top?parent.firstChild:null)}let curDOM=this.dom.firstChild;for(let panel of this.panels)if(panel.dom.parentNode==this.dom){for(;curDOM!=panel.dom;)curDOM=rm(curDOM);curDOM=curDOM.nextSibling}else this.dom.insertBefore(panel.dom,curDOM);for(;curDOM;)curDOM=rm(curDOM)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let cls of this.classes.split(" "))cls&&this.container.classList.remove(cls);for(let cls of(this.classes=this.view.themeClasses).split(" "))cls&&this.container.classList.add(cls)}}}function rm(node){let next=node.nextSibling;return node.remove(),next}const showPanel=state_dist.sj.define({enables:panelPlugin});class GutterMarker extends state_dist.FB{compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}eq(other){return!1}destroy(dom){}}GutterMarker.prototype.elementClass="",GutterMarker.prototype.toDOM=void 0,GutterMarker.prototype.mapMode=state_dist.iR.TrackBefore,GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1,GutterMarker.prototype.point=!0;const gutterLineClass=state_dist.sj.define(),gutterWidgetClass=state_dist.sj.define(),defaults={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>state_dist.om.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=state_dist.sj.define();function gutter(config){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults),config))]}const unfixGutters=state_dist.sj.define({combine:values=>values.some((x=>x))});function gutters(config){let result=[gutterView];return config&&!1===config.fixed&&result.push(unfixGutters.of(!0)),result}const gutterView=ViewPlugin.fromClass(class{constructor(view){this.view=view,this.prevViewport=view.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=view.state.facet(activeGutters).map((conf=>new SingleGutterView(view,conf)));for(let gutter of this.gutters)this.dom.appendChild(gutter.dom);this.fixed=!view.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),view.scrollDOM.insertBefore(this.dom,view.contentDOM)}update(update){if(this.updateGutters(update)){let vpA=this.prevViewport,vpB=update.view.viewport,vpOverlap=Math.min(vpA.to,vpB.to)-Math.max(vpA.from,vpB.from);this.syncGutters(vpOverlap<.8*(vpB.to-vpB.from))}update.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=update.view.viewport}syncGutters(detach){let after=this.dom.nextSibling;detach&&this.dom.remove();let lineClasses=state_dist.om.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),classSet=[],contexts=this.gutters.map((gutter=>new UpdateContext(gutter,this.view.viewport,-this.view.documentPadding.top)));for(let line of this.view.viewportLineBlocks)if(classSet.length&&(classSet=[]),Array.isArray(line.type)){let first=!0;for(let b of line.type)if(b.type==BlockType.Text&&first){advanceCursor(lineClasses,classSet,b.from);for(let cx of contexts)cx.line(this.view,b,classSet);first=!1}else if(b.widget)for(let cx of contexts)cx.widget(this.view,b)}else if(line.type==BlockType.Text){advanceCursor(lineClasses,classSet,line.from);for(let cx of contexts)cx.line(this.view,line,classSet)}else if(line.widget)for(let cx of contexts)cx.widget(this.view,line);for(let cx of contexts)cx.finish();detach&&this.view.scrollDOM.insertBefore(this.dom,after)}updateGutters(update){let prev=update.startState.facet(activeGutters),cur=update.state.facet(activeGutters),change=update.docChanged||update.heightChanged||update.viewportChanged||!state_dist.om.eq(update.startState.facet(gutterLineClass),update.state.facet(gutterLineClass),update.view.viewport.from,update.view.viewport.to);if(prev==cur)for(let gutter of this.gutters)gutter.update(update)&&(change=!0);else{change=!0;let gutters=[];for(let conf of cur){let known=prev.indexOf(conf);known<0?gutters.push(new SingleGutterView(this.view,conf)):(this.gutters[known].update(update),gutters.push(this.gutters[known]))}for(let g of this.gutters)g.dom.remove(),gutters.indexOf(g)<0&&g.destroy();for(let g of gutters)this.dom.appendChild(g.dom);this.gutters=gutters}return change}destroy(){for(let view of this.gutters)view.destroy();this.dom.remove()}},{provide:plugin=>EditorView.scrollMargins.of((view=>{let value=view.plugin(plugin);return value&&0!=value.gutters.length&&value.fixed?view.textDirection==Direction.LTR?{left:value.dom.offsetWidth*view.scaleX}:{right:value.dom.offsetWidth*view.scaleX}:null}))});function asArray(val){return Array.isArray(val)?val:[val]}function advanceCursor(cursor,collect,pos){for(;cursor.value&&cursor.from<=pos;)cursor.from==pos&&collect.push(cursor.value),cursor.next()}class UpdateContext{constructor(gutter,viewport,height){this.gutter=gutter,this.height=height,this.i=0,this.cursor=state_dist.om.iter(gutter.markers,viewport.from)}addElement(view,block,markers){let{gutter}=this,above=(block.top-this.height)/view.scaleY,height=block.height/view.scaleY;if(this.i==gutter.elements.length){let newElt=new GutterElement(view,height,above,markers);gutter.elements.push(newElt),gutter.dom.appendChild(newElt.dom)}else gutter.elements[this.i].update(view,height,above,markers);this.height=block.bottom,this.i++}line(view,line,extraMarkers){let localMarkers=[];advanceCursor(this.cursor,localMarkers,line.from),extraMarkers.length&&(localMarkers=localMarkers.concat(extraMarkers));let forLine=this.gutter.config.lineMarker(view,line,localMarkers);forLine&&localMarkers.unshift(forLine);let gutter=this.gutter;(0!=localMarkers.length||gutter.config.renderEmptyElements)&&this.addElement(view,line,localMarkers)}widget(view,block){let marker=this.gutter.config.widgetMarker(view,block.widget,block),markers=marker?[marker]:null;for(let cls of view.state.facet(gutterWidgetClass)){let marker=cls(view,block.widget,block);marker&&(markers||(markers=[])).push(marker)}markers&&this.addElement(view,block,markers)}finish(){let gutter=this.gutter;for(;gutter.elements.length>this.i;){let last=gutter.elements.pop();gutter.dom.removeChild(last.dom),last.destroy()}}}class SingleGutterView{constructor(view,config){this.view=view,this.config=config,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let prop in config.domEventHandlers)this.dom.addEventListener(prop,(event=>{let y,target=event.target;if(target!=this.dom&&this.dom.contains(target)){for(;target.parentNode!=this.dom;)target=target.parentNode;let rect=target.getBoundingClientRect();y=(rect.top+rect.bottom)/2}else y=event.clientY;let line=view.lineBlockAtHeight(y-view.documentTop);config.domEventHandlers[prop](view,line,event)&&event.preventDefault()}));this.markers=asArray(config.markers(view)),config.initialSpacer&&(this.spacer=new GutterElement(view,0,0,[config.initialSpacer(view)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(update){let prevMarkers=this.markers;if(this.markers=asArray(this.config.markers(update.view)),this.spacer&&this.config.updateSpacer){let updated=this.config.updateSpacer(this.spacer.markers[0],update);updated!=this.spacer.markers[0]&&this.spacer.update(update.view,0,0,[updated])}let vp=update.view.viewport;return!state_dist.om.eq(this.markers,prevMarkers,vp.from,vp.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(update)}destroy(){for(let elt of this.elements)elt.destroy()}}class GutterElement{constructor(view,height,above,markers){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(view,height,above,markers)}update(view,height,above,markers){this.height!=height&&(this.height=height,this.dom.style.height=height+"px"),this.above!=above&&(this.dom.style.marginTop=(this.above=above)?above+"px":""),function sameMarkers(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].compare(b[i]))return!1;return!0}(this.markers,markers)||this.setMarkers(view,markers)}setMarkers(view,markers){let cls="cm-gutterElement",domPos=this.dom.firstChild;for(let iNew=0,iOld=0;;){let skipTo=iOld,marker=iNew<markers.length?markers[iNew++]:null,matched=!1;if(marker){let c=marker.elementClass;c&&(cls+=" "+c);for(let i=iOld;i<this.markers.length;i++)if(this.markers[i].compare(marker)){skipTo=i,matched=!0;break}}else skipTo=this.markers.length;for(;iOld<skipTo;){let next=this.markers[iOld++];if(next.toDOM){next.destroy(domPos);let after=domPos.nextSibling;domPos.remove(),domPos=after}}if(!marker)break;marker.toDOM&&(matched?domPos=domPos.nextSibling:this.dom.insertBefore(marker.toDOM(view),domPos)),matched&&iOld++}this.dom.className=cls,this.markers=markers}destroy(){this.setMarkers(null,[])}}const lineNumberMarkers=state_dist.sj.define(),lineNumberWidgetMarker=state_dist.sj.define(),lineNumberConfig=state_dist.sj.define({combine:values=>(0,state_dist.QR)(values,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(a,b){let result=Object.assign({},a);for(let event in b){let exists=result[event],add=b[event];result[event]=exists?(view,line,event)=>exists(view,line,event)||add(view,line,event):add}return result}})});class NumberMarker extends GutterMarker{constructor(number){super(),this.number=number}eq(other){return this.number==other.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(view,number){return view.state.facet(lineNumberConfig).formatNumber(number,view.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],(state=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:view=>view.state.facet(lineNumberMarkers),lineMarker:(view,line,others)=>others.some((m=>m.toDOM))?null:new NumberMarker(formatNumber(view,view.state.doc.lineAt(line.from).number)),widgetMarker:(view,widget,block)=>{for(let m of view.state.facet(lineNumberWidgetMarker)){let result=m(view,widget,block);if(result)return result}return null},lineMarkerChange:update=>update.startState.facet(lineNumberConfig)!=update.state.facet(lineNumberConfig),initialSpacer:view=>new NumberMarker(formatNumber(view,maxLineNumber(view.state.doc.lines))),updateSpacer(spacer,update){let max=formatNumber(update.view,maxLineNumber(update.view.state.doc.lines));return max==spacer.number?spacer:new NumberMarker(max)},domEventHandlers:state.facet(lineNumberConfig).domEventHandlers})));function lineNumbers(config={}){return[lineNumberConfig.of(config),gutters(),lineNumberGutter]}function maxLineNumber(lines){let last=9;for(;last<lines;)last=10*last+9;return last}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],(state=>{let marks=[],last=-1;for(let range of state.selection.ranges){let linePos=state.doc.lineAt(range.head).from;linePos>last&&(last=linePos,marks.push(activeLineGutterMarker.range(linePos)))}return state_dist.om.of(marks)}));function highlightActiveLineGutter(){return activeLineGutterHighlighter}},"./node_modules/@lexical/clipboard/LexicalClipboard.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bi:()=>E,lW:()=>R});var LexicalSelection_prod=__webpack_require__("./node_modules/@lexical/selection/LexicalSelection.prod.mjs"),Lexical_prod=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs");function s(l,i,c,u=null){let a=null===u||i.isSelected(u);const d=(0,Lexical_prod.ff)(i)&&i.excludeFromCopy("html");let f=i;if(null!==u){let t=(0,LexicalSelection_prod.BE)(i);t=(0,Lexical_prod.kF)(t)&&null!==u?(0,LexicalSelection_prod.SD)(u,t):t,f=t}const p=(0,Lexical_prod.ff)(f)?f.getChildren():[],m=l._nodes.get(f.getType());let h;h=m&&void 0!==m.exportDOM?m.exportDOM(l,f):f.exportDOM(l);const{element:g,after:y}=h;if(!g)return!1;const w=document.createDocumentFragment();for(let e=0;e<p.length;e++){const n=p[e],t=s(l,n,w,u);!a&&(0,Lexical_prod.ff)(i)&&t&&i.extractWithChild(n,u,"html")&&(a=!0)}if(a&&!d){if((0,Lexical_prod.sb)(g)&&g.append(w),c.append(g),y){const e=y.call(f,g);e&&g.replaceWith(e)}}else c.append(w);return a}const u=new Set(["STYLE","SCRIPT"]);function a(e,n,t=new Map,l){let r=[];if(u.has(e.nodeName))return r;let i=null;const c=function(e,n){const{nodeName:t}=e,l=n._htmlConversions.get(t.toLowerCase());let o=null;if(void 0!==l)for(const n of l){const t=n(e);null!==t&&(null===o||(o.priority||0)<(t.priority||0))&&(o=t)}return null!==o?o.conversion:null}(e,n),s=c?c(e):null;let d=null;if(null!==s){d=s.after;const n=s.node;if(i=Array.isArray(n)?n[n.length-1]:n,null!==i){for(const[,e]of t)if(i=e(i,l),!i)break;i&&r.push(...Array.isArray(n)?n:[i])}null!=s.forChild&&t.set(e.nodeName,s.forChild)}const f=e.childNodes;let p=[];for(let e=0;e<f.length;e++)p.push(...a(f[e],n,new Map(t),i));return null!=d&&(p=d(p)),null==i?r=r.concat(p):(0,Lexical_prod.ff)(i)&&i.append(...p),r}var LexicalUtils_prod=__webpack_require__("./node_modules/@lexical/utils/LexicalUtils.prod.mjs"),g=function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};const w="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,y=e=>w?(e||window).getSelection():null;function v(t){const n=(0,Lexical_prod.vJ)();if(null==n)throw Error("Expected valid LexicalSelection");return(0,Lexical_prod.I2)(n)&&n.isCollapsed()||0===n.getNodes().length?"":function c(e,n){if("undefined"==typeof document||"undefined"==typeof window&&void 0===__webpack_require__.g.window)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),o=(0,Lexical_prod.Ni)().getChildren();for(let l=0;l<o.length;l++)s(e,o[l],t,n);return t.innerHTML}(t,n)}function D(e){const t=(0,Lexical_prod.vJ)();if(null==t)throw Error("Expected valid LexicalSelection");return(0,Lexical_prod.I2)(t)&&t.isCollapsed()||0===t.getNodes().length?null:JSON.stringify(function T(e,t){const n=[],o=(0,Lexical_prod.Ni)().getChildren();for(let l=0;l<o.length;l++)S(e,t,o[l],n);return{namespace:e._config.namespace,nodes:n}}(e,t))}function E(e,n,o){const l=e.getData("application/x-lexical-editor");if(l)try{const e=JSON.parse(l);if(e.namespace===o._config.namespace&&Array.isArray(e.nodes))return N(o,function _(e){const t=[];for(let o=0;o<e.length;o++){const l=e[o],r=(0,Lexical_prod.GM)(l);(0,Lexical_prod.kF)(r)&&(0,LexicalSelection_prod.Xg)(r),t.push(r)}return t}(e.nodes),n)}catch(e){}const r=e.getData("text/html");if(r)try{return N(o,function LexicalHtml_prod_i(e,n){const t=n.body?n.body.childNodes:[];let l=[];for(let n=0;n<t.length;n++){const o=t[n];if(!u.has(o.nodeName)){const n=a(o,e);null!==n&&(l=l.concat(n))}}return l}(o,(new DOMParser).parseFromString(r,"text/html")),n)}catch(e){}const i=e.getData("text/plain")||e.getData("text/uri-list");if(null!=i)if((0,Lexical_prod.I2)(n)){const e=i.split(/(\r?\n|\t)/);""===e[e.length-1]&&e.pop();for(let t=0;t<e.length;t++){const o=e[t];"\n"===o||"\r\n"===o?n.insertParagraph():"\t"===o?n.insertNodes([(0,Lexical_prod.ev)()]):n.insertText(o)}}else n.insertRawText(i)}function N(e,t,n){e.dispatchCommand(Lexical_prod.oq,{nodes:t,selection:n})||n.insertNodes(t)}function S(e,t,n,r=[]){let i=null===t||n.isSelected(t);const a=(0,Lexical_prod.ff)(n)&&n.excludeFromCopy("html");let c=n;if(null!==t){let e=(0,LexicalSelection_prod.BE)(n);e=(0,Lexical_prod.kF)(e)&&null!==t?(0,LexicalSelection_prod.SD)(t,e):e,c=e}const s=(0,Lexical_prod.ff)(c)?c.getChildren():[],u=function(e){const t=e.exportJSON(),n=e.constructor;if(t.type!==n.getType()&&g(58,n.name),(0,Lexical_prod.ff)(e)){const e=t.children;Array.isArray(e)||g(59,n.name)}return t}(c);if((0,Lexical_prod.kF)(c)){const e=c.__text;e.length>0?u.text=e:i=!1}for(let o=0;o<s.length;o++){const l=s[o],r=S(e,t,l,u.children);!i&&(0,Lexical_prod.ff)(n)&&r&&n.extractWithChild(l,t,"clone")&&(i=!0)}if(i&&!a)r.push(u);else if(Array.isArray(u.children))for(let e=0;e<u.children.length;e++){const t=u.children[e];r.push(t)}return i}let A=null;async function R(e,t){if(null!==A)return!1;if(null!==t)return new Promise(((n,o)=>{e.update((()=>{n(P(e,t))}))}));const n=e.getRootElement(),o=null==e._window?window.document:e._window.document,l=y(e._window);if(null===n||null===l)return!1;const i=o.createElement("span");i.style.cssText="position: fixed; top: -1000px;",i.append(o.createTextNode("#")),n.append(i);const a=new Range;return a.setStart(i,0),a.setEnd(i,1),l.removeAllRanges(),l.addRange(a),new Promise(((t,n)=>{const l=e.registerCommand(Lexical_prod.u5,(n=>((0,LexicalUtils_prod.xj)(n,ClipboardEvent)&&(l(),null!==A&&(window.clearTimeout(A),A=null),t(P(e,n))),!0)),Lexical_prod.d);A=window.setTimeout((()=>{l(),A=null,t(!1)}),50),o.execCommand("copy"),i.remove()}))}function P(e,t){const n=y(e._window);if(!n)return!1;const o=n.anchorNode,l=n.focusNode;if(null!==o&&null!==l&&!(0,Lexical_prod.LY)(e,o,l))return!1;t.preventDefault();const r=t.clipboardData,a=(0,Lexical_prod.vJ)();if(null===r||null===a)return!1;const c=v(e),s=D(e);let u="";return null!==a&&(u=a.getTextContent()),null!==c&&r.setData("text/html",c),null!==s&&r.setData("application/x-lexical-editor",s),r.setData("text/plain",u),!0}},"./node_modules/@lexical/dragon/LexicalDragon.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>o});var lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs");function o(o){const i=window.location.origin,a=a=>{if(a.origin!==i)return;const r=o.getRootElement();if(document.activeElement!==r)return;const s=a.data;if("string"==typeof s){let i;try{i=JSON.parse(s)}catch(e){return}if(i&&"nuanria_messaging"===i.protocol&&"request"===i.type){const r=i.payload;if(r&&"makeChanges"===r.functionId){const i=r.args;if(i){const[r,s,c,g,d,f]=i;o.update((()=>{const o=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.vJ)();if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(o)){const e=o.anchor;let t=e.getNode(),i=0,f=0;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(t)&&r>=0&&s>=0&&(i=r,f=r+s,o.setTextNodeRange(t,i,t,f)),i===f&&""===c||(o.insertRawText(c),t=e.getNode()),(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(t)){i=g,f=g+d;const e=t.getTextContentSize();i=i>e?e:i,f=f>e?e:f,o.setTextNodeRange(t,i,t,f)}a.stopImmediatePropagation()}}))}}}}};return window.addEventListener("message",a,!0),()=>{window.removeEventListener("message",a,!0)}}},"./node_modules/@lexical/link/LexicalLink.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Db:()=>_,FJ:()=>c,Hx:()=>m,yW:()=>d,zA:()=>g});var _lexical_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@lexical/utils/LexicalUtils.prod.mjs"),lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs");const o=new Set(["http:","https:","mailto:","sms:","tel:"]);class _ extends lexical__WEBPACK_IMPORTED_MODULE_0__.fG{static getType(){return"link"}static clone(t){return new _(t.__url,{rel:t.__rel,target:t.__target,title:t.__title},t.__key)}constructor(t,e={},r){super(r);const{target:i=null,rel:n=null,title:l=null}=e;this.__url=t,this.__target=i,this.__rel=n,this.__title=l}createDOM(e){const r=document.createElement("a");return r.href=this.sanitizeUrl(this.__url),null!==this.__target&&(r.target=this.__target),null!==this.__rel&&(r.rel=this.__rel),null!==this.__title&&(r.title=this.__title),(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_1__.ZB)(r,e.theme.link),r}updateDOM(t,e,r){const i=this.__url,n=this.__target,l=this.__rel,s=this.__title;return i!==t.__url&&(e.href=i),n!==t.__target&&(n?e.target=n:e.removeAttribute("target")),l!==t.__rel&&(l?e.rel=l:e.removeAttribute("rel")),s!==t.__title&&(s?e.title=s:e.removeAttribute("title")),!1}static importDOM(){return{a:t=>({conversion:a,priority:1})}}static importJSON(t){const e=g(t.url,{rel:t.rel,target:t.target,title:t.title});return e.setFormat(t.format),e.setIndent(t.indent),e.setDirection(t.direction),e}sanitizeUrl(t){try{const e=new URL(t);if(!o.has(e.protocol))return"about:blank"}catch(e){return t}return t}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),type:"link",url:this.getURL(),version:1}}getURL(){return this.getLatest().__url}setURL(t){this.getWritable().__url=t}getTarget(){return this.getLatest().__target}setTarget(t){this.getWritable().__target=t}getRel(){return this.getLatest().__rel}setRel(t){this.getWritable().__rel=t}getTitle(){return this.getLatest().__title}setTitle(t){this.getWritable().__title=t}insertNewAfter(t,e=!0){const r=g(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,e),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(t,e,r){if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(e))return!1;const i=e.anchor.getNode(),n=e.focus.getNode();return this.isParentOf(i)&&this.isParentOf(n)&&e.getTextContent().length>0}}function a(t){let r=null;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.nY)(t)){const e=t.textContent;(null!==e&&""!==e||t.children.length>0)&&(r=g(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}))}return{node:r}}function g(t,e){return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.pT)(new _(t,e))}function c(t){return t instanceof _}const d=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.gu)("TOGGLE_LINK_COMMAND");function m(t,e={}){const{target:r,title:i}=e,n=void 0===e.rel?"noreferrer":e.rel,o=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.vJ)();if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(o))return;const _=o.extract();if(null===t)_.forEach((t=>{const e=t.getParent();if(c(e)){const t=e.getChildren();for(let r=0;r<t.length;r++)e.insertBefore(t[r]);e.remove()}}));else{if(1===_.length){const e=function(t,e){let r=t;for(;null!==r&&null!==r.getParent()&&!e(r);)r=r.getParentOrThrow();return e(r)?r:null}(_[0],c);if(null!==e)return e.setURL(t),void 0!==r&&e.setTarget(r),null!==n&&e.setRel(n),void(void 0!==i&&e.setTitle(i))}let e=null,l=null;_.forEach((u=>{const o=u.getParent();if(o!==l&&null!==o&&(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(u)||u.isInline())){if(c(o))return l=o,o.setURL(t),void 0!==r&&o.setTarget(r),null!==n&&l.setRel(n),void(void 0!==i&&l.setTitle(i));if(o.is(e)||(e=o,l=g(t,{rel:n,target:r,title:i}),c(o)?null===u.getPreviousSibling()?o.insertBefore(l):o.insertAfter(l):u.insertBefore(l)),c(u)){if(u.is(l))return;if(null!==l){const t=u.getChildren();for(let e=0;e<t.length;e++)l.append(t[e])}u.remove()}else null!==l&&l.append(u)}}))}}},"./node_modules/@lexical/list/LexicalList.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DE:()=>J,HY:()=>z,Mz:()=>I,YW:()=>E,g2:()=>_,i:()=>D,q7:()=>U,tK:()=>N,uS:()=>H,us:()=>k,v5:()=>R,x:()=>$,yX:()=>O});var lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),_lexical_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@lexical/utils/LexicalUtils.prod.mjs"),p=function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};function _(e){let t=1,n=e.getParent();for(;null!=n;){if(I(n)){const e=n.getParent();if(z(e)){t++,n=e.getParent();continue}p(40)}return t}return t}function m(e){let t=e.getParent();z(t)||p(40);let n=t;for(;null!==n;)n=n.getParent(),z(n)&&(t=n);return t}function v(e){let t=[];const n=e.getChildren().filter(I);for(let e=0;e<n.length;e++){const r=n[e],i=r.getFirstChild();z(i)?t=t.concat(v(i)):t.push(r)}return t}function y(e){return I(e)&&z(e.getFirstChild())}function C(e){return D().append(e)}function T(e,t){return I(e)&&(0===t.length||1===t.length&&e.is(t[0])&&0===e.getChildrenSize())}function k(s,o){s.update((()=>{const s=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.vJ)();if(null!==s){const e=s.getNodes();if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(s)){const t=s.getStartEndPoints();null===t&&p(143);const[i]=t,c=i.getNode(),l=c.getParent();if(T(c,e)){const e=J(o);if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.Iq)(l)){c.replace(e);const t=D();(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(c)&&(t.setFormat(c.getFormatType()),t.setIndent(c.getIndent())),e.append(t)}else if(I(c)){const t=c.getParentOrThrow();S(e,t.getChildren()),t.replace(e)}return}}const c=new Set;for(let t=0;t<e.length;t++){const s=e[t];if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(s)||!s.isEmpty()||I(s)||c.has(s.getKey())){if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.jG)(s)){let e=s.getParent();for(;null!=e;){const t=e.getKey();if(z(e)){if(!c.has(t)){const n=J(o);S(n,e.getChildren()),e.replace(n),c.add(t)}break}{const r=e.getParent();if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.Iq)(r)&&!c.has(t)){c.add(t),b(e,o);break}e=r}}}}else b(s,o)}}}))}function S(e,t){e.splice(e.getChildrenSize(),0,t)}function b(e,t){if(z(e))return e;const n=e.getPreviousSibling(),r=e.getNextSibling(),i=D();if(i.setFormat(e.getFormatType()),i.setIndent(e.getIndent()),S(i,e.getChildren()),z(n)&&t===n.getListType())return n.append(i),e.remove(),z(r)&&t===r.getListType()&&(S(n,r.getChildren()),r.remove()),n;if(z(r)&&t===r.getListType())return r.getFirstChildOrThrow().insertBefore(i),e.remove(),r;{const n=J(t);return n.append(i),e.replace(n),n}}function P(e,t){const n=e.getLastChild(),r=t.getFirstChild();n&&r&&y(n)&&y(r)&&(P(n.getFirstChild(),r.getFirstChild()),r.remove());const i=t.getChildren();i.length>0&&e.append(...i),t.remove()}function N(n){n.update((()=>{const n=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.vJ)();if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(n)){const e=new Set,t=n.getNodes(),r=n.anchor.getNode();if(T(r,t))e.add(m(r));else for(let n=0;n<t.length;n++){const r=t[n];if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.jG)(r)){const t=(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_1__.eu)(r,E);null!=t&&e.add(m(t))}}for(const t of e){let e=t;const r=v(t);for(const t of r){const r=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.lJ)();S(r,t.getChildren()),e.insertAfter(r),e=r,t.__key===n.anchor.key&&n.anchor.set(r.getKey(),0,"element"),t.__key===n.focus.key&&n.focus.set(r.getKey(),0,"element"),t.remove()}t.remove()}}}))}function x(e){const t=new Set;if(y(e)||t.has(e.getKey()))return;const n=e.getParent(),r=e.getNextSibling(),i=e.getPreviousSibling();if(y(r)&&y(i)){const n=i.getFirstChild();if(z(n)){n.append(e);const i=r.getFirstChild();z(i)&&(S(n,i.getChildren()),r.remove(),t.add(r.getKey()))}}else if(y(r)){const t=r.getFirstChild();if(z(t)){const n=t.getFirstChild();null!==n&&n.insertBefore(e)}}else if(y(i)){const t=i.getFirstChild();z(t)&&t.append(e)}else if(z(n)){const t=D(),s=J(n.getListType());t.append(s),s.append(e),i?i.insertAfter(t):r?r.insertBefore(t):n.append(t)}}function A(e){if(y(e))return;const t=e.getParent(),n=t?t.getParent():void 0;if(z(n?n.getParent():void 0)&&I(n)&&z(t)){const r=t?t.getFirstChild():void 0,i=t?t.getLastChild():void 0;if(e.is(r))n.insertBefore(e),t.isEmpty()&&n.remove();else if(e.is(i))n.insertAfter(e),t.isEmpty()&&n.remove();else{const r=t.getListType(),i=D(),s=J(r);i.append(s),e.getPreviousSiblings().forEach((e=>s.append(e)));const o=D(),c=J(r);o.append(c),S(c,e.getNextSiblings()),n.insertBefore(i),n.insertAfter(o),n.replace(e)}}}function O(){const r=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.vJ)();if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(r)||!r.isCollapsed())return!1;const i=r.anchor.getNode();if(!I(i)||0!==i.getChildrenSize())return!1;const c=m(i),l=i.getParent();z(l)||p(40);const h=l.getParent();let a;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.Iq)(h))a=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.lJ)(),c.insertAfter(a);else{if(!I(h))return!1;a=D(),h.insertAfter(a)}a.select();const u=i.getNextSiblings();if(u.length>0){const e=J(l.getListType());if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.bS)(a))a.insertAfter(e);else{const t=D();t.append(e),a.insertAfter(t)}u.forEach((t=>{t.remove(),e.append(t)}))}return function(e){let t=e;for(;null==t.getNextSibling()&&null==t.getPreviousSibling();){const e=t.getParent();if(null==e||!I(t)&&!z(t))break;t=e}t.remove()}(i),!0}function L(...e){const t=[];for(const n of e)if(n&&"string"==typeof n)for(const[e]of n.matchAll(/\S+/g))t.push(e);return t}class E extends lexical__WEBPACK_IMPORTED_MODULE_0__.fG{static getType(){return"listitem"}static clone(e){return new E(e.__value,e.__checked,e.__key)}constructor(e,t,n){super(n),this.__value=void 0===e?1:e,this.__checked=t}createDOM(e){const t=document.createElement("li"),n=this.getParent();return z(n)&&"check"===n.getListType()&&w(t,this,null),t.value=this.__value,F(t,e.theme,this),t}updateDOM(e,t,n){const r=this.getParent();return z(r)&&"check"===r.getListType()&&w(t,this,e),t.value=this.__value,F(t,n.theme,this),!1}static transform(){return e=>{if(I(e)||p(144),null==e.__checked)return;const t=e.getParent();z(t)&&"check"!==t.getListType()&&null!=e.getChecked()&&e.setChecked(void 0)}}static importDOM(){return{li:e=>({conversion:M,priority:0})}}static importJSON(e){const t=D();return t.setChecked(e.checked),t.setValue(e.value),t.setFormat(e.format),t.setDirection(e.direction),t}exportDOM(e){const t=this.createDOM(e._config);return t.style.textAlign=this.getFormatType(),{element:t}}exportJSON(){return{...super.exportJSON(),checked:this.getChecked(),type:"listitem",value:this.getValue(),version:1}}append(...e){for(let t=0;t<e.length;t++){const n=e[t];if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(n)&&this.canMergeWith(n)){const e=n.getChildren();this.append(...e),n.remove()}else super.append(n)}return this}replace(e,t){if(I(e))return super.replace(e);this.setIndent(0);const n=this.getParentOrThrow();if(!z(n))return e;if(n.__first===this.getKey())n.insertBefore(e);else if(n.__last===this.getKey())n.insertAfter(e);else{const t=J(n.getListType());let r=this.getNextSibling();for(;r;){const e=r;r=r.getNextSibling(),t.append(e)}n.insertAfter(e),e.insertAfter(t)}return t&&((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(e)||p(139),this.getChildren().forEach((t=>{e.append(t)}))),this.remove(),0===n.getChildrenSize()&&n.remove(),e}insertAfter(e,t=!0){const n=this.getParentOrThrow();if(z(n)||p(39),I(e))return super.insertAfter(e,t);const r=this.getNextSiblings();if(n.insertAfter(e,t),0!==r.length){const i=J(n.getListType());r.forEach((e=>i.append(e))),e.insertAfter(i,t)}return e}remove(e){const t=this.getPreviousSibling(),n=this.getNextSibling();super.remove(e),t&&n&&y(t)&&y(n)&&(P(t.getFirstChild(),n.getFirstChild()),n.remove())}insertNewAfter(e,t=!0){const n=D(null==this.__checked&&void 0);return this.insertAfter(n,t),n}collapseAtStart(e){const t=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.lJ)();this.getChildren().forEach((e=>t.append(e)));const n=this.getParentOrThrow(),r=n.getParentOrThrow(),i=I(r);if(1===n.getChildrenSize())if(i)n.remove(),r.select();else{n.insertBefore(t),n.remove();const r=e.anchor,i=e.focus,s=t.getKey();"element"===r.type&&r.getNode().is(this)&&r.set(s,r.offset,"element"),"element"===i.type&&i.getNode().is(this)&&i.set(s,i.offset,"element")}else n.insertBefore(t),this.remove();return!0}getValue(){return this.getLatest().__value}setValue(e){this.getWritable().__value=e}getChecked(){return this.getLatest().__checked}setChecked(e){this.getWritable().__checked=e}toggleChecked(){this.setChecked(!this.__checked)}getIndent(){const e=this.getParent();if(null===e)return this.getLatest().__indent;let t=e.getParentOrThrow(),n=0;for(;I(t);)t=t.getParentOrThrow().getParentOrThrow(),n++;return n}setIndent(e){"number"==typeof e&&e>-1||p(117);let t=this.getIndent();for(;t!==e;)t<e?(x(this),t++):(A(this),t--);return this}canInsertAfter(e){return I(e)}canReplaceWith(e){return I(e)}canMergeWith(e){return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.bS)(e)||I(e)}extractWithChild(e,n){if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(n))return!1;const r=n.anchor.getNode(),i=n.focus.getNode();return this.isParentOf(r)&&this.isParentOf(i)&&this.getTextContent().length===n.getTextContent().length}isParentRequired(){return!0}createParentElementNode(){return J("bullet")}}function F(e,t,n){const r=[],i=[],s=t.list,o=s?s.listitem:void 0;let c;if(s&&s.nested&&(c=s.nested.listitem),void 0!==o&&r.push(...L(o)),s){const e=n.getParent(),t=z(e)&&"check"===e.getListType(),o=n.getChecked();t&&!o||i.push(s.listitemUnchecked),t&&o||i.push(s.listitemChecked),t&&r.push(o?s.listitemChecked:s.listitemUnchecked)}if(void 0!==c){const e=L(c);n.getChildren().some((e=>z(e)))?r.push(...e):i.push(...e)}i.length>0&&(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_1__.HE)(e,...i),r.length>0&&(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_1__.ZB)(e,...r)}function w(e,t,n,r){z(t.getFirstChild())?(e.removeAttribute("role"),e.removeAttribute("tabIndex"),e.removeAttribute("aria-checked")):(e.setAttribute("role","checkbox"),e.setAttribute("tabIndex","-1"),n&&t.__checked===n.__checked||e.setAttribute("aria-checked",t.getChecked()?"true":"false"))}function M(e){return{node:D((0,lexical__WEBPACK_IMPORTED_MODULE_0__.sb)(e)&&"true"===e.getAttribute("aria-checked"))}}function D(e){return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.pT)(new E(void 0,e))}function I(e){return e instanceof E}class R extends lexical__WEBPACK_IMPORTED_MODULE_0__.fG{static getType(){return"list"}static clone(e){const t=e.__listType||V[e.__tag];return new R(t,e.__start,e.__key)}constructor(e,t,n){super(n);const r=V[e]||e;this.__listType=r,this.__tag="number"===r?"ol":"ul",this.__start=t}getTag(){return this.__tag}setListType(e){const t=this.getWritable();t.__listType=e,t.__tag="number"===e?"ol":"ul"}getListType(){return this.__listType}getStart(){return this.__start}createDOM(e,t){const n=this.__tag,r=document.createElement(n);return 1!==this.__start&&r.setAttribute("start",String(this.__start)),r.__lexicalListType=this.__listType,K(r,e.theme,this),r}updateDOM(e,t,n){return e.__tag!==this.__tag||(K(t,n.theme,this),!1)}static transform(){return e=>{if(!z(e))throw Error("node is not a ListNode");!function(e){const t=e.getNextSibling();z(t)&&e.getListType()===t.getListType()&&P(e,t)}(e),function(e){const t="check"!==e.getListType();let n=e.getStart();for(const r of e.getChildren())I(r)&&(r.getValue()!==n&&r.setValue(n),t&&null!=r.getChecked()&&r.setChecked(void 0),z(r.getFirstChild())||n++)}(e)}}static importDOM(){return{ol:e=>({conversion:W,priority:0}),ul:e=>({conversion:W,priority:0})}}static importJSON(e){const t=J(e.listType,e.start);return t.setFormat(e.format),t.setIndent(e.indent),t.setDirection(e.direction),t}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&(0,lexical__WEBPACK_IMPORTED_MODULE_0__.sb)(t)&&(1!==this.__start&&t.setAttribute("start",String(this.__start)),"check"===this.__listType&&t.setAttribute("__lexicalListType","check")),{element:t}}exportJSON(){return{...super.exportJSON(),listType:this.getListType(),start:this.getStart(),tag:this.getTag(),type:"list",version:1}}canBeEmpty(){return!1}canIndent(){return!1}append(...e){for(let t=0;t<e.length;t++){const n=e[t];if(I(n))super.append(n);else{const e=D();if(z(n))e.append(n);else if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(n)){const t=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.sT)(n.getTextContent());e.append(t)}else e.append(n);super.append(e)}}return this}extractWithChild(e){return I(e)}}function K(e,t,n){const r=[],i=[],s=t.list;if(void 0!==s){const e=s[`${n.__tag}Depth`]||[],t=_(n)-1,o=t%e.length,c=e[o],l=s[n.__tag];let h;const a=s.nested,u=s.checklist;if(void 0!==a&&a.list&&(h=a.list),void 0!==l&&r.push(l),void 0!==u&&"check"===n.__listType&&r.push(u),void 0!==c){r.push(...L(c));for(let t=0;t<e.length;t++)t!==o&&i.push(n.__tag+t)}if(void 0!==h){const e=L(h);t>1?r.push(...e):i.push(...e)}}i.length>0&&(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_1__.HE)(e,...i),r.length>0&&(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_1__.ZB)(e,...r)}function B(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];if(I(r)){t.push(r);const e=r.getChildren();e.length>1&&e.forEach((e=>{z(e)&&t.push(C(e))}))}else t.push(C(r))}return t}function W(e){const t=e.nodeName.toLowerCase();let n=null;return"ol"===t?n=J("number",e.start):"ul"===t&&(n=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.sb)(e)&&"check"===e.getAttribute("__lexicallisttype")?J("check"):J("bullet")),{after:B,node:n}}const V={ol:"number",ul:"bullet"};function J(e,t=1){return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.pT)(new R(e,t))}function z(e){return e instanceof R}const U=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.gu)("INSERT_UNORDERED_LIST_COMMAND"),$=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.gu)("INSERT_ORDERED_LIST_COMMAND"),H=((0,lexical__WEBPACK_IMPORTED_MODULE_0__.gu)("INSERT_CHECK_LIST_COMMAND"),(0,lexical__WEBPACK_IMPORTED_MODULE_0__.gu)("REMOVE_LIST_COMMAND"))},"./node_modules/@lexical/offset/LexicalOffset.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ln:()=>d});var lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),s=function(t){const e=new URLSearchParams;e.append("code",t);for(let t=1;t<arguments.length;t++)e.append("v",arguments[t]);throw Error(`Minified Lexical error #${t}; visit https://lexical.dev/docs/error?${e} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};class o{constructor(t,e,n=1){this._offsetMap=t,this._firstNode=e,this._blockOffsetSize=n}createSelectionFromOffsets(l,s,o){const f=this._firstNode;if(null===f)return null;let c=l,u=s,a=i(f,c,this._blockOffsetSize),d=i(f,u,this._blockOffsetSize);if(void 0!==o&&(c=r(c,a,o,this,this._blockOffsetSize),a=i(f,c,this._blockOffsetSize),u=r(u,d,o,this,this._blockOffsetSize),d=i(f,u,this._blockOffsetSize)),null===a||null===d)return null;let p=a.key,h=d.key;const g=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ns)(p),v=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ns)(h);if(null===g||null===v)return null;let _=0,k=0,y="element",x="element";if("text"===a.type){_=c-a.start,y="text";const t=g.getNextSibling();c!==u&&_===g.getTextContentSize()&&(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(t)&&(_=0,p=t.__key)}else"inline"===a.type&&(p=g.getParentOrThrow().getKey(),_=u>a.start?a.end:a.start);"text"===d.type?(k=u-d.start,x="text"):"inline"===d.type&&(h=v.getParentOrThrow().getKey(),k=u>d.start?d.end:d.start);const S=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.uT)();return null===S?null:(S.anchor.set(p,_,y),S.focus.set(h,k,x),S)}getOffsetsFromSelection(t){const e=t.anchor,n=t.focus,l=this._offsetMap,s=e.offset,o=n.offset;let r=-1,i=-1;if("text"===e.type){const t=l.get(e.key);void 0!==t&&(r=t.start+s)}else{const t=e.getNode().getDescendantByIndex(s);if(null!==t){const e=l.get(t.getKey());void 0!==e&&(r=t.getIndexWithinParent()!==s?e.end:e.start)}}if("text"===n.type){const t=l.get(n.key);void 0!==t&&(i=t.start+n.offset)}else{const t=n.getNode().getDescendantByIndex(o);if(null!==t){const e=l.get(t.getKey());void 0!==e&&(i=t.getIndexWithinParent()!==o?e.end:e.start)}}return[r,i]}}function r(t,e,n,l,s){const o=n._offsetMap,r=l._offsetMap,f=new Set;let c=t,u=e;for(;null!==u;){const t=u.key,e=o.get(t),n=u.end-u.start;if(f.add(t),void 0===e)c+=n;else{const t=e.end-e.start;t!==n&&(c+=n-t)}const l=u.prev;if(null!==l){u=l;continue}let s=u.parent;for(;null!==s;){let t=s.prev;if(null!==t){const e=t.key,n=o.get(e),l=t.end-t.start;if(f.add(e),void 0===n)c+=l;else{const t=n.end-n.start;t!==l&&(c+=l-t)}t=t.prev}s=s.parent}break}const a=n._firstNode;if(null!==a){u=i(a,t,s);let e=!1;for(;null!==u;){if(!f.has(u.key)){e=!0;break}u=u.parent}if(!e)for(;null!==u;){const t=u.key;if(!f.has(t)){const e=r.get(t),n=u.end-u.start;if(void 0===e)c-=n;else{const t=e.end-e.start;n!==t&&(c+=t-n)}}u=u.prev}}return c}function i(t,e,n){let l=t;for(;null!==l;){if(e<l.end+("element"!==l.type||0===n?1:0)){const t=l.child;if(null!==t){l=t;continue}return l}const t=l.next;if(null===t)break;l=t}return null}function f(t,e,n,l,s,o){return{child:t,end:l,key:s,next:null,parent:o,prev:null,start:n,type:e}}function c(t,n,o,r,i,c){const d=r.get(n);void 0===d&&s(3);const p=t.offset;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(d)){const e=a(d,r),l=0===e.length,s=l?null:u(t,e,null,r,i,c);t.prevIsBlock&&!l||(t.prevIsBlock=!0,t.offset+=c);const h=f(s,"element",p,p,n,o);null!==s&&(s.parent=h);const g=t.offset;return h.end=g,i.set(n,h),h}t.prevIsBlock=!1;const h=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(d),g=h?d.__text.length:1,v=f(null,h?"text":"inline",p,t.offset+=g,n,o);return i.set(n,v),v}function u(t,e,n,l,s,o){let r=null,i=null;const f=e.length;for(let u=0;u<f;u++){const f=c(t,e[u],n,l,s,o);null===i?r=f:(f.prev=i,i.next=f),i=f}return r}function a(e,n){const l=[];let o=e.__first;for(;null!==o;){const e=null===n?(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ns)(o):n.get(o);null==e&&s(101),l.push(o),o=e.__next}return l}function d(t,e=1,n){const l=(n||t._pendingEditorState||t._editorState)._nodeMap,s=l.get("root"),r=new Map,i=u({offset:0,prevIsBlock:!1},a(s,l),null,l,r,e);return new o(r,i,e)}},"./node_modules/@lexical/react/LexicalComposer.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>f});var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),lexical__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const d="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;var m=d?react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect:react__WEBPACK_IMPORTED_MODULE_0__.useEffect;const u={tag:"history-merge"};function f({initialConfig:l,children:c}){const f=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>{const{theme:t,namespace:a,editor__DEPRECATED:c,nodes:s,onError:m,editorState:f,html:p}=l,E=(0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__.Mx)(null,t);let v=c||null;if(null===v){const e=(0,lexical__WEBPACK_IMPORTED_MODULE_2__.ie)({editable:l.editable,html:p,namespace:a,nodes:s,onError:t=>m(t,e),theme:t});!function(e,t){if(null!==t)if(void 0===t)e.update((()=>{const t=(0,lexical__WEBPACK_IMPORTED_MODULE_2__.Ni)();if(t.isEmpty()){const o=(0,lexical__WEBPACK_IMPORTED_MODULE_2__.lJ)();t.append(o);const n=d?document.activeElement:null;(null!==(0,lexical__WEBPACK_IMPORTED_MODULE_2__.vJ)()||null!==n&&n===e.getRootElement())&&o.select()}}),u);else if(null!==t)switch(typeof t){case"string":{const o=e.parseEditorState(t);e.setEditorState(o,u);break}case"object":e.setEditorState(t,u);break;case"function":e.update((()=>{(0,lexical__WEBPACK_IMPORTED_MODULE_2__.Ni)().isEmpty()&&t(e)}),u)}}(e,f),v=e}return[v,E]}),[]);return m((()=>{const e=l.editable,[t]=f;t.setEditable(void 0===e||e)}),[]),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__.Gu.Provider,{value:f},c)}},"./node_modules/@lexical/react/LexicalComposerContext.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DF:()=>o,Gu:()=>l,Mx:()=>t});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),r=function(e){const n=new URLSearchParams;n.append("code",e);for(let e=1;e<arguments.length;e++)n.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${n} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};const l=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);function t(e,n){let r=null;return null!=e&&(r=e[1]),{getTheme:function(){return null!=n?n:null!=r?r.getTheme():null}}}function o(){const e=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(l);return null==e&&r(8),e}},"./node_modules/@lexical/react/LexicalHorizontalRuleNode.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Hd:()=>E,PL:()=>C,fS:()=>g,s0:()=>y});var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),_lexical_react_useLexicalNodeSelection__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@lexical/react/useLexicalNodeSelection.prod.mjs"),_lexical_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@lexical/utils/LexicalUtils.prod.mjs"),lexical__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const y=(0,lexical__WEBPACK_IMPORTED_MODULE_1__.gu)("INSERT_HORIZONTAL_RULE_COMMAND");function O({nodeKey:n}){const[o]=(0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__.DF)(),[i,f,y]=(0,_lexical_react_useLexicalNodeSelection__WEBPACK_IMPORTED_MODULE_3__.Y)(n),O=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((e=>{if(i&&(0,lexical__WEBPACK_IMPORTED_MODULE_1__.RT)((0,lexical__WEBPACK_IMPORTED_MODULE_1__.vJ)())){e.preventDefault();const t=(0,lexical__WEBPACK_IMPORTED_MODULE_1__.ns)(n);if(E(t))return t.remove(),!0}return!1}),[i,n]);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>(0,_lexical_utils__WEBPACK_IMPORTED_MODULE_4__.Sd)(o.registerCommand(lexical__WEBPACK_IMPORTED_MODULE_1__.d8,(e=>{const t=o.getElementByKey(n);return e.target===t&&(e.shiftKey||y(),f(!i),!0)}),lexical__WEBPACK_IMPORTED_MODULE_1__.Ac),o.registerCommand(lexical__WEBPACK_IMPORTED_MODULE_1__.w$,O,lexical__WEBPACK_IMPORTED_MODULE_1__.Ac),o.registerCommand(lexical__WEBPACK_IMPORTED_MODULE_1__.gC,O,lexical__WEBPACK_IMPORTED_MODULE_1__.Ac))),[y,o,i,n,O,f]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{const e=o.getElementByKey(n);null!==e&&(e.className=i?"selected":"")}),[o,i,n]),null}class g extends lexical__WEBPACK_IMPORTED_MODULE_1__.Kp{static getType(){return"horizontalrule"}static clone(e){return new g(e.__key)}static importJSON(e){return C()}static importDOM(){return{hr:()=>({conversion:h,priority:0})}}exportJSON(){return{type:"horizontalrule",version:1}}exportDOM(){return{element:document.createElement("hr")}}createDOM(){return document.createElement("hr")}getTextContent(){return"\n"}isInline(){return!1}updateDOM(){return!1}decorate(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(O,{nodeKey:this.__key})}}function h(){return{node:C()}}function C(){return(0,lexical__WEBPACK_IMPORTED_MODULE_1__.pT)(new g)}function E(e){return e instanceof g}},"./node_modules/@lexical/react/useLexicalEditable.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>a});var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),u="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect:react__WEBPACK_IMPORTED_MODULE_0__.useEffect;function c(e){return{initialValueFn:()=>e.isEditable(),subscribe:t=>e.registerEditableListener(t)}}function a(){return function(t){const[n]=(0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_1__.DF)(),c=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>t(n)),[n,t]),a=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(c.initialValueFn()),[l,s]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(a.current);return u((()=>{const{initialValueFn:e,subscribe:t}=c,n=e();return a.current!==n&&(a.current=n,s(n)),t((e=>{a.current=e,s(e)}))}),[c,t]),l}(c)}},"./node_modules/@lexical/react/useLexicalNodeSelection.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Y:()=>u});var _lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),lexical__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function d(e,r){return e.getEditorState().read((()=>{const e=(0,lexical__WEBPACK_IMPORTED_MODULE_1__.ns)(r);return null!==e&&e.isSelected()}))}function u(t){const[u]=(0,_lexical_react_LexicalComposerContext__WEBPACK_IMPORTED_MODULE_2__.DF)(),[p,s]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)((()=>d(u,t)));return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{let e=!0;const r=u.registerUpdateListener((()=>{e&&s(d(u,t))}));return()=>{e=!1,r()}}),[u,t]),[p,(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((e=>{u.update((()=>{let a=(0,lexical__WEBPACK_IMPORTED_MODULE_1__.vJ)();(0,lexical__WEBPACK_IMPORTED_MODULE_1__.RT)(a)||(a=(0,lexical__WEBPACK_IMPORTED_MODULE_1__.rU)(),(0,lexical__WEBPACK_IMPORTED_MODULE_1__.n1)(a)),(0,lexical__WEBPACK_IMPORTED_MODULE_1__.RT)(a)&&(e?a.add(t):a.delete(t))}))}),[u,t]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((()=>{u.update((()=>{const e=(0,lexical__WEBPACK_IMPORTED_MODULE_1__.vJ)();(0,lexical__WEBPACK_IMPORTED_MODULE_1__.RT)(e)&&e.clear()}))}),[u])]}},"./node_modules/@lexical/selection/LexicalSelection.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{BE:()=>v,Cb:()=>A,Nx:()=>w,Rk:()=>L,SD:()=>C,Xg:()=>F,cb:()=>x,eT:()=>P,zI:()=>b,zT:()=>S});var lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs");const m=new Map;function y(e){let t=e;for(;null!=t;){if(t.nodeType===Node.TEXT_NODE)return t;t=t.firstChild}return null}function T(e){const t=e.parentNode;if(null==t)throw new Error("Should never happen");return[t,Array.from(t.childNodes).indexOf(e)]}function x(t,n,o,l,r){const s=n.getKey(),i=l.getKey(),c=document.createRange();let f=t.getElementByKey(s),u=t.getElementByKey(i),g=o,a=r;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(n)&&(f=y(f)),(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(l)&&(u=y(u)),void 0===n||void 0===l||null===f||null===u)return null;"BR"===f.nodeName&&([f,g]=T(f)),"BR"===u.nodeName&&([u,a]=T(u));const d=f.firstChild;f===u&&null!=d&&"BR"===d.nodeName&&0===g&&0===a&&(a=1);try{c.setStart(f,g),c.setEnd(u,a)}catch(e){return null}return!c.collapsed||g===a&&s===i||(c.setStart(u,a),c.setEnd(f,g)),c}function S(e,t){const n=e.getRootElement();if(null===n)return[];const o=n.getBoundingClientRect(),l=getComputedStyle(n),r=parseFloat(l.paddingLeft)+parseFloat(l.paddingRight),s=Array.from(t.getClientRects());let i,c=s.length;s.sort(((e,t)=>{const n=e.top-t.top;return Math.abs(n)<=3?e.left-t.left:n}));for(let e=0;e<c;e++){const t=s[e],n=i&&i.top<=t.top&&i.top+i.height>t.top&&i.left+i.width>t.left,l=t.width+r===o.width;n||l?(s.splice(e--,1),c--):i=t}return s}function N(e){const t={},n=e.split(";");for(const e of n)if(""!==e){const[n,o]=e.split(/:([^]+)/);n&&o&&(t[n.trim()]=o.trim())}return t}function v(o){const l=o.constructor.clone(o);return l.__parent=o.__parent,l.__next=o.__next,l.__prev=o.__prev,(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(o)&&(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(l)?(s=o,(r=l).__first=s.__first,r.__last=s.__last,r.__size=s.__size,r.__format=s.__format,r.__indent=s.__indent,r.__dir=s.__dir,r):(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(o)&&(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(l)?function(e,t){return e.__format=t.__format,e.__style=t.__style,e.__mode=t.__mode,e.__detail=t.__detail,e}(l,o):(0,lexical__WEBPACK_IMPORTED_MODULE_0__.bS)(o)&&(0,lexical__WEBPACK_IMPORTED_MODULE_0__.bS)(l)?function(e,t){return e.__textFormat=t.__textFormat,e}(l,o):l;var r,s}function C(e,t){const n=e.getStartEndPoints();if(t.isSelected(e)&&!t.isSegmented()&&!t.isToken()&&null!==n){const[l,r]=n,s=e.isBackward(),i=l.getNode(),c=r.getNode(),f=t.is(i),u=t.is(c);if(f||u){const[n,l]=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Ck)(e),r=i.is(c),f=t.is(s?c:i),u=t.is(s?i:c);let g,a=0;return r?(a=n>l?l:n,g=n>l?n:l):f?(a=s?l:n,g=void 0):u&&(a=0,g=s?n:l),t.__text=t.__text.slice(a,g),t}}return t}function w(e){if("text"===e.type)return e.offset===e.getNode().getTextContentSize();const n=e.getNode();if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(n))throw Error("isAtNodeEnd: node must be a TextNode or ElementNode");return e.offset===n.getChildrenSize()}function P(n,o,f){let u=o.getNode(),g=f;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(u)){const e=u.getDescendantByIndex(o.offset);null!==e&&(u=e)}for(;g>0&&null!==u;){if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(u)){const e=u.getLastDescendant();null!==e&&(u=e)}let f=u.getPreviousSibling(),a=0;if(null===f){let e=u.getParentOrThrow(),t=e.getPreviousSibling();for(;null===t;){if(e=e.getParent(),null===e){f=null;break}t=e.getPreviousSibling()}null!==e&&(a=e.isInline()?0:2,f=t)}let d=u.getTextContent();""===d&&(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(u)&&!u.isInline()&&(d="\n\n");const p=d.length;if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(u)||g>=p){const e=u.getParent();u.remove(),null==e||0!==e.getChildrenSize()||(0,lexical__WEBPACK_IMPORTED_MODULE_0__.hV)(e)||e.remove(),g-=p+a,u=f}else{const t=u.getKey(),l=n.getEditorState().read((()=>{const n=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ns)(t);return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(n)&&n.isSimpleText()?n.getTextContent():null})),f=p-g,a=d.slice(0,f);if(null!==l&&l!==d){const e=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.S1)();let t=u;if(u.isSimpleText())u.setTextContent(l);else{const e=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.sT)(l);u.replace(e),t=e}if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(e)&&e.isCollapsed()){const n=e.anchor.offset;t.select(n,n)}}else if(u.isSimpleText()){const e=o.key===t;let n=o.offset;n<g&&(n=p);const l=e?n-g:0,r=e?n:f;if(e&&0===l){const[e]=u.splitText(l,r);e.remove()}else{const[,e]=u.splitText(l,r);e.remove()}}else{const e=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.sT)(a);u.replace(e)}g=0}}}function F(e){const t=e.getStyle(),n=N(t);m.set(t,n)}function b(e,n){if(null===e)return;const o=e.getStartEndPoints(),l=o?o[0]:null;if(null!==l&&"root"===l.key){const e=n(),t=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Ni)(),o=t.getFirstChild();return void(o?o.replace(e,!0):t.append(e))}const r=e.getNodes(),s=null!==l&&function(e,t){let n=e;for(;null!==n&&null!==n.getParent()&&!t(n);)n=n.getParentOrThrow();return t(n)?n:null}(l.getNode(),j);s&&-1===r.indexOf(s)&&r.push(s);for(let e=0;e<r.length;e++){const o=r[e];if(!j(o))continue;if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(o))throw Error("Expected block node to be an ElementNode");const l=n();l.setFormat(o.getFormatType()),l.setIndent(o.getIndent()),o.replace(l,!0)}}function A(e,n){const o=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.B$)(e.focus,n);return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Cy)(o)&&!o.isIsolated()||(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(o)&&!o.isInline()&&!o.canBeEmpty()}function L(e,t,n){const o=function D(e){const t=e.anchor.getNode();return"rtl"===((0,lexical__WEBPACK_IMPORTED_MODULE_0__.hV)(t)?t:t.getParentOrThrow()).getDirection()}(e);!function R(e,t,n,o){e.modify(t?"extend":"move",n,o)}(e,t,n?!o:o,"character")}function j(n){if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.Cy)(n))return!1;if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(n)||(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Iq)(n))return!1;const o=n.getFirstChild(),l=null===o||(0,lexical__WEBPACK_IMPORTED_MODULE_0__.wH)(o)||(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(o)||o.isInline();return!n.isInline()&&!1!==n.canBeEmpty()&&l}},"./node_modules/@lexical/text/LexicalText.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{yl:()=>g});var lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs");function u(t,e=!0){if(t)return!1;let n=function s(){return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Ni)().getTextContent()}();return e&&(n=n.trim()),""===n}function g(t){return()=>function c(o){if(!u(o,!1))return!1;const l=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Ni)().getChildren(),s=l.length;if(s>1)return!1;for(let t=0;t<s;t++){const o=l[t];if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.Cy)(o))return!1;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(o)){if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.bS)(o))return!1;if(0!==o.__indent)return!1;const e=o.getChildren(),n=e.length;for(let r=0;r<n;r++){const n=e[t];if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(n))return!1}}}return!0}(t)}},"./node_modules/@lexical/utils/LexicalUtils.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bt:()=>I,HE:()=>C,Pe:()=>k,Sd:()=>b,Xq:()=>U,ZB:()=>B,cj:()=>F,eu:()=>D,mB:()=>H,xj:()=>$});var _lexical_selection__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@lexical/selection/LexicalSelection.prod.mjs"),lexical__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),g=function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};const p="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,h=p&&"documentMode"in document?document.documentMode:null,N=(p&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),p&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),!(!p||!("InputEvent"in window)||h)&&new window.InputEvent("input"),p&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),p&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream,p&&/Android/.test(navigator.userAgent),p&&/^(?=.*Chrome).*/i.test(navigator.userAgent));p&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent);function A(...e){const t=[];for(const n of e)if(n&&"string"==typeof n)for(const[e]of n.matchAll(/\S+/g))t.push(e);return t}function b(...e){return()=>{e.forEach((e=>e()))}}function B(e,...t){const n=A(...t);n.length>0&&e.classList.add(...n)}function C(e,...t){const n=A(...t);n.length>0&&e.classList.remove(...n)}function D(e,t){let n=e;for(;null!=n;){if(n instanceof t)return n;n=n.getParent()}return null}function H(e){const t=I(e,(e=>(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(e)&&!e.isInline()));return(0,lexical__WEBPACK_IMPORTED_MODULE_0__.ff)(t)||g(4,e.__key),t}const I=(e,t)=>{let n=e;for(;n!==(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Ni)()&&null!=n;){if(t(n))return n;n=n.getParent()}return null};function U(e,n){const o=new Map,r=e._pendingEditorState;for(const[e,r]of n._nodeMap){const n=(0,_lexical_selection__WEBPACK_IMPORTED_MODULE_1__.BE)(r);if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(n)){if(!(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(r))throw Error("Expected node be a TextNode");n.__text=r.__text}o.set(e,n)}r&&(r._nodeMap=o),e._dirtyType=2;const l=n._selection;(0,lexical__WEBPACK_IMPORTED_MODULE_0__.n1)(null===l?null:l.clone())}function k(e){const t=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.vJ)()||(0,lexical__WEBPACK_IMPORTED_MODULE_0__.S1)();if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.I2)(t)){const{focus:n}=t,o=n.getNode(),r=n.offset;if((0,lexical__WEBPACK_IMPORTED_MODULE_0__.Iq)(o)){const t=o.getChildAtIndex(r);null==t?o.append(e):t.insertBefore(e),e.selectNext()}else{let t,n;(0,lexical__WEBPACK_IMPORTED_MODULE_0__.kF)(o)?(t=o.getParentOrThrow(),n=o.getIndexWithinParent(),r>0&&(n+=1,o.splitText(r))):(t=o,n=r);const[,l]=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.hc)(t,n);l.insertBefore(e),l.selectStart()}}else{if(null!=t){const n=t.getNodes();n[n.length-1].getTopLevelElementOrThrow().insertAfter(e)}else(0,lexical__WEBPACK_IMPORTED_MODULE_0__.Ni)().append(e);const n=(0,lexical__WEBPACK_IMPORTED_MODULE_0__.lJ)();e.insertAfter(n),n.select()}return e.getLatest()}function F(e,t){const n=t();return e.replace(n),n.append(e),n}function $(e,t){return null!==e&&Object.getPrototypeOf(e).constructor.name===t.name}},"./node_modules/@lezer/common/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$g:()=>parseMixed,PH:()=>Tree,Qj:()=>IterMode,RY:()=>NodeWeakMap,Z6:()=>NodeType,cF:()=>DefaultBufferLength,fI:()=>NodeSet,iX:()=>Parser,rr:()=>TreeFragment,uY:()=>NodeProp});const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(from,to){this.from=from,this.to=to}}class NodeProp{constructor(config={}){this.id=nextPropID++,this.perNode=!!config.perNode,this.deserialize=config.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(match){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof match&&(match=NodeType.match(match)),type=>{let result=match(type);return void 0===result?null:[this,result]}}}NodeProp.closedBy=new NodeProp({deserialize:str=>str.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:str=>str.split(" ")}),NodeProp.group=new NodeProp({deserialize:str=>str.split(" ")}),NodeProp.isolate=new NodeProp({deserialize:value=>{if(value&&"rtl"!=value&&"ltr"!=value&&"auto"!=value)throw new RangeError("Invalid value for isolate: "+value);return value||"auto"}}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});class MountedTree{constructor(tree,overlay,parser){this.tree=tree,this.overlay=overlay,this.parser=parser}static get(tree){return tree&&tree.props&&tree.props[NodeProp.mounted.id]}}const noProps=Object.create(null);class NodeType{constructor(name,props,id,flags=0){this.name=name,this.props=props,this.id=id,this.flags=flags}static define(spec){let props=spec.props&&spec.props.length?Object.create(null):noProps,flags=(spec.top?1:0)|(spec.skipped?2:0)|(spec.error?4:0)|(null==spec.name?8:0),type=new NodeType(spec.name||"",props,spec.id,flags);if(spec.props)for(let src of spec.props)if(Array.isArray(src)||(src=src(type)),src){if(src[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");props[src[0].id]=src[1]}return type}prop(prop){return this.props[prop.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(name){if("string"==typeof name){if(this.name==name)return!0;let group=this.prop(NodeProp.group);return!!group&&group.indexOf(name)>-1}return this.id==name}static match(map){let direct=Object.create(null);for(let prop in map)for(let name of prop.split(" "))direct[name]=map[prop];return node=>{for(let groups=node.prop(NodeProp.group),i=-1;i<(groups?groups.length:0);i++){let found=direct[i<0?node.name:groups[i]];if(found)return found}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(types){this.types=types;for(let i=0;i<types.length;i++)if(types[i].id!=i)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...props){let newTypes=[];for(let type of this.types){let newProps=null;for(let source of props){let add=source(type);add&&(newProps||(newProps=Object.assign({},type.props)),newProps[add[0].id]=add[1])}newTypes.push(newProps?new NodeType(type.name,newProps,type.id,type.flags):type)}return new NodeSet(newTypes)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;!function(IterMode){IterMode[IterMode.ExcludeBuffers=1]="ExcludeBuffers",IterMode[IterMode.IncludeAnonymous=2]="IncludeAnonymous",IterMode[IterMode.IgnoreMounts=4]="IgnoreMounts",IterMode[IterMode.IgnoreOverlays=8]="IgnoreOverlays"}(IterMode||(IterMode={}));class Tree{constructor(type,children,positions,length,props){if(this.type=type,this.children=children,this.positions=positions,this.length=length,this.props=null,props&&props.length){this.props=Object.create(null);for(let[prop,value]of props)this.props["number"==typeof prop?prop:prop.id]=value}}toString(){let mounted=MountedTree.get(this);if(mounted&&!mounted.overlay)return mounted.tree.toString();let children="";for(let ch of this.children){let str=ch.toString();str&&(children&&(children+=","),children+=str)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(children.length?"("+children+")":""):children}cursor(mode=0){return new TreeCursor(this.topNode,mode)}cursorAt(pos,side=0,mode=0){let scope=CachedNode.get(this)||this.topNode,cursor=new TreeCursor(scope);return cursor.moveTo(pos,side),CachedNode.set(this,cursor._tree),cursor}get topNode(){return new TreeNode(this,0,0,null)}resolve(pos,side=0){let node=resolveNode(CachedNode.get(this)||this.topNode,pos,side,!1);return CachedNode.set(this,node),node}resolveInner(pos,side=0){let node=resolveNode(CachedInnerNode.get(this)||this.topNode,pos,side,!0);return CachedInnerNode.set(this,node),node}resolveStack(pos,side=0){return function stackIterator(tree,pos,side){let inner=tree.resolveInner(pos,side),layers=null;for(let scan=inner instanceof TreeNode?inner:inner.context.parent;scan;scan=scan.parent)if(scan.index<0){let parent=scan.parent;(layers||(layers=[inner])).push(parent.resolve(pos,side)),scan=parent}else{let mount=MountedTree.get(scan.tree);if(mount&&mount.overlay&&mount.overlay[0].from<=pos&&mount.overlay[mount.overlay.length-1].to>=pos){let root=new TreeNode(mount.tree,mount.overlay[0].from+scan.from,-1,scan);(layers||(layers=[inner])).push(resolveNode(root,pos,side,!1))}}return layers?iterStack(layers):inner}(this,pos,side)}iterate(spec){let{enter,leave,from=0,to=this.length}=spec,mode=spec.mode||0,anon=(mode&IterMode.IncludeAnonymous)>0;for(let c=this.cursor(mode|IterMode.IncludeAnonymous);;){let entered=!1;if(c.from<=to&&c.to>=from&&(!anon&&c.type.isAnonymous||!1!==enter(c))){if(c.firstChild())continue;entered=!0}for(;entered&&leave&&(anon||!c.type.isAnonymous)&&leave(c),!c.nextSibling();){if(!c.parent())return;entered=!0}}}prop(prop){return prop.perNode?this.props?this.props[prop.id]:void 0:this.type.prop(prop)}get propValues(){let result=[];if(this.props)for(let id in this.props)result.push([+id,this.props[id]]);return result}balance(config={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,((children,positions,length)=>new Tree(this.type,children,positions,length,this.propValues)),config.makeTree||((children,positions,length)=>new Tree(NodeType.none,children,positions,length)))}static build(data){return function buildTree(data){var _a;let{buffer,nodeSet,maxBufferLength=DefaultBufferLength,reused=[],minRepeatType=nodeSet.types.length}=data,cursor=Array.isArray(buffer)?new FlatBufferCursor(buffer,buffer.length):buffer,types=nodeSet.types,contextHash=0,lookAhead=0;function takeNode(parentStart,minPos,children,positions,inRepeat,depth){let{id,start,end,size}=cursor,lookAheadAtStart=lookAhead,contextAtStart=contextHash;for(;size<0;){if(cursor.next(),-1==size){let node=reused[id];return children.push(node),void positions.push(start-parentStart)}if(-3==size)return void(contextHash=id);if(-4==size)return void(lookAhead=id);throw new RangeError(`Unrecognized record size: ${size}`)}let node,buffer,type=types[id],startPos=start-parentStart;if(end-start<=maxBufferLength&&(buffer=findBufferSize(cursor.pos-minPos,inRepeat))){let data=new Uint16Array(buffer.size-buffer.skip),endPos=cursor.pos-buffer.size,index=data.length;for(;cursor.pos>endPos;)index=copyToBuffer(buffer.start,data,index);node=new TreeBuffer(data,end-buffer.start,nodeSet),startPos=buffer.start-parentStart}else{let endPos=cursor.pos-size;cursor.next();let localChildren=[],localPositions=[],localInRepeat=id>=minRepeatType?id:-1,lastGroup=0,lastEnd=end;for(;cursor.pos>endPos;)localInRepeat>=0&&cursor.id==localInRepeat&&cursor.size>=0?(cursor.end<=lastEnd-maxBufferLength&&(makeRepeatLeaf(localChildren,localPositions,start,lastGroup,cursor.end,lastEnd,localInRepeat,lookAheadAtStart,contextAtStart),lastGroup=localChildren.length,lastEnd=cursor.end),cursor.next()):depth>2500?takeFlatNode(start,endPos,localChildren,localPositions):takeNode(start,endPos,localChildren,localPositions,localInRepeat,depth+1);if(localInRepeat>=0&&lastGroup>0&&lastGroup<localChildren.length&&makeRepeatLeaf(localChildren,localPositions,start,lastGroup,start,lastEnd,localInRepeat,lookAheadAtStart,contextAtStart),localChildren.reverse(),localPositions.reverse(),localInRepeat>-1&&lastGroup>0){let make=makeBalanced(type,contextAtStart);node=balanceRange(type,localChildren,localPositions,0,localChildren.length,0,end-start,make,make)}else node=makeTree(type,localChildren,localPositions,end-start,lookAheadAtStart-end,contextAtStart)}children.push(node),positions.push(startPos)}function takeFlatNode(parentStart,minPos,children,positions){let nodes=[],nodeCount=0,stopAt=-1;for(;cursor.pos>minPos;){let{id,start,end,size}=cursor;if(size>4)cursor.next();else{if(stopAt>-1&&start<stopAt)break;stopAt<0&&(stopAt=end-maxBufferLength),nodes.push(id,start,end),nodeCount++,cursor.next()}}if(nodeCount){let buffer=new Uint16Array(4*nodeCount),start=nodes[nodes.length-2];for(let i=nodes.length-3,j=0;i>=0;i-=3)buffer[j++]=nodes[i],buffer[j++]=nodes[i+1]-start,buffer[j++]=nodes[i+2]-start,buffer[j++]=j;children.push(new TreeBuffer(buffer,nodes[2]-start,nodeSet)),positions.push(start-parentStart)}}function makeBalanced(type,contextHash){return(children,positions,length)=>{let last,lookAheadProp,lookAhead=0,lastI=children.length-1;if(lastI>=0&&(last=children[lastI])instanceof Tree){if(!lastI&&last.type==type&&last.length==length)return last;(lookAheadProp=last.prop(NodeProp.lookAhead))&&(lookAhead=positions[lastI]+last.length+lookAheadProp)}return makeTree(type,children,positions,length,lookAhead,contextHash)}}function makeRepeatLeaf(children,positions,base,i,from,to,type,lookAhead,contextHash){let localChildren=[],localPositions=[];for(;children.length>i;)localChildren.push(children.pop()),localPositions.push(positions.pop()+base-from);children.push(makeTree(nodeSet.types[type],localChildren,localPositions,to-from,lookAhead-to,contextHash)),positions.push(from-base)}function makeTree(type,children,positions,length,lookAhead,contextHash,props){if(contextHash){let pair=[NodeProp.contextHash,contextHash];props=props?[pair].concat(props):[pair]}if(lookAhead>25){let pair=[NodeProp.lookAhead,lookAhead];props=props?[pair].concat(props):[pair]}return new Tree(type,children,positions,length,props)}function findBufferSize(maxSize,inRepeat){let fork=cursor.fork(),size=0,start=0,skip=0,minStart=fork.end-maxBufferLength,result={size:0,start:0,skip:0};scan:for(let minPos=fork.pos-maxSize;fork.pos>minPos;){let nodeSize=fork.size;if(fork.id==inRepeat&&nodeSize>=0){result.size=size,result.start=start,result.skip=skip,skip+=4,size+=4,fork.next();continue}let startPos=fork.pos-nodeSize;if(nodeSize<0||startPos<minPos||fork.start<minStart)break;let localSkipped=fork.id>=minRepeatType?4:0,nodeStart=fork.start;for(fork.next();fork.pos>startPos;){if(fork.size<0){if(-3!=fork.size)break scan;localSkipped+=4}else fork.id>=minRepeatType&&(localSkipped+=4);fork.next()}start=nodeStart,size+=nodeSize,skip+=localSkipped}return(inRepeat<0||size==maxSize)&&(result.size=size,result.start=start,result.skip=skip),result.size>4?result:void 0}function copyToBuffer(bufferStart,buffer,index){let{id,start,end,size}=cursor;if(cursor.next(),size>=0&&id<minRepeatType){let startIndex=index;if(size>4){let endPos=cursor.pos-(size-4);for(;cursor.pos>endPos;)index=copyToBuffer(bufferStart,buffer,index)}buffer[--index]=startIndex,buffer[--index]=end-bufferStart,buffer[--index]=start-bufferStart,buffer[--index]=id}else-3==size?contextHash=id:-4==size&&(lookAhead=id);return index}let children=[],positions=[];for(;cursor.pos>0;)takeNode(data.start||0,data.bufferStart||0,children,positions,-1,0);let length=null!==(_a=data.length)&&void 0!==_a?_a:children.length?positions[0]+children[0].length:0;return new Tree(types[data.topID],children.reverse(),positions.reverse(),length)}(data)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(buffer,index){this.buffer=buffer,this.index=index}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(buffer,length,set){this.buffer=buffer,this.length=length,this.set=set}get type(){return NodeType.none}toString(){let result=[];for(let index=0;index<this.buffer.length;)result.push(this.childString(index)),index=this.buffer[index+3];return result.join(",")}childString(index){let id=this.buffer[index],endIndex=this.buffer[index+3],type=this.set.types[id],result=type.name;if(/\W/.test(result)&&!type.isError&&(result=JSON.stringify(result)),endIndex==(index+=4))return result;let children=[];for(;index<endIndex;)children.push(this.childString(index)),index=this.buffer[index+3];return result+"("+children.join(",")+")"}findChild(startIndex,endIndex,dir,pos,side){let{buffer}=this,pick=-1;for(let i=startIndex;i!=endIndex&&!(checkSide(side,pos,buffer[i+1],buffer[i+2])&&(pick=i,dir>0));i=buffer[i+3]);return pick}slice(startI,endI,from){let b=this.buffer,copy=new Uint16Array(endI-startI),len=0;for(let i=startI,j=0;i<endI;){copy[j++]=b[i++],copy[j++]=b[i++]-from;let to=copy[j++]=b[i++]-from;copy[j++]=b[i++]-startI,len=Math.max(len,to)}return new TreeBuffer(copy,len,this.set)}}function checkSide(side,pos,from,to){switch(side){case-2:return from<pos;case-1:return to>=pos&&from<pos;case 0:return from<pos&&to>pos;case 1:return from<=pos&&to>pos;case 2:return to>pos;case 4:return!0}}function resolveNode(node,pos,side,overlays){for(var _a;node.from==node.to||(side<1?node.from>=pos:node.from>pos)||(side>-1?node.to<=pos:node.to<pos);){let parent=!overlays&&node instanceof TreeNode&&node.index<0?null:node.parent;if(!parent)return node;node=parent}let mode=overlays?0:IterMode.IgnoreOverlays;if(overlays)for(let scan=node,parent=scan.parent;parent;scan=parent,parent=scan.parent)scan instanceof TreeNode&&scan.index<0&&(null===(_a=parent.enter(pos,side,mode))||void 0===_a?void 0:_a.from)!=scan.from&&(node=parent);for(;;){let inner=node.enter(pos,side,mode);if(!inner)return node;node=inner}}class BaseNode{cursor(mode=0){return new TreeCursor(this,mode)}getChild(type,before=null,after=null){let r=getChildren(this,type,before,after);return r.length?r[0]:null}getChildren(type,before=null,after=null){return getChildren(this,type,before,after)}resolve(pos,side=0){return resolveNode(this,pos,side,!1)}resolveInner(pos,side=0){return resolveNode(this,pos,side,!0)}matchContext(context){return matchNodeContext(this.parent,context)}enterUnfinishedNodesBefore(pos){let scan=this.childBefore(pos),node=this;for(;scan;){let last=scan.lastChild;if(!last||last.to!=scan.to)break;last.type.isError&&last.from==last.to?(node=scan,scan=last.prevSibling):scan=last}return node}get node(){return this}get next(){return this.parent}}class TreeNode extends BaseNode{constructor(_tree,from,index,_parent){super(),this._tree=_tree,this.from=from,this.index=index,this._parent=_parent}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(i,dir,pos,side,mode=0){for(let parent=this;;){for(let{children,positions}=parent._tree,e=dir>0?children.length:-1;i!=e;i+=dir){let next=children[i],start=positions[i]+parent.from;if(checkSide(side,pos,start,start+next.length))if(next instanceof TreeBuffer){if(mode&IterMode.ExcludeBuffers)continue;let index=next.findChild(0,next.buffer.length,dir,pos-start,side);if(index>-1)return new BufferNode(new BufferContext(parent,next,i,start),null,index)}else if(mode&IterMode.IncludeAnonymous||!next.type.isAnonymous||hasChild(next)){let mounted;if(!(mode&IterMode.IgnoreMounts)&&(mounted=MountedTree.get(next))&&!mounted.overlay)return new TreeNode(mounted.tree,start,i,parent);let inner=new TreeNode(next,start,i,parent);return mode&IterMode.IncludeAnonymous||!inner.type.isAnonymous?inner:inner.nextChild(dir<0?next.children.length-1:0,dir,pos,side)}}if(mode&IterMode.IncludeAnonymous||!parent.type.isAnonymous)return null;if(i=parent.index>=0?parent.index+dir:dir<0?-1:parent._parent._tree.children.length,parent=parent._parent,!parent)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(pos){return this.nextChild(0,1,pos,2)}childBefore(pos){return this.nextChild(this._tree.children.length-1,-1,pos,-2)}enter(pos,side,mode=0){let mounted;if(!(mode&IterMode.IgnoreOverlays)&&(mounted=MountedTree.get(this._tree))&&mounted.overlay){let rPos=pos-this.from;for(let{from,to}of mounted.overlay)if((side>0?from<=rPos:from<rPos)&&(side<0?to>=rPos:to>rPos))return new TreeNode(mounted.tree,mounted.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,pos,side,mode)}nextSignificantParent(){let val=this;for(;val.type.isAnonymous&&val._parent;)val=val._parent;return val}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function getChildren(node,type,before,after){let cur=node.cursor(),result=[];if(!cur.firstChild())return result;if(null!=before)for(let found=!1;!found;)if(found=cur.type.is(before),!cur.nextSibling())return result;for(;;){if(null!=after&&cur.type.is(after))return result;if(cur.type.is(type)&&result.push(cur.node),!cur.nextSibling())return null==after?result:[]}}function matchNodeContext(node,context,i=context.length-1){for(let p=node;i>=0;p=p.parent){if(!p)return!1;if(!p.type.isAnonymous){if(context[i]&&context[i]!=p.name)return!1;i--}}return!0}class BufferContext{constructor(parent,buffer,index,start){this.parent=parent,this.buffer=buffer,this.index=index,this.start=start}}class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(context,_parent,index){super(),this.context=context,this._parent=_parent,this.index=index,this.type=context.buffer.set.types[context.buffer.buffer[index]]}child(dir,pos,side){let{buffer}=this.context,index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],dir,pos-this.context.start,side);return index<0?null:new BufferNode(this.context,this,index)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(pos){return this.child(1,pos,2)}childBefore(pos){return this.child(-1,pos,-2)}enter(pos,side,mode=0){if(mode&IterMode.ExcludeBuffers)return null;let{buffer}=this.context,index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],side>0?1:-1,pos-this.context.start,side);return index<0?null:new BufferNode(this.context,this,index)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(dir){return this._parent?null:this.context.parent.nextChild(this.context.index+dir,dir,0,4)}get nextSibling(){let{buffer}=this.context,after=buffer.buffer[this.index+3];return after<(this._parent?buffer.buffer[this._parent.index+3]:buffer.buffer.length)?new BufferNode(this.context,this._parent,after):this.externalSibling(1)}get prevSibling(){let{buffer}=this.context,parentStart=this._parent?this._parent.index+4:0;return this.index==parentStart?this.externalSibling(-1):new BufferNode(this.context,this._parent,buffer.findChild(parentStart,this.index,-1,0,4))}get tree(){return null}toTree(){let children=[],positions=[],{buffer}=this.context,startI=this.index+4,endI=buffer.buffer[this.index+3];if(endI>startI){let from=buffer.buffer[this.index+1];children.push(buffer.slice(startI,endI,from)),positions.push(0)}return new Tree(this.type,children,positions,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function iterStack(heads){if(!heads.length)return null;let pick=0,picked=heads[0];for(let i=1;i<heads.length;i++){let node=heads[i];(node.from>picked.from||node.to<picked.to)&&(picked=node,pick=i)}let next=picked instanceof TreeNode&&picked.index<0?null:picked.parent,newHeads=heads.slice();return next?newHeads[pick]=next:newHeads.splice(pick,1),new StackIterator(newHeads,picked)}class StackIterator{constructor(heads,node){this.heads=heads,this.node=node}get next(){return iterStack(this.heads)}}class TreeCursor{get name(){return this.type.name}constructor(node,mode=0){if(this.mode=mode,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,node instanceof TreeNode)this.yieldNode(node);else{this._tree=node.context.parent,this.buffer=node.context;for(let n=node._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=node,this.yieldBuf(node.index)}}yieldNode(node){return!!node&&(this._tree=node,this.type=node.type,this.from=node.from,this.to=node.to,!0)}yieldBuf(index,type){this.index=index;let{start,buffer}=this.buffer;return this.type=type||buffer.set.types[buffer.buffer[index]],this.from=start+buffer.buffer[index+1],this.to=start+buffer.buffer[index+2],!0}yield(node){return!!node&&(node instanceof TreeNode?(this.buffer=null,this.yieldNode(node)):(this.buffer=node.context,this.yieldBuf(node.index,node.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(dir,pos,side){if(!this.buffer)return this.yield(this._tree.nextChild(dir<0?this._tree._tree.children.length-1:0,dir,pos,side,this.mode));let{buffer}=this.buffer,index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],dir,pos-this.buffer.start,side);return!(index<0)&&(this.stack.push(this.index),this.yieldBuf(index))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(pos){return this.enterChild(1,pos,2)}childBefore(pos){return this.enterChild(-1,pos,-2)}enter(pos,side,mode=this.mode){return this.buffer?!(mode&IterMode.ExcludeBuffers)&&this.enterChild(1,pos,side):this.yield(this._tree.enter(pos,side,mode))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let parent=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(parent)}sibling(dir){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+dir,dir,0,4,this.mode));let{buffer}=this.buffer,d=this.stack.length-1;if(dir<0){let parentStart=d<0?0:this.stack[d]+4;if(this.index!=parentStart)return this.yieldBuf(buffer.findChild(parentStart,this.index,-1,0,4))}else{let after=buffer.buffer[this.index+3];if(after<(d<0?buffer.buffer.length:buffer.buffer[this.stack[d]+3]))return this.yieldBuf(after)}return d<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+dir,dir,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(dir){let index,parent,{buffer}=this;if(buffer){if(dir>0){if(this.index<buffer.buffer.buffer.length)return!1}else for(let i=0;i<this.index;i++)if(buffer.buffer.buffer[i+3]<this.index)return!1;({index,parent}=buffer)}else({index,_parent:parent}=this._tree);for(;parent;({index,_parent:parent}=parent))if(index>-1)for(let i=index+dir,e=dir<0?-1:parent._tree.children.length;i!=e;i+=dir){let child=parent._tree.children[i];if(this.mode&IterMode.IncludeAnonymous||child instanceof TreeBuffer||!child.type.isAnonymous||hasChild(child))return!1}return!0}move(dir,enter){if(enter&&this.enterChild(dir,0,4))return!0;for(;;){if(this.sibling(dir))return!0;if(this.atLastNode(dir)||!this.parent())return!1}}next(enter=!0){return this.move(1,enter)}prev(enter=!0){return this.move(-1,enter)}moveTo(pos,side=0){for(;(this.from==this.to||(side<1?this.from>=pos:this.from>pos)||(side>-1?this.to<=pos:this.to<pos))&&this.parent(););for(;this.enterChild(1,pos,side););return this}get node(){if(!this.buffer)return this._tree;let cache=this.bufferNode,result=null,depth=0;if(cache&&cache.context==this.buffer)scan:for(let index=this.index,d=this.stack.length;d>=0;){for(let c=cache;c;c=c._parent)if(c.index==index){if(index==this.index)return c;result=c,depth=d+1;break scan}index=this.stack[--d]}for(let i=depth;i<this.stack.length;i++)result=new BufferNode(this.buffer,result,this.stack[i]);return this.bufferNode=new BufferNode(this.buffer,result,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(enter,leave){for(let depth=0;;){let mustLeave=!1;if(this.type.isAnonymous||!1!==enter(this)){if(this.firstChild()){depth++;continue}this.type.isAnonymous||(mustLeave=!0)}for(;;){if(mustLeave&&leave&&leave(this),mustLeave=this.type.isAnonymous,!depth)return;if(this.nextSibling())break;this.parent(),depth--,mustLeave=!0}}}matchContext(context){if(!this.buffer)return matchNodeContext(this.node.parent,context);let{buffer}=this.buffer,{types}=buffer.set;for(let i=context.length-1,d=this.stack.length-1;i>=0;d--){if(d<0)return matchNodeContext(this._tree,context,i);let type=types[buffer.buffer[this.stack[d]]];if(!type.isAnonymous){if(context[i]&&context[i]!=type.name)return!1;i--}}return!0}}function hasChild(tree){return tree.children.some((ch=>ch instanceof TreeBuffer||!ch.type.isAnonymous||hasChild(ch)))}const nodeSizeCache=new WeakMap;function nodeSize(balanceType,node){if(!balanceType.isAnonymous||node instanceof TreeBuffer||node.type!=balanceType)return 1;let size=nodeSizeCache.get(node);if(null==size){size=1;for(let child of node.children){if(child.type!=balanceType||!(child instanceof Tree)){size=1;break}size+=nodeSize(balanceType,child)}nodeSizeCache.set(node,size)}return size}function balanceRange(balanceType,children,positions,from,to,start,length,mkTop,mkTree){let total=0;for(let i=from;i<to;i++)total+=nodeSize(balanceType,children[i]);let maxChild=Math.ceil(1.5*total/8),localChildren=[],localPositions=[];return function divide(children,positions,from,to,offset){for(let i=from;i<to;){let groupFrom=i,groupStart=positions[i],groupSize=nodeSize(balanceType,children[i]);for(i++;i<to;i++){let nextSize=nodeSize(balanceType,children[i]);if(groupSize+nextSize>=maxChild)break;groupSize+=nextSize}if(i==groupFrom+1){if(groupSize>maxChild){let only=children[groupFrom];divide(only.children,only.positions,0,only.children.length,positions[groupFrom]+offset);continue}localChildren.push(children[groupFrom])}else{let length=positions[i-1]+children[i-1].length-groupStart;localChildren.push(balanceRange(balanceType,children,positions,groupFrom,i,groupStart,length,null,mkTree))}localPositions.push(groupStart+offset-start)}}(children,positions,from,to,0),(mkTop||mkTree)(localChildren,localPositions,length)}class NodeWeakMap{constructor(){this.map=new WeakMap}setBuffer(buffer,index,value){let inner=this.map.get(buffer);inner||this.map.set(buffer,inner=new Map),inner.set(index,value)}getBuffer(buffer,index){let inner=this.map.get(buffer);return inner&&inner.get(index)}set(node,value){node instanceof BufferNode?this.setBuffer(node.context.buffer,node.index,value):node instanceof TreeNode&&this.map.set(node.tree,value)}get(node){return node instanceof BufferNode?this.getBuffer(node.context.buffer,node.index):node instanceof TreeNode?this.map.get(node.tree):void 0}cursorSet(cursor,value){cursor.buffer?this.setBuffer(cursor.buffer.buffer,cursor.index,value):this.map.set(cursor.tree,value)}cursorGet(cursor){return cursor.buffer?this.getBuffer(cursor.buffer.buffer,cursor.index):this.map.get(cursor.tree)}}class TreeFragment{constructor(from,to,tree,offset,openStart=!1,openEnd=!1){this.from=from,this.to=to,this.tree=tree,this.offset=offset,this.open=(openStart?1:0)|(openEnd?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(tree,fragments=[],partial=!1){let result=[new TreeFragment(0,tree.length,tree,0,!1,partial)];for(let f of fragments)f.to>tree.length&&result.push(f);return result}static applyChanges(fragments,changes,minGap=128){if(!changes.length)return fragments;let result=[],fI=1,nextF=fragments.length?fragments[0]:null;for(let cI=0,pos=0,off=0;;cI++){let nextC=cI<changes.length?changes[cI]:null,nextPos=nextC?nextC.fromA:1e9;if(nextPos-pos>=minGap)for(;nextF&&nextF.from<nextPos;){let cut=nextF;if(pos>=cut.from||nextPos<=cut.to||off){let fFrom=Math.max(cut.from,pos)-off,fTo=Math.min(cut.to,nextPos)-off;cut=fFrom>=fTo?null:new TreeFragment(fFrom,fTo,cut.tree,cut.offset+off,cI>0,!!nextC)}if(cut&&result.push(cut),nextF.to>nextPos)break;nextF=fI<fragments.length?fragments[fI++]:null}if(!nextC)break;pos=nextC.toA,off=nextC.toA-nextC.toB}return result}}class Parser{startParse(input,fragments,ranges){return"string"==typeof input&&(input=new StringInput(input)),ranges=ranges?ranges.length?ranges.map((r=>new Range(r.from,r.to))):[new Range(0,0)]:[new Range(0,input.length)],this.createParse(input,fragments||[],ranges)}parse(input,fragments,ranges){let parse=this.startParse(input,fragments,ranges);for(;;){let done=parse.advance();if(done)return done}}}class StringInput{constructor(string){this.string=string}get length(){return this.string.length}chunk(from){return this.string.slice(from)}get lineChunks(){return!1}read(from,to){return this.string.slice(from,to)}}function parseMixed(nest){return(parse,input,fragments,ranges)=>new MixedParse(parse,nest,input,fragments,ranges)}class InnerParse{constructor(parser,parse,overlay,target,from){this.parser=parser,this.parse=parse,this.overlay=overlay,this.target=target,this.from=from}}function checkRanges(ranges){if(!ranges.length||ranges.some((r=>r.from>=r.to)))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(ranges))}class ActiveOverlay{constructor(parser,predicate,mounts,index,start,target,prev){this.parser=parser,this.predicate=predicate,this.mounts=mounts,this.index=index,this.start=start,this.target=target,this.prev=prev,this.depth=0,this.ranges=[]}}const stoppedInner=new NodeProp({perNode:!0});class MixedParse{constructor(base,nest,input,fragments,ranges){this.nest=nest,this.input=input,this.fragments=fragments,this.ranges=ranges,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=base}advance(){if(this.baseParse){let done=this.baseParse.advance();if(!done)return null;if(this.baseParse=null,this.baseTree=done,this.startInner(),null!=this.stoppedAt)for(let inner of this.inner)inner.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let result=this.baseTree;return null!=this.stoppedAt&&(result=new Tree(result.type,result.children,result.positions,result.length,result.propValues.concat([[stoppedInner,this.stoppedAt]]))),result}let inner=this.inner[this.innerDone],done=inner.parse.advance();if(done){this.innerDone++;let props=Object.assign(Object.create(null),inner.target.props);props[NodeProp.mounted.id]=new MountedTree(done,inner.overlay,inner.parser),inner.target.props=props}return null}get parsedPos(){if(this.baseParse)return 0;let pos=this.input.length;for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].from<pos&&(pos=Math.min(pos,this.inner[i].parse.parsedPos));return pos}stopAt(pos){if(this.stoppedAt=pos,this.baseParse)this.baseParse.stopAt(pos);else for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].parse.stopAt(pos)}startInner(){let fragmentCursor=new FragmentCursor(this.fragments),overlay=null,covered=null,cursor=new TreeCursor(new TreeNode(this.baseTree,this.ranges[0].from,0,null),IterMode.IncludeAnonymous|IterMode.IgnoreMounts);scan:for(let nest,isCovered;;){let range,enter=!0;if(null!=this.stoppedAt&&cursor.from>=this.stoppedAt)enter=!1;else if(fragmentCursor.hasNode(cursor)){if(overlay){let match=overlay.mounts.find((m=>m.frag.from<=cursor.from&&m.frag.to>=cursor.to&&m.mount.overlay));if(match)for(let r of match.mount.overlay){let from=r.from+match.pos,to=r.to+match.pos;from>=cursor.from&&to<=cursor.to&&!overlay.ranges.some((r=>r.from<to&&r.to>from))&&overlay.ranges.push({from,to})}}enter=!1}else if(covered&&(isCovered=checkCover(covered.ranges,cursor.from,cursor.to)))enter=2!=isCovered;else if(!cursor.type.isAnonymous&&(nest=this.nest(cursor,this.input))&&(cursor.from<cursor.to||!nest.overlay)){cursor.tree||materialize(cursor);let oldMounts=fragmentCursor.findMounts(cursor.from,nest.parser);if("function"==typeof nest.overlay)overlay=new ActiveOverlay(nest.parser,nest.overlay,oldMounts,this.inner.length,cursor.from,cursor.tree,overlay);else{let ranges=punchRanges(this.ranges,nest.overlay||(cursor.from<cursor.to?[new Range(cursor.from,cursor.to)]:[]));ranges.length&&checkRanges(ranges),!ranges.length&&nest.overlay||this.inner.push(new InnerParse(nest.parser,ranges.length?nest.parser.startParse(this.input,enterFragments(oldMounts,ranges),ranges):nest.parser.startParse(""),nest.overlay?nest.overlay.map((r=>new Range(r.from-cursor.from,r.to-cursor.from))):null,cursor.tree,ranges.length?ranges[0].from:cursor.from)),nest.overlay?ranges.length&&(covered={ranges,depth:0,prev:covered}):enter=!1}}else if(overlay&&(range=overlay.predicate(cursor))&&(!0===range&&(range=new Range(cursor.from,cursor.to)),range.from<range.to)){let last=overlay.ranges.length-1;last>=0&&overlay.ranges[last].to==range.from?overlay.ranges[last]={from:overlay.ranges[last].from,to:range.to}:overlay.ranges.push(range)}if(enter&&cursor.firstChild())overlay&&overlay.depth++,covered&&covered.depth++;else for(;!cursor.nextSibling();){if(!cursor.parent())break scan;if(overlay&&! --overlay.depth){let ranges=punchRanges(this.ranges,overlay.ranges);ranges.length&&(checkRanges(ranges),this.inner.splice(overlay.index,0,new InnerParse(overlay.parser,overlay.parser.startParse(this.input,enterFragments(overlay.mounts,ranges),ranges),overlay.ranges.map((r=>new Range(r.from-overlay.start,r.to-overlay.start))),overlay.target,ranges[0].from))),overlay=overlay.prev}covered&&! --covered.depth&&(covered=covered.prev)}}}}function checkCover(covered,from,to){for(let range of covered){if(range.from>=to)break;if(range.to>from)return range.from<=from&&range.to>=to?2:1}return 0}function sliceBuf(buf,startI,endI,nodes,positions,off){if(startI<endI){let from=buf.buffer[startI+1];nodes.push(buf.slice(startI,endI,from)),positions.push(from-off)}}function materialize(cursor){let{node}=cursor,stack=[],buffer=node.context.buffer;do{stack.push(cursor.index),cursor.parent()}while(!cursor.tree);let base=cursor.tree,i=base.children.indexOf(buffer),buf=base.children[i],b=buf.buffer,newStack=[i];base.children[i]=function split(startI,endI,type,innerOffset,length,stackPos){let targetI=stack[stackPos],children=[],positions=[];sliceBuf(buf,startI,targetI,children,positions,innerOffset);let from=b[targetI+1],to=b[targetI+2];newStack.push(children.length);let child=stackPos?split(targetI+4,b[targetI+3],buf.set.types[b[targetI]],from,to-from,stackPos-1):node.toTree();return children.push(child),positions.push(from-innerOffset),sliceBuf(buf,b[targetI+3],endI,children,positions,innerOffset),new Tree(type,children,positions,length)}(0,b.length,NodeType.none,0,buf.length,stack.length-1);for(let index of newStack){let tree=cursor.tree.children[index],pos=cursor.tree.positions[index];cursor.yield(new TreeNode(tree,pos+cursor.from,index,cursor._tree))}}class StructureCursor{constructor(root,offset){this.offset=offset,this.done=!1,this.cursor=root.cursor(IterMode.IncludeAnonymous|IterMode.IgnoreMounts)}moveTo(pos){let{cursor}=this,p=pos-this.offset;for(;!this.done&&cursor.from<p;)cursor.to>=pos&&cursor.enter(p,1,IterMode.IgnoreOverlays|IterMode.ExcludeBuffers)||cursor.next(!1)||(this.done=!0)}hasNode(cursor){if(this.moveTo(cursor.from),!this.done&&this.cursor.from+this.offset==cursor.from&&this.cursor.tree)for(let tree=this.cursor.tree;;){if(tree==cursor.tree)return!0;if(!(tree.children.length&&0==tree.positions[0]&&tree.children[0]instanceof Tree))break;tree=tree.children[0]}return!1}}class FragmentCursor{constructor(fragments){var _a;if(this.fragments=fragments,this.curTo=0,this.fragI=0,fragments.length){let first=this.curFrag=fragments[0];this.curTo=null!==(_a=first.tree.prop(stoppedInner))&&void 0!==_a?_a:first.to,this.inner=new StructureCursor(first.tree,-first.offset)}else this.curFrag=this.inner=null}hasNode(node){for(;this.curFrag&&node.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=node.from&&this.curTo>=node.to&&this.inner.hasNode(node)}nextFrag(){var _a;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let frag=this.curFrag=this.fragments[this.fragI];this.curTo=null!==(_a=frag.tree.prop(stoppedInner))&&void 0!==_a?_a:frag.to,this.inner=new StructureCursor(frag.tree,-frag.offset)}}findMounts(pos,parser){var _a;let result=[];if(this.inner){this.inner.cursor.moveTo(pos,1);for(let pos=this.inner.cursor.node;pos;pos=pos.parent){let mount=null===(_a=pos.tree)||void 0===_a?void 0:_a.prop(NodeProp.mounted);if(mount&&mount.parser==parser)for(let i=this.fragI;i<this.fragments.length;i++){let frag=this.fragments[i];if(frag.from>=pos.to)break;frag.tree==this.curFrag.tree&&result.push({frag,pos:pos.from-frag.offset,mount})}}}return result}}function punchRanges(outer,ranges){let copy=null,current=ranges;for(let i=1,j=0;i<outer.length;i++){let gapFrom=outer[i-1].to,gapTo=outer[i].from;for(;j<current.length;j++){let r=current[j];if(r.from>=gapTo)break;r.to<=gapFrom||(copy||(current=copy=ranges.slice()),r.from<gapFrom?(copy[j]=new Range(r.from,gapFrom),r.to>gapTo&&copy.splice(j+1,0,new Range(gapTo,r.to))):r.to>gapTo?copy[j--]=new Range(gapTo,r.to):copy.splice(j--,1))}}return current}function findCoverChanges(a,b,from,to){let iA=0,iB=0,inA=!1,inB=!1,pos=-1e9,result=[];for(;;){let nextA=iA==a.length?1e9:inA?a[iA].to:a[iA].from,nextB=iB==b.length?1e9:inB?b[iB].to:b[iB].from;if(inA!=inB){let start=Math.max(pos,from),end=Math.min(nextA,nextB,to);start<end&&result.push(new Range(start,end))}if(pos=Math.min(nextA,nextB),1e9==pos)break;nextA==pos&&(inA?(inA=!1,iA++):inA=!0),nextB==pos&&(inB?(inB=!1,iB++):inB=!0)}return result}function enterFragments(mounts,ranges){let result=[];for(let{pos,mount,frag}of mounts){let startPos=pos+(mount.overlay?mount.overlay[0].from:0),endPos=startPos+mount.tree.length,from=Math.max(frag.from,startPos),to=Math.min(frag.to,endPos);if(mount.overlay){let changes=findCoverChanges(ranges,mount.overlay.map((r=>new Range(r.from+pos,r.to+pos))),from,to);for(let i=0,pos=from;;i++){let last=i==changes.length,end=last?to:changes[i].from;if(end>pos&&result.push(new TreeFragment(pos,end,mount.tree,-startPos,frag.from>=pos||frag.openStart,frag.to<=end||frag.openEnd)),last)break;pos=changes[i].to}}else result.push(new TreeFragment(from,to,mount.tree,-startPos,frag.from>=startPos||frag.openStart,frag.to<=endPos||frag.openEnd))}return result}},"./node_modules/@lezer/highlight/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DM:()=>highlightTree,_A:()=>tags,az:()=>tagHighlighter,pn:()=>styleTags,vw:()=>Tag});var _lezer_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@lezer/common/dist/index.js");let nextTagID=0;class Tag{constructor(name,set,base,modified){this.name=name,this.set=set,this.base=base,this.modified=modified,this.id=nextTagID++}toString(){let{name}=this;for(let mod of this.modified)mod.name&&(name=`${mod.name}(${name})`);return name}static define(nameOrParent,parent){let name="string"==typeof nameOrParent?nameOrParent:"?";if(nameOrParent instanceof Tag&&(parent=nameOrParent),null==parent?void 0:parent.base)throw new Error("Can not derive from a modified tag");let tag=new Tag(name,[],null,[]);if(tag.set.push(tag),parent)for(let t of parent.set)tag.set.push(t);return tag}static defineModifier(name){let mod=new Modifier(name);return tag=>tag.modified.indexOf(mod)>-1?tag:Modifier.get(tag.base||tag,tag.modified.concat(mod).sort(((a,b)=>a.id-b.id)))}}let nextModifierID=0;class Modifier{constructor(name){this.name=name,this.instances=[],this.id=nextModifierID++}static get(base,mods){if(!mods.length)return base;let exists=mods[0].instances.find((t=>t.base==base&&function sameArray(a,b){return a.length==b.length&&a.every(((x,i)=>x==b[i]))}(mods,t.modified)));if(exists)return exists;let set=[],tag=new Tag(base.name,set,base,mods);for(let m of mods)m.instances.push(tag);let configs=function powerSet(array){let sets=[[]];for(let i=0;i<array.length;i++)for(let j=0,e=sets.length;j<e;j++)sets.push(sets[j].concat(array[i]));return sets.sort(((a,b)=>b.length-a.length))}(mods);for(let parent of base.set)if(!parent.modified.length)for(let config of configs)set.push(Modifier.get(parent,config));return tag}}function styleTags(spec){let byName=Object.create(null);for(let prop in spec){let tags=spec[prop];Array.isArray(tags)||(tags=[tags]);for(let part of prop.split(" "))if(part){let pieces=[],mode=2,rest=part;for(let pos=0;;){if("..."==rest&&pos>0&&pos+3==part.length){mode=1;break}let m=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(rest);if(!m)throw new RangeError("Invalid path: "+part);if(pieces.push("*"==m[0]?"":'"'==m[0][0]?JSON.parse(m[0]):m[0]),pos+=m[0].length,pos==part.length)break;let next=part[pos++];if(pos==part.length&&"!"==next){mode=0;break}if("/"!=next)throw new RangeError("Invalid path: "+part);rest=part.slice(pos)}let last=pieces.length-1,inner=pieces[last];if(!inner)throw new RangeError("Invalid path: "+part);let rule=new Rule(tags,mode,last>0?pieces.slice(0,last):null);byName[inner]=rule.sort(byName[inner])}}return ruleNodeProp.add(byName)}const ruleNodeProp=new _lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY;class Rule{constructor(tags,mode,context,next){this.tags=tags,this.mode=mode,this.context=context,this.next=next}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(other){return!other||other.depth<this.depth?(this.next=other,this):(other.next=this.sort(other.next),other)}get depth(){return this.context?this.context.length:0}}function tagHighlighter(tags,options){let map=Object.create(null);for(let style of tags)if(Array.isArray(style.tag))for(let tag of style.tag)map[tag.id]=style.class;else map[style.tag.id]=style.class;let{scope,all=null}=options||{};return{style:tags=>{let cls=all;for(let tag of tags)for(let sub of tag.set){let tagClass=map[sub.id];if(tagClass){cls=cls?cls+" "+tagClass:tagClass;break}}return cls},scope}}function highlightTree(tree,highlighter,putStyle,from=0,to=tree.length){let builder=new HighlightBuilder(from,Array.isArray(highlighter)?highlighter:[highlighter],putStyle);builder.highlightRange(tree.cursor(),from,to,"",builder.highlighters),builder.flush(to)}Rule.empty=new Rule([],2,null);class HighlightBuilder{constructor(at,highlighters,span){this.at=at,this.highlighters=highlighters,this.span=span,this.class=""}startSpan(at,cls){cls!=this.class&&(this.flush(at),at>this.at&&(this.at=at),this.class=cls)}flush(to){to>this.at&&this.class&&this.span(this.at,to,this.class)}highlightRange(cursor,from,to,inheritedClass,highlighters){let{type,from:start,to:end}=cursor;if(start>=to||end<=from)return;type.isTop&&(highlighters=this.highlighters.filter((h=>!h.scope||h.scope(type))));let cls=inheritedClass,rule=function getStyleTags(node){let rule=node.type.prop(ruleNodeProp);for(;rule&&rule.context&&!node.matchContext(rule.context);)rule=rule.next;return rule||null}(cursor)||Rule.empty,tagCls=function highlightTags(highlighters,tags){let result=null;for(let highlighter of highlighters){let value=highlighter.style(tags);value&&(result=result?result+" "+value:value)}return result}(highlighters,rule.tags);if(tagCls&&(cls&&(cls+=" "),cls+=tagCls,1==rule.mode&&(inheritedClass+=(inheritedClass?" ":"")+tagCls)),this.startSpan(Math.max(from,start),cls),rule.opaque)return;let mounted=cursor.tree&&cursor.tree.prop(_lezer_common__WEBPACK_IMPORTED_MODULE_0__.uY.mounted);if(mounted&&mounted.overlay){let inner=cursor.node.enter(mounted.overlay[0].from+start,1),innerHighlighters=this.highlighters.filter((h=>!h.scope||h.scope(mounted.tree.type))),hasChild=cursor.firstChild();for(let i=0,pos=start;;i++){let next=i<mounted.overlay.length?mounted.overlay[i]:null,nextPos=next?next.from+start:end,rangeFrom=Math.max(from,pos),rangeTo=Math.min(to,nextPos);if(rangeFrom<rangeTo&&hasChild)for(;cursor.from<rangeTo&&(this.highlightRange(cursor,rangeFrom,rangeTo,inheritedClass,highlighters),this.startSpan(Math.min(rangeTo,cursor.to),cls),!(cursor.to>=nextPos)&&cursor.nextSibling()););if(!next||nextPos>to)break;pos=next.to+start,pos>from&&(this.highlightRange(inner.cursor(),Math.max(from,next.from+start),Math.min(to,pos),"",innerHighlighters),this.startSpan(Math.min(to,pos),cls))}hasChild&&cursor.parent()}else if(cursor.firstChild()){mounted&&(inheritedClass="");do{if(!(cursor.to<=from)){if(cursor.from>=to)break;this.highlightRange(cursor,from,to,inheritedClass,highlighters),this.startSpan(Math.min(to,cursor.to),cls)}}while(cursor.nextSibling());cursor.parent()}}}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name,variableName:t(name),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier("definition"),constant:Tag.defineModifier("constant"),function:Tag.defineModifier("function"),standard:Tag.defineModifier("standard"),local:Tag.defineModifier("local"),special:Tag.defineModifier("special")};for(let name in tags){let val=tags[name];val instanceof Tag&&(val.name=name)}tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}])},"./node_modules/@radix-ui/react-menubar/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G5:()=>SubContent2,H_:()=>CheckboxItem2,Pb:()=>Sub2,UC:()=>Content2,VF:()=>ItemIndicator2,W1:()=>Menu,ZL:()=>Portal2,ZP:()=>SubTrigger2,bL:()=>Root3,hN:()=>RadioItem2,i3:()=>Arrow2,l9:()=>Trigger,q7:()=>Item3,z6:()=>RadioGroup2});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_radix_ui_react_collection__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@radix-ui/react-collection/dist/index.mjs"),_radix_ui_react_direction__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@radix-ui/react-direction/dist/index.mjs"),_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@radix-ui/primitive/dist/index.mjs"),_radix_ui_react_compose_refs__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@radix-ui/react-compose-refs/dist/index.mjs"),_radix_ui_react_context__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@radix-ui/react-context/dist/index.mjs"),_radix_ui_react_id__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@radix-ui/react-id/dist/index.mjs"),_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@radix-ui/react-menu/dist/index.mjs"),_radix_ui_react_roving_focus__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@radix-ui/react-roving-focus/dist/index.mjs"),_radix_ui_react_primitive__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@radix-ui/react-primitive/dist/index.mjs"),_radix_ui_react_use_controllable_state__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),[Collection,useCollection,createCollectionScope]=(0,_radix_ui_react_collection__WEBPACK_IMPORTED_MODULE_2__.N)("Menubar"),[createMenubarContext,createMenubarScope]=(0,_radix_ui_react_context__WEBPACK_IMPORTED_MODULE_3__.A)("Menubar",[createCollectionScope,_radix_ui_react_roving_focus__WEBPACK_IMPORTED_MODULE_4__.RG]),useMenuScope=(0,_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.UE)(),useRovingFocusGroupScope=(0,_radix_ui_react_roving_focus__WEBPACK_IMPORTED_MODULE_4__.RG)(),[MenubarContextProvider,useMenubarContext]=createMenubarContext("Menubar"),Menubar=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,value:valueProp,onValueChange,defaultValue,loop=!0,dir,...menubarProps}=props,direction=(0,_radix_ui_react_direction__WEBPACK_IMPORTED_MODULE_6__.jH)(dir),rovingFocusGroupScope=useRovingFocusGroupScope(__scopeMenubar),[value="",setValue]=(0,_radix_ui_react_use_controllable_state__WEBPACK_IMPORTED_MODULE_7__.i)({prop:valueProp,onChange:onValueChange,defaultProp:defaultValue}),[currentTabStopId,setCurrentTabStopId]=react__WEBPACK_IMPORTED_MODULE_0__.useState(null);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(MenubarContextProvider,{scope:__scopeMenubar,value,onMenuOpen:react__WEBPACK_IMPORTED_MODULE_0__.useCallback((value2=>{setValue(value2),setCurrentTabStopId(value2)}),[setValue]),onMenuClose:react__WEBPACK_IMPORTED_MODULE_0__.useCallback((()=>setValue("")),[setValue]),onMenuToggle:react__WEBPACK_IMPORTED_MODULE_0__.useCallback((value2=>{setValue((prevValue=>prevValue?"":value2)),setCurrentTabStopId(value2)}),[setValue]),dir:direction,loop,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(Collection.Provider,{scope:__scopeMenubar,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(Collection.Slot,{scope:__scopeMenubar,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_roving_focus__WEBPACK_IMPORTED_MODULE_4__.bL,{asChild:!0,...rovingFocusGroupScope,orientation:"horizontal",loop,dir:direction,currentTabStopId,onCurrentTabStopIdChange:setCurrentTabStopId,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_primitive__WEBPACK_IMPORTED_MODULE_8__.sG.div,{role:"menubar",...menubarProps,ref:forwardedRef})})})})})}));Menubar.displayName="Menubar";var[MenubarMenuProvider,useMenubarMenuContext]=createMenubarContext("MenubarMenu"),MenubarMenu=props=>{const{__scopeMenubar,value:valueProp,...menuProps}=props,autoValue=(0,_radix_ui_react_id__WEBPACK_IMPORTED_MODULE_9__.B)(),value=valueProp||autoValue||"LEGACY_REACT_AUTO_VALUE",context=useMenubarContext("MenubarMenu",__scopeMenubar),menuScope=useMenuScope(__scopeMenubar),triggerRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(null),wasKeyboardTriggerOpenRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(!1),open=context.value===value;return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((()=>{open||(wasKeyboardTriggerOpenRef.current=!1)}),[open]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(MenubarMenuProvider,{scope:__scopeMenubar,value,triggerId:(0,_radix_ui_react_id__WEBPACK_IMPORTED_MODULE_9__.B)(),triggerRef,contentId:(0,_radix_ui_react_id__WEBPACK_IMPORTED_MODULE_9__.B)(),wasKeyboardTriggerOpenRef,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.bL,{...menuScope,open,onOpenChange:open2=>{open2||context.onMenuClose()},modal:!1,dir:context.dir,...menuProps})})};MenubarMenu.displayName="MenubarMenu";var MenubarTrigger=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,disabled=!1,...triggerProps}=props,rovingFocusGroupScope=useRovingFocusGroupScope(__scopeMenubar),menuScope=useMenuScope(__scopeMenubar),context=useMenubarContext("MenubarTrigger",__scopeMenubar),menuContext=useMenubarMenuContext("MenubarTrigger",__scopeMenubar),ref=react__WEBPACK_IMPORTED_MODULE_0__.useRef(null),composedRefs=(0,_radix_ui_react_compose_refs__WEBPACK_IMPORTED_MODULE_10__.s)(forwardedRef,ref,menuContext.triggerRef),[isFocused,setIsFocused]=react__WEBPACK_IMPORTED_MODULE_0__.useState(!1),open=context.value===menuContext.value;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(Collection.ItemSlot,{scope:__scopeMenubar,value:menuContext.value,disabled,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_roving_focus__WEBPACK_IMPORTED_MODULE_4__.q7,{asChild:!0,...rovingFocusGroupScope,focusable:!disabled,tabStopId:menuContext.value,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.Mz,{asChild:!0,...menuScope,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_primitive__WEBPACK_IMPORTED_MODULE_8__.sG.button,{type:"button",role:"menuitem",id:menuContext.triggerId,"aria-haspopup":"menu","aria-expanded":open,"aria-controls":open?menuContext.contentId:void 0,"data-highlighted":isFocused?"":void 0,"data-state":open?"open":"closed","data-disabled":disabled?"":void 0,disabled,...triggerProps,ref:composedRefs,onPointerDown:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onPointerDown,(event=>{disabled||0!==event.button||!1!==event.ctrlKey||(context.onMenuOpen(menuContext.value),open||event.preventDefault())})),onPointerEnter:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onPointerEnter,(()=>{Boolean(context.value)&&!open&&(context.onMenuOpen(menuContext.value),ref.current?.focus())})),onKeyDown:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onKeyDown,(event=>{disabled||(["Enter"," "].includes(event.key)&&context.onMenuToggle(menuContext.value),"ArrowDown"===event.key&&context.onMenuOpen(menuContext.value),["Enter"," ","ArrowDown"].includes(event.key)&&(menuContext.wasKeyboardTriggerOpenRef.current=!0,event.preventDefault()))})),onFocus:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onFocus,(()=>setIsFocused(!0))),onBlur:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onBlur,(()=>setIsFocused(!1)))})})})})}));MenubarTrigger.displayName="MenubarTrigger";var MenubarPortal=props=>{const{__scopeMenubar,...portalProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.ZL,{...menuScope,...portalProps})};MenubarPortal.displayName="MenubarPortal";var MenubarContent=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,align="start",...contentProps}=props,menuScope=useMenuScope(__scopeMenubar),context=useMenubarContext("MenubarContent",__scopeMenubar),menuContext=useMenubarMenuContext("MenubarContent",__scopeMenubar),getItems=useCollection(__scopeMenubar),hasInteractedOutsideRef=react__WEBPACK_IMPORTED_MODULE_0__.useRef(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.UC,{id:menuContext.contentId,"aria-labelledby":menuContext.triggerId,"data-radix-menubar-content":"",...menuScope,...contentProps,ref:forwardedRef,align,onCloseAutoFocus:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onCloseAutoFocus,(event=>{Boolean(context.value)||hasInteractedOutsideRef.current||menuContext.triggerRef.current?.focus(),hasInteractedOutsideRef.current=!1,event.preventDefault()})),onFocusOutside:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onFocusOutside,(event=>{const target=event.target;getItems().some((item=>item.ref.current?.contains(target)))&&event.preventDefault()})),onInteractOutside:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onInteractOutside,(()=>{hasInteractedOutsideRef.current=!0})),onEntryFocus:event=>{menuContext.wasKeyboardTriggerOpenRef.current||event.preventDefault()},onKeyDown:(0,_radix_ui_primitive__WEBPACK_IMPORTED_MODULE_11__.m)(props.onKeyDown,(event=>{if(["ArrowRight","ArrowLeft"].includes(event.key)){const target=event.target,targetIsSubTrigger=target.hasAttribute("data-radix-menubar-subtrigger"),isKeyDownInsideSubMenu=target.closest("[data-radix-menubar-content]")!==event.currentTarget,isPrevKey=("rtl"===context.dir?"ArrowRight":"ArrowLeft")===event.key;if(!isPrevKey&&targetIsSubTrigger)return;if(isKeyDownInsideSubMenu&&isPrevKey)return;let candidateValues=getItems().filter((item=>!item.disabled)).map((item=>item.value));isPrevKey&&candidateValues.reverse();const currentIndex=candidateValues.indexOf(menuContext.value);candidateValues=context.loop?function wrapArray(array,startIndex){return array.map(((_,index)=>array[(startIndex+index)%array.length]))}(candidateValues,currentIndex+1):candidateValues.slice(currentIndex+1);const[nextValue]=candidateValues;nextValue&&context.onMenuOpen(nextValue)}}),{checkForDefaultPrevented:!1}),style:{...props.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})}));MenubarContent.displayName="MenubarContent";var MenubarGroup=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...groupProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.YJ,{...menuScope,...groupProps,ref:forwardedRef})}));MenubarGroup.displayName="MenubarGroup";var MenubarLabel=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...labelProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.JU,{...menuScope,...labelProps,ref:forwardedRef})}));MenubarLabel.displayName="MenubarLabel";var MenubarItem=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...itemProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.q7,{...menuScope,...itemProps,ref:forwardedRef})}));MenubarItem.displayName="MenubarItem";var MenubarCheckboxItem=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...checkboxItemProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.H_,{...menuScope,...checkboxItemProps,ref:forwardedRef})}));MenubarCheckboxItem.displayName="MenubarCheckboxItem";var MenubarRadioGroup=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...radioGroupProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.z6,{...menuScope,...radioGroupProps,ref:forwardedRef})}));MenubarRadioGroup.displayName="MenubarRadioGroup";var MenubarRadioItem=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...radioItemProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.hN,{...menuScope,...radioItemProps,ref:forwardedRef})}));MenubarRadioItem.displayName="MenubarRadioItem";var MenubarItemIndicator=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...itemIndicatorProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.VF,{...menuScope,...itemIndicatorProps,ref:forwardedRef})}));MenubarItemIndicator.displayName="MenubarItemIndicator";var MenubarSeparator=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...separatorProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.wv,{...menuScope,...separatorProps,ref:forwardedRef})}));MenubarSeparator.displayName="MenubarSeparator";var MenubarArrow=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...arrowProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.i3,{...menuScope,...arrowProps,ref:forwardedRef})}));MenubarArrow.displayName="MenubarArrow";var MenubarSub=props=>{const{__scopeMenubar,children,open:openProp,onOpenChange,defaultOpen}=props,menuScope=useMenuScope(__scopeMenubar),[open=!1,setOpen]=(0,_radix_ui_react_use_controllable_state__WEBPACK_IMPORTED_MODULE_7__.i)({prop:openProp,defaultProp:defaultOpen,onChange:onOpenChange});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.Pb,{...menuScope,open,onOpenChange:setOpen,children})};MenubarSub.displayName="MenubarSub";var MenubarSubTrigger=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...subTriggerProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.ZP,{"data-radix-menubar-subtrigger":"",...menuScope,...subTriggerProps,ref:forwardedRef})}));MenubarSubTrigger.displayName="MenubarSubTrigger";var MenubarSubContent=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((props,forwardedRef)=>{const{__scopeMenubar,...subContentProps}=props,menuScope=useMenuScope(__scopeMenubar);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_radix_ui_react_menu__WEBPACK_IMPORTED_MODULE_5__.G5,{...menuScope,"data-radix-menubar-content":"",...subContentProps,ref:forwardedRef,style:{...props.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})}));MenubarSubContent.displayName="MenubarSubContent";var Root3=Menubar,Menu=MenubarMenu,Trigger=MenubarTrigger,Portal2=MenubarPortal,Content2=MenubarContent,Item3=MenubarItem,CheckboxItem2=MenubarCheckboxItem,RadioGroup2=MenubarRadioGroup,RadioItem2=MenubarRadioItem,ItemIndicator2=MenubarItemIndicator,Arrow2=MenubarArrow,Sub2=MenubarSub,SubTrigger2=MenubarSubTrigger,SubContent2=MenubarSubContent},"./node_modules/@sentry/core/build/esm/exports.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Cp:()=>captureException});const SDK_VERSION="9.14.0",worldwide_GLOBAL_OBJ=globalThis;function carrier_getMainCarrier(){return carrier_getSentryCarrier(worldwide_GLOBAL_OBJ),worldwide_GLOBAL_OBJ}function carrier_getSentryCarrier(carrier){const __SENTRY__=carrier.__SENTRY__=carrier.__SENTRY__||{};return __SENTRY__.version=__SENTRY__.version||SDK_VERSION,__SENTRY__[SDK_VERSION]=__SENTRY__[SDK_VERSION]||{}}function carrier_getGlobalSingleton(name,creator,obj=worldwide_GLOBAL_OBJ){const __SENTRY__=obj.__SENTRY__=obj.__SENTRY__||{},carrier=__SENTRY__[SDK_VERSION]=__SENTRY__[SDK_VERSION]||{};return carrier[name]||(carrier[name]=creator())}function misc_uuid4(crypto=function getCrypto(){const gbl=worldwide_GLOBAL_OBJ;return gbl.crypto||gbl.msCrypto}()){let getRandomByte=()=>16*Math.random();try{if(crypto?.randomUUID)return crypto.randomUUID().replace(/-/g,"");crypto?.getRandomValues&&(getRandomByte=()=>{const typedArray=new Uint8Array(1);return crypto.getRandomValues(typedArray),typedArray[0]})}catch(_){}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(c=>(c^(15&getRandomByte())>>c/4).toString(16)))}function time_dateTimestampInSeconds(){return Date.now()/1e3}const time_timestampInSeconds=function createUnixTimestampInSecondsFunc(){const{performance}=worldwide_GLOBAL_OBJ;if(!performance?.now)return time_dateTimestampInSeconds;const approxStartingTimeOrigin=Date.now()-performance.now(),timeOrigin=null==performance.timeOrigin?approxStartingTimeOrigin:performance.timeOrigin;return()=>(timeOrigin+performance.now())/1e3}();function session_updateSession(session,context={}){if(context.user&&(!session.ipAddress&&context.user.ip_address&&(session.ipAddress=context.user.ip_address),session.did||context.did||(session.did=context.user.id||context.user.email||context.user.username)),session.timestamp=context.timestamp||time_timestampInSeconds(),context.abnormal_mechanism&&(session.abnormal_mechanism=context.abnormal_mechanism),context.ignoreDuration&&(session.ignoreDuration=context.ignoreDuration),context.sid&&(session.sid=32===context.sid.length?context.sid:misc_uuid4()),void 0!==context.init&&(session.init=context.init),!session.did&&context.did&&(session.did=`${context.did}`),"number"==typeof context.started&&(session.started=context.started),session.ignoreDuration)session.duration=void 0;else if("number"==typeof context.duration)session.duration=context.duration;else{const duration=session.timestamp-session.started;session.duration=duration>=0?duration:0}context.release&&(session.release=context.release),context.environment&&(session.environment=context.environment),!session.ipAddress&&context.ipAddress&&(session.ipAddress=context.ipAddress),!session.userAgent&&context.userAgent&&(session.userAgent=context.userAgent),"number"==typeof context.errors&&(session.errors=context.errors),context.status&&(session.status=context.status)}const objectToString=Object.prototype.toString;function isBuiltin(wat,className){return objectToString.call(wat)===`[object ${className}]`}function isPlainObject(wat){return isBuiltin(wat,"Object")}const debug_build_DEBUG_BUILD="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,CONSOLE_LEVELS=["debug","info","warn","error","log","assert","trace"],originalConsoleMethods={};const logger_logger=carrier_getGlobalSingleton("logger",(function makeLogger(){let enabled=!1;const logger={enable:()=>{enabled=!0},disable:()=>{enabled=!1},isEnabled:()=>enabled};return debug_build_DEBUG_BUILD?CONSOLE_LEVELS.forEach((name=>{logger[name]=(...args)=>{enabled&&function consoleSandbox(callback){if(!("console"in worldwide_GLOBAL_OBJ))return callback();const console=worldwide_GLOBAL_OBJ.console,wrappedFuncs={},wrappedLevels=Object.keys(originalConsoleMethods);wrappedLevels.forEach((level=>{const originalConsoleMethod=originalConsoleMethods[level];wrappedFuncs[level]=console[level],console[level]=originalConsoleMethod}));try{return callback()}finally{wrappedLevels.forEach((level=>{console[level]=wrappedFuncs[level]}))}}((()=>{worldwide_GLOBAL_OBJ.console[name](`Sentry Logger [${name}]:`,...args)}))}})):CONSOLE_LEVELS.forEach((name=>{logger[name]=()=>{}})),logger}));function generateTraceId(){return misc_uuid4()}function string_truncate(str,max=0){return"string"!=typeof str||0===max||str.length<=max?str:`${str.slice(0,max)}...`}function merge(initialObj,mergeObj,levels=2){if(!mergeObj||"object"!=typeof mergeObj||levels<=0)return mergeObj;if(initialObj&&0===Object.keys(mergeObj).length)return initialObj;const output={...initialObj};for(const key in mergeObj)Object.prototype.hasOwnProperty.call(mergeObj,key)&&(output[key]=merge(output[key],mergeObj[key],levels-1));return output}function object_addNonEnumerableProperty(obj,name,value){try{Object.defineProperty(obj,name,{value,writable:!0,configurable:!0})}catch(o_O){debug_build_DEBUG_BUILD&&logger_logger.log(`Failed to add non-enumerable property "${name}" to object`,obj)}}function _setSpanForScope(scope,span){span?object_addNonEnumerableProperty(scope,"_sentrySpan",span):delete scope._sentrySpan}function _getSpanForScope(scope){return scope._sentrySpan}class scope_Scope{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:generateTraceId(),sampleRand:Math.random()}}clone(){const newScope=new scope_Scope;return newScope._breadcrumbs=[...this._breadcrumbs],newScope._tags={...this._tags},newScope._extra={...this._extra},newScope._contexts={...this._contexts},this._contexts.flags&&(newScope._contexts.flags={values:[...this._contexts.flags.values]}),newScope._user=this._user,newScope._level=this._level,newScope._session=this._session,newScope._transactionName=this._transactionName,newScope._fingerprint=this._fingerprint,newScope._eventProcessors=[...this._eventProcessors],newScope._attachments=[...this._attachments],newScope._sdkProcessingMetadata={...this._sdkProcessingMetadata},newScope._propagationContext={...this._propagationContext},newScope._client=this._client,newScope._lastEventId=this._lastEventId,_setSpanForScope(newScope,_getSpanForScope(this)),newScope}setClient(client){this._client=client}setLastEventId(lastEventId){this._lastEventId=lastEventId}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(callback){this._scopeListeners.push(callback)}addEventProcessor(callback){return this._eventProcessors.push(callback),this}setUser(user){return this._user=user||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&session_updateSession(this._session,{user}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(tags){return this._tags={...this._tags,...tags},this._notifyScopeListeners(),this}setTag(key,value){return this._tags={...this._tags,[key]:value},this._notifyScopeListeners(),this}setExtras(extras){return this._extra={...this._extra,...extras},this._notifyScopeListeners(),this}setExtra(key,extra){return this._extra={...this._extra,[key]:extra},this._notifyScopeListeners(),this}setFingerprint(fingerprint){return this._fingerprint=fingerprint,this._notifyScopeListeners(),this}setLevel(level){return this._level=level,this._notifyScopeListeners(),this}setTransactionName(name){return this._transactionName=name,this._notifyScopeListeners(),this}setContext(key,context){return null===context?delete this._contexts[key]:this._contexts[key]=context,this._notifyScopeListeners(),this}setSession(session){return session?this._session=session:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(captureContext){if(!captureContext)return this;const scopeToMerge="function"==typeof captureContext?captureContext(this):captureContext,scopeInstance=scopeToMerge instanceof scope_Scope?scopeToMerge.getScopeData():isPlainObject(scopeToMerge)?captureContext:void 0,{tags,extra,user,contexts,level,fingerprint=[],propagationContext}=scopeInstance||{};return this._tags={...this._tags,...tags},this._extra={...this._extra,...extra},this._contexts={...this._contexts,...contexts},user&&Object.keys(user).length&&(this._user=user),level&&(this._level=level),fingerprint.length&&(this._fingerprint=fingerprint),propagationContext&&(this._propagationContext=propagationContext),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,_setSpanForScope(this,void 0),this._attachments=[],this.setPropagationContext({traceId:generateTraceId(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(breadcrumb,maxBreadcrumbs){const maxCrumbs="number"==typeof maxBreadcrumbs?maxBreadcrumbs:100;if(maxCrumbs<=0)return this;const mergedBreadcrumb={timestamp:time_dateTimestampInSeconds(),...breadcrumb,message:breadcrumb.message?string_truncate(breadcrumb.message,2048):breadcrumb.message};return this._breadcrumbs.push(mergedBreadcrumb),this._breadcrumbs.length>maxCrumbs&&(this._breadcrumbs=this._breadcrumbs.slice(-maxCrumbs),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(attachment){return this._attachments.push(attachment),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:_getSpanForScope(this)}}setSDKProcessingMetadata(newData){return this._sdkProcessingMetadata=merge(this._sdkProcessingMetadata,newData,2),this}setPropagationContext(context){return this._propagationContext=context,this}getPropagationContext(){return this._propagationContext}captureException(exception,hint){const eventId=hint?.event_id||misc_uuid4();if(!this._client)return logger_logger.warn("No client configured on scope - will not capture exception!"),eventId;const syntheticException=new Error("Sentry syntheticException");return this._client.captureException(exception,{originalException:exception,syntheticException,...hint,event_id:eventId},this),eventId}captureMessage(message,level,hint){const eventId=hint?.event_id||misc_uuid4();if(!this._client)return logger_logger.warn("No client configured on scope - will not capture message!"),eventId;const syntheticException=new Error(message);return this._client.captureMessage(message,level,{originalException:message,syntheticException,...hint,event_id:eventId},this),eventId}captureEvent(event,hint){const eventId=hint?.event_id||misc_uuid4();return this._client?(this._client.captureEvent(event,{...hint,event_id:eventId},this),eventId):(logger_logger.warn("No client configured on scope - will not capture event!"),eventId)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((callback=>{callback(this)})),this._notifyingListeners=!1)}}class AsyncContextStack{constructor(scope,isolationScope){let assignedScope,assignedIsolationScope;assignedScope=scope||new scope_Scope,assignedIsolationScope=isolationScope||new scope_Scope,this._stack=[{scope:assignedScope}],this._isolationScope=assignedIsolationScope}withScope(callback){const scope=this._pushScope();let maybePromiseResult;try{maybePromiseResult=callback(scope)}catch(e){throw this._popScope(),e}return function is_isThenable(wat){return Boolean(wat?.then&&"function"==typeof wat.then)}(maybePromiseResult)?maybePromiseResult.then((res=>(this._popScope(),res)),(e=>{throw this._popScope(),e})):(this._popScope(),maybePromiseResult)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const scope=this.getScope().clone();return this._stack.push({client:this.getClient(),scope}),scope}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function getAsyncContextStack(){const sentry=carrier_getSentryCarrier(carrier_getMainCarrier());return sentry.stack=sentry.stack||new AsyncContextStack(function getDefaultCurrentScope(){return carrier_getGlobalSingleton("defaultCurrentScope",(()=>new scope_Scope))}(),function getDefaultIsolationScope(){return carrier_getGlobalSingleton("defaultIsolationScope",(()=>new scope_Scope))}())}function withScope(callback){return getAsyncContextStack().withScope(callback)}function withSetScope(scope,callback){const stack=getAsyncContextStack();return stack.withScope((()=>(stack.getStackTop().scope=scope,callback(scope))))}function stackStrategy_withIsolationScope(callback){return getAsyncContextStack().withScope((()=>callback(getAsyncContextStack().getIsolationScope())))}function asyncContext_getAsyncContextStrategy(carrier){const sentry=carrier_getSentryCarrier(carrier);return sentry.acs?sentry.acs:function getStackAsyncContextStrategy(){return{withIsolationScope:stackStrategy_withIsolationScope,withScope,withSetScope,withSetIsolationScope:(_isolationScope,callback)=>stackStrategy_withIsolationScope(callback),getCurrentScope:()=>getAsyncContextStack().getScope(),getIsolationScope:()=>getAsyncContextStack().getIsolationScope()}}()}function currentScopes_getCurrentScope(){return asyncContext_getAsyncContextStrategy(carrier_getMainCarrier()).getCurrentScope()}function parseEventHintOrCaptureContext(hint){if(hint)return function hintIsScopeOrFunction(hint){return hint instanceof scope_Scope||"function"==typeof hint}(hint)||function hintIsScopeContext(hint){return Object.keys(hint).some((key=>captureContextKeys.includes(key)))}(hint)?{captureContext:hint}:hint}const captureContextKeys=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function captureException(exception,hint){return currentScopes_getCurrentScope().captureException(exception,parseEventHintOrCaptureContext(hint))}},"./node_modules/lexical/Lexical.prod.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$7:()=>U,$e:()=>u,AX:()=>m,Ac:()=>fs,B$:()=>Re,C:()=>qt,Ck:()=>ii,Cy:()=>Yi,Ey:()=>Ir,FE:()=>s,GM:()=>Ki,H2:()=>ki,HY:()=>z,I2:()=>ti,Iq:()=>Ze,JM:()=>p,Kf:()=>J,Kp:()=>Xi,LY:()=>Gt,MK:()=>Hr,Mv:()=>e,Ni:()=>pe,OX:()=>w,Pi:()=>P,Q$:()=>b,RT:()=>ni,S1:()=>yi,Sr:()=>F,Tg:()=>O,UD:()=>v,V3:()=>g,VS:()=>W,WK:()=>kr,WW:()=>K,Wg:()=>hs,Wu:()=>i,XK:()=>o,YW:()=>E,Z$:()=>Zt,ZK:()=>h,bM:()=>l,bS:()=>us,bb:()=>T,d:()=>gs,d8:()=>r,e1:()=>Ae,ev:()=>$r,fD:()=>os,fG:()=>Zi,fU:()=>I,ff:()=>Gi,gC:()=>C,gu:()=>t,h:()=>es,hV:()=>ns,hc:()=>ln,hi:()=>a,ie:()=>ps,if:()=>S,jG:()=>se,jZ:()=>as,kF:()=>Ur,lJ:()=>cs,mB:()=>d,n1:()=>me,nY:()=>cn,ns:()=>fe,oq:()=>n,pF:()=>V,pT:()=>tn,rU:()=>hi,ri:()=>L,sT:()=>Jr,sb:()=>un,sc:()=>te,si:()=>D,u5:()=>M,uT:()=>di,vJ:()=>pi,vi:()=>f,w:()=>c,w$:()=>N,wH:()=>Cr,xL:()=>he});var console=__webpack_require__("./node_modules/console-browserify/index.js");function t(t){return{}}const e={},n={},r={},i={},s={},o={},l={},c={},u={},a={},f={},d={},h={},g={},_={},p={},y={},m={},x={},v={},T={},S={},k={},C={},b={},N={},w={},E={},P={},D={},F={},I={},O={},L={},A={},M={},W={},z={},K={},J={},U={},V={},$={};var H=function(t){const e=new URLSearchParams;e.append("code",t);for(let t=1;t<arguments.length;t++)e.append("v",arguments[t]);throw Error(`Minified Lexical error #${t}; visit https://lexical.dev/docs/error?${e} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};const j="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,q=j&&"documentMode"in document?document.documentMode:null,Q=j&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),X=j&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Y=!(!j||!("InputEvent"in window)||q)&&"getTargetRanges"in new window.InputEvent("input"),Z=j&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),G=j&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,tt=j&&/Android/.test(navigator.userAgent),et=j&&/^(?=.*Chrome).*/i.test(navigator.userAgent),nt=j&&tt&&et,rt=j&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!et,lt=1,ct=2,ut=0,at=1,ft=2,_t=1,pt=2,yt=3,mt=4,xt=5,vt=6,Tt=Z||G||rt?" ":"​",St="\n\n",kt=X?" ":Tt,Ct="֑-߿יִ-﷽ﹰ-ﻼ",bt="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",Nt=new RegExp("^[^"+bt+"]*["+Ct+"]"),wt=new RegExp("^[^"+Ct+"]*["+bt+"]"),Et={bold:1,code:16,highlight:128,italic:2,strikethrough:4,subscript:32,superscript:64,underline:8},Pt={directionless:1,unmergeable:2},Dt={center:2,end:6,justify:4,left:1,right:3,start:5},Ft={[pt]:"center",[vt]:"end",[mt]:"justify",[_t]:"left",[yt]:"right",[xt]:"start"},It={normal:0,segmented:2,token:1},Ot={[ut]:"normal",[ft]:"segmented",[at]:"token"};function Lt(...t){const e=[];for(const n of t)if(n&&"string"==typeof n)for(const[t]of n.matchAll(/\S+/g))e.push(t);return e}let Mt=!1,Wt=0;function zt(t){Wt=t.timeStamp}function Bt(t,e,n){return e.__lexicalLineBreak===t||void 0!==t[`__lexicalKey_${n._key}`]}function Rt(t,e,n){const r=on(n._window);let i=null,s=null;null!==r&&r.anchorNode===t&&(i=r.anchorOffset,s=r.focusOffset);const o=t.nodeValue;null!==o&&Ne(e,o,i,s,!1)}function Kt(t,e,n){if(ti(t)){const e=t.anchor.getNode();if(e.is(n)&&t.format!==e.getFormat())return!1}return 3===e.nodeType&&n.isAttached()}function Jt(t,e,n){Mt=!0;const r=performance.now()-Wt>100;try{Qi(t,(()=>{const i=pi()||function(t){return t.getEditorState().read((()=>{const t=pi();return null!==t?t.clone():null}))}(t),s=new Map,o=t.getRootElement(),l=t._editorState,c=t._blockCursorElement;let u=!1,a="";for(let n=0;n<e.length;n++){const f=e[n],d=f.type,h=f.target;let g=he(h,l);if(!(null===g&&h!==o||Yi(g)))if("characterData"===d)r&&Ur(g)&&Kt(i,h,g)&&Rt(h,g,t);else if("childList"===d){u=!0;const e=f.addedNodes;for(let n=0;n<e.length;n++){const r=e[n],i=de(r),s=r.parentNode;if(null!=s&&r!==c&&null===i&&("BR"!==r.nodeName||!Bt(r,s,t))){if(X){const t=r.innerText||r.nodeValue;t&&(a+=t)}s.removeChild(r)}}const n=f.removedNodes,r=n.length;if(r>0){let e=0;for(let i=0;i<r;i++){const r=n[i];("BR"===r.nodeName&&Bt(r,h,t)||c===r)&&(h.appendChild(r),e++)}r!==e&&(h===o&&(g=ye(l)),s.set(h,g))}}}if(s.size>0)for(const[e,n]of s)if(Gi(n)){const r=n.getChildrenKeys();let i=e.firstChild;for(let n=0;n<r.length;n++){const s=r[n],o=t.getElementByKey(s);null!==o&&(null==i?(e.appendChild(o),i=o):i!==o&&e.replaceChild(o,i),i=i.nextSibling)}}else Ur(n)&&n.markDirty();const f=n.takeRecords();if(f.length>0){for(let e=0;e<f.length;e++){const n=f[e],r=n.addedNodes,i=n.target;for(let e=0;e<r.length;e++){const n=r[e],s=n.parentNode;null==s||"BR"!==n.nodeName||Bt(n,i,t)||s.removeChild(n)}}n.takeRecords()}null!==i&&(u&&(i.dirty=!0,me(i)),X&&Ke(t)&&i.insertRawText(a))}))}finally{Mt=!1}}function Ut(t){const e=t._observer;null!==e&&Jt(t,e.takeRecords(),e)}function Vt(t){!function(t){0===Wt&&Qe(t).addEventListener("textInput",zt,!0)}(t),t._observer=new MutationObserver(((e,n)=>{Jt(t,e,n)}))}function $t(t,e){const n=t.__mode,r=t.__format,i=t.__style,s=e.__mode,o=e.__format,l=e.__style;return!(null!==n&&n!==s||null!==r&&r!==o||null!==i&&i!==l)}function Ht(t,e){const n=t.mergeWithSibling(e),r=Wi()._normalizedNodes;return r.add(t.__key),r.add(e.__key),n}function jt(t){let e,n,r=t;if(""!==r.__text||!r.isSimpleText()||r.isUnmergeable()){for(;null!==(e=r.getPreviousSibling())&&Ur(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(""!==e.__text){if($t(e,r)){r=Ht(e,r);break}break}e.remove()}for(;null!==(n=r.getNextSibling())&&Ur(n)&&n.isSimpleText()&&!n.isUnmergeable();){if(""!==n.__text){if($t(r,n)){r=Ht(r,n);break}break}n.remove()}}else r.remove()}function qt(t){return Qt(t.anchor),Qt(t.focus),t}function Qt(t){for(;"element"===t.type;){const e=t.getNode(),n=t.offset;let r,i;if(n===e.getChildrenSize()?(r=e.getChildAtIndex(n-1),i=!0):(r=e.getChildAtIndex(n),i=!1),Ur(r)){t.set(r.__key,i?r.getTextContentSize():0,"text");break}if(!Gi(r))break;t.set(r.__key,i?r.getChildrenSize():0,"element")}}let Xt=1;const Yt="function"==typeof queueMicrotask?queueMicrotask:t=>{Promise.resolve().then(t)};function Zt(t){const e=document.activeElement;if(null===e)return!1;const n=e.nodeName;return Yi(he(t))&&("INPUT"===n||"TEXTAREA"===n||"true"===e.contentEditable&&null==e.__lexicalEditor)}function Gt(t,e,n){const r=t.getRootElement();try{return null!==r&&r.contains(e)&&r.contains(n)&&null!==e&&!Zt(e)&&te(e)===t}catch(t){return!1}}function te(t){let e=t;for(;null!=e;){const t=e.__lexicalEditor;if(null!=t)return t;e=$e(e)}return null}function ee(t){return t.isToken()||t.isSegmented()}function ne(t){return 3===t.nodeType}function re(t){let e=t;for(;null!=e;){if(ne(e))return e;e=e.firstChild}return null}function ie(t,e,n){const r=Et[e];if(null!==n&&(t&r)==(n&r))return t;let i=t^r;return"subscript"===e?i&=~Et.superscript:"superscript"===e&&(i&=~Et.subscript),i}function se(t){return Ur(t)||Cr(t)||Yi(t)}function oe(t,e){if(null!=e)return void(t.__key=e);Li(),Ai();const n=Wi(),r=Mi(),i=""+Xt++;r._nodeMap.set(i,t),Gi(t)?n._dirtyElements.set(i,!0):n._dirtyLeaves.add(i),n._cloneNotNeeded.add(i),n._dirtyType=lt,t.__key=i}function le(t){const e=t.getParent();if(null!==e){const n=t.getWritable(),r=e.getWritable(),i=t.getPreviousSibling(),s=t.getNextSibling();if(null===i)if(null!==s){const t=s.getWritable();r.__first=s.__key,t.__prev=null}else r.__first=null;else{const t=i.getWritable();if(null!==s){const e=s.getWritable();e.__prev=t.__key,t.__next=e.__key}else t.__next=null;n.__prev=null}if(null===s)if(null!==i){const t=i.getWritable();r.__last=i.__key,t.__next=null}else r.__last=null;else{const t=s.getWritable();if(null!==i){const e=i.getWritable();e.__next=t.__key,t.__prev=e.__key}else t.__prev=null;n.__next=null}r.__size--,n.__parent=null}}function ce(t){Ai();const e=t.getLatest(),n=e.__parent,r=Mi(),i=Wi(),s=r._nodeMap,o=i._dirtyElements;null!==n&&function(t,e,n){let r=t;for(;null!==r;){if(n.has(r))return;const t=e.get(r);if(void 0===t)break;n.set(r,!1),r=t.__parent}}(n,s,o);const l=e.__key;i._dirtyType=lt,Gi(t)?o.set(l,!0):i._dirtyLeaves.add(l)}function ue(t){Li();const e=Wi(),n=e._compositionKey;if(t!==n){if(e._compositionKey=t,null!==n){const t=fe(n);null!==t&&t.getWritable()}if(null!==t){const e=fe(t);null!==e&&e.getWritable()}}}function ae(){return Oi()?null:Wi()._compositionKey}function fe(t,e){const n=(e||Mi())._nodeMap.get(t);return void 0===n?null:n}function de(t,e){const n=t[`__lexicalKey_${Wi()._key}`];return void 0!==n?fe(n,e):null}function he(t,e){let n=t;for(;null!=n;){const t=de(n,e);if(null!==t)return t;n=$e(n)}return null}function ge(t){const e=t._decorators,n=Object.assign({},e);return t._pendingDecorators=n,n}function _e(t){return t.read((()=>pe().getTextContent()))}function pe(){return ye(Mi())}function ye(t){return t._nodeMap.get("root")}function me(t){Li();const e=Mi();null!==t&&(t.dirty=!0,t.setCachedNodes(null)),e._selection=t}function xe(t){const e=Wi(),n=function(t,e){let n=t;for(;null!=n;){const t=n[`__lexicalKey_${e._key}`];if(void 0!==t)return t;n=$e(n)}return null}(t,e);return null===n?t===e.getRootElement()?fe("root"):null:fe(n)}function ve(t,e){return e?t.getTextContentSize():0}function Te(t){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(t)}function Se(t){const e=[];let n=t;for(;null!==n;)e.push(n),n=n._parentEditor;return e}function ke(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Ce(t){return 3===t.nodeType?t.nodeValue:null}function be(t,e,n){const r=on(e._window);if(null===r)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(null!==i){let e=Ce(i);const r=he(i);if(null!==e&&Ur(r)){if(e===Tt&&n){const t=n.length;e=n,s=t,o=t}null!==e&&Ne(r,e,s,o,t)}}}function Ne(t,e,n,r,i){let s=t;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let l=e;(o||i)&&e[e.length-1]===Tt&&(l=e.slice(0,-1));const c=s.getTextContent();if(i||l!==c){if(""===l){if(ue(null),Z||G||rt)s.remove();else{const t=Wi();setTimeout((()=>{t.update((()=>{s.isAttached()&&s.remove()}))}),20)}return}const e=s.getParent(),i=yi(),c=s.getTextContentSize(),u=ae(),a=s.getKey();if(s.isToken()||null!==u&&a===u&&!o||ti(i)&&(null!==e&&!e.canInsertTextBefore()&&0===i.anchor.offset||i.anchor.key===t.__key&&0===i.anchor.offset&&!s.canInsertTextBefore()&&!o||i.focus.key===t.__key&&i.focus.offset===c&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const f=pi();if(!ti(f)||null===n||null===r)return void s.setTextContent(l);if(f.setTextNodeRange(s,n,s,r),s.isSegmented()){const t=Jr(s.getTextContent());s.replace(t),s=t}s.setTextContent(l)}}}function Ee(t){return 37===t}function Pe(t){return 39===t}function De(t,e){return Q?t:e}function Fe(t){return 13===t}function Ie(t){return 8===t}function Oe(t){return 46===t}function Le(t,e,n){return 65===t&&De(e,n)}function Ae(){const t=pe();me(qt(t.select(0,t.getChildrenSize())))}function Me(t,e){void 0===t.__lexicalClassNameCache&&(t.__lexicalClassNameCache={});const n=t.__lexicalClassNameCache,r=n[e];if(void 0!==r)return r;const i=t[e];if("string"==typeof i){const t=Lt(i);return n[e]=t,t}return i}function We(t,e,n,r,i){if(0===n.size)return;const s=r.__type,o=r.__key,l=e.get(s);void 0===l&&H(33,s);const c=l.klass;let u=t.get(c);void 0===u&&(u=new Map,t.set(c,u));const a=u.get(o),f="destroyed"===a&&"created"===i;(void 0===a||f)&&u.set(o,f?"updated":i)}function Be(t,e,n){const r=t.getParent();let i=n,s=t;return null!==r&&(e&&0===n?(i=s.getIndexWithinParent(),s=r):e||n!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function Re(t,e){const n=t.offset;if("element"===t.type)return Be(t.getNode(),e,n);{const r=t.getNode();if(e&&0===n||!e&&n===r.getTextContentSize()){const t=e?r.getPreviousSibling():r.getNextSibling();return null===t?Be(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):t}}return null}function Ke(t){const e=Qe(t).event,n=e&&e.inputType;return"insertFromPaste"===n||"insertFromPasteAsQuotation"===n}function Je(t,e,n){return Hi(t,e,n)}function Ue(t){return!ns(t)&&!t.isLastChild()&&!t.isInline()}function Ve(t,e){const n=t._keyToDOMMap.get(e);return void 0===n&&H(75,e),n}function $e(t){const e=t.assignedSlot||t.parentElement;return null!==e&&11===e.nodeType?e.host:e}function qe(t,e){let n=t.getParent();for(;null!==n;){if(n.is(e))return!0;n=n.getParent()}return!1}function Qe(t){const e=t._window;return null===e&&H(78),e}function Ze(t){return ns(t)||Gi(t)&&t.isShadowRoot()}function tn(t){const e=Wi(),n=t.constructor.getType(),r=e._nodes.get(n);void 0===r&&H(97);const i=r.replace;if(null!==i){const e=i(t);return e instanceof t.constructor||H(98),e}return t}function en(t,e){!ns(t.getParent())||Gi(e)||Yi(e)||H(99)}function nn(t){return(Yi(t)||Gi(t)&&!t.canBeEmpty())&&!t.isInline()}function rn(t,e,n){n.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=t.parentElement;null!==r&&r.removeChild(t)}function on(t){return j?(t||window).getSelection():null}function ln(t,e){let n=t.getChildAtIndex(e);null==n&&(n=t),Ze(t)&&H(102);const r=t=>{const e=t.getParentOrThrow(),i=Ze(e),s=t!==n||i?function Ge(t){const e=t.constructor.clone(t);return oe(e,null),e}(t):t;if(i)return Gi(t)&&Gi(s)||H(133),t.insertAfter(s),[t,s,s];{const[n,i,o]=r(e),l=t.getNextSiblings();return o.append(s,...l),[n,i,s]}},[i,s]=r(n);return[i,s]}function cn(t){return un(t)&&"A"===t.tagName}function un(t){return 1===t.nodeType}function an(t){if(Yi(t)&&!t.isInline())return!0;if(!Gi(t)||Ze(t))return!1;const e=t.getFirstChild(),n=null===e||Cr(e)||Ur(e)||e.isInline();return!t.isInline()&&!1!==t.canBeEmpty()&&n}function fn(t,e){let n=t;for(;null!==n&&null!==n.getParent()&&!e(n);)n=n.getParentOrThrow();return e(n)?n:null}function hn(t,e,n,r,i,s){let o=t.getFirstChild();for(;null!==o;){const t=o.__key;o.__parent===e&&(Gi(o)&&hn(o,t,n,r,i,s),n.has(t)||s.delete(t),i.push(t)),o=o.getNextSibling()}}let gn,_n,pn,yn,mn,xn,vn,Tn,Sn,kn,Cn="",bn="",Nn=null,wn="",En=!1,Pn=!1,Dn=null;function Fn(t,e){const n=vn.get(t);if(null!==e){const n=qn(t);n.parentNode===e&&e.removeChild(n)}if(Tn.has(t)||_n._keyToDOMMap.delete(t),Gi(n)){const t=Un(n,vn);In(t,0,t.length-1,null)}void 0!==n&&We(kn,pn,yn,n,"destroyed")}function In(t,e,n,r){let i=e;for(;i<=n;++i){const e=t[i];void 0!==e&&Fn(e,r)}}function On(t,e){t.setProperty("text-align",e)}const Ln="40px";function An(t,e){const n=gn.theme.indent;if("string"==typeof n){const r=t.classList.contains(n);e>0&&!r?t.classList.add(n):e<1&&r&&t.classList.remove(n)}const r=getComputedStyle(t).getPropertyValue("--lexical-indent-base-value")||Ln;t.style.setProperty("padding-inline-start",0===e?"":`calc(${e} * ${r})`)}function Mn(t,e){const n=t.style;0===e?On(n,""):1===e?On(n,"left"):2===e?On(n,"center"):3===e?On(n,"right"):4===e?On(n,"justify"):5===e?On(n,"start"):6===e&&On(n,"end")}function Wn(t,e,n){const r=Tn.get(t);void 0===r&&H(60);const i=r.createDOM(gn,_n);if(function(t,e,n){const r=n._keyToDOMMap;e["__lexicalKey_"+n._key]=t,r.set(t,e)}(t,i,_n),Ur(r)?i.setAttribute("data-lexical-text","true"):Yi(r)&&i.setAttribute("data-lexical-decorator","true"),Gi(r)){const t=r.__indent,e=r.__size;if(0!==t&&An(i,t),0!==e){const t=e-1;!function(t,e,n,r){const i=bn;bn="",zn(t,n,0,e,r,null),Kn(n,r),bn=i}(Un(r,Tn),t,r,i)}const n=r.__format;0!==n&&Mn(i,n),r.isInline()||Rn(null,r,i),Ue(r)&&(Cn+=St,wn+=St)}else{const e=r.getTextContent();if(Yi(r)){const e=r.decorate(_n,gn);null!==e&&$n(t,e),i.contentEditable="false"}else Ur(r)&&(r.isDirectionless()||(bn+=e));Cn+=e,wn+=e}if(null!==e)if(null!=n)e.insertBefore(i,n);else{const t=e.__lexicalLineBreak;null!=t?e.insertBefore(i,t):e.appendChild(i)}return We(kn,pn,yn,r,"created"),i}function zn(t,e,n,r,i,s){const o=Cn;Cn="";let l=n;for(;l<=r;++l){Wn(t[l],i,s);const e=Tn.get(t[l]);null!==e&&null===Nn&&Ur(e)&&(Nn=e.getFormat())}Ue(e)&&(Cn+=St),i.__lexicalTextContent=Cn,Cn=o+Cn}function Bn(t,e){const n=e.get(t);return Cr(n)||Yi(n)&&n.isInline()}function Rn(t,e,n){const r=null!==t&&(0===t.__size||Bn(t.__last,vn)),i=0===e.__size||Bn(e.__last,Tn);if(r){if(!i){const t=n.__lexicalLineBreak;null!=t&&n.removeChild(t),n.__lexicalLineBreak=null}}else if(i){const t=document.createElement("br");n.__lexicalLineBreak=t,n.appendChild(t)}}function Kn(t,e){const n=e.__lexicalDirTextContent,r=e.__lexicalDir;if(n!==bn||r!==Dn){const n=""===bn,s=n?Dn:(i=bn,Nt.test(i)?"rtl":wt.test(i)?"ltr":null);if(s!==r){const i=e.classList,o=gn.theme;let l=null!==r?o[r]:void 0,c=null!==s?o[s]:void 0;if(void 0!==l){if("string"==typeof l){const t=Lt(l);l=o[r]=t}i.remove(...l)}if(null===s||n&&"ltr"===s)e.removeAttribute("dir");else{if(void 0!==c){if("string"==typeof c){const t=Lt(c);c=o[s]=t}void 0!==c&&i.add(...c)}e.dir=s}Pn||(t.getWritable().__dir=s)}Dn=s,e.__lexicalDirTextContent=bn,e.__lexicalDir=s}var i}function Un(t,e){const n=[];let r=t.__first;for(;null!==r;){const t=e.get(r);void 0===t&&H(101),n.push(r),r=t.__next}return n}function Vn(t,e){const n=vn.get(t);let r=Tn.get(t);void 0!==n&&void 0!==r||H(61);const i=En||xn.has(t)||mn.has(t),s=Ve(_n,t);if(n===r&&!i){if(Gi(n)){const t=s.__lexicalTextContent;void 0!==t&&(Cn+=t,wn+=t);const e=s.__lexicalDirTextContent;void 0!==e&&(bn+=e)}else{const t=n.getTextContent();Ur(n)&&!n.isDirectionless()&&(bn+=t),wn+=t,Cn+=t}return s}if(n!==r&&i&&We(kn,pn,yn,r,"updated"),r.updateDOM(n,s,gn)){const n=Wn(t,null,null);return null===e&&H(62),e.replaceChild(n,s),Fn(t,null),n}if(Gi(n)&&Gi(r)){const t=r.__indent;t!==n.__indent&&An(s,t);const e=r.__format;e!==n.__format&&Mn(s,e),i&&(function Jn(t,e,n){const r=bn;var i;bn="",Nn=null,function(t,e,n){const r=Cn,i=t.__size,s=e.__size;if(Cn="",1===i&&1===s){const r=t.__first,i=e.__first;if(r===i)Vn(r,n);else{const t=qn(r),e=Wn(i,null,null);n.replaceChild(e,t),Fn(r,null)}const s=Tn.get(i);null===Nn&&Ur(s)&&(Nn=s.getFormat())}else{const r=Un(t,vn),o=Un(e,Tn);if(0===i)0!==s&&zn(o,e,0,s-1,n,null);else if(0===s){if(0!==i){const t=null==n.__lexicalLineBreak;In(r,0,i-1,t?null:n),t&&(n.textContent="")}}else!function(t,e,n,r,i,s){const o=r-1,l=i-1;let c,u,a=s.firstChild,f=0,d=0;for(;f<=o&&d<=l;){const t=e[f],r=n[d];if(t===r)a=Hn(Vn(r,s)),f++,d++;else{void 0===c&&(c=new Set(e)),void 0===u&&(u=new Set(n));const i=u.has(t),o=c.has(r);if(i)if(o){const t=Ve(_n,r);t===a?a=Hn(Vn(r,s)):(null!=a?s.insertBefore(t,a):s.appendChild(t),Vn(r,s)),f++,d++}else Wn(r,s,a),d++;else a=Hn(qn(t)),Fn(t,s),f++}const i=Tn.get(r);null!==i&&null===Nn&&Ur(i)&&(Nn=i.getFormat())}const g=f>o,_=d>l;if(g&&!_){const e=n[l+1];zn(n,t,d,l,s,void 0===e?null:_n.getElementByKey(e))}else _&&!g&&In(e,f,o,s)}(e,r,o,i,s,n)}Ue(e)&&(Cn+=St),n.__lexicalTextContent=Cn,Cn=r+Cn}(t,e,n),Kn(e,n),us(i=e)&&null!=Nn&&Nn!==i.__textFormat&&i.setTextFormat(Nn),bn=r,Nn=null}(n,r,s),ns(r)||r.isInline()||Rn(n,r,s)),Ue(r)&&(Cn+=St,wn+=St)}else{const e=r.getTextContent();if(Yi(r)){const e=r.decorate(_n,gn);null!==e&&$n(t,e)}else Ur(r)&&!r.isDirectionless()&&(bn+=e);Cn+=e,wn+=e}if(!Pn&&ns(r)&&r.__cachedText!==wn){const t=r.getWritable();t.__cachedText=wn,r=t}return s}function $n(t,e){let n=_n._pendingDecorators;const r=_n._decorators;if(null===n){if(r[t]===e)return;n=ge(_n)}n[t]=e}function Hn(t){let e=t.nextSibling;return null!==e&&e===_n._blockCursorElement&&(e=e.nextSibling),e}function qn(t){const e=Sn.get(t);return void 0===e&&H(75,t),e}const Qn=Object.freeze({}),Yn=[["keydown",function(t,e){if(Zn=t.timeStamp,Gn=t.keyCode,e.isComposing())return;const{keyCode:n,shiftKey:r,ctrlKey:o,metaKey:l,altKey:c}=t;Je(e,_,t)||(!function(t,e,n,r){return Pe(t)&&!e&&!r&&!n}(n,o,c,l)?!function(t,e,n,r,i){return Pe(t)&&!r&&!n&&(e||i)}(n,o,r,c,l)?!function(t,e,n,r){return Ee(t)&&!e&&!r&&!n}(n,o,c,l)?!function(t,e,n,r,i){return Ee(t)&&!r&&!n&&(e||i)}(n,o,r,c,l)?!function(t,e,n){return function(t){return 38===t}(t)&&!e&&!n}(n,o,l)?!function(t,e,n){return function(t){return 40===t}(t)&&!e&&!n}(n,o,l)?!function(t,e){return Fe(t)&&e}(n,r)?!function(t){return 32===t}(n)?!function(t,e){return Q&&e&&79===t}(n,o)?!function(t,e){return Fe(t)&&!e}(n,r)?!function(t,e,n,r){return Q?!e&&!n&&(Ie(t)||72===t&&r):!(r||e||n)&&Ie(t)}(n,c,l,o)?!function(t){return 27===t}(n)?!function(t,e,n,r,i){return Q?!(n||r||i)&&(Oe(t)||68===t&&e):!(e||r||i)&&Oe(t)}(n,o,r,c,l)?!function(t,e,n){return Ie(t)&&(Q?e:n)}(n,c,o)?!function(t,e,n){return Oe(t)&&(Q?e:n)}(n,c,o)?!function(t,e){return Q&&e&&Ie(t)}(n,l)?!function(t,e){return Q&&e&&Oe(t)}(n,l)?!function(t,e,n,r){return 66===t&&!e&&De(n,r)}(n,c,l,o)?!function(t,e,n,r){return 85===t&&!e&&De(n,r)}(n,c,l,o)?!function(t,e,n,r){return 73===t&&!e&&De(n,r)}(n,c,l,o)?!function(t,e,n,r){return 9===t&&!e&&!n&&!r}(n,c,o,l)?!function(t,e,n,r){return 90===t&&!e&&De(n,r)}(n,r,l,o)?!function(t,e,n,r){return Q?90===t&&n&&e:89===t&&r||90===t&&r&&e}(n,r,l,o)?ni(e._editorState._selection)?function(t,e,n,r){return!e&&67===t&&(Q?n:r)}(n,r,l,o)?(t.preventDefault(),Je(e,M,t)):function(t,e,n,r){return!e&&88===t&&(Q?n:r)}(n,r,l,o)?(t.preventDefault(),Je(e,W,t)):Le(n,l,o)&&(t.preventDefault(),Je(e,z,t)):!X&&Le(n,l,o)&&(t.preventDefault(),Je(e,z,t)):(t.preventDefault(),Je(e,g,void 0)):(t.preventDefault(),Je(e,h,void 0)):Je(e,w,t):(t.preventDefault(),Je(e,d,"italic")):(t.preventDefault(),Je(e,d,"underline")):(t.preventDefault(),Je(e,d,"bold")):(t.preventDefault(),Je(e,f,!1)):(t.preventDefault(),Je(e,f,!0)):(t.preventDefault(),Je(e,a,!1)):(t.preventDefault(),Je(e,a,!0)):Oe(n)?Je(e,N,t):(t.preventDefault(),Je(e,i,!1)):Je(e,b,t):Ie(n)?Je(e,C,t):(t.preventDefault(),Je(e,i,!0)):(sr=!1,Je(e,S,t)):(t.preventDefault(),sr=!0,Je(e,s,!0)):Je(e,k,t):(sr=!0,Je(e,S,t)):Je(e,T,t):Je(e,v,t):Je(e,x,t):Je(e,m,t):Je(e,y,t):Je(e,p,t),function(t,e,n,r){return t||e||n||r}(o,r,c,l)&&Je(e,$,t))}],["pointerdown",function(t,e){const n=t.target,r=t.pointerType;n instanceof Node&&"touch"!==r&&Qi(e,(()=>{Yi(he(n))||(ir=!0)}))}],["compositionstart",function(t,e){Qi(e,(()=>{const n=pi();if(ti(n)&&!e.isComposing()){const r=n.anchor,i=n.anchor.getNode();ue(r.key),(t.timeStamp<Zn+30||"element"===r.type||!n.isCollapsed()||i.getFormat()!==n.format||Ur(i)&&i.getStyle()!==n.style)&&Je(e,l,kt)}}))}],["compositionend",function(t,e){X?or=!0:Qi(e,(()=>{dr(e,t.data)}))}],["input",function(t,e){t.stopPropagation(),Qi(e,(()=>{const n=pi(),r=t.data,i=fr(t);if(null!=r&&ti(n)&&cr(n,i,r,t.timeStamp,!1)){or&&(dr(e,r),or=!1);const i=n.anchor,s=i.getNode(),o=on(e._window);if(null===o)return;const c=i.offset;Y&&!n.isCollapsed()&&Ur(s)&&null!==o.anchorNode&&s.getTextContent().slice(0,c)+r+s.getTextContent().slice(c+n.focus.offset)===Ce(o.anchorNode)||Je(e,l,r);const u=r.length;X&&u>1&&"insertCompositionText"===t.inputType&&!e.isComposing()&&(n.anchor.offset-=u),Z||G||rt||!e.isComposing()||(Zn=0,ue(null))}else be(!1,e,null!==r?r:void 0),or&&(dr(e,r||void 0),or=!1);Li(),Ut(Wi())})),er=null}],["click",function(t,e){Qi(e,(()=>{const n=pi(),i=on(e._window),s=yi();if(i)if(ti(n)){const e=n.anchor,r=e.getNode();"element"===e.type&&0===e.offset&&n.isCollapsed()&&!ns(r)&&1===pe().getChildrenSize()&&r.getTopLevelElementOrThrow().isEmpty()&&null!==s&&n.is(s)?(i.removeAllRanges(),n.dirty=!0):3!==t.detail||n.isCollapsed()||r!==n.focus.getNode()&&(Gi(r)?r.select(0):r.getParentOrThrow().select(0))}else if("touch"===t.pointerType){const n=i.anchorNode;if(null!==n){const r=n.nodeType;1!==r&&3!==r||me(_i(s,i,e,t))}}Je(e,r,t)}))}],["cut",Qn],["copy",Qn],["dragstart",Qn],["dragover",Qn],["dragend",Qn],["paste",Qn],["focus",Qn],["blur",Qn],["drop",Qn]];Y&&Yn.push(["beforeinput",(t,e)=>function(t,e){const n=t.inputType,r=fr(t);"deleteCompositionText"===n||X&&Ke(e)||"insertCompositionText"!==n&&Qi(e,(()=>{const _=pi();if("deleteContentBackward"===n){if(null===_){const t=yi();if(!ti(t))return;me(t.clone())}if(ti(_)){const n=_.anchor.key===_.focus.key;if(p=t.timeStamp,229===Gn&&p<Zn+30&&e.isComposing()&&n){if(ue(null),Zn=0,setTimeout((()=>{Qi(e,(()=>{ue(null)}))}),30),ti(_)){const t=_.anchor.getNode();t.markDirty(),_.format=t.getFormat(),Ur(t)||H(142),_.style=t.getStyle()}}else{ue(null),t.preventDefault();const r=_.anchor.getNode().getTextContent(),s=0===_.anchor.offset&&_.focus.offset===r.length;nt&&n&&!s||Je(e,i,!0)}return}}var p;if(!ti(_))return;const y=t.data;null!==er&&be(!1,e,er),_.dirty&&null===er||!_.isCollapsed()||ns(_.anchor.getNode())||null===r||_.applyDOMRange(r),er=null;const m=_.anchor,x=_.focus,v=m.getNode(),T=x.getNode();if("insertText"!==n&&"insertTranspose"!==n)switch(t.preventDefault(),n){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Je(e,l,t);break;case"insertFromComposition":ue(null),Je(e,l,t);break;case"insertLineBreak":ue(null),Je(e,s,!1);break;case"insertParagraph":ue(null),sr&&!G?(sr=!1,Je(e,s,!1)):Je(e,o,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Je(e,c,t);break;case"deleteByComposition":(function(t,e){return t!==e||Gi(t)||Gi(e)||!t.isToken()||!e.isToken()})(v,T)&&Je(e,u,t);break;case"deleteByDrag":case"deleteByCut":Je(e,u,t);break;case"deleteContent":Je(e,i,!1);break;case"deleteWordBackward":Je(e,a,!0);break;case"deleteWordForward":Je(e,a,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Je(e,f,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Je(e,f,!1);break;case"formatStrikeThrough":Je(e,d,"strikethrough");break;case"formatBold":Je(e,d,"bold");break;case"formatItalic":Je(e,d,"italic");break;case"formatUnderline":Je(e,d,"underline");break;case"historyUndo":Je(e,h,void 0);break;case"historyRedo":Je(e,g,void 0)}else{if("\n"===y)t.preventDefault(),Je(e,s,!1);else if(y===St)t.preventDefault(),Je(e,o,void 0);else if(null==y&&t.dataTransfer){const e=t.dataTransfer.getData("text/plain");t.preventDefault(),_.insertRawText(e)}else null!=y&&cr(_,r,y,t.timeStamp,!0)?(t.preventDefault(),Je(e,l,y)):er=y;tr=t.timeStamp}}))}(t,e)]);let Zn=0,Gn=0,tr=0,er=null;const nr=new WeakMap;let rr=!1,ir=!1,sr=!1,or=!1,lr=[0,"",0,"root",0];function cr(t,e,n,r,i){const s=t.anchor,o=t.focus,l=s.getNode(),c=Wi(),u=on(c._window),a=null!==u?u.anchorNode:null,f=s.key,d=c.getElementByKey(f),h=n.length;return f!==o.key||!Ur(l)||(!i&&(!Y||tr<r+50)||l.isDirty()&&h<2||Te(n))&&s.offset!==o.offset&&!l.isComposing()||ee(l)||l.isDirty()&&h>1||(i||!Y)&&null!==d&&!l.isComposing()&&a!==re(d)||null!==u&&null!==e&&(!e.collapsed||e.startContainer!==u.anchorNode||e.startOffset!==u.anchorOffset)||l.getFormat()!==t.format||l.getStyle()!==t.style||function we(t,e){if(e.isSegmented())return!0;if(!t.isCollapsed())return!1;const n=t.anchor.offset,r=e.getParentOrThrow(),i=e.isToken();return 0===n?!e.canInsertTextBefore()||!r.canInsertTextBefore()&&!e.isComposing()||i||function(t){const e=t.getPreviousSibling();return(Ur(e)||Gi(e)&&e.isInline())&&!e.canInsertTextAfter()}(e):n===e.getTextContentSize()&&(!e.canInsertTextAfter()||!r.canInsertTextAfter()&&!e.isComposing()||i)}(t,l)}function ur(t,e){return null!==t&&null!==t.nodeValue&&3===t.nodeType&&0!==e&&e!==t.nodeValue.length}function ar(t,n,r){const{anchorNode:i,anchorOffset:s,focusNode:o,focusOffset:l}=t;rr&&(rr=!1,ur(i,s)&&ur(o,l))||Qi(n,(()=>{if(!r)return void me(null);if(!Gt(n,i,o))return;const c=pi();if(ti(c)){const e=c.anchor,r=e.getNode();if(c.isCollapsed()){"Range"===t.type&&t.anchorNode===t.focusNode&&(c.dirty=!0);const i=Qe(n).event,s=i?i.timeStamp:performance.now(),[o,l,u,a,f]=lr,d=pe(),h=!1===n.isComposing()&&""===d.getTextContent();if(s<f+200&&e.offset===u&&e.key===a)c.format=o,c.style=l;else if("text"===e.type)Ur(r)||H(141),c.format=r.getFormat(),c.style=r.getStyle();else if("element"===e.type&&!h){const t=e.getNode();t instanceof os&&0===t.getChildrenSize()?c.format=t.getTextFormat():c.format=0,c.style=""}}else{const t=e.key,n=c.focus.key,r=c.getNodes(),i=r.length,o=c.isBackward(),u=o?l:s,a=o?s:l,f=o?n:t,d=o?t:n;let h=255,g=!1;for(let t=0;t<i;t++){const e=r[t],n=e.getTextContentSize();if(Ur(e)&&0!==n&&!(0===t&&e.__key===f&&u===n||t===i-1&&e.__key===d&&0===a)&&(g=!0,h&=e.getFormat(),0===h))break}c.format=g?h:0}}Je(n,e,void 0)}))}function fr(t){if(!t.getTargetRanges)return null;const e=t.getTargetRanges();return 0===e.length?null:e[0]}function dr(t,e){const n=t._compositionKey;if(ue(null),null!==n&&null!=e){if(""===e){const e=fe(n),r=re(t.getElementByKey(n));return void(null!==r&&null!==r.nodeValue&&Ur(e)&&Ne(e,r.nodeValue,null,null,!0))}if("\n"===e[e.length-1]){const e=pi();if(ti(e)){const n=e.focus;return e.anchor.set(n.key,n.offset,n.type),void Je(t,S,null)}}}be(!0,t,e)}function hr(t){let e=t.__lexicalEventHandles;return void 0===e&&(e=[],t.__lexicalEventHandles=e),e}const gr=new Map;function _r(t){const e=t.target,n=on(null==e?null:9===e.nodeType?e.defaultView:e.ownerDocument.defaultView);if(null===n)return;const r=te(n.anchorNode);if(null===r)return;ir&&(ir=!1,Qi(r,(()=>{const e=yi(),i=n.anchorNode;if(null===i)return;const s=i.nodeType;1!==s&&3!==s||me(_i(e,n,r,t))})));const i=Se(r),s=i[i.length-1],o=s._key,l=gr.get(o),c=l||s;c!==r&&ar(n,c,!1),ar(n,r,!0),r!==s?gr.set(o,r):l&&gr.delete(o)}function pr(t){t._lexicalHandled=!0}function yr(t){return!0===t._lexicalHandled}function xr(t,e,n){Li();const r=t.__key,i=t.getParent();if(null===i)return;const s=function(t){const e=pi();if(!ti(e)||!Gi(t))return e;const{anchor:n,focus:r}=e,i=n.getNode(),s=r.getNode();return qe(i,t)&&n.set(t.__key,0,"element"),qe(s,t)&&r.set(t.__key,0,"element"),e}(t);let o=!1;if(ti(s)&&e){const e=s.anchor,n=s.focus;e.key===r&&(vi(e,t,i,t.getPreviousSibling(),t.getNextSibling()),o=!0),n.key===r&&(vi(n,t,i,t.getPreviousSibling(),t.getNextSibling()),o=!0)}else ni(s)&&e&&t.isSelected()&&t.selectPrevious();if(ti(s)&&e&&!o){const e=t.getIndexWithinParent();le(t),mi(s,i,e,-1)}else le(t);n||Ze(i)||i.canBeEmpty()||!i.isEmpty()||xr(i,e),e&&ns(i)&&i.isEmpty()&&i.selectEnd()}class vr{static getType(){H(64,this.name)}static clone(t){H(65,this.name)}constructor(t){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,oe(this,t)}getType(){return this.__type}isInline(){H(137,this.constructor.name)}isAttached(){let t=this.__key;for(;null!==t;){if("root"===t)return!0;const e=fe(t);if(null===e)break;t=e.__parent}return!1}isSelected(t){const e=t||pi();if(null==e)return!1;const n=e.getNodes().some((t=>t.__key===this.__key));return(Ur(this)||!ti(e)||"element"!==e.anchor.type||"element"!==e.focus.type||e.anchor.key!==e.focus.key||e.anchor.offset!==e.focus.offset)&&n}getKey(){return this.__key}getIndexWithinParent(){const t=this.getParent();if(null===t)return-1;let e=t.getFirstChild(),n=0;for(;null!==e;){if(this.is(e))return n;n++,e=e.getNextSibling()}return-1}getParent(){const t=this.getLatest().__parent;return null===t?null:fe(t)}getParentOrThrow(){const t=this.getParent();return null===t&&H(66,this.__key),t}getTopLevelElement(){let t=this;for(;null!==t;){const e=t.getParent();if(Ze(e))return Gi(t)||H(138),t;t=e}return null}getTopLevelElementOrThrow(){const t=this.getTopLevelElement();return null===t&&H(67,this.__key),t}getParents(){const t=[];let e=this.getParent();for(;null!==e;)t.push(e),e=e.getParent();return t}getParentKeys(){const t=[];let e=this.getParent();for(;null!==e;)t.push(e.__key),e=e.getParent();return t}getPreviousSibling(){const t=this.getLatest().__prev;return null===t?null:fe(t)}getPreviousSiblings(){const t=[],e=this.getParent();if(null===e)return t;let n=e.getFirstChild();for(;null!==n&&!n.is(this);)t.push(n),n=n.getNextSibling();return t}getNextSibling(){const t=this.getLatest().__next;return null===t?null:fe(t)}getNextSiblings(){const t=[];let e=this.getNextSibling();for(;null!==e;)t.push(e),e=e.getNextSibling();return t}getCommonAncestor(t){const e=this.getParents(),n=t.getParents();Gi(this)&&e.unshift(this),Gi(t)&&n.unshift(t);const r=e.length,i=n.length;if(0===r||0===i||e[r-1]!==n[i-1])return null;const s=new Set(n);for(let t=0;t<r;t++){const n=e[t];if(s.has(n))return n}return null}is(t){return null!=t&&this.__key===t.__key}isBefore(t){if(this===t)return!1;if(t.isParentOf(this))return!0;if(this.isParentOf(t))return!1;const e=this.getCommonAncestor(t);let n=0,r=0,i=this;for(;;){const t=i.getParentOrThrow();if(t===e){n=i.getIndexWithinParent();break}i=t}for(i=t;;){const t=i.getParentOrThrow();if(t===e){r=i.getIndexWithinParent();break}i=t}return n<r}isParentOf(t){const e=this.__key;if(e===t.__key)return!1;let n=t;for(;null!==n;){if(n.__key===e)return!0;n=n.getParent()}return!1}getNodesBetween(t){const e=this.isBefore(t),n=[],r=new Set;let i=this;for(;null!==i;){const s=i.__key;if(r.has(s)||(r.add(s),n.push(i)),i===t)break;const o=Gi(i)?e?i.getFirstChild():i.getLastChild():null;if(null!==o){i=o;continue}const l=e?i.getNextSibling():i.getPreviousSibling();if(null!==l){i=l;continue}const c=i.getParentOrThrow();if(r.has(c.__key)||n.push(c),c===t)break;let u=null,a=c;do{if(null===a&&H(68),u=e?a.getNextSibling():a.getPreviousSibling(),a=a.getParent(),null===a)break;null!==u||r.has(a.__key)||n.push(a)}while(null===u);i=u}return e||n.reverse(),n}isDirty(){const t=Wi()._dirtyLeaves;return null!==t&&t.has(this.__key)}getLatest(){const t=fe(this.__key);return null===t&&H(113),t}getWritable(){Li();const t=Mi(),e=Wi(),n=t._nodeMap,r=this.__key,i=this.getLatest(),s=i.__parent,o=e._cloneNotNeeded,l=pi();if(null!==l&&l.setCachedNodes(null),o.has(r))return ce(i),i;const c=i.constructor.clone(i);return c.__parent=s,c.__next=i.__next,c.__prev=i.__prev,Gi(i)&&Gi(c)?(us(i)&&us(c)&&(c.__textFormat=i.__textFormat),c.__first=i.__first,c.__last=i.__last,c.__size=i.__size,c.__indent=i.__indent,c.__format=i.__format,c.__dir=i.__dir):Ur(i)&&Ur(c)&&(c.__format=i.__format,c.__style=i.__style,c.__mode=i.__mode,c.__detail=i.__detail),o.add(r),c.__key=r,ce(c),n.set(r,c),c}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(t,e){H(70)}updateDOM(t,e,n){H(71)}exportDOM(t){return{element:this.createDOM(t._config,t)}}exportJSON(){H(72)}static importJSON(t){H(18,this.name)}static transform(){return null}remove(t){xr(this,!0,t)}replace(t,e){Li();let n=pi();null!==n&&(n=n.clone()),en(this,t);const r=this.getLatest(),i=this.__key,s=t.__key,o=t.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;le(o);const u=r.getPreviousSibling(),a=r.getNextSibling(),f=r.__prev,d=r.__next,h=r.__parent;if(xr(r,!1,!0),null===u?l.__first=s:u.getWritable().__next=s,o.__prev=f,null===a?l.__last=s:a.getWritable().__prev=s,o.__next=d,o.__parent=h,l.__size=c,e&&(Gi(this)&&Gi(o)||H(139),this.getChildren().forEach((t=>{o.append(t)}))),ti(n)){me(n);const t=n.anchor,e=n.focus;t.key===i&&Xr(t,o),e.key===i&&Xr(e,o)}return ae()===i&&ue(s),o}insertAfter(t,e=!0){Li(),en(this,t);const n=this.getWritable(),r=t.getWritable(),i=r.getParent(),s=pi();let o=!1,l=!1;if(null!==i){const e=t.getIndexWithinParent();if(le(r),ti(s)){const t=i.__key,n=s.anchor,r=s.focus;o="element"===n.type&&n.key===t&&n.offset===e+1,l="element"===r.type&&r.key===t&&r.offset===e+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),a=r.__key,f=n.__next;if(null===c?u.__last=a:c.getWritable().__prev=a,u.__size++,n.__next=a,r.__next=f,r.__prev=n.__key,r.__parent=n.__parent,e&&ti(s)){const t=this.getIndexWithinParent();mi(s,u,t+1);const e=u.__key;o&&s.anchor.set(e,t+2,"element"),l&&s.focus.set(e,t+2,"element")}return t}insertBefore(t,e=!0){Li(),en(this,t);const n=this.getWritable(),r=t.getWritable(),i=r.__key;le(r);const s=this.getPreviousSibling(),o=this.getParentOrThrow().getWritable(),l=n.__prev,c=this.getIndexWithinParent();null===s?o.__first=i:s.getWritable().__next=i,o.__size++,n.__prev=i,r.__prev=l,r.__next=n.__key,r.__parent=n.__parent;const u=pi();return e&&ti(u)&&mi(u,this.getParentOrThrow(),c),t}isParentRequired(){return!1}createParentElementNode(){return cs()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(t,e){Li();const n=this.getPreviousSibling(),r=this.getParentOrThrow();if(null===n)return r.select(0,0);if(Gi(n))return n.select();if(!Ur(n)){const t=n.getIndexWithinParent()+1;return r.select(t,t)}return n.select(t,e)}selectNext(t,e){Li();const n=this.getNextSibling(),r=this.getParentOrThrow();if(null===n)return r.select();if(Gi(n))return n.select(0,0);if(!Ur(n)){const t=n.getIndexWithinParent();return r.select(t,t)}return n.select(t,e)}markDirty(){this.getWritable()}}class Tr extends vr{static getType(){return"linebreak"}static clone(t){return new Tr(t.__key)}constructor(t){super(t)}getTextContent(){return"\n"}createDOM(){return document.createElement("br")}updateDOM(){return!1}static importDOM(){return{br:t=>function(t){const e=t.parentElement;if(null!==e){const n=e.firstChild;if(n===t||n.nextSibling===t&&br(n)){const n=e.lastChild;if(n===t||n.previousSibling===t&&br(n))return!0}}return!1}(t)?null:{conversion:Sr,priority:0}}}static importJSON(t){return kr()}exportJSON(){return{type:"linebreak",version:1}}}function Sr(t){return{node:kr()}}function kr(){return tn(new Tr)}function Cr(t){return t instanceof Tr}function br(t){return 3===t.nodeType&&/^( |\t|\r?\n)+$/.test(t.textContent||"")}function Nr(t,e){return 16&e?"code":128&e?"mark":32&e?"sub":64&e?"sup":null}function wr(t,e){return 1&e?"strong":2&e?"em":"span"}function Er(t,e,n,r,i){const s=r.classList;let o=Me(i,"base");void 0!==o&&s.add(...o),o=Me(i,"underlineStrikethrough");let l=!1;const c=8&e&&4&e;void 0!==o&&(8&n&&4&n?(l=!0,c||s.add(...o)):c&&s.remove(...o));for(const t in Et){const r=Et[t];if(o=Me(i,t),void 0!==o)if(n&r){if(l&&("underline"===t||"strikethrough"===t)){e&r&&s.remove(...o);continue}e&r&&(!c||"underline"!==t)&&"strikethrough"!==t||s.add(...o)}else e&r&&s.remove(...o)}}function Pr(t,e,n){const r=e.firstChild,i=n.isComposing(),s=t+(i?Tt:"");if(null==r)e.textContent=s;else{const t=r.nodeValue;if(t!==s)if(i||X){const[e,n,i]=function(t,e){const n=t.length,r=e.length;let i=0,s=0;for(;i<n&&i<r&&t[i]===e[i];)i++;for(;s+i<n&&s+i<r&&t[n-s-1]===e[r-s-1];)s++;return[i,n-i-s,e.slice(i,r-s)]}(t,s);0!==n&&r.deleteData(e,n),r.insertData(e,i)}else r.nodeValue=s}}function Dr(t,e,n,r,i,s){Pr(i,t,e);const o=s.theme.text;void 0!==o&&Er(0,0,r,t,o)}function Fr(t,e){const n=document.createElement(e);return n.appendChild(t),n}class Ir extends vr{static getType(){return"text"}static clone(t){return new Ir(t.__text,t.__key)}constructor(t,e){super(e),this.__text=t,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const t=this.getLatest();return Ot[t.__mode]}getStyle(){return this.getLatest().__style}isToken(){return 1===this.getLatest().__mode}isComposing(){return this.__key===ae()}isSegmented(){return 2===this.getLatest().__mode}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(t){const e=Et[t];return!!(this.getFormat()&e)}isSimpleText(){return"text"===this.__type&&0===this.__mode}getTextContent(){return this.getLatest().__text}getFormatFlags(t,e){return ie(this.getLatest().__format,t,e)}canHaveFormat(){return!0}createDOM(t,e){const n=this.__format,r=Nr(0,n),i=wr(0,n),s=null===r?i:r,o=document.createElement(s);let l=o;this.hasFormat("code")&&o.setAttribute("spellcheck","false"),null!==r&&(l=document.createElement(i),o.appendChild(l)),Dr(l,this,0,n,this.__text,t);const c=this.__style;return""!==c&&(o.style.cssText=c),o}updateDOM(t,e,n){const r=this.__text,i=t.__format,s=this.__format,o=Nr(0,i),l=Nr(0,s),c=wr(0,i),u=wr(0,s);if((null===o?c:o)!==(null===l?u:l))return!0;if(o===l&&c!==u){const t=e.firstChild;null==t&&H(48);const i=document.createElement(u);return Dr(i,this,0,s,r,n),e.replaceChild(i,t),!1}let a=e;null!==l&&null!==o&&(a=e.firstChild,null==a&&H(49)),Pr(r,a,this);const f=n.theme.text;void 0!==f&&i!==s&&Er(0,i,s,a,f);const d=t.__style,h=this.__style;return d!==h&&(e.style.cssText=h),!1}static importDOM(){return{"#text":()=>({conversion:Wr,priority:0}),b:()=>({conversion:Lr,priority:0}),code:()=>({conversion:Kr,priority:0}),em:()=>({conversion:Kr,priority:0}),i:()=>({conversion:Kr,priority:0}),s:()=>({conversion:Kr,priority:0}),span:()=>({conversion:Or,priority:0}),strong:()=>({conversion:Kr,priority:0}),sub:()=>({conversion:Kr,priority:0}),sup:()=>({conversion:Kr,priority:0}),u:()=>({conversion:Kr,priority:0})}}static importJSON(t){const e=Jr(t.text);return e.setFormat(t.format),e.setDetail(t.detail),e.setMode(t.mode),e.setStyle(t.style),e}exportDOM(t){let{element:e}=super.exportDOM(t);return null!==e&&un(e)||H(132),e.style.whiteSpace="pre-wrap",this.hasFormat("bold")&&(e=Fr(e,"b")),this.hasFormat("italic")&&(e=Fr(e,"i")),this.hasFormat("strikethrough")&&(e=Fr(e,"s")),this.hasFormat("underline")&&(e=Fr(e,"u")),{element:e}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),type:"text",version:1}}selectionTransform(t,e){}setFormat(t){const e=this.getWritable();return e.__format="string"==typeof t?Et[t]:t,e}setDetail(t){const e=this.getWritable();return e.__detail="string"==typeof t?Pt[t]:t,e}setStyle(t){const e=this.getWritable();return e.__style=t,e}toggleFormat(t){const e=ie(this.getFormat(),t,null);return this.setFormat(e)}toggleDirectionless(){const t=this.getWritable();return t.__detail^=1,t}toggleUnmergeable(){const t=this.getWritable();return t.__detail^=2,t}setMode(t){const e=It[t];if(this.__mode===e)return this;const n=this.getWritable();return n.__mode=e,n}setTextContent(t){if(this.__text===t)return this;const e=this.getWritable();return e.__text=t,e}select(t,e){Li();let n=t,r=e;const i=pi(),s=this.getTextContent(),o=this.__key;if("string"==typeof s){const t=s.length;void 0===n&&(n=t),void 0===r&&(r=t)}else n=0,r=0;if(!ti(i))return fi(o,n,o,r,"text","text");{const t=ae();t!==i.anchor.key&&t!==i.focus.key||ue(o),i.setTextNodeRange(this,n,this,r)}return i}selectStart(){return this.select(0,0)}selectEnd(){const t=this.getTextContentSize();return this.select(t,t)}spliceText(t,e,n,r){const i=this.getWritable(),s=i.__text,o=n.length;let l=t;l<0&&(l=o+l,l<0&&(l=0));const c=pi();if(r&&ti(c)){const e=t+o;c.setTextNodeRange(i,e,i,e)}const u=s.slice(0,l)+n+s.slice(l+e);return i.__text=u,i}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...t){Li();const e=this.getLatest(),n=e.getTextContent(),r=e.__key,i=ae(),s=new Set(t),o=[],l=n.length;let c="";for(let t=0;t<l;t++)""!==c&&s.has(t)&&(o.push(c),c=""),c+=n[t];""!==c&&o.push(c);const u=o.length;if(0===u)return[];if(o[0]===n)return[e];const a=o[0],f=e.getParentOrThrow();let d;const h=e.getFormat(),g=e.getStyle(),_=e.__detail;let p=!1;e.isSegmented()?(d=Jr(a),d.__format=h,d.__style=g,d.__detail=_,p=!0):(d=e.getWritable(),d.__text=a);const y=pi(),m=[d];let x=a.length;for(let t=1;t<u;t++){const e=o[t],n=e.length,s=Jr(e).getWritable();s.__format=h,s.__style=g,s.__detail=_;const l=s.__key,c=x+n;if(ti(y)){const t=y.anchor,e=y.focus;t.key===r&&"text"===t.type&&t.offset>x&&t.offset<=c&&(t.key=l,t.offset-=x,y.dirty=!0),e.key===r&&"text"===e.type&&e.offset>x&&e.offset<=c&&(e.key=l,e.offset-=x,y.dirty=!0)}i===r&&ue(l),x=c,m.push(s)}!function(t){const e=t.getPreviousSibling(),n=t.getNextSibling();null!==e&&ce(e),null!==n&&ce(n)}(this);const v=f.getWritable(),T=this.getIndexWithinParent();return p?(v.splice(T,0,m),this.remove()):v.splice(T,1,m),ti(y)&&mi(y,f,T,u-1),m}mergeWithSibling(t){const e=t===this.getPreviousSibling();e||t===this.getNextSibling()||H(50);const n=this.__key,r=t.__key,i=this.__text,s=i.length;ae()===r&&ue(n);const o=pi();if(ti(o)){const i=o.anchor,l=o.focus;null!==i&&i.key===r&&(Ti(i,e,n,t,s),o.dirty=!0),null!==l&&l.key===r&&(Ti(l,e,n,t,s),o.dirty=!0)}const l=t.__text,c=e?l+i:i+l;this.setTextContent(c);const u=this.getWritable();return t.remove(),u}isTextEntity(){return!1}}function Or(t){const e=t.style,n=e.fontWeight,r="700"===n||"bold"===n,i="line-through"===e.textDecoration,s="italic"===e.fontStyle,o="underline"===e.textDecoration,l=e.verticalAlign;return{forChild:t=>Ur(t)?(r&&t.toggleFormat("bold"),i&&t.toggleFormat("strikethrough"),s&&t.toggleFormat("italic"),o&&t.toggleFormat("underline"),"sub"===l&&t.toggleFormat("subscript"),"super"===l&&t.toggleFormat("superscript"),t):t,node:null}}function Lr(t){const e="normal"===t.style.fontWeight;return{forChild:t=>(Ur(t)&&!e&&t.toggleFormat("bold"),t),node:null}}const Ar=new WeakMap;function Mr(t){return"PRE"===t.nodeName||1===t.nodeType&&void 0!==t.style&&void 0!==t.style.whiteSpace&&t.style.whiteSpace.startsWith("pre")}function Wr(t){const e=t;null===t.parentElement&&H(129);let n=e.textContent||"";if(null!==function(t){let e,n=t.parentNode;const r=[t];for(;null!==n&&void 0===(e=Ar.get(n))&&!Mr(n);)r.push(n),n=n.parentNode;const i=void 0===e?n:e;for(let t=0;t<r.length;t++)Ar.set(r[t],i);return i}(e)){const t=n.split(/(\r?\n|\t)/),e=[],r=t.length;for(let n=0;n<r;n++){const r=t[n];"\n"===r||"\r\n"===r?e.push(kr()):"\t"===r?e.push($r()):""!==r&&e.push(Jr(r))}return{node:e}}if(n=n.replace(/\r/g,"").replace(/[ \t\n]+/g," "),""===n)return{node:null};if(" "===n[0]){let t=e,r=!0;for(;null!==t&&null!==(t=Br(t,!1));){const e=t.textContent||"";if(e.length>0){/[ \t\n]$/.test(e)&&(n=n.slice(1)),r=!1;break}}r&&(n=n.slice(1))}if(" "===n[n.length-1]){let t=e,r=!0;for(;null!==t&&null!==(t=Br(t,!0));)if((t.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){r=!1;break}r&&(n=n.slice(0,n.length-1))}return""===n?{node:null}:{node:Jr(n)}}const zr=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/,"i");function Br(t,e){let n=t;for(;;){let t;for(;null===(t=e?n.nextSibling:n.previousSibling);){const t=n.parentElement;if(null===t)return null;n=t}if(n=t,1===n.nodeType){const t=n.style.display;if(""===t&&null===n.nodeName.match(zr)||""!==t&&!t.startsWith("inline"))return null}let r=n;for(;null!==(r=e?n.firstChild:n.lastChild);)n=r;if(3===n.nodeType)return n;if("BR"===n.nodeName)return null}}const Rr={code:"code",em:"italic",i:"italic",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function Kr(t){const e=Rr[t.nodeName.toLowerCase()];return void 0===e?{node:null}:{forChild:t=>(Ur(t)&&!t.hasFormat(e)&&t.toggleFormat(e),t),node:null}}function Jr(t=""){return tn(new Ir(t))}function Ur(t){return t instanceof Ir}class Vr extends Ir{static getType(){return"tab"}static clone(t){const e=new Vr(t.__key);return e.__text=t.__text,e.__format=t.__format,e.__style=t.__style,e}constructor(t){super("\t",t),this.__detail=2}static importDOM(){return null}static importJSON(t){const e=$r();return e.setFormat(t.format),e.setStyle(t.style),e}exportJSON(){return{...super.exportJSON(),type:"tab",version:1}}setTextContent(t){H(126)}setDetail(t){H(127)}setMode(t){H(128)}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function $r(){return tn(new Vr)}function Hr(t){return t instanceof Vr}class jr{constructor(t,e,n){this._selection=null,this.key=t,this.offset=e,this.type=n}is(t){return this.key===t.key&&this.offset===t.offset&&this.type===t.type}isBefore(t){let e=this.getNode(),n=t.getNode();const r=this.offset,i=t.offset;if(Gi(e)){const t=e.getDescendantByIndex(r);e=null!=t?t:e}if(Gi(n)){const t=n.getDescendantByIndex(i);n=null!=t?t:n}return e===n?r<i:e.isBefore(n)}getNode(){const t=fe(this.key);return null===t&&H(20),t}set(t,e,n){const r=this._selection,i=this.key;this.key=t,this.offset=e,this.type=n,Oi()||(ae()===i&&ue(t),null!==r&&(r.setCachedNodes(null),r.dirty=!0))}}function qr(t,e,n){return new jr(t,e,n)}function Qr(t,e){let n=e.__key,r=t.offset,i="element";if(Ur(e)){i="text";const t=e.getTextContentSize();r>t&&(r=t)}else if(!Gi(e)){const t=e.getNextSibling();if(Ur(t))n=t.__key,r=0,i="text";else{const t=e.getParent();t&&(n=t.__key,r=e.getIndexWithinParent()+1)}}t.set(n,r,i)}function Xr(t,e){if(Gi(e)){const n=e.getLastDescendant();Gi(n)||Ur(n)?Qr(t,n):Qr(t,e)}else Qr(t,e)}function Yr(t,e,n,r){const i=t.getNode(),s=i.getChildAtIndex(t.offset),o=Jr(),l=ns(i)?cs().append(o):o;o.setFormat(n),o.setStyle(r),null===s?i.append(l):s.insertBefore(l),t.is(e)&&e.set(o.__key,0,"text"),t.set(o.__key,0,"text")}function Zr(t,e,n,r){t.key=e,t.offset=n,t.type=r}class Gr{constructor(t){this._cachedNodes=null,this._nodes=t,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(t){this._cachedNodes=t}is(t){if(!ni(t))return!1;const e=this._nodes,n=t._nodes;return e.size===n.size&&Array.from(e).every((t=>n.has(t)))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(t){this.dirty=!0,this._nodes.add(t),this._cachedNodes=null}delete(t){this.dirty=!0,this._nodes.delete(t),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(t){return this._nodes.has(t)}clone(){return new Gr(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(t){}insertText(){}insertNodes(t){const e=this.getNodes(),n=e.length,r=e[n-1];let i;if(Ur(r))i=r.select();else{const t=r.getIndexWithinParent()+1;i=r.getParentOrThrow().select(t,t)}i.insertNodes(t);for(let t=0;t<n;t++)e[t].remove()}getNodes(){const t=this._cachedNodes;if(null!==t)return t;const e=this._nodes,n=[];for(const t of e){const e=fe(t);null!==e&&n.push(e)}return Oi()||(this._cachedNodes=n),n}getTextContent(){const t=this.getNodes();let e="";for(let n=0;n<t.length;n++)e+=t[n].getTextContent();return e}}function ti(t){return t instanceof ei}class ei{constructor(t,e,n,r){this.anchor=t,this.focus=e,t._selection=this,e._selection=this,this._cachedNodes=null,this.format=n,this.style=r,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(t){this._cachedNodes=t}is(t){return!!ti(t)&&this.anchor.is(t.anchor)&&this.focus.is(t.focus)&&this.format===t.format&&this.style===t.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const t=this._cachedNodes;if(null!==t)return t;const e=this.anchor,n=this.focus,r=e.isBefore(n),i=r?e:n,s=r?n:e;let o=i.getNode(),l=s.getNode();const c=i.offset,u=s.offset;if(Gi(o)){const t=o.getDescendantByIndex(c);o=null!=t?t:o}if(Gi(l)){let t=l.getDescendantByIndex(u);null!==t&&t!==o&&l.getChildAtIndex(u)===t&&(t=t.getPreviousSibling()),l=null!=t?t:l}let a;return a=o.is(l)?Gi(o)&&o.getChildrenSize()>0?[]:[o]:o.getNodesBetween(l),Oi()||(this._cachedNodes=a),a}setTextNodeRange(t,e,n,r){Zr(this.anchor,t.__key,e,"text"),Zr(this.focus,n.__key,r,"text"),this._cachedNodes=null,this.dirty=!0}getTextContent(){const t=this.getNodes();if(0===t.length)return"";const e=t[0],n=t[t.length-1],r=this.anchor,i=this.focus,s=r.isBefore(i),[o,l]=ii(this);let c="",u=!0;for(let a=0;a<t.length;a++){const f=t[a];if(Gi(f)&&!f.isInline())u||(c+="\n"),u=!f.isEmpty();else if(u=!1,Ur(f)){let t=f.getTextContent();f===e?f===n?"element"===r.type&&"element"===i.type&&i.offset!==r.offset||(t=o<l?t.slice(o,l):t.slice(l,o)):t=s?t.slice(o):t.slice(l):f===n&&(t=s?t.slice(0,l):t.slice(0,o)),c+=t}else!Yi(f)&&!Cr(f)||f===n&&this.isCollapsed()||(c+=f.getTextContent())}return c}applyDOMRange(t){const e=Wi(),n=e.getEditorState()._selection,r=ui(t.startContainer,t.startOffset,t.endContainer,t.endOffset,e,n);if(null===r)return;const[i,s]=r;Zr(this.anchor,i.key,i.offset,i.type),Zr(this.focus,s.key,s.offset,s.type),this._cachedNodes=null}clone(){const t=this.anchor,e=this.focus;return new ei(qr(t.key,t.offset,t.type),qr(e.key,e.offset,e.type),this.format,this.style)}toggleFormat(t){this.format=ie(this.format,t,null),this.dirty=!0}setStyle(t){this.style=t,this.dirty=!0}hasFormat(t){const e=Et[t];return!!(this.format&e)}insertRawText(t){const e=t.split(/(\r?\n|\t)/),n=[],r=e.length;for(let t=0;t<r;t++){const r=e[t];"\n"===r||"\r\n"===r?n.push(kr()):"\t"===r?n.push($r()):n.push(Jr(r))}this.insertNodes(n)}insertText(t){const e=this.anchor,n=this.focus,r=this.isCollapsed()||e.isBefore(n),i=this.format,s=this.style;r&&"element"===e.type?Yr(e,n,i,s):r||"element"!==n.type||Yr(n,e,i,s);const o=this.getNodes(),l=o.length,c=r?n:e,u=(r?e:n).offset,a=c.offset;let f=o[0];Ur(f)||H(26);const d=f.getTextContent().length,h=f.getParentOrThrow();let g=o[l-1];if(this.isCollapsed()&&u===d&&(f.isSegmented()||f.isToken()||!f.canInsertTextAfter()||!h.canInsertTextAfter()&&null===f.getNextSibling())){let e=f.getNextSibling();if(Ur(e)&&e.canInsertTextBefore()&&!ee(e)||(e=Jr(),e.setFormat(i),h.canInsertTextAfter()?f.insertAfter(e):h.insertAfter(e)),e.select(0,0),f=e,""!==t)return void this.insertText(t)}else if(this.isCollapsed()&&0===u&&(f.isSegmented()||f.isToken()||!f.canInsertTextBefore()||!h.canInsertTextBefore()&&null===f.getPreviousSibling())){let e=f.getPreviousSibling();if(Ur(e)&&!ee(e)||(e=Jr(),e.setFormat(i),h.canInsertTextBefore()?f.insertBefore(e):h.insertBefore(e)),e.select(),f=e,""!==t)return void this.insertText(t)}else if(f.isSegmented()&&u!==d){const t=Jr(f.getTextContent());t.setFormat(i),f.replace(t),f=t}else if(!this.isCollapsed()&&""!==t){const e=g.getParent();if(!h.canInsertTextBefore()||!h.canInsertTextAfter()||Gi(e)&&(!e.canInsertTextBefore()||!e.canInsertTextAfter()))return this.insertText(""),ci(this.anchor,this.focus,null),void this.insertText(t)}if(1===l){if(f.isToken()){const e=Jr(t);return e.select(),void f.replace(e)}const e=f.getFormat(),n=f.getStyle();if(u!==a||e===i&&n===s){if(Hr(f)){const e=Jr(t);return e.setFormat(i),e.setStyle(s),e.select(),void f.replace(e)}}else{if(""!==f.getTextContent()){const e=Jr(t);if(e.setFormat(i),e.setStyle(s),e.select(),0===u)f.insertBefore(e,!1);else{const[t]=f.splitText(u);t.insertAfter(e,!1)}return void(e.isComposing()&&"text"===this.anchor.type&&(this.anchor.offset-=t.length))}f.setFormat(i),f.setStyle(s)}const r=a-u;f=f.spliceText(u,r,t,!0),""===f.getTextContent()?f.remove():"text"===this.anchor.type&&(f.isComposing()?this.anchor.offset-=t.length:(this.format=e,this.style=n))}else{const e=new Set([...f.getParentKeys(),...g.getParentKeys()]),n=Gi(f)?f:f.getParentOrThrow();let r=Gi(g)?g:g.getParentOrThrow(),i=g;if(!n.is(r)&&r.isInline())do{i=r,r=r.getParentOrThrow()}while(r.isInline());if("text"===c.type&&(0!==a||""===g.getTextContent())||"element"===c.type&&g.getIndexWithinParent()<a)if(Ur(g)&&!g.isToken()&&a!==g.getTextContentSize()){if(g.isSegmented()){const t=Jr(g.getTextContent());g.replace(t),g=t}ns(c.getNode())||"text"!==c.type||(g=g.spliceText(0,a,"")),e.add(g.__key)}else{const t=g.getParentOrThrow();t.canBeEmpty()||1!==t.getChildrenSize()?g.remove():t.remove()}else e.add(g.__key);const s=r.getChildren(),h=new Set(o),_=n.is(r),p=n.isInline()&&null===f.getNextSibling()?n:f;for(let t=s.length-1;t>=0;t--){const e=s[t];if(e.is(f)||Gi(e)&&e.isParentOf(f))break;e.isAttached()&&(!h.has(e)||e.is(i)?_||p.insertAfter(e,!1):e.remove())}if(!_){let t=r,n=null;for(;null!==t;){const r=t.getChildren(),i=r.length;(0===i||r[i-1].is(n))&&(e.delete(t.__key),n=t),t=t.getParent()}}if(f.isToken())if(u===d)f.select();else{const e=Jr(t);e.select(),f.replace(e)}else f=f.spliceText(u,d-u,t,!0),""===f.getTextContent()?f.remove():f.isComposing()&&"text"===this.anchor.type&&(this.anchor.offset-=t.length);for(let t=1;t<l;t++){const n=o[t],r=n.__key;e.has(r)||n.remove()}}}removeText(){this.insertText("")}formatText(t){if(this.isCollapsed())return this.toggleFormat(t),void ue(null);const e=this.getNodes(),n=[];for(const t of e)Ur(t)&&n.push(t);const r=n.length;if(0===r)return this.toggleFormat(t),void ue(null);const i=this.anchor,s=this.focus,o=this.isBackward(),l=o?s:i,c=o?i:s;let u=0,a=n[0],f="element"===l.type?0:l.offset;if("text"===l.type&&f===a.getTextContentSize()&&(u=1,a=n[1],f=0),null==a)return;const d=a.getFormatFlags(t,null),h=r-1;let g=n[h];const _="text"===c.type?c.offset:g.getTextContentSize();if(a.is(g)){if(f===_)return;if(0===f&&_===a.getTextContentSize())a.setFormat(d);else{const t=a.splitText(f,_),e=0===f?t[0]:t[1];e.setFormat(d),"text"===l.type&&l.set(e.__key,0,"text"),"text"===c.type&&c.set(e.__key,_-f,"text")}return void(this.format=d)}0!==f&&([,a]=a.splitText(f),f=0),a.setFormat(d);const p=g.getFormatFlags(t,d);_>0&&(_!==g.getTextContentSize()&&([g]=g.splitText(_)),g.setFormat(p));for(let e=u+1;e<h;e++){const r=n[e];if(!r.isToken()){const e=r.getFormatFlags(t,p);r.setFormat(e)}}"text"===l.type&&l.set(a.__key,f,"text"),"text"===c.type&&c.set(g.__key,_,"text"),this.format=d|p}insertNodes(t){if(0===t.length)return;if("root"===this.anchor.key){this.insertParagraph();const e=pi();return ti(e)||H(134),e.insertNodes(t)}const e=fn((this.isBackward()?this.focus:this.anchor).getNode(),an),n=t[t.length-1];if("__language"in e&&Gi(e)){if("__language"in t[0])this.insertText(t[0].getTextContent());else{const r=bi(this);e.splice(r,0,t),n.selectEnd()}return}if(!t.some((t=>(Gi(t)||Yi(t))&&!t.isInline()))){Gi(e)||H(135);const r=bi(this);return e.splice(r,0,t),void n.selectEnd()}const r=function(t){const e=cs();let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=Cr(i);if(s||Yi(i)&&i.isInline()||Gi(i)&&i.isInline()||Ur(i)||i.isParentRequired()){if(null===n&&(n=i.createParentElementNode(),e.append(n),s))continue;null!==n&&n.append(i)}else e.append(i),n=null}return e}(t),i=r.getLastDescendant(),s=r.getChildren(),o=t=>"__value"in t&&"__checked"in t,l=Gi(e)&&e.isEmpty()?null:this.insertParagraph(),c=s[s.length-1];let u=s[0];var a;Gi(a=u)&&an(a)&&!a.isEmpty()&&Gi(e)&&(!e.isEmpty()||o(e))&&(Gi(e)||H(135),e.append(...u.getChildren()),u=s[1]),u&&function(t,e){const r=e.getParentOrThrow().getLastChild();let i=e;const s=[e];for(;i!==r;)i.getNextSibling()||H(140),i=i.getNextSibling(),s.push(i);let o=t;for(const t of s)o=o.insertAfter(t)}(e,u);const f=fn(i,an);l&&Gi(f)&&(o(l)||an(c))&&(f.append(...l.getChildren()),l.remove()),Gi(e)&&e.isEmpty()&&e.remove(),i.selectEnd();const d=Gi(e)?e.getLastChild():null;Cr(d)&&f!==e&&d.remove()}insertParagraph(){if("root"===this.anchor.key){const t=cs();return pe().splice(this.anchor.offset,0,[t]),t.select(),t}const t=bi(this),e=fn(this.anchor.getNode(),an);Gi(e)||H(136);const n=e.getChildAtIndex(t),r=n?[n,...n.getNextSiblings()]:[],i=e.insertNewAfter(this,!1);return i?(i.append(...r),i.selectStart(),i):null}insertLineBreak(t){const e=kr();if(this.insertNodes([e]),t){const t=e.getParentOrThrow(),n=e.getIndexWithinParent();t.select(n,n)}}extract(){const t=this.getNodes(),e=t.length,n=e-1,r=this.anchor,i=this.focus;let s=t[0],o=t[n];const[l,c]=ii(this);if(0===e)return[];if(1===e){if(Ur(s)&&!this.isCollapsed()){const t=l>c?c:l,e=l>c?l:c,n=s.splitText(t,e),r=0===t?n[0]:n[1];return null!=r?[r]:[]}return[s]}const u=r.isBefore(i);if(Ur(s)){const e=u?l:c;e===s.getTextContentSize()?t.shift():0!==e&&([,s]=s.splitText(e),t[0]=s)}if(Ur(o)){const e=o.getTextContent().length,r=u?c:l;0===r?t.pop():r!==e&&([o]=o.splitText(r),t[n]=o)}return t}modify(t,e,n){const r=this.focus,i=this.anchor,s="move"===t,o=Re(r,e);if(Yi(o)&&!o.isIsolated()){if(s&&o.isKeyboardSelectable()){const t=hi();return t.add(o.__key),void me(t)}const t=e?o.getPreviousSibling():o.getNextSibling();if(Ur(t)){const n=t.__key,o=e?t.getTextContent().length:0;return r.set(n,o,"text"),void(s&&i.set(n,o,"text"))}{const n=o.getParentOrThrow();let l,c;return Gi(t)?(c=t.__key,l=e?t.getChildrenSize():0):(l=o.getIndexWithinParent(),c=n.__key,e||l++),r.set(c,l,"element"),void(s&&i.set(c,l,"element"))}}const l=Wi(),c=on(l._window);if(!c)return;const u=l._blockCursorElement,a=l._rootElement;if(null===a||null===u||!Gi(o)||o.isInline()||o.canBeEmpty()||rn(u,l,a),function(t,e,n,r){t.modify(e,n,r)}(c,t,e?"backward":"forward",n),c.rangeCount>0){const t=c.getRangeAt(0),n=this.anchor.getNode(),r=ns(n)?n:function Ye(t){let e=t.getParentOrThrow();for(;null!==e;){if(Ze(e))return e;e=e.getParentOrThrow()}return e}(n);if(this.applyDOMRange(t),this.dirty=!0,!s){const n=this.getNodes(),i=[];let s=!1;for(let t=0;t<n.length;t++){const e=n[t];qe(e,r)?i.push(e):s=!0}if(s&&i.length>0)if(e){const t=i[0];Gi(t)?t.selectStart():t.getParentOrThrow().selectStart()}else{const t=i[i.length-1];Gi(t)?t.selectEnd():t.getParentOrThrow().selectEnd()}c.anchorNode===t.startContainer&&c.anchorOffset===t.startOffset||function(t){const e=t.focus,n=t.anchor,r=n.key,i=n.offset,s=n.type;Zr(n,e.key,e.offset,e.type),Zr(e,r,i,s),t._cachedNodes=null}(this)}}}forwardDeletion(t,e,n){if(!n&&("element"===t.type&&Gi(e)&&t.offset===e.getChildrenSize()||"text"===t.type&&t.offset===e.getTextContentSize())){const t=e.getParent(),n=e.getNextSibling()||(null===t?null:t.getNextSibling());if(Gi(n)&&n.isShadowRoot())return!0}return!1}deleteCharacter(t){const n=this.isCollapsed();if(this.isCollapsed()){const n=this.anchor;let r=n.getNode();if(this.forwardDeletion(n,r,t))return;const i=this.focus,s=Re(i,t);if(Yi(s)&&!s.isIsolated()){if(s.isKeyboardSelectable()&&Gi(r)&&0===r.getChildrenSize()){r.remove();const t=hi();t.add(s.__key),me(t)}else s.remove(),Wi().dispatchCommand(e,void 0);return}if(!t&&Gi(s)&&Gi(r)&&r.isEmpty())return r.remove(),void s.selectStart();if(this.modify("extend",t,"character"),this.isCollapsed()){if(t&&0===n.offset&&("element"===n.type?n.getNode():n.getNode().getParentOrThrow()).collapseAtStart(this))return}else{const e="text"===i.type?i.getNode():null;if(r="text"===n.type?n.getNode():null,null!==e&&e.isSegmented()){const n=i.offset,s=e.getTextContentSize();if(e.is(r)||t&&n!==s||!t&&0!==n)return void si(e,t,n)}else if(null!==r&&r.isSegmented()){const i=n.offset,s=r.getTextContentSize();if(r.is(e)||t&&0!==i||!t&&i!==s)return void si(r,t,i)}!function(t,e){const n=t.anchor,r=t.focus,i=n.getNode();if(i===r.getNode()&&"text"===n.type&&"text"===r.type){const t=n.offset,s=r.offset,o=t<s,l=o?t:s,c=o?s:t,u=c-1;l!==u&&(Te(i.getTextContent().slice(l,c))||(e?r.offset=u:n.offset=u))}}(this,t)}}if(this.removeText(),t&&!n&&this.isCollapsed()&&"element"===this.anchor.type&&0===this.anchor.offset){const t=this.anchor.getNode();t.isEmpty()&&ns(t.getParent())&&0===t.getIndexWithinParent()&&t.collapseAtStart(this)}}deleteLine(t){this.isCollapsed()&&("text"===this.anchor.type&&this.modify("extend",t,"lineboundary"),0===(t?this.focus:this.anchor).offset&&this.modify("extend",t,"character")),this.removeText()}deleteWord(t){if(this.isCollapsed()){const e=this.anchor,n=e.getNode();if(this.forwardDeletion(e,n,t))return;this.modify("extend",t,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function ni(t){return t instanceof Gr}function ri(t){const e=t.offset;if("text"===t.type)return e;const n=t.getNode();return e===n.getChildrenSize()?n.getTextContent().length:0}function ii(t){const e=t.getStartEndPoints();if(null===e)return[0,0];const[n,r]=e;return"element"===n.type&&"element"===r.type&&n.key===r.key&&n.offset===r.offset?[0,0]:[ri(n),ri(r)]}function si(t,e,n){const r=t,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,l=0;for(let t=0;t<s;t++){const r=t===s-1;if(l=o,o+=i[t].length,e&&o===n||o>n||r){i.splice(t,1),r&&(l=void 0);break}}const c=i.join("").trim();""===c?r.remove():(r.setTextContent(c),r.select(l,l))}function oi(t,e,n,r){let i,s=e;if(1===t.nodeType){let o=!1;const l=t.childNodes,c=l.length;s===c&&(o=!0,s=c-1);let u=l[s],a=!1;if(u===r._blockCursorElement?(u=l[s+1],a=!0):null!==r._blockCursorElement&&s--,i=xe(u),Ur(i))s=ve(i,o);else{let r=xe(t);if(null===r)return null;if(Gi(r)){s=Math.min(r.getChildrenSize(),s);let t=r.getChildAtIndex(s);if(Gi(t)&&function(t,e,n){const r=t.getParent();return null===n||null===r||!r.canBeEmpty()||r!==n.getNode()}(t,0,n)){const e=o?t.getLastDescendant():t.getFirstDescendant();null===e?(r=t,s=0):(t=e,r=Gi(t)?t:t.getParentOrThrow())}Ur(t)?(i=t,r=null,s=ve(t,o)):t!==r&&o&&!a&&s++}else{const n=r.getIndexWithinParent();s=0===e&&Yi(r)&&xe(t)===r?n:n+1,r=r.getParentOrThrow()}if(Gi(r))return qr(r.__key,s,"element")}}else i=xe(t);return Ur(i)?qr(i.__key,s,"text"):null}function li(t,e,n){const r=t.offset,i=t.getNode();if(0===r){const r=i.getPreviousSibling(),s=i.getParent();if(e){if((n||!e)&&null===r&&Gi(s)&&s.isInline()){const e=s.getPreviousSibling();Ur(e)&&(t.key=e.__key,t.offset=e.getTextContent().length)}}else Gi(r)&&!n&&r.isInline()?(t.key=r.__key,t.offset=r.getChildrenSize(),t.type="element"):Ur(r)&&(t.key=r.__key,t.offset=r.getTextContent().length)}else if(r===i.getTextContent().length){const r=i.getNextSibling(),s=i.getParent();if(e&&Gi(r)&&r.isInline())t.key=r.__key,t.offset=0,t.type="element";else if((n||e)&&null===r&&Gi(s)&&s.isInline()&&!s.canInsertTextAfter()){const e=s.getNextSibling();Ur(e)&&(t.key=e.__key,t.offset=0)}}}function ci(t,e,n){if("text"===t.type&&"text"===e.type){const r=t.isBefore(e),i=t.is(e);li(t,r,i),li(e,!r,i),i&&(e.key=t.key,e.offset=t.offset,e.type=t.type);const s=Wi();if(s.isComposing()&&s._compositionKey!==t.key&&ti(n)){const r=n.anchor,i=n.focus;Zr(t,r.key,r.offset,r.type),Zr(e,i.key,i.offset,i.type)}}}function ui(t,e,n,r,i,s){if(null===t||null===n||!Gt(i,t,n))return null;const o=oi(t,e,ti(s)?s.anchor:null,i);if(null===o)return null;const l=oi(n,r,ti(s)?s.focus:null,i);if(null===l)return null;if("element"===o.type&&"element"===l.type){const e=xe(t),r=xe(n);if(Yi(e)&&Yi(r))return null}return ci(o,l,s),[o,l]}function fi(t,e,n,r,i,s){const o=Mi(),l=new ei(qr(t,e,i),qr(n,r,s),0,"");return l.dirty=!0,o._selection=l,l}function di(){const t=qr("root",0,"element"),e=qr("root",0,"element");return new ei(t,e,0,"")}function hi(){return new Gr(new Set)}function _i(t,e,n,r){const i=n._window;if(null===i)return null;const s=r||i.event,o=s?s.type:void 0,l="selectionchange"===o,c=!Mt&&(l||"beforeinput"===o||"compositionstart"===o||"compositionend"===o||"click"===o&&s&&3===s.detail||"drop"===o||void 0===o);let u,a,f,d;if(ti(t)&&!c)return t.clone();if(null===e)return null;if(u=e.anchorNode,a=e.focusNode,f=e.anchorOffset,d=e.focusOffset,l&&ti(t)&&!Gt(n,u,a))return t.clone();const h=ui(u,f,a,d,n,t);if(null===h)return null;const[g,_]=h;return new ei(g,_,ti(t)?t.format:0,ti(t)?t.style:"")}function pi(){return Mi()._selection}function yi(){return Wi()._editorState._selection}function mi(t,e,n,r=1){const i=t.anchor,s=t.focus,o=i.getNode(),l=s.getNode();if(!e.is(o)&&!e.is(l))return;const c=e.__key;if(t.isCollapsed()){const e=i.offset;if(n<=e&&r>0||n<e&&r<0){const n=Math.max(0,e+r);i.set(c,n,"element"),s.set(c,n,"element"),xi(t)}}else{const o=t.isBackward(),l=o?s:i,u=l.getNode(),a=o?i:s,f=a.getNode();if(e.is(u)){const t=l.offset;(n<=t&&r>0||n<t&&r<0)&&l.set(c,Math.max(0,t+r),"element")}if(e.is(f)){const t=a.offset;(n<=t&&r>0||n<t&&r<0)&&a.set(c,Math.max(0,t+r),"element")}}xi(t)}function xi(t){const e=t.anchor,n=e.offset,r=t.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(t.isCollapsed()){if(!Gi(s))return;const t=s.getChildrenSize(),i=n>=t,o=i?s.getChildAtIndex(t-1):s.getChildAtIndex(n);if(Ur(o)){let t=0;i&&(t=o.getTextContentSize()),e.set(o.__key,t,"text"),r.set(o.__key,t,"text")}}else{if(Gi(s)){const t=s.getChildrenSize(),r=n>=t,i=r?s.getChildAtIndex(t-1):s.getChildAtIndex(n);if(Ur(i)){let t=0;r&&(t=i.getTextContentSize()),e.set(i.__key,t,"text")}}if(Gi(o)){const t=o.getChildrenSize(),e=i>=t,n=e?o.getChildAtIndex(t-1):o.getChildAtIndex(i);if(Ur(n)){let t=0;e&&(t=n.getTextContentSize()),r.set(n.__key,t,"text")}}}}function vi(t,e,n,r,i){let s=null,o=0,l=null;null!==r?(s=r.__key,Ur(r)?(o=r.getTextContentSize(),l="text"):Gi(r)&&(o=r.getChildrenSize(),l="element")):null!==i&&(s=i.__key,Ur(i)?l="text":Gi(i)&&(l="element")),null!==s&&null!==l?t.set(s,o,l):(o=e.getIndexWithinParent(),-1===o&&(o=n.getChildrenSize()),t.set(n.__key,o,"element"))}function Ti(t,e,n,r,i){"text"===t.type?(t.key=n,e||(t.offset+=i)):t.offset>r.getIndexWithinParent()&&(t.offset-=1)}function ki(t){let e=pi()||yi();null===e&&(e=pe().selectEnd()),e.insertNodes(t)}function bi(t){t.isCollapsed()||t.removeText();const e=t.anchor;let n=e.getNode(),r=e.offset;for(;!an(n);)[n,r]=Ni(n,r);return r}function Ni(t,e){const n=t.getParent();if(!n){const t=cs();return pe().append(t),t.select(),[pe(),0]}if(Ur(t)){const r=t.splitText(e);if(0===r.length)return[n,t.getIndexWithinParent()];const i=0===e?0:1;return[n,r[0].getIndexWithinParent()+i]}if(!Gi(t)||0===e)return[n,t.getIndexWithinParent()];const r=t.getChildAtIndex(e);if(r){const n=new ei(qr(t.__key,e,"element"),qr(t.__key,e,"element"),0,""),i=t.insertNewAfter(n);i&&i.append(r,...r.getNextSiblings())}return[n,t.getIndexWithinParent()+1]}let wi=null,Ei=null,Pi=!1,Di=!1,Fi=0;const Ii={characterData:!0,childList:!0,subtree:!0};function Oi(){return Pi||null!==wi&&wi._readOnly}function Li(){Pi&&H(13)}function Ai(){Fi>99&&H(14)}function Mi(){return null===wi&&H(15),wi}function Wi(){return null===Ei&&H(16),Ei}function Bi(t,e,n){const r=e.__type,i=function(t,e){const n=t._nodes.get(e);return void 0===n&&H(30,e),n}(t,r);let s=n.get(r);void 0===s&&(s=Array.from(i.transforms),n.set(r,s));const o=s.length;for(let t=0;t<o&&(s[t](e),e.isAttached());t++);}function Ri(t,e){return void 0!==t&&t.__key!==e&&t.isAttached()}function Ki(t){return Ji(t,Wi()._nodes)}function Ji(t,e){const n=t.type,r=e.get(n);void 0===r&&H(17,n);const i=r.klass;t.type!==i.getType()&&H(18,i.name);const s=i.importJSON(t),o=t.children;if(Gi(s)&&Array.isArray(o))for(let t=0;t<o.length;t++){const n=Ji(o[t],e);s.append(n)}return s}function Ui(t,e){const n=wi,r=Pi,i=Ei;wi=t,Pi=!0,Ei=null;try{return e()}finally{wi=n,Pi=r,Ei=i}}function Vi(t,n){const r=t._pendingEditorState,i=t._rootElement,s=t._headless||null===i;if(null===r)return;const o=t._editorState,l=o._selection,c=r._selection,u=0!==t._dirtyType,a=wi,f=Pi,d=Ei,h=t._updating,g=t._observer;let _=null;if(t._pendingEditorState=null,t._editorState=r,!s&&u&&null!==g){Ei=t,wi=r,Pi=!1,t._updating=!0;try{const e=t._dirtyType,n=t._dirtyElements,i=t._dirtyLeaves;g.disconnect(),_=function jn(t,e,n,r,i,s){Cn="",wn="",bn="",En=r===ct,Dn=null,_n=n,gn=n._config,pn=n._nodes,yn=_n._listeners.mutation,mn=i,xn=s,vn=t._nodeMap,Tn=e._nodeMap,Pn=e._readOnly,Sn=new Map(n._keyToDOMMap);const o=new Map;return kn=o,Vn("root",null),_n=void 0,pn=void 0,mn=void 0,xn=void 0,vn=void 0,Tn=void 0,gn=void 0,Sn=void 0,kn=void 0,o}(o,r,t,e,n,i)}catch(e){if(e instanceof Error&&t._onError(e),Di)throw e;return _s(t,null,i,r),Vt(t),t._dirtyType=ct,Di=!0,Vi(t,o),void(Di=!1)}finally{g.observe(i,Ii),t._updating=h,wi=a,Pi=f,Ei=d}}r._readOnly||(r._readOnly=!0);const p=t._dirtyLeaves,y=t._dirtyElements,m=t._normalizedNodes,x=t._updateTags,v=t._deferred;u&&(t._dirtyType=0,t._cloneNotNeeded.clear(),t._dirtyLeaves=new Set,t._dirtyElements=new Map,t._normalizedNodes=new Set,t._updateTags=new Set),function(t,e){const n=t._decorators;let r=t._pendingDecorators||n;const i=e._nodeMap;let s;for(s in r)i.has(s)||(r===n&&(r=ge(t)),delete r[s])}(t,r);const T=s?null:on(t._window);if(t._editable&&null!==T&&(u||null===c||c.dirty)){Ei=t,wi=r;try{if(null!==g&&g.disconnect(),u||null===c||c.dirty){const e=t._blockCursorElement;null!==e&&rn(e,t,i),function Si(t,e,n,r,i,s,o){const l=r.anchorNode,c=r.focusNode,u=r.anchorOffset,a=r.focusOffset,f=document.activeElement;if(i.has("collaboration")&&f!==s||null!==f&&Zt(f))return;if(!ti(e))return void(null!==t&&Gt(n,l,c)&&r.removeAllRanges());const d=e.anchor,h=e.focus,g=d.key,_=h.key,p=Ve(n,g),y=Ve(n,_),m=d.offset,x=h.offset,v=e.format,T=e.style,S=e.isCollapsed();let k=p,C=y,b=!1;if("text"===d.type){k=re(p);const t=d.getNode();b=t.getFormat()!==v||t.getStyle()!==T}else ti(t)&&"text"===t.anchor.type&&(b=!0);var N,w,E,P,D;if("text"===h.type&&(C=re(y)),null!==k&&null!==C&&(S&&(null===t||b||ti(t)&&(t.format!==v||t.style!==T))&&(N=v,w=T,E=m,P=g,D=performance.now(),lr=[N,w,E,P,D]),u!==m||a!==x||l!==k||c!==C||"Range"===r.type&&S||(null!==f&&s.contains(f)||s.focus({preventScroll:!0}),"element"===d.type))){try{r.setBaseAndExtent(k,m,C,x)}catch(t){}if(!i.has("skip-scroll-into-view")&&e.isCollapsed()&&null!==s&&s===document.activeElement){const t=e instanceof ei&&"element"===e.anchor.type?k.childNodes[m]||null:r.rangeCount>0?r.getRangeAt(0):null;if(null!==t){let e;if(t instanceof Text){const n=document.createRange();n.selectNode(t),e=n.getBoundingClientRect()}else e=t.getBoundingClientRect();!function(t,e,n){const r=n.ownerDocument,i=r.defaultView;if(null===i)return;let{top:s,bottom:o}=e,l=0,c=0,u=n;for(;null!==u;){const e=u===r.body;if(e)l=0,c=Qe(t).innerHeight;else{const t=u.getBoundingClientRect();l=t.top,c=t.bottom}let n=0;if(s<l?n=-(l-s):o>c&&(n=o-c),0!==n)if(e)i.scrollBy(0,n);else{const t=u.scrollTop;u.scrollTop+=n;const e=u.scrollTop-t;s-=e,o-=e}if(e)break;u=$e(u)}}(n,e,s)}}rr=!0}}(l,c,t,T,x,i)}(function sn(t,e,n){let r=t._blockCursorElement;if(ti(n)&&n.isCollapsed()&&"element"===n.anchor.type&&e.contains(document.activeElement)){const i=n.anchor,s=i.getNode(),o=i.offset;let l=!1,c=null;if(o===s.getChildrenSize())nn(s.getChildAtIndex(o-1))&&(l=!0);else{const e=s.getChildAtIndex(o);if(nn(e)){const n=e.getPreviousSibling();(null===n||nn(n))&&(l=!0,c=t.getElementByKey(e.__key))}}if(l){const n=t.getElementByKey(s.__key);return null===r&&(t._blockCursorElement=r=function(t){const e=t.theme,n=document.createElement("div");n.contentEditable="false",n.setAttribute("data-lexical-cursor","true");let r=e.blockCursor;if(void 0!==r){if("string"==typeof r){const t=Lt(r);r=e.blockCursor=t}void 0!==r&&n.classList.add(...r)}return n}(t._config)),e.style.caretColor="transparent",void(null===c?n.appendChild(r):n.insertBefore(r,c))}}null!==r&&rn(r,t,e)})(t,i,c),null!==g&&g.observe(i,Ii)}finally{Ei=d,wi=a}}null!==_&&function(t,e,n,r,i){const s=Array.from(t._listeners.mutation),o=s.length;for(let t=0;t<o;t++){const[o,l]=s[t],c=e.get(l);void 0!==c&&o(c,{dirtyLeaves:r,prevEditorState:i,updateTags:n})}}(t,_,x,p,o),ti(c)||null===c||null!==l&&l.is(c)||t.dispatchCommand(e,void 0);const S=t._pendingDecorators;null!==S&&(t._decorators=S,t._pendingDecorators=null,$i("decorator",t,!0,S)),function(t,e,n){const r=_e(e),i=_e(n);r!==i&&$i("textcontent",t,!0,i)}(t,n||o,r),$i("update",t,!0,{dirtyElements:y,dirtyLeaves:p,editorState:r,normalizedNodes:m,prevEditorState:n||o,tags:x}),function(t,e){if(t._deferred=[],0!==e.length){const n=t._updating;t._updating=!0;try{for(let t=0;t<e.length;t++)e[t]()}finally{t._updating=n}}}(t,v),function(t){const e=t._updates;if(0!==e.length){const n=e.shift();if(n){const[e,r]=n;qi(t,e,r)}}}(t)}function $i(t,e,n,...r){const i=e._updating;e._updating=n;try{const n=Array.from(e._listeners[t]);for(let t=0;t<n.length;t++)n[t].apply(null,r)}finally{e._updating=i}}function Hi(t,e,n){if(!1===t._updating||Ei!==t){let r=!1;return t.update((()=>{r=Hi(t,e,n)})),r}const r=Se(t);for(let i=4;i>=0;i--)for(let s=0;s<r.length;s++){const o=r[s]._commands.get(e);if(void 0!==o){const e=o[i];if(void 0!==e){const r=Array.from(e),i=r.length;for(let e=0;e<i;e++)if(!0===r[e](n,t))return!0}}}return!1}function ji(t,e){const n=t._updates;let r=e||!1;for(;0!==n.length;){const e=n.shift();if(e){const[n,i]=e;let s,o;void 0!==i&&(s=i.onUpdate,o=i.tag,i.skipTransforms&&(r=!0),s&&t._deferred.push(s),o&&t._updateTags.add(o)),n()}}return r}function qi(t,e,n){const r=t._updateTags;let i,s,o=!1,l=!1;void 0!==n&&(i=n.onUpdate,s=n.tag,null!=s&&r.add(s),o=n.skipTransforms||!1,l=n.discrete||!1),i&&t._deferred.push(i);const c=t._editorState;let u=t._pendingEditorState,a=!1;(null===u||u._readOnly)&&(u=t._pendingEditorState=new ss(new Map((u||c)._nodeMap)),a=!0),u._flushSync=l;const f=wi,d=Pi,h=Ei,g=t._updating;wi=u,Pi=!1,t._updating=!0,Ei=t;try{a&&(t._headless?null!==c._selection&&(u._selection=c._selection.clone()):u._selection=function(t){const e=t.getEditorState()._selection,n=on(t._window);return ti(e)||null==e?_i(e,n,t,null):e.clone()}(t));const n=t._compositionKey;e(),o=ji(t,o),function(t,e){const n=e.getEditorState()._selection,r=t._selection;if(ti(r)){const t=r.anchor,e=r.focus;let i;if("text"===t.type&&(i=t.getNode(),i.selectionTransform(n,r)),"text"===e.type){const t=e.getNode();i!==t&&t.selectionTransform(n,r)}}}(u,t),0!==t._dirtyType&&(o?function(t,e){const n=e._dirtyLeaves,r=t._nodeMap;for(const t of n){const e=r.get(t);Ur(e)&&e.isAttached()&&e.isSimpleText()&&!e.isUnmergeable()&&jt(e)}}(u,t):function(t,e){const n=e._dirtyLeaves,r=e._dirtyElements,i=t._nodeMap,s=ae(),o=new Map;let l=n,c=l.size,u=r,a=u.size;for(;c>0||a>0;){if(c>0){e._dirtyLeaves=new Set;for(const t of l){const r=i.get(t);Ur(r)&&r.isAttached()&&r.isSimpleText()&&!r.isUnmergeable()&&jt(r),void 0!==r&&Ri(r,s)&&Bi(e,r,o),n.add(t)}if(l=e._dirtyLeaves,c=l.size,c>0){Fi++;continue}}e._dirtyLeaves=new Set,e._dirtyElements=new Map;for(const t of u){const n=t[0],l=t[1];if("root"!==n&&!l)continue;const c=i.get(n);void 0!==c&&Ri(c,s)&&Bi(e,c,o),r.set(n,l)}l=e._dirtyLeaves,c=l.size,u=e._dirtyElements,a=u.size,Fi++}e._dirtyLeaves=n,e._dirtyElements=r}(u,t),ji(t),function(t,e,n,r){const i=t._nodeMap,s=e._nodeMap,o=[];for(const[t]of r){const e=s.get(t);void 0!==e&&(e.isAttached()||(Gi(e)&&hn(e,t,i,s,o,r),i.has(t)||r.delete(t),o.push(t)))}for(const t of o)s.delete(t);for(const t of n){const e=s.get(t);void 0===e||e.isAttached()||(i.has(t)||n.delete(t),s.delete(t))}}(c,u,t._dirtyLeaves,t._dirtyElements)),n!==t._compositionKey&&(u._flushSync=!0);const r=u._selection;if(ti(r)){const t=u._nodeMap,e=r.anchor.key,n=r.focus.key;void 0!==t.get(e)&&void 0!==t.get(n)||H(19)}else ni(r)&&0===r._nodes.size&&(u._selection=null)}catch(e){return e instanceof Error&&t._onError(e),t._pendingEditorState=c,t._dirtyType=ct,t._cloneNotNeeded.clear(),t._dirtyLeaves=new Set,t._dirtyElements.clear(),void Vi(t)}finally{wi=f,Pi=d,Ei=h,t._updating=g,Fi=0}const _=0!==t._dirtyType||function(t,e){const n=e.getEditorState()._selection,r=t._selection;if(null!==r){if(r.dirty||!r.is(n))return!0}else if(null!==n)return!0;return!1}(u,t);_?u._flushSync?(u._flushSync=!1,Vi(t)):a&&Yt((()=>{Vi(t)})):(u._flushSync=!1,a&&(r.clear(),t._deferred=[],t._pendingEditorState=null))}function Qi(t,e,n){t._updating?t._updates.push([e,n]):qi(t,e,n)}class Xi extends vr{constructor(t){super(t)}decorate(t,e){H(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function Yi(t){return t instanceof Xi}class Zi extends vr{constructor(t){super(t),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__indent=0,this.__dir=null}getFormat(){return this.getLatest().__format}getFormatType(){const t=this.getFormat();return Ft[t]||""}getIndent(){return this.getLatest().__indent}getChildren(){const t=[];let e=this.getFirstChild();for(;null!==e;)t.push(e),e=e.getNextSibling();return t}getChildrenKeys(){const t=[];let e=this.getFirstChild();for(;null!==e;)t.push(e.__key),e=e.getNextSibling();return t}getChildrenSize(){return this.getLatest().__size}isEmpty(){return 0===this.getChildrenSize()}isDirty(){const t=Wi()._dirtyElements;return null!==t&&t.has(this.__key)}isLastChild(){const t=this.getLatest(),e=this.getParentOrThrow().getLastChild();return null!==e&&e.is(t)}getAllTextNodes(){const t=[];let e=this.getFirstChild();for(;null!==e;){if(Ur(e)&&t.push(e),Gi(e)){const n=e.getAllTextNodes();t.push(...n)}e=e.getNextSibling()}return t}getFirstDescendant(){let t=this.getFirstChild();for(;Gi(t);){const e=t.getFirstChild();if(null===e)break;t=e}return t}getLastDescendant(){let t=this.getLastChild();for(;Gi(t);){const e=t.getLastChild();if(null===e)break;t=e}return t}getDescendantByIndex(t){const e=this.getChildren(),n=e.length;if(t>=n){const t=e[n-1];return Gi(t)&&t.getLastDescendant()||t||null}const r=e[t];return Gi(r)&&r.getFirstDescendant()||r||null}getFirstChild(){const t=this.getLatest().__first;return null===t?null:fe(t)}getFirstChildOrThrow(){const t=this.getFirstChild();return null===t&&H(45,this.__key),t}getLastChild(){const t=this.getLatest().__last;return null===t?null:fe(t)}getLastChildOrThrow(){const t=this.getLastChild();return null===t&&H(96,this.__key),t}getChildAtIndex(t){const e=this.getChildrenSize();let n,r;if(t<e/2){for(n=this.getFirstChild(),r=0;null!==n&&r<=t;){if(r===t)return n;n=n.getNextSibling(),r++}return null}for(n=this.getLastChild(),r=e-1;null!==n&&r>=t;){if(r===t)return n;n=n.getPreviousSibling(),r--}return null}getTextContent(){let t="";const e=this.getChildren(),n=e.length;for(let r=0;r<n;r++){const i=e[r];t+=i.getTextContent(),Gi(i)&&r!==n-1&&!i.isInline()&&(t+=St)}return t}getTextContentSize(){let t=0;const e=this.getChildren(),n=e.length;for(let r=0;r<n;r++){const i=e[r];t+=i.getTextContentSize(),Gi(i)&&r!==n-1&&!i.isInline()&&(t+=2)}return t}getDirection(){return this.getLatest().__dir}hasFormat(t){if(""!==t){const e=Dt[t];return!!(this.getFormat()&e)}return!1}select(t,e){Li();const n=pi();let r=t,i=e;const s=this.getChildrenSize();if(!this.canBeEmpty())if(0===t&&0===e){const t=this.getFirstChild();if(Ur(t)||Gi(t))return t.select(0,0)}else if(!(void 0!==t&&t!==s||void 0!==e&&e!==s)){const t=this.getLastChild();if(Ur(t)||Gi(t))return t.select()}void 0===r&&(r=s),void 0===i&&(i=s);const o=this.__key;return ti(n)?(n.anchor.set(o,r,"element"),n.focus.set(o,i,"element"),n.dirty=!0,n):fi(o,r,o,i,"element","element")}selectStart(){const t=this.getFirstDescendant();return t?t.selectStart():this.select()}selectEnd(){const t=this.getLastDescendant();return t?t.selectEnd():this.select()}clear(){const t=this.getWritable();return this.getChildren().forEach((t=>t.remove())),t}append(...t){return this.splice(this.getChildrenSize(),0,t)}setDirection(t){const e=this.getWritable();return e.__dir=t,e}setFormat(t){return this.getWritable().__format=""!==t?Dt[t]:0,this}setIndent(t){return this.getWritable().__indent=t,this}splice(t,e,n){const r=n.length,i=this.getChildrenSize(),s=this.getWritable(),o=s.__key,l=[],c=[],u=this.getChildAtIndex(t+e);let a=null,f=i-e+r;if(0!==t)if(t===i)a=this.getLastChild();else{const e=this.getChildAtIndex(t);null!==e&&(a=e.getPreviousSibling())}if(e>0){let t=null===a?this.getFirstChild():a.getNextSibling();for(let n=0;n<e;n++){null===t&&H(100);const e=t.getNextSibling(),n=t.__key;le(t.getWritable()),c.push(n),t=e}}let d=a;for(let t=0;t<r;t++){const e=n[t];null!==d&&e.is(d)&&(a=d=d.getPreviousSibling());const r=e.getWritable();r.__parent===o&&f--,le(r);const i=e.__key;if(null===d)s.__first=i,r.__prev=null;else{const t=d.getWritable();t.__next=i,r.__prev=t.__key}e.__key===o&&H(76),r.__parent=o,l.push(i),d=e}if(t+e===i)null!==d&&(d.getWritable().__next=null,s.__last=d.__key);else if(null!==u){const t=u.getWritable();if(null!==d){const e=d.getWritable();t.__prev=d.__key,e.__next=u.__key}else t.__prev=null}if(s.__size=f,c.length){const t=pi();if(ti(t)){const e=new Set(c),n=new Set(l),{anchor:r,focus:i}=t;ts(r,e,n)&&vi(r,r.getNode(),this,a,u),ts(i,e,n)&&vi(i,i.getNode(),this,a,u),0!==f||this.canBeEmpty()||Ze(this)||this.remove()}}return s}exportJSON(){return{children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),type:"element",version:1}}insertNewAfter(t,e){return null}canIndent(){return!0}collapseAtStart(t){return!1}excludeFromCopy(t){return!1}canReplaceWith(t){return!0}canInsertAfter(t){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(t){return!1}extractWithChild(t,e,n){return!1}}function Gi(t){return t instanceof Zi}function ts(t,e,n){let r=t.getNode();for(;r;){const t=r.__key;if(e.has(t)&&!n.has(t))return!0;r=r.getParent()}return!1}class es extends Zi{static getType(){return"root"}static clone(){return new es}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){H(51)}getTextContent(){const t=this.__cachedText;return!Oi()&&0!==Wi()._dirtyType||null===t?super.getTextContent():t}remove(){H(52)}replace(t){H(53)}insertBefore(t){H(54)}insertAfter(t){H(55)}updateDOM(t,e){return!1}append(...t){for(let e=0;e<t.length;e++){const n=t[e];Gi(n)||Yi(n)||H(56)}return super.append(...t)}static importJSON(t){const e=pe();return e.setFormat(t.format),e.setIndent(t.indent),e.setDirection(t.direction),e}exportJSON(){return{children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),type:"root",version:1}}collapseAtStart(){return!0}}function ns(t){return t instanceof es}function rs(){return new ss(new Map([["root",new es]]))}function is(t){const e=t.exportJSON(),n=t.constructor;if(e.type!==n.getType()&&H(130,n.name),Gi(t)){const r=e.children;Array.isArray(r)||H(59,n.name);const i=t.getChildren();for(let t=0;t<i.length;t++){const e=is(i[t]);r.push(e)}}return e}class ss{constructor(t,e){this._nodeMap=t,this._selection=e||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return 1===this._nodeMap.size&&null===this._selection}read(t){return Ui(this,t)}clone(t){const e=new ss(this._nodeMap,void 0===t?this._selection:t);return e._readOnly=!0,e}toJSON(){return Ui(this,(()=>({root:is(pe())})))}}class os extends Zi{constructor(t){super(t),this.__textFormat=0}static getType(){return"paragraph"}getTextFormat(){return this.getLatest().__textFormat}setTextFormat(t){const e=this.getWritable();return e.__textFormat=t,e}hasTextFormat(t){const e=Et[t];return!!(this.getTextFormat()&e)}static clone(t){return new os(t.__key)}createDOM(t){const e=document.createElement("p"),n=Me(t.theme,"paragraph");return void 0!==n&&e.classList.add(...n),e}updateDOM(t,e,n){return!1}static importDOM(){return{p:t=>({conversion:ls,priority:0})}}exportDOM(t){const{element:e}=super.exportDOM(t);if(e&&un(e)){this.isEmpty()&&e.append(document.createElement("br"));const t=this.getFormatType();e.style.textAlign=t;const n=this.getDirection();n&&(e.dir=n);const r=this.getIndent();r>0&&(e.style.textIndent=20*r+"px")}return{element:e}}static importJSON(t){const e=cs();return e.setFormat(t.format),e.setIndent(t.indent),e.setDirection(t.direction),e.setTextFormat(t.textFormat),e}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),type:"paragraph",version:1}}insertNewAfter(t,e){const n=cs();n.setTextFormat(t.format);const r=this.getDirection();return n.setDirection(r),n.setFormat(this.getFormatType()),this.insertAfter(n,e),n}collapseAtStart(){const t=this.getChildren();if(0===t.length||Ur(t[0])&&""===t[0].getTextContent().trim()){if(null!==this.getNextSibling())return this.selectNext(),this.remove(),!0;if(null!==this.getPreviousSibling())return this.selectPrevious(),this.remove(),!0}return!1}}function ls(t){const e=cs();if(t.style){e.setFormat(t.style.textAlign);const n=parseInt(t.style.textIndent,10)/20;n>0&&e.setIndent(n)}return{node:e}}function cs(){return tn(new os)}function us(t){return t instanceof os}const as=0,fs=1,hs=3,gs=4;function _s(t,e,n,r){const i=t._keyToDOMMap;i.clear(),t._editorState=rs(),t._pendingEditorState=r,t._compositionKey=null,t._dirtyType=0,t._cloneNotNeeded.clear(),t._dirtyLeaves=new Set,t._dirtyElements.clear(),t._normalizedNodes=new Set,t._updateTags=new Set,t._updates=[],t._blockCursorElement=null;const s=t._observer;null!==s&&(s.disconnect(),t._observer=null),null!==e&&(e.textContent=""),null!==n&&(n.textContent="",i.set("root",n))}function ps(t){const e=t||{},n=function zi(){return Ei}(),r=e.theme||{},i=void 0===t?n:e.parentEditor||null,s=e.disableEvents||!1,o=rs(),l=e.namespace||(null!==i?i._config.namespace:ke()),c=e.editorState,u=[es,Ir,Tr,Vr,os,...e.nodes||[]],{onError:a,html:f}=e,d=void 0===e.editable||e.editable;let h;if(void 0===t&&null!==n)h=n._nodes;else{h=new Map;for(let t=0;t<u.length;t++){let e=u[t],n=null,r=null;if("function"!=typeof e){const t=e;e=t.replace,n=t.with,r=t.withKlass||null}const i=e.getType(),s=e.transform(),o=new Set;null!==s&&o.add(s),h.set(i,{exportDOM:f&&f.export?f.export.get(e):void 0,klass:e,replace:n,replaceWithKlass:r,transforms:o})}}const g=new ys(o,i,h,{disableEvents:s,namespace:l,theme:r},a||console.error,function(t,e){const n=new Map,r=new Set,i=t=>{Object.keys(t).forEach((e=>{let r=n.get(e);void 0===r&&(r=[],n.set(e,r)),r.push(t[e])}))};return t.forEach((t=>{const e=t.klass.importDOM;if(null==e||r.has(e))return;r.add(e);const n=e.call(t.klass);null!==n&&i(n)})),e&&i(e),n}(h,f?f.import:void 0),d);return void 0!==c&&(g._pendingEditorState=c,g._dirtyType=ct),g}class ys{constructor(t,e,n,r,i,s,o){this._parentEditor=e,this._rootElement=null,this._editorState=t,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=r,this._nodes=n,this._decorators={},this._pendingDecorators=null,this._dirtyType=0,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=ke(),this._onError=i,this._htmlConversions=s,this._editable=o,this._headless=null!==e&&e._headless,this._window=null,this._blockCursorElement=null}isComposing(){return null!=this._compositionKey}registerUpdateListener(t){const e=this._listeners.update;return e.add(t),()=>{e.delete(t)}}registerEditableListener(t){const e=this._listeners.editable;return e.add(t),()=>{e.delete(t)}}registerDecoratorListener(t){const e=this._listeners.decorator;return e.add(t),()=>{e.delete(t)}}registerTextContentListener(t){const e=this._listeners.textcontent;return e.add(t),()=>{e.delete(t)}}registerRootListener(t){const e=this._listeners.root;return t(this._rootElement,null),e.add(t),()=>{t(null,this._rootElement),e.delete(t)}}registerCommand(t,e,n){void 0===n&&H(35);const r=this._commands;r.has(t)||r.set(t,[new Set,new Set,new Set,new Set,new Set]);const i=r.get(t);void 0===i&&H(36,String(t));const s=i[n];return s.add(e),()=>{s.delete(e),i.every((t=>0===t.size))&&r.delete(t)}}registerMutationListener(t,e){void 0===this._nodes.get(t.getType())&&H(37,t.name);const n=this._listeners.mutation;return n.set(e,t),()=>{n.delete(e)}}registerNodeTransformToKlass(t,e){const n=t.getType(),r=this._nodes.get(n);return void 0===r&&H(37,t.name),r.transforms.add(e),r}registerNodeTransform(t,e){const n=this.registerNodeTransformToKlass(t,e),r=[n],i=n.replaceWithKlass;if(null!=i){const t=this.registerNodeTransformToKlass(i,e);r.push(t)}var o;return o=t.getType(),Qi(this,(()=>{const t=Mi();if(t.isEmpty())return;if("root"===o)return void pe().markDirty();const e=t._nodeMap;for(const[,t]of e)t.markDirty()}),null===this._pendingEditorState?{tag:"history-merge"}:void 0),()=>{r.forEach((t=>t.transforms.delete(e)))}}hasNode(t){return this._nodes.has(t.getType())}hasNodes(t){return t.every(this.hasNode.bind(this))}dispatchCommand(t,e){return Je(this,t,e)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(t){const e=this._rootElement;if(t!==e){const n=Me(this._config.theme,"root"),r=this._pendingEditorState||this._editorState;if(this._rootElement=t,_s(this,e,t,r),null!==e&&(this._config.disableEvents||function mr(t){const e=t.ownerDocument,n=nr.get(e);if(void 0===n)throw Error("Root element not registered");nr.set(e,n-1),0===nr.get(e)&&e.removeEventListener("selectionchange",_r);const r=t.__lexicalEditor;null!=r&&(function(t){if(null!==t._parentEditor){const e=Se(t),n=e[e.length-1]._key;gr.get(n)===t&&gr.delete(n)}else gr.delete(t._key)}(r),t.__lexicalEditor=null);const i=hr(t);for(let t=0;t<i.length;t++)i[t]();t.__lexicalEventHandles=[]}(e),null!=n&&e.classList.remove(...n)),null!==t){const e=function(t){const e=t.ownerDocument;return e&&e.defaultView||null}(t),r=t.style;r.userSelect="text",r.whiteSpace="pre-wrap",r.wordBreak="break-word",t.setAttribute("data-lexical-editor","true"),this._window=e,this._dirtyType=ct,Vt(this),this._updateTags.add("history-merge"),Vi(this),this._config.disableEvents||function(t,e){const n=t.ownerDocument,r=nr.get(n);(void 0===r||r<1)&&n.addEventListener("selectionchange",_r),nr.set(n,r||1),t.__lexicalEditor=e;const i=hr(t);for(let n=0;n<Yn.length;n++){const[r,s]=Yn[n],o="function"==typeof s?t=>{yr(t)||(pr(t),(e.isEditable()||"click"===r)&&s(t,e))}:t=>{if(!yr(t)&&(pr(t),e.isEditable()))switch(r){case"cut":return Je(e,W,t);case"copy":return Je(e,M,t);case"paste":return Je(e,c,t);case"dragstart":return Je(e,O,t);case"dragover":return Je(e,L,t);case"dragend":return Je(e,A,t);case"focus":return Je(e,U,t);case"blur":return Je(e,V,t);case"drop":return Je(e,F,t)}};t.addEventListener(r,o),i.push((()=>{t.removeEventListener(r,o)}))}}(t,this),null!=n&&t.classList.add(...n)}else this._editorState=r,this._pendingEditorState=null,this._window=null;$i("root",this,!1,t,e)}}getElementByKey(t){return this._keyToDOMMap.get(t)||null}getEditorState(){return this._editorState}setEditorState(t,e){t.isEmpty()&&H(38),Ut(this);const n=this._pendingEditorState,r=this._updateTags,i=void 0!==e?e.tag:null;null===n||n.isEmpty()||(null!=i&&r.add(i),Vi(this)),this._pendingEditorState=t,this._dirtyType=ct,this._dirtyElements.set("root",!1),this._compositionKey=null,null!=i&&r.add(i),Vi(this)}parseEditorState(t,e){return function(t,e,n){const r=rs(),i=wi,s=Pi,o=Ei,l=e._dirtyElements,c=e._dirtyLeaves,u=e._cloneNotNeeded,a=e._dirtyType;e._dirtyElements=new Map,e._dirtyLeaves=new Set,e._cloneNotNeeded=new Set,e._dirtyType=0,wi=r,Pi=!1,Ei=e;try{const i=e._nodes;Ji(t.root,i),n&&n(),r._readOnly=!0}catch(t){t instanceof Error&&e._onError(t)}finally{e._dirtyElements=l,e._dirtyLeaves=c,e._cloneNotNeeded=u,e._dirtyType=a,wi=i,Pi=s,Ei=o}return r}("string"==typeof t?JSON.parse(t):t,this,e)}update(t,e){Qi(this,t,e)}focus(t,e={}){const n=this._rootElement;null!==n&&(n.setAttribute("autocapitalize","off"),Qi(this,(()=>{const t=pi(),n=pe();null!==t?t.dirty=!0:0!==n.getChildrenSize()&&("rootStart"===e.defaultSelection?n.selectStart():n.selectEnd())}),{onUpdate:()=>{n.removeAttribute("autocapitalize"),t&&t()},tag:"focus"}),null===this._pendingEditorState&&n.removeAttribute("autocapitalize"))}blur(){const t=this._rootElement;null!==t&&t.blur();const e=on(this._window);null!==e&&e.removeAllRanges()}isEditable(){return this._editable}setEditable(t){this._editable!==t&&(this._editable=t,$i("editable",this,!0,t))}toJSON(){return{editorState:this._editorState.toJSON()}}}},"./node_modules/lib0/array.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{HT:()=>from,HV:()=>last,S2:()=>appendTo,cy:()=>isArray,zN:()=>some});const last=arr=>arr[arr.length-1],appendTo=(dest,src)=>{for(let i=0;i<src.length;i++)dest.push(src[i])},from=Array.from,some=(arr,f)=>{for(let i=0;i<arr.length;i++)if(f(arr[i],i,arr))return!0;return!1},isArray=Array.isArray},"./node_modules/lib0/binary.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CW:()=>BITS32,D1:()=>BIT3,D7:()=>BIT7,Dk:()=>BIT1,KD:()=>BIT2,KJ:()=>BIT6,P1:()=>BITS6,WD:()=>BITS7,WY:()=>BITS5,vZ:()=>BITS31,wn:()=>BIT4,wt:()=>BIT8});const BIT1=1,BIT2=2,BIT3=4,BIT4=8,BIT6=32,BIT7=64,BIT8=128,BITS5=31,BITS6=63,BITS7=127,BITS31=2147483647,BITS32=4294967295},"./node_modules/lib0/buffer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ey:()=>fromBase64,HR:()=>copyUint8Array,nk:()=>toBase64,zS:()=>createUint8ArrayFromArrayBuffer});var _string_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lib0/string.js"),_environment_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lib0/environment.js"),Buffer=__webpack_require__("./node_modules/node-polyfill-webpack-plugin/node_modules/buffer/index.js").hp;const createUint8ArrayFromLen=len=>new Uint8Array(len),createUint8ArrayFromArrayBuffer=buffer=>new Uint8Array(buffer),toBase64=_environment_js__WEBPACK_IMPORTED_MODULE_1__.Bd?bytes=>{let s="";for(let i=0;i<bytes.byteLength;i++)s+=_string_js__WEBPACK_IMPORTED_MODULE_0__.QV(bytes[i]);return btoa(s)}:bytes=>Buffer.from(bytes.buffer,bytes.byteOffset,bytes.byteLength).toString("base64"),fromBase64=_environment_js__WEBPACK_IMPORTED_MODULE_1__.Bd?s=>{const a=atob(s),bytes=createUint8ArrayFromLen(a.length);for(let i=0;i<a.length;i++)bytes[i]=a.charCodeAt(i);return bytes}:s=>{const buf=Buffer.from(s,"base64");return buffer=buf.buffer,byteOffset=buf.byteOffset,length=buf.byteLength,new Uint8Array(buffer,byteOffset,length);var buffer,byteOffset,length},copyUint8Array=uint8Array=>{const newBuf=createUint8ArrayFromLen(uint8Array.byteLength);return newBuf.set(uint8Array),newBuf}},"./node_modules/lib0/decoding.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$C:()=>createDecoder,Ib:()=>StringDecoder,Jg:()=>readAny,VQ:()=>UintOptRleDecoder,bo:()=>readVarUint8Array,cQ:()=>RleDecoder,cw:()=>readVarUint,t3:()=>readVarString,xK:()=>IntDiffOptRleDecoder,xh:()=>readUint8});var _binary_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lib0/binary.js"),_math_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/lib0/math.js"),_number_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lib0/number.js"),_string_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/lib0/string.js"),_error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lib0/error.js");const errorUnexpectedEndOfArray=_error_js__WEBPACK_IMPORTED_MODULE_0__.vt("Unexpected end of array"),errorIntegerOutOfRange=_error_js__WEBPACK_IMPORTED_MODULE_0__.vt("Integer out of Range");class Decoder{constructor(uint8Array){this.arr=uint8Array,this.pos=0}}const createDecoder=uint8Array=>new Decoder(uint8Array),hasContent=decoder=>decoder.pos!==decoder.arr.length,readUint8Array=(decoder,len)=>{const view=new Uint8Array(decoder.arr.buffer,decoder.pos+decoder.arr.byteOffset,len);return decoder.pos+=len,view},readVarUint8Array=decoder=>readUint8Array(decoder,readVarUint(decoder)),readUint8=decoder=>decoder.arr[decoder.pos++],readVarUint=decoder=>{let num=0,mult=1;const len=decoder.arr.length;for(;decoder.pos<len;){const r=decoder.arr[decoder.pos++];if(num+=(r&_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD)*mult,mult*=128,r<_binary_js__WEBPACK_IMPORTED_MODULE_1__.wt)return num;if(num>_number_js__WEBPACK_IMPORTED_MODULE_2__.Is)throw errorIntegerOutOfRange}throw errorUnexpectedEndOfArray},readVarInt=decoder=>{let r=decoder.arr[decoder.pos++],num=r&_binary_js__WEBPACK_IMPORTED_MODULE_1__.P1,mult=64;const sign=(r&_binary_js__WEBPACK_IMPORTED_MODULE_1__.D7)>0?-1:1;if(!(r&_binary_js__WEBPACK_IMPORTED_MODULE_1__.wt))return sign*num;const len=decoder.arr.length;for(;decoder.pos<len;){if(r=decoder.arr[decoder.pos++],num+=(r&_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD)*mult,mult*=128,r<_binary_js__WEBPACK_IMPORTED_MODULE_1__.wt)return sign*num;if(num>_number_js__WEBPACK_IMPORTED_MODULE_2__.Is)throw errorIntegerOutOfRange}throw errorUnexpectedEndOfArray},readVarString=_string_js__WEBPACK_IMPORTED_MODULE_3__.tv?decoder=>_string_js__WEBPACK_IMPORTED_MODULE_3__.tv.decode(readVarUint8Array(decoder)):decoder=>{let remainingLen=readVarUint(decoder);if(0===remainingLen)return"";{let encodedString=String.fromCodePoint(readUint8(decoder));if(--remainingLen<100)for(;remainingLen--;)encodedString+=String.fromCodePoint(readUint8(decoder));else for(;remainingLen>0;){const nextLen=remainingLen<1e4?remainingLen:1e4,bytes=decoder.arr.subarray(decoder.pos,decoder.pos+nextLen);decoder.pos+=nextLen,encodedString+=String.fromCodePoint.apply(null,bytes),remainingLen-=nextLen}return decodeURIComponent(escape(encodedString))}},readFromDataView=(decoder,len)=>{const dv=new DataView(decoder.arr.buffer,decoder.arr.byteOffset+decoder.pos,len);return decoder.pos+=len,dv},readAnyLookupTable=[decoder=>{},decoder=>null,readVarInt,decoder=>readFromDataView(decoder,4).getFloat32(0,!1),decoder=>readFromDataView(decoder,8).getFloat64(0,!1),decoder=>readFromDataView(decoder,8).getBigInt64(0,!1),decoder=>!1,decoder=>!0,readVarString,decoder=>{const len=readVarUint(decoder),obj={};for(let i=0;i<len;i++){obj[readVarString(decoder)]=readAny(decoder)}return obj},decoder=>{const len=readVarUint(decoder),arr=[];for(let i=0;i<len;i++)arr.push(readAny(decoder));return arr},readVarUint8Array],readAny=decoder=>readAnyLookupTable[127-readUint8(decoder)](decoder);class RleDecoder extends Decoder{constructor(uint8Array,reader){super(uint8Array),this.reader=reader,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),hasContent(this)?this.count=readVarUint(this)+1:this.count=-1),this.count--,this.s}}class UintOptRleDecoder extends Decoder{constructor(uint8Array){super(uint8Array),this.s=0,this.count=0}read(){if(0===this.count){this.s=readVarInt(this);const isNegative=_math_js__WEBPACK_IMPORTED_MODULE_4__.sj(this.s);this.count=1,isNegative&&(this.s=-this.s,this.count=readVarUint(this)+2)}return this.count--,this.s}}class IntDiffOptRleDecoder extends Decoder{constructor(uint8Array){super(uint8Array),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const diff=readVarInt(this),hasCount=1&diff;this.diff=_math_js__WEBPACK_IMPORTED_MODULE_4__.RI(diff/2),this.count=1,hasCount&&(this.count=readVarUint(this)+2)}return this.s+=this.diff,this.count--,this.s}}class StringDecoder{constructor(uint8Array){this.decoder=new UintOptRleDecoder(uint8Array),this.str=readVarString(this.decoder),this.spos=0}read(){const end=this.spos+this.decoder.read(),res=this.str.slice(this.spos,end);return this.spos=end,res}}},"./node_modules/lib0/encoding.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bw:()=>length,D$:()=>UintOptRleEncoder,FA:()=>IntDiffOptRleEncoder,Fo:()=>toUint8Array,Gu:()=>writeVarUint8Array,IO:()=>writeAny,LH:()=>writeUint8Array,QJ:()=>writeUint8,Qj:()=>writeVarString,Sw:()=>StringEncoder,cq:()=>RleEncoder,xv:()=>createEncoder,zd:()=>writeVarUint});var _math_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lib0/math.js"),_number_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/lib0/number.js"),_binary_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lib0/binary.js"),_string_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lib0/string.js"),_array_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/lib0/array.js");class Encoder{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const createEncoder=()=>new Encoder,length=encoder=>{let len=encoder.cpos;for(let i=0;i<encoder.bufs.length;i++)len+=encoder.bufs[i].length;return len},toUint8Array=encoder=>{const uint8arr=new Uint8Array(length(encoder));let curPos=0;for(let i=0;i<encoder.bufs.length;i++){const d=encoder.bufs[i];uint8arr.set(d,curPos),curPos+=d.length}return uint8arr.set(new Uint8Array(encoder.cbuf.buffer,0,encoder.cpos),curPos),uint8arr},write=(encoder,num)=>{const bufferLen=encoder.cbuf.length;encoder.cpos===bufferLen&&(encoder.bufs.push(encoder.cbuf),encoder.cbuf=new Uint8Array(2*bufferLen),encoder.cpos=0),encoder.cbuf[encoder.cpos++]=num},writeUint8=write,writeVarUint=(encoder,num)=>{for(;num>_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD;)write(encoder,_binary_js__WEBPACK_IMPORTED_MODULE_1__.wt|_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD&num),num=_math_js__WEBPACK_IMPORTED_MODULE_0__.RI(num/128);write(encoder,_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD&num)},writeVarInt=(encoder,num)=>{const isNegative=_math_js__WEBPACK_IMPORTED_MODULE_0__.sj(num);for(isNegative&&(num=-num),write(encoder,(num>_binary_js__WEBPACK_IMPORTED_MODULE_1__.P1?_binary_js__WEBPACK_IMPORTED_MODULE_1__.wt:0)|(isNegative?_binary_js__WEBPACK_IMPORTED_MODULE_1__.D7:0)|_binary_js__WEBPACK_IMPORTED_MODULE_1__.P1&num),num=_math_js__WEBPACK_IMPORTED_MODULE_0__.RI(num/64);num>0;)write(encoder,(num>_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD?_binary_js__WEBPACK_IMPORTED_MODULE_1__.wt:0)|_binary_js__WEBPACK_IMPORTED_MODULE_1__.WD&num),num=_math_js__WEBPACK_IMPORTED_MODULE_0__.RI(num/128)},_strBuffer=new Uint8Array(3e4),_maxStrBSize=_strBuffer.length/3,writeVarString=_string_js__WEBPACK_IMPORTED_MODULE_2__.db&&_string_js__WEBPACK_IMPORTED_MODULE_2__.db.encodeInto?(encoder,str)=>{if(str.length<_maxStrBSize){const written=_string_js__WEBPACK_IMPORTED_MODULE_2__.db.encodeInto(str,_strBuffer).written||0;writeVarUint(encoder,written);for(let i=0;i<written;i++)write(encoder,_strBuffer[i])}else writeVarUint8Array(encoder,_string_js__WEBPACK_IMPORTED_MODULE_2__.Af(str))}:(encoder,str)=>{const encodedString=unescape(encodeURIComponent(str)),len=encodedString.length;writeVarUint(encoder,len);for(let i=0;i<len;i++)write(encoder,encodedString.codePointAt(i))},writeUint8Array=(encoder,uint8Array)=>{const bufferLen=encoder.cbuf.length,cpos=encoder.cpos,leftCopyLen=_math_js__WEBPACK_IMPORTED_MODULE_0__.jk(bufferLen-cpos,uint8Array.length),rightCopyLen=uint8Array.length-leftCopyLen;encoder.cbuf.set(uint8Array.subarray(0,leftCopyLen),cpos),encoder.cpos+=leftCopyLen,rightCopyLen>0&&(encoder.bufs.push(encoder.cbuf),encoder.cbuf=new Uint8Array(_math_js__WEBPACK_IMPORTED_MODULE_0__.T9(2*bufferLen,rightCopyLen)),encoder.cbuf.set(uint8Array.subarray(leftCopyLen)),encoder.cpos=rightCopyLen)},writeVarUint8Array=(encoder,uint8Array)=>{writeVarUint(encoder,uint8Array.byteLength),writeUint8Array(encoder,uint8Array)},writeOnDataView=(encoder,len)=>{((encoder,len)=>{const bufferLen=encoder.cbuf.length;bufferLen-encoder.cpos<len&&(encoder.bufs.push(new Uint8Array(encoder.cbuf.buffer,0,encoder.cpos)),encoder.cbuf=new Uint8Array(2*_math_js__WEBPACK_IMPORTED_MODULE_0__.T9(bufferLen,len)),encoder.cpos=0)})(encoder,len);const dview=new DataView(encoder.cbuf.buffer,encoder.cpos,len);return encoder.cpos+=len,dview},floatTestBed=new DataView(new ArrayBuffer(4)),writeAny=(encoder,data)=>{switch(typeof data){case"string":write(encoder,119),writeVarString(encoder,data);break;case"number":_number_js__WEBPACK_IMPORTED_MODULE_3__.Fq(data)&&_math_js__WEBPACK_IMPORTED_MODULE_0__.tn(data)<=_binary_js__WEBPACK_IMPORTED_MODULE_1__.vZ?(write(encoder,125),writeVarInt(encoder,data)):(num=data,floatTestBed.setFloat32(0,num),floatTestBed.getFloat32(0)===num?(write(encoder,124),((encoder,num)=>{writeOnDataView(encoder,4).setFloat32(0,num,!1)})(encoder,data)):(write(encoder,123),((encoder,num)=>{writeOnDataView(encoder,8).setFloat64(0,num,!1)})(encoder,data)));break;case"bigint":write(encoder,122),((encoder,num)=>{writeOnDataView(encoder,8).setBigInt64(0,num,!1)})(encoder,data);break;case"object":if(null===data)write(encoder,126);else if(_array_js__WEBPACK_IMPORTED_MODULE_4__.cy(data)){write(encoder,117),writeVarUint(encoder,data.length);for(let i=0;i<data.length;i++)writeAny(encoder,data[i])}else if(data instanceof Uint8Array)write(encoder,116),writeVarUint8Array(encoder,data);else{write(encoder,118);const keys=Object.keys(data);writeVarUint(encoder,keys.length);for(let i=0;i<keys.length;i++){const key=keys[i];writeVarString(encoder,key),writeAny(encoder,data[key])}}break;case"boolean":write(encoder,data?120:121);break;default:write(encoder,127)}var num};class RleEncoder extends Encoder{constructor(writer){super(),this.w=writer,this.s=null,this.count=0}write(v){this.s===v?this.count++:(this.count>0&&writeVarUint(this,this.count-1),this.count=1,this.w(this,v),this.s=v)}}const flushUintOptRleEncoder=encoder=>{encoder.count>0&&(writeVarInt(encoder.encoder,1===encoder.count?encoder.s:-encoder.s),encoder.count>1&&writeVarUint(encoder.encoder,encoder.count-2))};class UintOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0}write(v){this.s===v?this.count++:(flushUintOptRleEncoder(this),this.count=1,this.s=v)}toUint8Array(){return flushUintOptRleEncoder(this),toUint8Array(this.encoder)}}const flushIntDiffOptRleEncoder=encoder=>{if(encoder.count>0){const encodedDiff=2*encoder.diff+(1===encoder.count?0:1);writeVarInt(encoder.encoder,encodedDiff),encoder.count>1&&writeVarUint(encoder.encoder,encoder.count-2)}};class IntDiffOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0,this.diff=0}write(v){this.diff===v-this.s?(this.s=v,this.count++):(flushIntDiffOptRleEncoder(this),this.count=1,this.diff=v-this.s,this.s=v)}toUint8Array(){return flushIntDiffOptRleEncoder(this),toUint8Array(this.encoder)}}class StringEncoder{constructor(){this.sarr=[],this.s="",this.lensE=new UintOptRleEncoder}write(string){this.s+=string,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(string.length)}toUint8Array(){const encoder=new Encoder;return this.sarr.push(this.s),this.s="",writeVarString(encoder,this.sarr.join("")),writeUint8Array(encoder,this.lensE.toUint8Array()),toUint8Array(encoder)}}},"./node_modules/lib0/environment.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{dn:()=>getVariable,Bd:()=>isBrowser,WI:()=>supportsColor});var map=__webpack_require__("./node_modules/lib0/map.js"),string=__webpack_require__("./node_modules/lib0/string.js");const undefinedToNull=v=>void 0===v?null:v;var storage=__webpack_require__("./node_modules/lib0/storage.js"),lib0_function=__webpack_require__("./node_modules/lib0/function.js"),process=__webpack_require__("./node_modules/process/browser.js");const isNode=void 0!==process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==process?process:0),isBrowser="undefined"!=typeof window&&"undefined"!=typeof document&&!isNode;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let params;const args=[],computeParams=()=>{if(void 0===params)if(isNode){params=map.vt();const pargs=process.argv;let currParamName=null;for(let i=0;i<pargs.length;i++){const parg=pargs[i];"-"===parg[0]?(null!==currParamName&&params.set(currParamName,""),currParamName=parg):null!==currParamName?(params.set(currParamName,parg),currParamName=null):args.push(parg)}null!==currParamName&&params.set(currParamName,"")}else"object"==typeof location?(params=map.vt(),(location.search||"?").slice(1).split("&").forEach((kv=>{if(0!==kv.length){const[key,value]=kv.split("=");params.set(`--${string.jN(key,"-")}`,value),params.set(`-${string.jN(key,"-")}`,value)}}))):params=map.vt();return params},hasParam=name=>computeParams().has(name),getVariable=name=>undefinedToNull(isNode?process.env[name.toUpperCase().replaceAll("-","_")]:storage.JT.getItem(name)),hasConf=name=>hasParam("--"+name)||null!==getVariable(name),supportsColor=(hasConf("production"),isNode&&lib0_function.EK(process.env.FORCE_COLOR,["true","1","2"])||!hasParam("--no-colors")&&!hasConf("no-color")&&(!isNode||process.stdout.isTTY)&&(!isNode||hasParam("--color")||null!==getVariable("COLORTERM")||(getVariable("TERM")||"").includes("color")))},"./node_modules/lib0/error.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Mq:()=>unexpectedCase,bD:()=>methodUnimplemented,vt:()=>create});const create=s=>new Error(s),methodUnimplemented=()=>{throw create("Method unimplemented")},unexpectedCase=()=>{throw create("Unexpected case")}},"./node_modules/lib0/function.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EK:()=>isOneOf,OK:()=>callAll,id:()=>id,vo:()=>equalityDeep});var _array_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lib0/array.js"),_object_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lib0/object.js");const callAll=(fs,args,i=0)=>{try{for(;i<fs.length;i++)fs[i](...args)}finally{i<fs.length&&callAll(fs,args,i+1)}},id=a=>a,equalityDeep=(a,b)=>{if(null==a||null==b)return((a,b)=>a===b)(a,b);if(a.constructor!==b.constructor)return!1;if(a===b)return!0;switch(a.constructor){case ArrayBuffer:a=new Uint8Array(a),b=new Uint8Array(b);case Uint8Array:if(a.byteLength!==b.byteLength)return!1;for(let i=0;i<a.length;i++)if(a[i]!==b[i])return!1;break;case Set:if(a.size!==b.size)return!1;for(const value of a)if(!b.has(value))return!1;break;case Map:if(a.size!==b.size)return!1;for(const key of a.keys())if(!b.has(key)||!equalityDeep(a.get(key),b.get(key)))return!1;break;case Object:if(_object_js__WEBPACK_IMPORTED_MODULE_0__.Bw(a)!==_object_js__WEBPACK_IMPORTED_MODULE_0__.Bw(b))return!1;for(const key in a)if(!_object_js__WEBPACK_IMPORTED_MODULE_0__.i5(a,key)||!equalityDeep(a[key],b[key]))return!1;break;case Array:if(a.length!==b.length)return!1;for(let i=0;i<a.length;i++)if(!equalityDeep(a[i],b[i]))return!1;break;default:return!1}return!0},isOneOf=(value,options)=>options.includes(value);_array_js__WEBPACK_IMPORTED_MODULE_1__.cy},"./node_modules/lib0/map.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>copy,Tj:()=>map,_4:()=>setIfUndefined,bz:()=>any,vt:()=>create});const create=()=>new Map,copy=m=>{const r=create();return m.forEach(((v,k)=>{r.set(k,v)})),r},setIfUndefined=(map,key,createT)=>{let set=map.get(key);return void 0===set&&map.set(key,set=createT()),set},map=(m,f)=>{const res=[];for(const[key,value]of m)res.push(f(value,key));return res},any=(m,f)=>{for(const[key,value]of m)if(f(value,key))return!0;return!1}},"./node_modules/lib0/math.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{RI:()=>floor,T9:()=>max,jk:()=>min,sj:()=>isNegativeZero,tn:()=>abs});const floor=Math.floor,abs=(Math.ceil,Math.abs),min=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(a,b)=>a<b?a:b),max=(a,b)=>a>b?a:b,isNegativeZero=(Number.isNaN,Math.pow,Math.sign,n=>0!==n?n<0:1/n<0)},"./node_modules/lib0/number.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Fq:()=>isInteger,Is:()=>MAX_SAFE_INTEGER});var _math_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lib0/math.js"),_binary_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lib0/binary.js");const MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER,isInteger=(Number.MIN_SAFE_INTEGER,_binary_js__WEBPACK_IMPORTED_MODULE_0__.vZ,_binary_js__WEBPACK_IMPORTED_MODULE_0__.CW,Number.isInteger||(num=>"number"==typeof num&&isFinite(num)&&_math_js__WEBPACK_IMPORTED_MODULE_1__.RI(num)===num));Number.isNaN,Number.parseInt},"./node_modules/lib0/object.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bw:()=>length,Im:()=>isEmpty,SQ:()=>equalFlat,Tj:()=>map,i5:()=>hasProperty,jJ:()=>forEach,kp:()=>assign,ol:()=>deepFreeze});const assign=Object.assign,keys=Object.keys,forEach=(obj,f)=>{for(const key in obj)f(obj[key],key)},map=(obj,f)=>{const results=[];for(const key in obj)results.push(f(obj[key],key));return results},length=obj=>keys(obj).length,size=obj=>keys(obj).length,isEmpty=obj=>{for(const _k in obj)return!1;return!0},hasProperty=(obj,key)=>Object.prototype.hasOwnProperty.call(obj,key),equalFlat=(a,b)=>a===b||size(a)===size(b)&&((obj,f)=>{for(const key in obj)if(!f(obj[key],key))return!1;return!0})(a,((val,key)=>(void 0!==val||hasProperty(b,key))&&b[key]===val)),freeze=Object.freeze,deepFreeze=o=>{for(const key in o){const c=o[key];"object"!=typeof c&&"function"!=typeof c||deepFreeze(o[key])}return freeze(o)}},"./node_modules/lib0/observable.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>ObservableV2,c:()=>Observable});var _map_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lib0/map.js"),_set_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lib0/set.js"),_array_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/lib0/array.js");class ObservableV2{constructor(){this._observers=_map_js__WEBPACK_IMPORTED_MODULE_0__.vt()}on(name,f){return _map_js__WEBPACK_IMPORTED_MODULE_0__._4(this._observers,name,_set_js__WEBPACK_IMPORTED_MODULE_1__.vt).add(f),f}once(name,f){const _f=(...args)=>{this.off(name,_f),f(...args)};this.on(name,_f)}off(name,f){const observers=this._observers.get(name);void 0!==observers&&(observers.delete(f),0===observers.size&&this._observers.delete(name))}emit(name,args){return _array_js__WEBPACK_IMPORTED_MODULE_2__.HT((this._observers.get(name)||_map_js__WEBPACK_IMPORTED_MODULE_0__.vt()).values()).forEach((f=>f(...args)))}destroy(){this._observers=_map_js__WEBPACK_IMPORTED_MODULE_0__.vt()}}class Observable{constructor(){this._observers=_map_js__WEBPACK_IMPORTED_MODULE_0__.vt()}on(name,f){_map_js__WEBPACK_IMPORTED_MODULE_0__._4(this._observers,name,_set_js__WEBPACK_IMPORTED_MODULE_1__.vt).add(f)}once(name,f){const _f=(...args)=>{this.off(name,_f),f(...args)};this.on(name,_f)}off(name,f){const observers=this._observers.get(name);void 0!==observers&&(observers.delete(f),0===observers.size&&this._observers.delete(name))}emit(name,args){return _array_js__WEBPACK_IMPORTED_MODULE_2__.HT((this._observers.get(name)||_map_js__WEBPACK_IMPORTED_MODULE_0__.vt()).values()).forEach((f=>f(...args)))}destroy(){this._observers=_map_js__WEBPACK_IMPORTED_MODULE_0__.vt()}}},"./node_modules/lib0/set.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{vt:()=>create});const create=()=>new Set},"./node_modules/lib0/storage.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{JT:()=>varStorage,k9:()=>onChange,o6:()=>offChange});let _localStorage=new class VarStoragePolyfill{constructor(){this.map=new Map}setItem(key,newValue){this.map.set(key,newValue)}getItem(key){return this.map.get(key)}},usePolyfill=!0;try{"undefined"!=typeof localStorage&&localStorage&&(_localStorage=localStorage,usePolyfill=!1)}catch(e){}const varStorage=_localStorage,onChange=eventHandler=>usePolyfill||addEventListener("storage",eventHandler),offChange=eventHandler=>usePolyfill||removeEventListener("storage",eventHandler)},"./node_modules/lib0/string.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Af:()=>encodeUtf8,QV:()=>fromCharCode,db:()=>utf8TextEncoder,jN:()=>fromCamelCase,tv:()=>utf8TextDecoder});const fromCharCode=String.fromCharCode,trimLeftRegex=(String.fromCodePoint,fromCharCode(65535),/^\s*/g),fromCamelCaseRegex=/([A-Z])/g,fromCamelCase=(s,separator)=>(s=>s.replace(trimLeftRegex,""))(s.replace(fromCamelCaseRegex,(match=>`${separator}${(s=>s.toLowerCase())(match)}`))),utf8TextEncoder="undefined"!=typeof TextEncoder?new TextEncoder:null,encodeUtf8=utf8TextEncoder?str=>utf8TextEncoder.encode(str):str=>{const encodedString=unescape(encodeURIComponent(str)),len=encodedString.length,buf=new Uint8Array(len);for(let i=0;i<len;i++)buf[i]=encodedString.codePointAt(i);return buf};let utf8TextDecoder="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});utf8TextDecoder&&1===utf8TextDecoder.decode(new Uint8Array).length&&(utf8TextDecoder=null)},"./node_modules/lib0/time.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_g:()=>getUnixTime});const getUnixTime=Date.now},"./node_modules/react-error-boundary/dist/react-error-boundary.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{tH:()=>ErrorBoundary});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const ErrorBoundaryContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(error){return{didCatch:!0,error}}resetErrorBoundary(){const{error}=this.state;if(null!==error){for(var _this$props$onReset,_this$props,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];null===(_this$props$onReset=(_this$props=this.props).onReset)||void 0===_this$props$onReset||_this$props$onReset.call(_this$props,{args,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(error,info){var _this$props$onError,_this$props2;null===(_this$props$onError=(_this$props2=this.props).onError)||void 0===_this$props$onError||_this$props$onError.call(_this$props2,error,info)}componentDidUpdate(prevProps,prevState){const{didCatch}=this.state,{resetKeys}=this.props;var _this$props$onReset2,_this$props3;didCatch&&null!==prevState.error&&function hasArrayChanged(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.length!==b.length||a.some(((item,index)=>!Object.is(item,b[index])))}(prevProps.resetKeys,resetKeys)&&(null===(_this$props$onReset2=(_this$props3=this.props).onReset)||void 0===_this$props$onReset2||_this$props$onReset2.call(_this$props3,{next:resetKeys,prev:prevProps.resetKeys,reason:"keys"}),this.setState(initialState))}render(){const{children,fallbackRender,FallbackComponent,fallback}=this.props,{didCatch,error}=this.state;let childToRender=children;if(didCatch){const props={error,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof fallbackRender)childToRender=fallbackRender(props);else if(FallbackComponent)childToRender=(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(FallbackComponent,props);else{if(void 0===fallback)throw error;childToRender=fallback}}return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(ErrorBoundaryContext.Provider,{value:{didCatch,error,resetErrorBoundary:this.resetErrorBoundary}},childToRender)}}},"./node_modules/react-intersection-observer-hook/dist/react-intersection-observer-hook.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>useIntersectionObserver});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function createObserverCache(){var cachesByRoot=new Map;return{getObserver:function getObserver(_ref){var root=_ref.root,rootMargin=_ref.rootMargin,threshold=_ref.threshold,cacheByRoot=cachesByRoot.get(root);cacheByRoot||(cacheByRoot=new Map,cachesByRoot.set(root,cacheByRoot));var cacheKey=JSON.stringify({rootMargin,threshold}),cachedObserver=cacheByRoot.get(cacheKey);if(!cachedObserver){var entryCallbacks=new Map,observer=new IntersectionObserver((function(entries){entries.forEach((function(entry){var callback=entryCallbacks.get(entry.target);null==callback||callback(entry)}))}),{root,rootMargin,threshold});cachedObserver={observer,entryCallbacks},cacheByRoot.set(cacheKey,cachedObserver)}return{observe:function observe(node,callback){var _cachedObserver,_cachedObserver2;null==(_cachedObserver=cachedObserver)||_cachedObserver.entryCallbacks.set(node,callback),null==(_cachedObserver2=cachedObserver)||_cachedObserver2.observer.observe(node)},unobserve:function unobserve(node){var _cachedObserver3,_cachedObserver4;null==(_cachedObserver3=cachedObserver)||_cachedObserver3.entryCallbacks.delete(node),null==(_cachedObserver4=cachedObserver)||_cachedObserver4.observer.unobserve(node)}}}}}var DEFAULT_ROOT_MARGIN="0px",DEFAULT_THRESHOLD=[0],observerCache=createObserverCache();function useIntersectionObserver(args){var _args$rootMargin,_args$threshold,rootMargin=null!=(_args$rootMargin=null==args?void 0:args.rootMargin)?_args$rootMargin:DEFAULT_ROOT_MARGIN,threshold=null!=(_args$threshold=null==args?void 0:args.threshold)?_args$threshold:DEFAULT_THRESHOLD,nodeRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),rootRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),observerRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),_useState=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(),entry=_useState[0],setEntry=_useState[1],observe=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){var node=nodeRef.current;if(node){var observer=observerCache.getObserver({root:rootRef.current,rootMargin,threshold});observer.observe(node,(function(observedEntry){setEntry(observedEntry)})),observerRef.current=observer}else setEntry(void 0)}),[rootMargin,threshold]),unobserve=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(){var currentObserver=observerRef.current,node=nodeRef.current;node&&(null==currentObserver||currentObserver.unobserve(node)),observerRef.current=null}),[]);return[(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(node){unobserve(),nodeRef.current=node,observe()}),[observe,unobserve]),{entry,rootRef:(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(rootNode){unobserve(),rootRef.current=rootNode,observe()}),[observe,unobserve])}]}},"./node_modules/style-mod/src/style-mod.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>StyleModule});const COUNT="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),SET="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),top="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class StyleModule{constructor(spec,options){this.rules=[];let{finish}=options||{};function splitSelector(selector){return/^@/.test(selector)?[selector]:selector.split(/,\s*/)}function render(selectors,spec,target,isKeyframes){let local=[],isAt=/^@(\w+)\b/.exec(selectors[0]),keyframes=isAt&&"keyframes"==isAt[1];if(isAt&&null==spec)return target.push(selectors[0]+";");for(let prop in spec){let value=spec[prop];if(/&/.test(prop))render(prop.split(/,\s*/).map((part=>selectors.map((sel=>part.replace(/&/,sel))))).reduce(((a,b)=>a.concat(b))),value,target);else if(value&&"object"==typeof value){if(!isAt)throw new RangeError("The value of a property ("+prop+") should be a primitive value.");render(splitSelector(prop),value,local,keyframes)}else null!=value&&local.push(prop.replace(/_.*/,"").replace(/[A-Z]/g,(l=>"-"+l.toLowerCase()))+": "+value+";")}(local.length||keyframes)&&target.push((!finish||isAt||isKeyframes?selectors:selectors.map(finish)).join(", ")+" {"+local.join(" ")+"}")}for(let prop in spec)render(splitSelector(prop),spec[prop],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let id=top[COUNT]||1;return top[COUNT]=id+1,"ͼ"+id.toString(36)}static mount(root,modules,options){let set=root[SET],nonce=options&&options.nonce;set?nonce&&set.setNonce(nonce):set=new StyleSet(root,nonce),set.mount(Array.isArray(modules)?modules:[modules],root)}}let adoptedSet=new Map;class StyleSet{constructor(root,nonce){let doc=root.ownerDocument||root,win=doc.defaultView;if(!root.head&&root.adoptedStyleSheets&&win.CSSStyleSheet){let adopted=adoptedSet.get(doc);if(adopted)return root[SET]=adopted;this.sheet=new win.CSSStyleSheet,adoptedSet.set(doc,this)}else this.styleTag=doc.createElement("style"),nonce&&this.styleTag.setAttribute("nonce",nonce);this.modules=[],root[SET]=this}mount(modules,root){let sheet=this.sheet,pos=0,j=0;for(let i=0;i<modules.length;i++){let mod=modules[i],index=this.modules.indexOf(mod);if(index<j&&index>-1&&(this.modules.splice(index,1),j--,index=-1),-1==index){if(this.modules.splice(j++,0,mod),sheet)for(let k=0;k<mod.rules.length;k++)sheet.insertRule(mod.rules[k],pos++)}else{for(;j<index;)pos+=this.modules[j++].rules.length;pos+=mod.rules.length,j++}}if(sheet)root.adoptedStyleSheets.indexOf(this.sheet)<0&&(root.adoptedStyleSheets=[this.sheet,...root.adoptedStyleSheets]);else{let text="";for(let i=0;i<this.modules.length;i++)text+=this.modules[i].getRules()+"\n";this.styleTag.textContent=text;let target=root.head||root;this.styleTag.parentNode!=target&&target.insertBefore(this.styleTag,target.firstChild)}}setNonce(nonce){this.styleTag&&this.styleTag.getAttribute("nonce")!=nonce&&this.styleTag.setAttribute("nonce",nonce)}}},"./node_modules/yjs/dist/yjs.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{JA:()=>Doc,T5:()=>YMap,EY:()=>YText,ad:()=>UndoManager,WF:()=>YXmlElement,ZQ:()=>YXmlText,Cr:()=>YMapEvent,zN:()=>YTextEvent,xz:()=>YXmlEvent,QE:()=>applyUpdate,Qs:()=>applyUpdateV2,uG:()=>compareRelativePositions,IT:()=>createAbsolutePositionFromRelativePosition,sH:()=>createRelativePositionFromJSON,SF:()=>createRelativePositionFromTypeIndex,PR:()=>encodeStateAsUpdate,FX:()=>encodeStateVector,TB:()=>relativePositionToJSON});var observable=__webpack_require__("./node_modules/lib0/observable.js"),array=__webpack_require__("./node_modules/lib0/array.js"),lib0_math=__webpack_require__("./node_modules/lib0/math.js"),lib0_map=__webpack_require__("./node_modules/lib0/map.js"),lib0_encoding=__webpack_require__("./node_modules/lib0/encoding.js"),lib0_decoding=__webpack_require__("./node_modules/lib0/decoding.js");crypto.subtle;const webcrypto_getRandomValues=crypto.getRandomValues.bind(crypto),uint32=(Math.random,()=>webcrypto_getRandomValues(new Uint32Array(1))[0]),uuidv4Template=[1e7]+-1e3+-4e3+-8e3+-1e11,uuidv4=()=>uuidv4Template.replace(/[018]/g,(c=>(c^uint32()&15>>c/4).toString(16))),create=f=>new Promise(f);Promise.all.bind(Promise);var buffer=__webpack_require__("./node_modules/lib0/buffer.js"),lib0_error=__webpack_require__("./node_modules/lib0/error.js"),lib0_binary=__webpack_require__("./node_modules/lib0/binary.js"),lib0_function=__webpack_require__("./node_modules/lib0/function.js"),set=__webpack_require__("./node_modules/lib0/set.js"),environment=__webpack_require__("./node_modules/lib0/environment.js");class Pair{constructor(left,right){this.left=left,this.right=right}}const pair_create=(left,right)=>new Pair(left,right),doc="undefined"!=typeof document?document:{},symbol_create=("undefined"!=typeof DOMParser&&new DOMParser,doc.ELEMENT_NODE,doc.TEXT_NODE,doc.CDATA_SECTION_NODE,doc.COMMENT_NODE,doc.DOCUMENT_NODE,doc.DOCUMENT_TYPE_NODE,doc.DOCUMENT_FRAGMENT_NODE,Symbol);var lib0_time=__webpack_require__("./node_modules/lib0/time.js");const BOLD=symbol_create(),UNBOLD=symbol_create(),BLUE=symbol_create(),GREY=symbol_create(),GREEN=symbol_create(),RED=symbol_create(),PURPLE=symbol_create(),ORANGE=symbol_create(),UNCOLOR=symbol_create();lib0_time._g();var console=__webpack_require__("./node_modules/console-browserify/index.js");const _browserStyleMap={[BOLD]:pair_create("font-weight","bold"),[UNBOLD]:pair_create("font-weight","normal"),[BLUE]:pair_create("color","blue"),[GREEN]:pair_create("color","green"),[GREY]:pair_create("color","grey"),[RED]:pair_create("color","red"),[PURPLE]:pair_create("color","purple"),[ORANGE]:pair_create("color","orange"),[UNCOLOR]:pair_create("color","black")},computeLoggingArgs=environment.WI?args=>{1===args.length&&args[0]?.constructor===Function&&(args=args[0]());const strBuilder=[],styles=[],currentStyle=lib0_map.vt();let logArgs=[],i=0;for(;i<args.length;i++){const arg=args[i],style=_browserStyleMap[arg];if(void 0!==style)currentStyle.set(style.left,style.right);else{if(void 0===arg)break;if(arg.constructor!==String&&arg.constructor!==Number)break;{const style=(m=currentStyle,lib0_map.Tj(m,((value,key)=>`${key}:${value};`)).join(""));i>0||style.length>0?(strBuilder.push("%c"+arg),styles.push(style)):strBuilder.push(arg)}}}var m;for(i>0&&(logArgs=styles,logArgs.unshift(strBuilder.join("")));i<args.length;i++){const arg=args[i];arg instanceof Symbol||logArgs.push(arg)}return logArgs}:args=>{1===args.length&&args[0]?.constructor===Function&&(args=args[0]());const strBuilder=[],logArgs=[];let i=0;for(;i<args.length;i++){const arg=args[i];if(void 0===arg)break;if(arg.constructor===String||arg.constructor===Number)strBuilder.push(arg);else if(arg.constructor===Object)break}for(i>0&&logArgs.push(strBuilder.join(""));i<args.length;i++){const arg=args[i];arg instanceof Symbol||logArgs.push(arg)}return logArgs},print=(...args)=>{console.log(...computeLoggingArgs(args)),vconsoles.forEach((vc=>vc.print(args)))},warn=(...args)=>{console.warn(...computeLoggingArgs(args)),args.unshift(ORANGE),vconsoles.forEach((vc=>vc.print(args)))},vconsoles=set.vt();const createIterator=next=>({[Symbol.iterator](){return this},next}),iteratorMap=(iterator,fmap)=>createIterator((()=>{const{done,value}=iterator.next();return{done,value:done?void 0:fmap(value)}}));var object=__webpack_require__("./node_modules/lib0/object.js"),yjs_console=__webpack_require__("./node_modules/console-browserify/index.js");observable.W;class DeleteItem{constructor(clock,len){this.clock=clock,this.len=len}}class DeleteSet{constructor(){this.clients=new Map}}const iterateDeletedStructs=(transaction,ds,f)=>ds.clients.forEach(((deletes,clientid)=>{const structs=transaction.doc.store.clients.get(clientid);for(let i=0;i<deletes.length;i++){const del=deletes[i];iterateStructs(transaction,structs,del.clock,del.len,f)}})),isDeleted=(ds,id)=>{const dis=ds.clients.get(id.client);return void 0!==dis&&null!==((dis,clock)=>{let left=0,right=dis.length-1;for(;left<=right;){const midindex=lib0_math.RI((left+right)/2),mid=dis[midindex],midclock=mid.clock;if(midclock<=clock){if(clock<midclock+mid.len)return midindex;left=midindex+1}else right=midindex-1}return null})(dis,id.clock)},sortAndMergeDeleteSet=ds=>{ds.clients.forEach((dels=>{let i,j;for(dels.sort(((a,b)=>a.clock-b.clock)),i=1,j=1;i<dels.length;i++){const left=dels[j-1],right=dels[i];left.clock+left.len>=right.clock?left.len=lib0_math.T9(left.len,right.clock+right.len-left.clock):(j<i&&(dels[j]=right),j++)}dels.length=j}))},mergeDeleteSets=dss=>{const merged=new DeleteSet;for(let dssI=0;dssI<dss.length;dssI++)dss[dssI].clients.forEach(((delsLeft,client)=>{if(!merged.clients.has(client)){const dels=delsLeft.slice();for(let i=dssI+1;i<dss.length;i++)array.S2(dels,dss[i].clients.get(client)||[]);merged.clients.set(client,dels)}}));return sortAndMergeDeleteSet(merged),merged},addToDeleteSet=(ds,client,clock,length)=>{lib0_map._4(ds.clients,client,(()=>[])).push(new DeleteItem(clock,length))},createDeleteSet=()=>new DeleteSet,createDeleteSetFromStructStore=ss=>{const ds=createDeleteSet();return ss.clients.forEach(((structs,client)=>{const dsitems=[];for(let i=0;i<structs.length;i++){const struct=structs[i];if(struct.deleted){const clock=struct.id.clock;let len=struct.length;if(i+1<structs.length)for(let next=structs[i+1];i+1<structs.length&&next.deleted;next=structs[1+ ++i])len+=next.length;dsitems.push(new DeleteItem(clock,len))}}dsitems.length>0&&ds.clients.set(client,dsitems)})),ds},writeDeleteSet=(encoder,ds)=>{lib0_encoding.zd(encoder.restEncoder,ds.clients.size),array.HT(ds.clients.entries()).sort(((a,b)=>b[0]-a[0])).forEach((([client,dsitems])=>{encoder.resetDsCurVal(),lib0_encoding.zd(encoder.restEncoder,client);const len=dsitems.length;lib0_encoding.zd(encoder.restEncoder,len);for(let i=0;i<len;i++){const item=dsitems[i];encoder.writeDsClock(item.clock),encoder.writeDsLen(item.len)}}))},readDeleteSet=decoder=>{const ds=new DeleteSet,numClients=lib0_decoding.cw(decoder.restDecoder);for(let i=0;i<numClients;i++){decoder.resetDsCurVal();const client=lib0_decoding.cw(decoder.restDecoder),numberOfDeletes=lib0_decoding.cw(decoder.restDecoder);if(numberOfDeletes>0){const dsField=lib0_map._4(ds.clients,client,(()=>[]));for(let i=0;i<numberOfDeletes;i++)dsField.push(new DeleteItem(decoder.readDsClock(),decoder.readDsLen()))}}return ds},readAndApplyDeleteSet=(decoder,transaction,store)=>{const unappliedDS=new DeleteSet,numClients=lib0_decoding.cw(decoder.restDecoder);for(let i=0;i<numClients;i++){decoder.resetDsCurVal();const client=lib0_decoding.cw(decoder.restDecoder),numberOfDeletes=lib0_decoding.cw(decoder.restDecoder),structs=store.clients.get(client)||[],state=getState(store,client);for(let i=0;i<numberOfDeletes;i++){const clock=decoder.readDsClock(),clockEnd=clock+decoder.readDsLen();if(clock<state){state<clockEnd&&addToDeleteSet(unappliedDS,client,state,clockEnd-state);let index=findIndexSS(structs,clock),struct=structs[index];for(!struct.deleted&&struct.id.clock<clock&&(structs.splice(index+1,0,splitItem(transaction,struct,clock-struct.id.clock)),index++);index<structs.length&&(struct=structs[index++],struct.id.clock<clockEnd);)struct.deleted||(clockEnd<struct.id.clock+struct.length&&structs.splice(index,0,splitItem(transaction,struct,clockEnd-struct.id.clock)),struct.delete(transaction))}else addToDeleteSet(unappliedDS,client,clock,clockEnd-clock)}}if(unappliedDS.clients.size>0){const ds=new UpdateEncoderV2;return lib0_encoding.zd(ds.restEncoder,0),writeDeleteSet(ds,unappliedDS),ds.toUint8Array()}return null},generateNewClientId=uint32;class Doc extends observable.W{constructor({guid=uuidv4(),collectionid=null,gc=!0,gcFilter=()=>!0,meta=null,autoLoad=!1,shouldLoad=!0}={}){super(),this.gc=gc,this.gcFilter=gcFilter,this.clientID=generateNewClientId(),this.guid=guid,this.collectionid=collectionid,this.share=new Map,this.store=new StructStore,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=shouldLoad,this.autoLoad=autoLoad,this.meta=meta,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=create((resolve=>{this.on("load",(()=>{this.isLoaded=!0,resolve(this)}))}));const provideSyncedPromise=()=>create((resolve=>{const eventHandler=isSynced=>{void 0!==isSynced&&!0!==isSynced||(this.off("sync",eventHandler),resolve())};this.on("sync",eventHandler)}));this.on("sync",(isSynced=>{!1===isSynced&&this.isSynced&&(this.whenSynced=provideSyncedPromise()),this.isSynced=void 0===isSynced||!0===isSynced,this.isSynced&&!this.isLoaded&&this.emit("load",[this])})),this.whenSynced=provideSyncedPromise()}load(){const item=this._item;null===item||this.shouldLoad||transact(item.parent.doc,(transaction=>{transaction.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(array.HT(this.subdocs).map((doc=>doc.guid)))}transact(f,origin=null){return transact(this,f,origin)}get(name,TypeConstructor=AbstractType){const type=lib0_map._4(this.share,name,(()=>{const t=new TypeConstructor;return t._integrate(this,null),t})),Constr=type.constructor;if(TypeConstructor!==AbstractType&&Constr!==TypeConstructor){if(Constr===AbstractType){const t=new TypeConstructor;t._map=type._map,type._map.forEach((n=>{for(;null!==n;n=n.left)n.parent=t})),t._start=type._start;for(let n=t._start;null!==n;n=n.right)n.parent=t;return t._length=type._length,this.share.set(name,t),t._integrate(this,null),t}throw new Error(`Type with the name ${name} has already been defined with a different constructor`)}return type}getArray(name=""){return this.get(name,YArray)}getText(name=""){return this.get(name,YText)}getMap(name=""){return this.get(name,YMap)}getXmlElement(name=""){return this.get(name,YXmlElement)}getXmlFragment(name=""){return this.get(name,YXmlFragment)}toJSON(){const doc={};return this.share.forEach(((value,key)=>{doc[key]=value.toJSON()})),doc}destroy(){this.isDestroyed=!0,array.HT(this.subdocs).forEach((subdoc=>subdoc.destroy()));const item=this._item;if(null!==item){this._item=null;const content=item.content;content.doc=new Doc({guid:this.guid,...content.opts,shouldLoad:!1}),content.doc._item=item,transact(item.parent.doc,(transaction=>{const doc=content.doc;item.deleted||transaction.subdocsAdded.add(doc),transaction.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class DSDecoderV1{constructor(decoder){this.restDecoder=decoder}resetDsCurVal(){}readDsClock(){return lib0_decoding.cw(this.restDecoder)}readDsLen(){return lib0_decoding.cw(this.restDecoder)}}class UpdateDecoderV1 extends DSDecoderV1{readLeftID(){return createID(lib0_decoding.cw(this.restDecoder),lib0_decoding.cw(this.restDecoder))}readRightID(){return createID(lib0_decoding.cw(this.restDecoder),lib0_decoding.cw(this.restDecoder))}readClient(){return lib0_decoding.cw(this.restDecoder)}readInfo(){return lib0_decoding.xh(this.restDecoder)}readString(){return lib0_decoding.t3(this.restDecoder)}readParentInfo(){return 1===lib0_decoding.cw(this.restDecoder)}readTypeRef(){return lib0_decoding.cw(this.restDecoder)}readLen(){return lib0_decoding.cw(this.restDecoder)}readAny(){return lib0_decoding.Jg(this.restDecoder)}readBuf(){return buffer.HR(lib0_decoding.bo(this.restDecoder))}readJSON(){return JSON.parse(lib0_decoding.t3(this.restDecoder))}readKey(){return lib0_decoding.t3(this.restDecoder)}}class DSDecoderV2{constructor(decoder){this.dsCurrVal=0,this.restDecoder=decoder}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=lib0_decoding.cw(this.restDecoder),this.dsCurrVal}readDsLen(){const diff=lib0_decoding.cw(this.restDecoder)+1;return this.dsCurrVal+=diff,diff}}class UpdateDecoderV2 extends DSDecoderV2{constructor(decoder){super(decoder),this.keys=[],lib0_decoding.cw(decoder),this.keyClockDecoder=new lib0_decoding.xK(lib0_decoding.bo(decoder)),this.clientDecoder=new lib0_decoding.VQ(lib0_decoding.bo(decoder)),this.leftClockDecoder=new lib0_decoding.xK(lib0_decoding.bo(decoder)),this.rightClockDecoder=new lib0_decoding.xK(lib0_decoding.bo(decoder)),this.infoDecoder=new lib0_decoding.cQ(lib0_decoding.bo(decoder),lib0_decoding.xh),this.stringDecoder=new lib0_decoding.Ib(lib0_decoding.bo(decoder)),this.parentInfoDecoder=new lib0_decoding.cQ(lib0_decoding.bo(decoder),lib0_decoding.xh),this.typeRefDecoder=new lib0_decoding.VQ(lib0_decoding.bo(decoder)),this.lenDecoder=new lib0_decoding.VQ(lib0_decoding.bo(decoder))}readLeftID(){return new ID(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ID(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return lib0_decoding.Jg(this.restDecoder)}readBuf(){return lib0_decoding.bo(this.restDecoder)}readJSON(){return lib0_decoding.Jg(this.restDecoder)}readKey(){const keyClock=this.keyClockDecoder.read();if(keyClock<this.keys.length)return this.keys[keyClock];{const key=this.stringDecoder.read();return this.keys.push(key),key}}}class DSEncoderV1{constructor(){this.restEncoder=lib0_encoding.xv()}toUint8Array(){return lib0_encoding.Fo(this.restEncoder)}resetDsCurVal(){}writeDsClock(clock){lib0_encoding.zd(this.restEncoder,clock)}writeDsLen(len){lib0_encoding.zd(this.restEncoder,len)}}class UpdateEncoderV1 extends DSEncoderV1{writeLeftID(id){lib0_encoding.zd(this.restEncoder,id.client),lib0_encoding.zd(this.restEncoder,id.clock)}writeRightID(id){lib0_encoding.zd(this.restEncoder,id.client),lib0_encoding.zd(this.restEncoder,id.clock)}writeClient(client){lib0_encoding.zd(this.restEncoder,client)}writeInfo(info){lib0_encoding.QJ(this.restEncoder,info)}writeString(s){lib0_encoding.Qj(this.restEncoder,s)}writeParentInfo(isYKey){lib0_encoding.zd(this.restEncoder,isYKey?1:0)}writeTypeRef(info){lib0_encoding.zd(this.restEncoder,info)}writeLen(len){lib0_encoding.zd(this.restEncoder,len)}writeAny(any){lib0_encoding.IO(this.restEncoder,any)}writeBuf(buf){lib0_encoding.Gu(this.restEncoder,buf)}writeJSON(embed){lib0_encoding.Qj(this.restEncoder,JSON.stringify(embed))}writeKey(key){lib0_encoding.Qj(this.restEncoder,key)}}class DSEncoderV2{constructor(){this.restEncoder=lib0_encoding.xv(),this.dsCurrVal=0}toUint8Array(){return lib0_encoding.Fo(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(clock){const diff=clock-this.dsCurrVal;this.dsCurrVal=clock,lib0_encoding.zd(this.restEncoder,diff)}writeDsLen(len){0===len&&lib0_error.Mq(),lib0_encoding.zd(this.restEncoder,len-1),this.dsCurrVal+=len}}class UpdateEncoderV2 extends DSEncoderV2{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new lib0_encoding.FA,this.clientEncoder=new lib0_encoding.D$,this.leftClockEncoder=new lib0_encoding.FA,this.rightClockEncoder=new lib0_encoding.FA,this.infoEncoder=new lib0_encoding.cq(lib0_encoding.QJ),this.stringEncoder=new lib0_encoding.Sw,this.parentInfoEncoder=new lib0_encoding.cq(lib0_encoding.QJ),this.typeRefEncoder=new lib0_encoding.D$,this.lenEncoder=new lib0_encoding.D$}toUint8Array(){const encoder=lib0_encoding.xv();return lib0_encoding.zd(encoder,0),lib0_encoding.Gu(encoder,this.keyClockEncoder.toUint8Array()),lib0_encoding.Gu(encoder,this.clientEncoder.toUint8Array()),lib0_encoding.Gu(encoder,this.leftClockEncoder.toUint8Array()),lib0_encoding.Gu(encoder,this.rightClockEncoder.toUint8Array()),lib0_encoding.Gu(encoder,lib0_encoding.Fo(this.infoEncoder)),lib0_encoding.Gu(encoder,this.stringEncoder.toUint8Array()),lib0_encoding.Gu(encoder,lib0_encoding.Fo(this.parentInfoEncoder)),lib0_encoding.Gu(encoder,this.typeRefEncoder.toUint8Array()),lib0_encoding.Gu(encoder,this.lenEncoder.toUint8Array()),lib0_encoding.LH(encoder,lib0_encoding.Fo(this.restEncoder)),lib0_encoding.Fo(encoder)}writeLeftID(id){this.clientEncoder.write(id.client),this.leftClockEncoder.write(id.clock)}writeRightID(id){this.clientEncoder.write(id.client),this.rightClockEncoder.write(id.clock)}writeClient(client){this.clientEncoder.write(client)}writeInfo(info){this.infoEncoder.write(info)}writeString(s){this.stringEncoder.write(s)}writeParentInfo(isYKey){this.parentInfoEncoder.write(isYKey?1:0)}writeTypeRef(info){this.typeRefEncoder.write(info)}writeLen(len){this.lenEncoder.write(len)}writeAny(any){lib0_encoding.IO(this.restEncoder,any)}writeBuf(buf){lib0_encoding.Gu(this.restEncoder,buf)}writeJSON(embed){lib0_encoding.IO(this.restEncoder,embed)}writeKey(key){const clock=this.keyMap.get(key);void 0===clock?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(key)):this.keyClockEncoder.write(clock)}}const writeClientsStructs=(encoder,store,_sm)=>{const sm=new Map;_sm.forEach(((clock,client)=>{getState(store,client)>clock&&sm.set(client,clock)})),getStateVector(store).forEach(((_clock,client)=>{_sm.has(client)||sm.set(client,0)})),lib0_encoding.zd(encoder.restEncoder,sm.size),array.HT(sm.entries()).sort(((a,b)=>b[0]-a[0])).forEach((([client,clock])=>{((encoder,structs,client,clock)=>{clock=lib0_math.T9(clock,structs[0].id.clock);const startNewStructs=findIndexSS(structs,clock);lib0_encoding.zd(encoder.restEncoder,structs.length-startNewStructs),encoder.writeClient(client),lib0_encoding.zd(encoder.restEncoder,clock);const firstStruct=structs[startNewStructs];firstStruct.write(encoder,clock-firstStruct.id.clock);for(let i=startNewStructs+1;i<structs.length;i++)structs[i].write(encoder,0)})(encoder,store.clients.get(client),client,clock)}))},readUpdateV2=(decoder,ydoc,transactionOrigin,structDecoder=new UpdateDecoderV2(decoder))=>transact(ydoc,(transaction=>{transaction.local=!1;let retry=!1;const doc=transaction.doc,store=doc.store,ss=((decoder,doc)=>{const clientRefs=lib0_map.vt(),numOfStateUpdates=lib0_decoding.cw(decoder.restDecoder);for(let i=0;i<numOfStateUpdates;i++){const numberOfStructs=lib0_decoding.cw(decoder.restDecoder),refs=new Array(numberOfStructs),client=decoder.readClient();let clock=lib0_decoding.cw(decoder.restDecoder);clientRefs.set(client,{i:0,refs});for(let i=0;i<numberOfStructs;i++){const info=decoder.readInfo();switch(lib0_binary.WY&info){case 0:{const len=decoder.readLen();refs[i]=new GC(createID(client,clock),len),clock+=len;break}case 10:{const len=lib0_decoding.cw(decoder.restDecoder);refs[i]=new Skip(createID(client,clock),len),clock+=len;break}default:{const cantCopyParentInfo=!(info&(lib0_binary.D7|lib0_binary.wt)),struct=new Item(createID(client,clock),null,(info&lib0_binary.wt)===lib0_binary.wt?decoder.readLeftID():null,null,(info&lib0_binary.D7)===lib0_binary.D7?decoder.readRightID():null,cantCopyParentInfo?decoder.readParentInfo()?doc.get(decoder.readString()):decoder.readLeftID():null,cantCopyParentInfo&&(info&lib0_binary.KJ)===lib0_binary.KJ?decoder.readString():null,readItemContent(decoder,info));refs[i]=struct,clock+=struct.length}}}}return clientRefs})(structDecoder,doc),restStructs=((transaction,store,clientsStructRefs)=>{const stack=[];let clientsStructRefsIds=array.HT(clientsStructRefs.keys()).sort(((a,b)=>a-b));if(0===clientsStructRefsIds.length)return null;const getNextStructTarget=()=>{if(0===clientsStructRefsIds.length)return null;let nextStructsTarget=clientsStructRefs.get(clientsStructRefsIds[clientsStructRefsIds.length-1]);for(;nextStructsTarget.refs.length===nextStructsTarget.i;){if(clientsStructRefsIds.pop(),!(clientsStructRefsIds.length>0))return null;nextStructsTarget=clientsStructRefs.get(clientsStructRefsIds[clientsStructRefsIds.length-1])}return nextStructsTarget};let curStructsTarget=getNextStructTarget();if(null===curStructsTarget)return null;const restStructs=new StructStore,missingSV=new Map,updateMissingSv=(client,clock)=>{const mclock=missingSV.get(client);(null==mclock||mclock>clock)&&missingSV.set(client,clock)};let stackHead=curStructsTarget.refs[curStructsTarget.i++];const state=new Map,addStackToRestSS=()=>{for(const item of stack){const client=item.id.client,inapplicableItems=clientsStructRefs.get(client);inapplicableItems?(inapplicableItems.i--,restStructs.clients.set(client,inapplicableItems.refs.slice(inapplicableItems.i)),clientsStructRefs.delete(client),inapplicableItems.i=0,inapplicableItems.refs=[]):restStructs.clients.set(client,[item]),clientsStructRefsIds=clientsStructRefsIds.filter((c=>c!==client))}stack.length=0};for(;;){if(stackHead.constructor!==Skip){const offset=lib0_map._4(state,stackHead.id.client,(()=>getState(store,stackHead.id.client)))-stackHead.id.clock;if(offset<0)stack.push(stackHead),updateMissingSv(stackHead.id.client,stackHead.id.clock-1),addStackToRestSS();else{const missing=stackHead.getMissing(transaction,store);if(null!==missing){stack.push(stackHead);const structRefs=clientsStructRefs.get(missing)||{refs:[],i:0};if(structRefs.refs.length!==structRefs.i){stackHead=structRefs.refs[structRefs.i++];continue}updateMissingSv(missing,getState(store,missing)),addStackToRestSS()}else(0===offset||offset<stackHead.length)&&(stackHead.integrate(transaction,offset),state.set(stackHead.id.client,stackHead.id.clock+stackHead.length))}}if(stack.length>0)stackHead=stack.pop();else if(null!==curStructsTarget&&curStructsTarget.i<curStructsTarget.refs.length)stackHead=curStructsTarget.refs[curStructsTarget.i++];else{if(curStructsTarget=getNextStructTarget(),null===curStructsTarget)break;stackHead=curStructsTarget.refs[curStructsTarget.i++]}}if(restStructs.clients.size>0){const encoder=new UpdateEncoderV2;return writeClientsStructs(encoder,restStructs,new Map),lib0_encoding.zd(encoder.restEncoder,0),{missing:missingSV,update:encoder.toUint8Array()}}return null})(transaction,store,ss),pending=store.pendingStructs;if(pending){for(const[client,clock]of pending.missing)if(clock<getState(store,client)){retry=!0;break}if(restStructs){for(const[client,clock]of restStructs.missing){const mclock=pending.missing.get(client);(null==mclock||mclock>clock)&&pending.missing.set(client,clock)}pending.update=mergeUpdatesV2([pending.update,restStructs.update])}}else store.pendingStructs=restStructs;const dsRest=readAndApplyDeleteSet(structDecoder,transaction,store);if(store.pendingDs){const pendingDSUpdate=new UpdateDecoderV2(lib0_decoding.$C(store.pendingDs));lib0_decoding.cw(pendingDSUpdate.restDecoder);const dsRest2=readAndApplyDeleteSet(pendingDSUpdate,transaction,store);store.pendingDs=dsRest&&dsRest2?mergeUpdatesV2([dsRest,dsRest2]):dsRest||dsRest2}else store.pendingDs=dsRest;if(retry){const update=store.pendingStructs.update;store.pendingStructs=null,applyUpdateV2(transaction.doc,update)}}),transactionOrigin,!1),applyUpdateV2=(ydoc,update,transactionOrigin,YDecoder=UpdateDecoderV2)=>{const decoder=lib0_decoding.$C(update);readUpdateV2(decoder,ydoc,transactionOrigin,new YDecoder(decoder))},applyUpdate=(ydoc,update,transactionOrigin)=>applyUpdateV2(ydoc,update,transactionOrigin,UpdateDecoderV1),encodeStateAsUpdateV2=(doc,encodedTargetStateVector=new Uint8Array([0]),encoder=new UpdateEncoderV2)=>{((encoder,doc,targetStateVector=new Map)=>{writeClientsStructs(encoder,doc.store,targetStateVector),writeDeleteSet(encoder,createDeleteSetFromStructStore(doc.store))})(encoder,doc,decodeStateVector(encodedTargetStateVector));const updates=[encoder.toUint8Array()];if(doc.store.pendingDs&&updates.push(doc.store.pendingDs),doc.store.pendingStructs&&updates.push(diffUpdateV2(doc.store.pendingStructs.update,encodedTargetStateVector)),updates.length>1){if(encoder.constructor===UpdateEncoderV1)return mergeUpdates(updates.map(((update,i)=>0===i?update:convertUpdateFormatV2ToV1(update))));if(encoder.constructor===UpdateEncoderV2)return mergeUpdatesV2(updates)}return updates[0]},encodeStateAsUpdate=(doc,encodedTargetStateVector)=>encodeStateAsUpdateV2(doc,encodedTargetStateVector,new UpdateEncoderV1),readStateVector=decoder=>{const ss=new Map,ssLength=lib0_decoding.cw(decoder.restDecoder);for(let i=0;i<ssLength;i++){const client=lib0_decoding.cw(decoder.restDecoder),clock=lib0_decoding.cw(decoder.restDecoder);ss.set(client,clock)}return ss},decodeStateVector=decodedState=>readStateVector(new DSDecoderV1(lib0_decoding.$C(decodedState))),writeStateVector=(encoder,sv)=>(lib0_encoding.zd(encoder.restEncoder,sv.size),array.HT(sv.entries()).sort(((a,b)=>b[0]-a[0])).forEach((([client,clock])=>{lib0_encoding.zd(encoder.restEncoder,client),lib0_encoding.zd(encoder.restEncoder,clock)})),encoder),encodeStateVectorV2=(doc,encoder=new DSEncoderV2)=>(doc instanceof Map?writeStateVector(encoder,doc):((encoder,doc)=>{writeStateVector(encoder,getStateVector(doc.store))})(encoder,doc),encoder.toUint8Array()),encodeStateVector=doc=>encodeStateVectorV2(doc,new DSEncoderV1);class EventHandler{constructor(){this.l=[]}}const createEventHandler=()=>new EventHandler,addEventHandlerListener=(eventHandler,f)=>eventHandler.l.push(f),removeEventHandlerListener=(eventHandler,f)=>{const l=eventHandler.l,len=l.length;eventHandler.l=l.filter((g=>f!==g)),len===eventHandler.l.length&&yjs_console.error("[yjs] Tried to remove event handler that doesn't exist.")},callEventHandlerListeners=(eventHandler,arg0,arg1)=>lib0_function.OK(eventHandler.l,[arg0,arg1]);class ID{constructor(client,clock){this.client=client,this.clock=clock}}const compareIDs=(a,b)=>a===b||null!==a&&null!==b&&a.client===b.client&&a.clock===b.clock,createID=(client,clock)=>new ID(client,clock),findRootTypeKey=type=>{for(const[key,value]of type.doc.share.entries())if(value===type)return key;throw lib0_error.Mq()},yjs_isParentOf=(parent,child)=>{for(;null!==child;){if(child.parent===parent)return!0;child=child.parent._item}return!1};class RelativePosition{constructor(type,tname,item,assoc=0){this.type=type,this.tname=tname,this.item=item,this.assoc=assoc}}const relativePositionToJSON=rpos=>{const json={};return rpos.type&&(json.type=rpos.type),rpos.tname&&(json.tname=rpos.tname),rpos.item&&(json.item=rpos.item),null!=rpos.assoc&&(json.assoc=rpos.assoc),json},createRelativePositionFromJSON=json=>new RelativePosition(null==json.type?null:createID(json.type.client,json.type.clock),json.tname??null,null==json.item?null:createID(json.item.client,json.item.clock),null==json.assoc?0:json.assoc);class AbsolutePosition{constructor(type,index,assoc=0){this.type=type,this.index=index,this.assoc=assoc}}const createRelativePosition=(type,item,assoc)=>{let typeid=null,tname=null;return null===type._item?tname=findRootTypeKey(type):typeid=createID(type._item.id.client,type._item.id.clock),new RelativePosition(typeid,tname,item,assoc)},createRelativePositionFromTypeIndex=(type,index,assoc=0)=>{let t=type._start;if(assoc<0){if(0===index)return createRelativePosition(type,null,assoc);index--}for(;null!==t;){if(!t.deleted&&t.countable){if(t.length>index)return createRelativePosition(type,createID(t.id.client,t.id.clock+index),assoc);index-=t.length}if(null===t.right&&assoc<0)return createRelativePosition(type,t.lastId,assoc);t=t.right}return createRelativePosition(type,null,assoc)},createAbsolutePositionFromRelativePosition=(rpos,doc,followUndoneDeletions=!0)=>{const store=doc.store,rightID=rpos.item,typeID=rpos.type,tname=rpos.tname,assoc=rpos.assoc;let type=null,index=0;if(null!==rightID){if(getState(store,rightID.client)<=rightID.clock)return null;const res=followUndoneDeletions?followRedone(store,rightID):((store,id)=>{const item=getItem(store,id);return{item,diff:id.clock-item.id.clock}})(store,rightID),right=res.item;if(!(right instanceof Item))return null;if(type=right.parent,null===type._item||!type._item.deleted){index=right.deleted||!right.countable?0:res.diff+(assoc>=0?0:1);let n=right.left;for(;null!==n;)!n.deleted&&n.countable&&(index+=n.length),n=n.left}}else{if(null!==tname)type=doc.get(tname);else{if(null===typeID)throw lib0_error.Mq();{if(getState(store,typeID.client)<=typeID.clock)return null;const{item}=followUndoneDeletions?followRedone(store,typeID):{item:getItem(store,typeID)};if(!(item instanceof Item&&item.content instanceof ContentType))return null;type=item.content.type}}index=assoc>=0?type._length:0}return((type,index,assoc=0)=>new AbsolutePosition(type,index,assoc))(type,index,rpos.assoc)},compareRelativePositions=(a,b)=>a===b||null!==a&&null!==b&&a.tname===b.tname&&compareIDs(a.item,b.item)&&compareIDs(a.type,b.type)&&a.assoc===b.assoc;class Snapshot{constructor(ds,sv){this.ds=ds,this.sv=sv}}const createSnapshot=(ds,sm)=>new Snapshot(ds,sm),isVisible=(createSnapshot(createDeleteSet(),new Map),(item,snapshot)=>void 0===snapshot?!item.deleted:snapshot.sv.has(item.id.client)&&(snapshot.sv.get(item.id.client)||0)>item.id.clock&&!isDeleted(snapshot.ds,item.id)),splitSnapshotAffectedStructs=(transaction,snapshot)=>{const meta=lib0_map._4(transaction.meta,splitSnapshotAffectedStructs,set.vt),store=transaction.doc.store;meta.has(snapshot)||(snapshot.sv.forEach(((clock,client)=>{clock<getState(store,client)&&getItemCleanStart(transaction,createID(client,clock))})),iterateDeletedStructs(transaction,snapshot.ds,(_item=>{})),meta.add(snapshot))};class StructStore{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const getStateVector=store=>{const sm=new Map;return store.clients.forEach(((structs,client)=>{const struct=structs[structs.length-1];sm.set(client,struct.id.clock+struct.length)})),sm},getState=(store,client)=>{const structs=store.clients.get(client);if(void 0===structs)return 0;const lastStruct=structs[structs.length-1];return lastStruct.id.clock+lastStruct.length},addStruct=(store,struct)=>{let structs=store.clients.get(struct.id.client);if(void 0===structs)structs=[],store.clients.set(struct.id.client,structs);else{const lastStruct=structs[structs.length-1];if(lastStruct.id.clock+lastStruct.length!==struct.id.clock)throw lib0_error.Mq()}structs.push(struct)},findIndexSS=(structs,clock)=>{let left=0,right=structs.length-1,mid=structs[right],midclock=mid.id.clock;if(midclock===clock)return right;let midindex=lib0_math.RI(clock/(midclock+mid.length-1)*right);for(;left<=right;){if(mid=structs[midindex],midclock=mid.id.clock,midclock<=clock){if(clock<midclock+mid.length)return midindex;left=midindex+1}else right=midindex-1;midindex=lib0_math.RI((left+right)/2)}throw lib0_error.Mq()},getItem=(store,id)=>{const structs=store.clients.get(id.client);return structs[findIndexSS(structs,id.clock)]},findIndexCleanStart=(transaction,structs,clock)=>{const index=findIndexSS(structs,clock),struct=structs[index];return struct.id.clock<clock&&struct instanceof Item?(structs.splice(index+1,0,splitItem(transaction,struct,clock-struct.id.clock)),index+1):index},getItemCleanStart=(transaction,id)=>{const structs=transaction.doc.store.clients.get(id.client);return structs[findIndexCleanStart(transaction,structs,id.clock)]},getItemCleanEnd=(transaction,store,id)=>{const structs=store.clients.get(id.client),index=findIndexSS(structs,id.clock),struct=structs[index];return id.clock!==struct.id.clock+struct.length-1&&struct.constructor!==GC&&structs.splice(index+1,0,splitItem(transaction,struct,id.clock-struct.id.clock+1)),struct},iterateStructs=(transaction,structs,clockStart,len,f)=>{if(0===len)return;const clockEnd=clockStart+len;let struct,index=findIndexCleanStart(transaction,structs,clockStart);do{struct=structs[index++],clockEnd<struct.id.clock+struct.length&&findIndexCleanStart(transaction,structs,clockEnd),f(struct)}while(index<structs.length&&structs[index].id.clock<clockEnd)};class Transaction{constructor(doc,origin,local){this.doc=doc,this.deleteSet=new DeleteSet,this.beforeState=getStateVector(doc.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=origin,this.meta=new Map,this.local=local,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const writeUpdateMessageFromTransaction=(encoder,transaction)=>!(0===transaction.deleteSet.clients.size&&!lib0_map.bz(transaction.afterState,((clock,client)=>transaction.beforeState.get(client)!==clock)))&&(sortAndMergeDeleteSet(transaction.deleteSet),((encoder,transaction)=>{writeClientsStructs(encoder,transaction.doc.store,transaction.beforeState)})(encoder,transaction),writeDeleteSet(encoder,transaction.deleteSet),!0),addChangedTypeToTransaction=(transaction,type,parentSub)=>{const item=type._item;(null===item||item.id.clock<(transaction.beforeState.get(item.id.client)||0)&&!item.deleted)&&lib0_map._4(transaction.changed,type,set.vt).add(parentSub)},tryToMergeWithLefts=(structs,pos)=>{let right=structs[pos],left=structs[pos-1],i=pos;for(;i>0&&(left.deleted===right.deleted&&left.constructor===right.constructor&&left.mergeWith(right));right=left,left=structs[--i-1])right instanceof Item&&null!==right.parentSub&&right.parent._map.get(right.parentSub)===right&&right.parent._map.set(right.parentSub,left);const merged=pos-i;return merged&&structs.splice(pos+1-merged,merged),merged},tryGcDeleteSet=(ds,store,gcFilter)=>{for(const[client,deleteItems]of ds.clients.entries()){const structs=store.clients.get(client);for(let di=deleteItems.length-1;di>=0;di--){const deleteItem=deleteItems[di],endDeleteItemClock=deleteItem.clock+deleteItem.len;for(let si=findIndexSS(structs,deleteItem.clock),struct=structs[si];si<structs.length&&struct.id.clock<endDeleteItemClock;struct=structs[++si]){const struct=structs[si];if(deleteItem.clock+deleteItem.len<=struct.id.clock)break;struct instanceof Item&&struct.deleted&&!struct.keep&&gcFilter(struct)&&struct.gc(store,!1)}}}},tryMergeDeleteSet=(ds,store)=>{ds.clients.forEach(((deleteItems,client)=>{const structs=store.clients.get(client);for(let di=deleteItems.length-1;di>=0;di--){const deleteItem=deleteItems[di];for(let si=lib0_math.jk(structs.length-1,1+findIndexSS(structs,deleteItem.clock+deleteItem.len-1)),struct=structs[si];si>0&&struct.id.clock>=deleteItem.clock;struct=structs[si])si-=1+tryToMergeWithLefts(structs,si)}}))},cleanupTransactions=(transactionCleanups,i)=>{if(i<transactionCleanups.length){const transaction=transactionCleanups[i],doc=transaction.doc,store=doc.store,ds=transaction.deleteSet,mergeStructs=transaction._mergeStructs;try{sortAndMergeDeleteSet(ds),transaction.afterState=getStateVector(transaction.doc.store),doc.emit("beforeObserverCalls",[transaction,doc]);const fs=[];transaction.changed.forEach(((subs,itemtype)=>fs.push((()=>{null!==itemtype._item&&itemtype._item.deleted||itemtype._callObserver(transaction,subs)})))),fs.push((()=>{transaction.changedParentTypes.forEach(((events,type)=>{type._dEH.l.length>0&&(null===type._item||!type._item.deleted)&&((events=events.filter((event=>null===event.target._item||!event.target._item.deleted))).forEach((event=>{event.currentTarget=type,event._path=null})),events.sort(((event1,event2)=>event1.path.length-event2.path.length)),callEventHandlerListeners(type._dEH,events,transaction))}))})),fs.push((()=>doc.emit("afterTransaction",[transaction,doc]))),(0,lib0_function.OK)(fs,[]),transaction._needFormattingCleanup&&cleanupYTextAfterTransaction(transaction)}finally{doc.gc&&tryGcDeleteSet(ds,store,doc.gcFilter),tryMergeDeleteSet(ds,store),transaction.afterState.forEach(((clock,client)=>{const beforeClock=transaction.beforeState.get(client)||0;if(beforeClock!==clock){const structs=store.clients.get(client),firstChangePos=lib0_math.T9(findIndexSS(structs,beforeClock),1);for(let i=structs.length-1;i>=firstChangePos;)i-=1+tryToMergeWithLefts(structs,i)}}));for(let i=mergeStructs.length-1;i>=0;i--){const{client,clock}=mergeStructs[i].id,structs=store.clients.get(client),replacedStructPos=findIndexSS(structs,clock);replacedStructPos+1<structs.length&&tryToMergeWithLefts(structs,replacedStructPos+1)>1||replacedStructPos>0&&tryToMergeWithLefts(structs,replacedStructPos)}if(transaction.local||transaction.afterState.get(doc.clientID)===transaction.beforeState.get(doc.clientID)||(print(ORANGE,BOLD,"[yjs] ",UNBOLD,RED,"Changed the client-id because another client seems to be using it."),doc.clientID=generateNewClientId()),doc.emit("afterTransactionCleanup",[transaction,doc]),doc._observers.has("update")){const encoder=new UpdateEncoderV1;writeUpdateMessageFromTransaction(encoder,transaction)&&doc.emit("update",[encoder.toUint8Array(),transaction.origin,doc,transaction])}if(doc._observers.has("updateV2")){const encoder=new UpdateEncoderV2;writeUpdateMessageFromTransaction(encoder,transaction)&&doc.emit("updateV2",[encoder.toUint8Array(),transaction.origin,doc,transaction])}const{subdocsAdded,subdocsLoaded,subdocsRemoved}=transaction;(subdocsAdded.size>0||subdocsRemoved.size>0||subdocsLoaded.size>0)&&(subdocsAdded.forEach((subdoc=>{subdoc.clientID=doc.clientID,null==subdoc.collectionid&&(subdoc.collectionid=doc.collectionid),doc.subdocs.add(subdoc)})),subdocsRemoved.forEach((subdoc=>doc.subdocs.delete(subdoc))),doc.emit("subdocs",[{loaded:subdocsLoaded,added:subdocsAdded,removed:subdocsRemoved},doc,transaction]),subdocsRemoved.forEach((subdoc=>subdoc.destroy()))),transactionCleanups.length<=i+1?(doc._transactionCleanups=[],doc.emit("afterAllTransactions",[doc,transactionCleanups])):cleanupTransactions(transactionCleanups,i+1)}}},transact=(doc,f,origin=null,local=!0)=>{const transactionCleanups=doc._transactionCleanups;let initialCall=!1,result=null;null===doc._transaction&&(initialCall=!0,doc._transaction=new Transaction(doc,origin,local),transactionCleanups.push(doc._transaction),1===transactionCleanups.length&&doc.emit("beforeAllTransactions",[doc]),doc.emit("beforeTransaction",[doc._transaction,doc]));try{result=f(doc._transaction)}finally{if(initialCall){const finishCleanup=doc._transaction===transactionCleanups[0];doc._transaction=null,finishCleanup&&cleanupTransactions(transactionCleanups,0)}}return result};class StackItem{constructor(deletions,insertions){this.insertions=insertions,this.deletions=deletions,this.meta=new Map}}const clearUndoManagerStackItem=(tr,um,stackItem)=>{iterateDeletedStructs(tr,stackItem.deletions,(item=>{item instanceof Item&&um.scope.some((type=>yjs_isParentOf(type,item)))&&keepItem(item,!1)}))},popStackItem=(undoManager,stack,eventType)=>{let _tr=null;const doc=undoManager.doc,scope=undoManager.scope;transact(doc,(transaction=>{for(;stack.length>0&&null===undoManager.currStackItem;){const store=doc.store,stackItem=stack.pop(),itemsToRedo=new Set,itemsToDelete=[];let performedChange=!1;iterateDeletedStructs(transaction,stackItem.insertions,(struct=>{if(struct instanceof Item){if(null!==struct.redone){let{item,diff}=followRedone(store,struct.id);diff>0&&(item=getItemCleanStart(transaction,createID(item.id.client,item.id.clock+diff))),struct=item}!struct.deleted&&scope.some((type=>yjs_isParentOf(type,struct)))&&itemsToDelete.push(struct)}})),iterateDeletedStructs(transaction,stackItem.deletions,(struct=>{struct instanceof Item&&scope.some((type=>yjs_isParentOf(type,struct)))&&!isDeleted(stackItem.insertions,struct.id)&&itemsToRedo.add(struct)})),itemsToRedo.forEach((struct=>{performedChange=null!==redoItem(transaction,struct,itemsToRedo,stackItem.insertions,undoManager.ignoreRemoteMapChanges,undoManager)||performedChange}));for(let i=itemsToDelete.length-1;i>=0;i--){const item=itemsToDelete[i];undoManager.deleteFilter(item)&&(item.delete(transaction),performedChange=!0)}undoManager.currStackItem=performedChange?stackItem:null}transaction.changed.forEach(((subProps,type)=>{subProps.has(null)&&type._searchMarker&&(type._searchMarker.length=0)})),_tr=transaction}),undoManager);const res=undoManager.currStackItem;if(null!=res){const changedParentTypes=_tr.changedParentTypes;undoManager.emit("stack-item-popped",[{stackItem:res,type:eventType,changedParentTypes,origin:undoManager},undoManager]),undoManager.currStackItem=null}return res};class UndoManager extends observable.W{constructor(typeScope,{captureTimeout=500,captureTransaction=_tr=>!0,deleteFilter=()=>!0,trackedOrigins=new Set([null]),ignoreRemoteMapChanges=!1,doc=array.cy(typeScope)?typeScope[0].doc:typeScope.doc}={}){super(),this.scope=[],this.doc=doc,this.addToScope(typeScope),this.deleteFilter=deleteFilter,trackedOrigins.add(this),this.trackedOrigins=trackedOrigins,this.captureTransaction=captureTransaction,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=ignoreRemoteMapChanges,this.captureTimeout=captureTimeout,this.afterTransactionHandler=transaction=>{if(!(this.captureTransaction(transaction)&&this.scope.some((type=>transaction.changedParentTypes.has(type)))&&(this.trackedOrigins.has(transaction.origin)||transaction.origin&&this.trackedOrigins.has(transaction.origin.constructor))))return;const undoing=this.undoing,redoing=this.redoing,stack=undoing?this.redoStack:this.undoStack;undoing?this.stopCapturing():redoing||this.clear(!1,!0);const insertions=new DeleteSet;transaction.afterState.forEach(((endClock,client)=>{const startClock=transaction.beforeState.get(client)||0,len=endClock-startClock;len>0&&addToDeleteSet(insertions,client,startClock,len)}));const now=lib0_time._g();let didAdd=!1;if(this.lastChange>0&&now-this.lastChange<this.captureTimeout&&stack.length>0&&!undoing&&!redoing){const lastOp=stack[stack.length-1];lastOp.deletions=mergeDeleteSets([lastOp.deletions,transaction.deleteSet]),lastOp.insertions=mergeDeleteSets([lastOp.insertions,insertions])}else stack.push(new StackItem(transaction.deleteSet,insertions)),didAdd=!0;undoing||redoing||(this.lastChange=now),iterateDeletedStructs(transaction,transaction.deleteSet,(item=>{item instanceof Item&&this.scope.some((type=>yjs_isParentOf(type,item)))&&keepItem(item,!0)}));const changeEvent=[{stackItem:stack[stack.length-1],origin:transaction.origin,type:undoing?"redo":"undo",changedParentTypes:transaction.changedParentTypes},this];didAdd?this.emit("stack-item-added",changeEvent):this.emit("stack-item-updated",changeEvent)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",(()=>{this.destroy()}))}addToScope(ytypes){(ytypes=array.cy(ytypes)?ytypes:[ytypes]).forEach((ytype=>{this.scope.every((yt=>yt!==ytype))&&(ytype.doc!==this.doc&&warn("[yjs#509] Not same Y.Doc"),this.scope.push(ytype))}))}addTrackedOrigin(origin){this.trackedOrigins.add(origin)}removeTrackedOrigin(origin){this.trackedOrigins.delete(origin)}clear(clearUndoStack=!0,clearRedoStack=!0){(clearUndoStack&&this.canUndo()||clearRedoStack&&this.canRedo())&&this.doc.transact((tr=>{clearUndoStack&&(this.undoStack.forEach((item=>clearUndoManagerStackItem(tr,this,item))),this.undoStack=[]),clearRedoStack&&(this.redoStack.forEach((item=>clearUndoManagerStackItem(tr,this,item))),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:clearUndoStack,redoStackCleared:clearRedoStack}])}))}stopCapturing(){this.lastChange=0}undo(){let res;this.undoing=!0;try{res=popStackItem(this,this.undoStack,"undo")}finally{this.undoing=!1}return res}redo(){let res;this.redoing=!0;try{res=popStackItem(this,this.redoStack,"redo")}finally{this.redoing=!1}return res}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class LazyStructReader{constructor(decoder,filterSkips){this.gen=function*lazyStructReaderGenerator(decoder){const numOfStateUpdates=lib0_decoding.cw(decoder.restDecoder);for(let i=0;i<numOfStateUpdates;i++){const numberOfStructs=lib0_decoding.cw(decoder.restDecoder),client=decoder.readClient();let clock=lib0_decoding.cw(decoder.restDecoder);for(let i=0;i<numberOfStructs;i++){const info=decoder.readInfo();if(10===info){const len=lib0_decoding.cw(decoder.restDecoder);yield new Skip(createID(client,clock),len),clock+=len}else if(lib0_binary.WY&info){const cantCopyParentInfo=!(info&(lib0_binary.D7|lib0_binary.wt)),struct=new Item(createID(client,clock),null,(info&lib0_binary.wt)===lib0_binary.wt?decoder.readLeftID():null,null,(info&lib0_binary.D7)===lib0_binary.D7?decoder.readRightID():null,cantCopyParentInfo?decoder.readParentInfo()?decoder.readString():decoder.readLeftID():null,cantCopyParentInfo&&(info&lib0_binary.KJ)===lib0_binary.KJ?decoder.readString():null,readItemContent(decoder,info));yield struct,clock+=struct.length}else{const len=decoder.readLen();yield new GC(createID(client,clock),len),clock+=len}}}}(decoder),this.curr=null,this.done=!1,this.filterSkips=filterSkips,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Skip);return this.curr}}class LazyStructWriter{constructor(encoder){this.currClient=0,this.startClock=0,this.written=0,this.encoder=encoder,this.clientStructs=[]}}const mergeUpdates=updates=>mergeUpdatesV2(updates,UpdateDecoderV1,UpdateEncoderV1),sliceStruct=(left,diff)=>{if(left.constructor===GC){const{client,clock}=left.id;return new GC(createID(client,clock+diff),left.length-diff)}if(left.constructor===Skip){const{client,clock}=left.id;return new Skip(createID(client,clock+diff),left.length-diff)}{const leftItem=left,{client,clock}=leftItem.id;return new Item(createID(client,clock+diff),null,createID(client,clock+diff-1),null,leftItem.rightOrigin,leftItem.parent,leftItem.parentSub,leftItem.content.splice(diff))}},mergeUpdatesV2=(updates,YDecoder=UpdateDecoderV2,YEncoder=UpdateEncoderV2)=>{if(1===updates.length)return updates[0];const updateDecoders=updates.map((update=>new YDecoder(lib0_decoding.$C(update))));let lazyStructDecoders=updateDecoders.map((decoder=>new LazyStructReader(decoder,!0))),currWrite=null;const updateEncoder=new YEncoder,lazyStructEncoder=new LazyStructWriter(updateEncoder);for(;lazyStructDecoders=lazyStructDecoders.filter((dec=>null!==dec.curr)),lazyStructDecoders.sort(((dec1,dec2)=>{if(dec1.curr.id.client===dec2.curr.id.client){const clockDiff=dec1.curr.id.clock-dec2.curr.id.clock;return 0===clockDiff?dec1.curr.constructor===dec2.curr.constructor?0:dec1.curr.constructor===Skip?1:-1:clockDiff}return dec2.curr.id.client-dec1.curr.id.client})),0!==lazyStructDecoders.length;){const currDecoder=lazyStructDecoders[0],firstClient=currDecoder.curr.id.client;if(null!==currWrite){let curr=currDecoder.curr,iterated=!1;for(;null!==curr&&curr.id.clock+curr.length<=currWrite.struct.id.clock+currWrite.struct.length&&curr.id.client>=currWrite.struct.id.client;)curr=currDecoder.next(),iterated=!0;if(null===curr||curr.id.client!==firstClient||iterated&&curr.id.clock>currWrite.struct.id.clock+currWrite.struct.length)continue;if(firstClient!==currWrite.struct.id.client)writeStructToLazyStructWriter(lazyStructEncoder,currWrite.struct,currWrite.offset),currWrite={struct:curr,offset:0},currDecoder.next();else if(currWrite.struct.id.clock+currWrite.struct.length<curr.id.clock)if(currWrite.struct.constructor===Skip)currWrite.struct.length=curr.id.clock+curr.length-currWrite.struct.id.clock;else{writeStructToLazyStructWriter(lazyStructEncoder,currWrite.struct,currWrite.offset);const diff=curr.id.clock-currWrite.struct.id.clock-currWrite.struct.length;currWrite={struct:new Skip(createID(firstClient,currWrite.struct.id.clock+currWrite.struct.length),diff),offset:0}}else{const diff=currWrite.struct.id.clock+currWrite.struct.length-curr.id.clock;diff>0&&(currWrite.struct.constructor===Skip?currWrite.struct.length-=diff:curr=sliceStruct(curr,diff)),currWrite.struct.mergeWith(curr)||(writeStructToLazyStructWriter(lazyStructEncoder,currWrite.struct,currWrite.offset),currWrite={struct:curr,offset:0},currDecoder.next())}}else currWrite={struct:currDecoder.curr,offset:0},currDecoder.next();for(let next=currDecoder.curr;null!==next&&next.id.client===firstClient&&next.id.clock===currWrite.struct.id.clock+currWrite.struct.length&&next.constructor!==Skip;next=currDecoder.next())writeStructToLazyStructWriter(lazyStructEncoder,currWrite.struct,currWrite.offset),currWrite={struct:next,offset:0}}null!==currWrite&&(writeStructToLazyStructWriter(lazyStructEncoder,currWrite.struct,currWrite.offset),currWrite=null),finishLazyStructWriting(lazyStructEncoder);const dss=updateDecoders.map((decoder=>readDeleteSet(decoder))),ds=mergeDeleteSets(dss);return writeDeleteSet(updateEncoder,ds),updateEncoder.toUint8Array()},diffUpdateV2=(update,sv,YDecoder=UpdateDecoderV2,YEncoder=UpdateEncoderV2)=>{const state=decodeStateVector(sv),encoder=new YEncoder,lazyStructWriter=new LazyStructWriter(encoder),decoder=new YDecoder(lib0_decoding.$C(update)),reader=new LazyStructReader(decoder,!1);for(;reader.curr;){const curr=reader.curr,currClient=curr.id.client,svClock=state.get(currClient)||0;if(reader.curr.constructor!==Skip)if(curr.id.clock+curr.length>svClock)for(writeStructToLazyStructWriter(lazyStructWriter,curr,lib0_math.T9(svClock-curr.id.clock,0)),reader.next();reader.curr&&reader.curr.id.client===currClient;)writeStructToLazyStructWriter(lazyStructWriter,reader.curr,0),reader.next();else for(;reader.curr&&reader.curr.id.client===currClient&&reader.curr.id.clock+reader.curr.length<=svClock;)reader.next();else reader.next()}finishLazyStructWriting(lazyStructWriter);const ds=readDeleteSet(decoder);return writeDeleteSet(encoder,ds),encoder.toUint8Array()},flushLazyStructWriter=lazyWriter=>{lazyWriter.written>0&&(lazyWriter.clientStructs.push({written:lazyWriter.written,restEncoder:lib0_encoding.Fo(lazyWriter.encoder.restEncoder)}),lazyWriter.encoder.restEncoder=lib0_encoding.xv(),lazyWriter.written=0)},writeStructToLazyStructWriter=(lazyWriter,struct,offset)=>{lazyWriter.written>0&&lazyWriter.currClient!==struct.id.client&&flushLazyStructWriter(lazyWriter),0===lazyWriter.written&&(lazyWriter.currClient=struct.id.client,lazyWriter.encoder.writeClient(struct.id.client),lib0_encoding.zd(lazyWriter.encoder.restEncoder,struct.id.clock+offset)),struct.write(lazyWriter.encoder,offset),lazyWriter.written++},finishLazyStructWriting=lazyWriter=>{flushLazyStructWriter(lazyWriter);const restEncoder=lazyWriter.encoder.restEncoder;lib0_encoding.zd(restEncoder,lazyWriter.clientStructs.length);for(let i=0;i<lazyWriter.clientStructs.length;i++){const partStructs=lazyWriter.clientStructs[i];lib0_encoding.zd(restEncoder,partStructs.written),lib0_encoding.LH(restEncoder,partStructs.restEncoder)}},convertUpdateFormat=(update,blockTransformer,YDecoder,YEncoder)=>{const updateDecoder=new YDecoder(lib0_decoding.$C(update)),lazyDecoder=new LazyStructReader(updateDecoder,!1),updateEncoder=new YEncoder,lazyWriter=new LazyStructWriter(updateEncoder);for(let curr=lazyDecoder.curr;null!==curr;curr=lazyDecoder.next())writeStructToLazyStructWriter(lazyWriter,blockTransformer(curr),0);finishLazyStructWriting(lazyWriter);const ds=readDeleteSet(updateDecoder);return writeDeleteSet(updateEncoder,ds),updateEncoder.toUint8Array()},convertUpdateFormatV2ToV1=update=>convertUpdateFormat(update,lib0_function.id,UpdateDecoderV2,UpdateEncoderV1),errorComputeChanges="You must not compute changes after the event-handler fired.";class YEvent{constructor(target,transaction){this.target=target,this.currentTarget=target,this.transaction=transaction,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=getPathTo(this.currentTarget,this.target))}deletes(struct){return isDeleted(this.transaction.deleteSet,struct.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw lib0_error.vt(errorComputeChanges);const keys=new Map,target=this.target;this.transaction.changed.get(target).forEach((key=>{if(null!==key){const item=target._map.get(key);let action,oldValue;if(this.adds(item)){let prev=item.left;for(;null!==prev&&this.adds(prev);)prev=prev.left;if(this.deletes(item)){if(null===prev||!this.deletes(prev))return;action="delete",oldValue=array.HV(prev.content.getContent())}else null!==prev&&this.deletes(prev)?(action="update",oldValue=array.HV(prev.content.getContent())):(action="add",oldValue=void 0)}else{if(!this.deletes(item))return;action="delete",oldValue=array.HV(item.content.getContent())}keys.set(key,{action,oldValue})}})),this._keys=keys}return this._keys}get delta(){return this.changes.delta}adds(struct){return struct.id.clock>=(this.transaction.beforeState.get(struct.id.client)||0)}get changes(){let changes=this._changes;if(null===changes){if(0===this.transaction.doc._transactionCleanups.length)throw lib0_error.vt(errorComputeChanges);const target=this.target,added=set.vt(),deleted=set.vt(),delta=[];changes={added,deleted,delta,keys:this.keys};if(this.transaction.changed.get(target).has(null)){let lastOp=null;const packOp=()=>{lastOp&&delta.push(lastOp)};for(let item=target._start;null!==item;item=item.right)item.deleted?this.deletes(item)&&!this.adds(item)&&(null!==lastOp&&void 0!==lastOp.delete||(packOp(),lastOp={delete:0}),lastOp.delete+=item.length,deleted.add(item)):this.adds(item)?(null!==lastOp&&void 0!==lastOp.insert||(packOp(),lastOp={insert:[]}),lastOp.insert=lastOp.insert.concat(item.content.getContent()),added.add(item)):(null!==lastOp&&void 0!==lastOp.retain||(packOp(),lastOp={retain:0}),lastOp.retain+=item.length);null!==lastOp&&void 0===lastOp.retain&&packOp()}this._changes=changes}return changes}}const getPathTo=(parent,child)=>{const path=[];for(;null!==child._item&&child!==parent;){if(null!==child._item.parentSub)path.unshift(child._item.parentSub);else{let i=0,c=child._item.parent._start;for(;c!==child._item&&null!==c;)!c.deleted&&c.countable&&(i+=c.length),c=c.right;path.unshift(i)}child=child._item.parent}return path},warnPrematureAccess=()=>{warn("Invalid access: Add Yjs type to a document before reading data.")};let globalSearchMarkerTimestamp=0;class ArraySearchMarker{constructor(p,index){p.marker=!0,this.p=p,this.index=index,this.timestamp=globalSearchMarkerTimestamp++}}const overwriteMarker=(marker,p,index)=>{marker.p.marker=!1,marker.p=p,p.marker=!0,marker.index=index,marker.timestamp=globalSearchMarkerTimestamp++},findMarker=(yarray,index)=>{if(null===yarray._start||0===index||null===yarray._searchMarker)return null;const marker=0===yarray._searchMarker.length?null:yarray._searchMarker.reduce(((a,b)=>lib0_math.tn(index-a.index)<lib0_math.tn(index-b.index)?a:b));let p=yarray._start,pindex=0;for(null!==marker&&(p=marker.p,pindex=marker.index,(marker=>{marker.timestamp=globalSearchMarkerTimestamp++})(marker));null!==p.right&&pindex<index;){if(!p.deleted&&p.countable){if(index<pindex+p.length)break;pindex+=p.length}p=p.right}for(;null!==p.left&&pindex>index;)p=p.left,!p.deleted&&p.countable&&(pindex-=p.length);for(;null!==p.left&&p.left.id.client===p.id.client&&p.left.id.clock+p.left.length===p.id.clock;)p=p.left,!p.deleted&&p.countable&&(pindex-=p.length);return null!==marker&&lib0_math.tn(marker.index-pindex)<p.parent.length/80?(overwriteMarker(marker,p,pindex),marker):((searchMarker,p,index)=>{if(searchMarker.length>=80){const marker=searchMarker.reduce(((a,b)=>a.timestamp<b.timestamp?a:b));return overwriteMarker(marker,p,index),marker}{const pm=new ArraySearchMarker(p,index);return searchMarker.push(pm),pm}})(yarray._searchMarker,p,pindex)},updateMarkerChanges=(searchMarker,index,len)=>{for(let i=searchMarker.length-1;i>=0;i--){const m=searchMarker[i];if(len>0){let p=m.p;for(p.marker=!1;p&&(p.deleted||!p.countable);)p=p.left,p&&!p.deleted&&p.countable&&(m.index-=p.length);if(null===p||!0===p.marker){searchMarker.splice(i,1);continue}m.p=p,p.marker=!0}(index<m.index||len>0&&index===m.index)&&(m.index=lib0_math.T9(index,m.index+len))}},callTypeObservers=(type,transaction,event)=>{const changedType=type,changedParentTypes=transaction.changedParentTypes;for(;lib0_map._4(changedParentTypes,type,(()=>[])).push(event),null!==type._item;)type=type._item.parent;callEventHandlerListeners(changedType._eH,event,transaction)};class AbstractType{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=createEventHandler(),this._dEH=createEventHandler(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(y,item){this.doc=y,this._item=item}_copy(){throw lib0_error.bD()}clone(){throw lib0_error.bD()}_write(_encoder){}get _first(){let n=this._start;for(;null!==n&&n.deleted;)n=n.right;return n}_callObserver(transaction,_parentSubs){!transaction.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(f){addEventHandlerListener(this._eH,f)}observeDeep(f){addEventHandlerListener(this._dEH,f)}unobserve(f){removeEventHandlerListener(this._eH,f)}unobserveDeep(f){removeEventHandlerListener(this._dEH,f)}toJSON(){}}const typeListSlice=(type,start,end)=>{type.doc??warnPrematureAccess(),start<0&&(start=type._length+start),end<0&&(end=type._length+end);let len=end-start;const cs=[];let n=type._start;for(;null!==n&&len>0;){if(n.countable&&!n.deleted){const c=n.content.getContent();if(c.length<=start)start-=c.length;else{for(let i=start;i<c.length&&len>0;i++)cs.push(c[i]),len--;start=0}}n=n.right}return cs},typeListToArray=type=>{type.doc??warnPrematureAccess();const cs=[];let n=type._start;for(;null!==n;){if(n.countable&&!n.deleted){const c=n.content.getContent();for(let i=0;i<c.length;i++)cs.push(c[i])}n=n.right}return cs},typeListForEach=(type,f)=>{let index=0,n=type._start;for(type.doc??warnPrematureAccess();null!==n;){if(n.countable&&!n.deleted){const c=n.content.getContent();for(let i=0;i<c.length;i++)f(c[i],index++,type)}n=n.right}},typeListMap=(type,f)=>{const result=[];return typeListForEach(type,((c,i)=>{result.push(f(c,i,type))})),result},typeListCreateIterator=type=>{let n=type._start,currentContent=null,currentContentIndex=0;return{[Symbol.iterator](){return this},next:()=>{if(null===currentContent){for(;null!==n&&n.deleted;)n=n.right;if(null===n)return{done:!0,value:void 0};currentContent=n.content.getContent(),currentContentIndex=0,n=n.right}const value=currentContent[currentContentIndex++];return currentContent.length<=currentContentIndex&&(currentContent=null),{done:!1,value}}}},typeListGet=(type,index)=>{type.doc??warnPrematureAccess();const marker=findMarker(type,index);let n=type._start;for(null!==marker&&(n=marker.p,index-=marker.index);null!==n;n=n.right)if(!n.deleted&&n.countable){if(index<n.length)return n.content.getContent()[index];index-=n.length}},typeListInsertGenericsAfter=(transaction,parent,referenceItem,content)=>{let left=referenceItem;const doc=transaction.doc,ownClientId=doc.clientID,store=doc.store,right=null===referenceItem?parent._start:referenceItem.right;let jsonContent=[];const packJsonContent=()=>{jsonContent.length>0&&(left=new Item(createID(ownClientId,getState(store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,new ContentAny(jsonContent)),left.integrate(transaction,0),jsonContent=[])};content.forEach((c=>{if(null===c)jsonContent.push(c);else switch(c.constructor){case Number:case Object:case Boolean:case Array:case String:jsonContent.push(c);break;default:switch(packJsonContent(),c.constructor){case Uint8Array:case ArrayBuffer:left=new Item(createID(ownClientId,getState(store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,new ContentBinary(new Uint8Array(c))),left.integrate(transaction,0);break;case Doc:left=new Item(createID(ownClientId,getState(store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,new ContentDoc(c)),left.integrate(transaction,0);break;default:if(!(c instanceof AbstractType))throw new Error("Unexpected content type in insert operation");left=new Item(createID(ownClientId,getState(store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,new ContentType(c)),left.integrate(transaction,0)}}})),packJsonContent()},lengthExceeded=()=>lib0_error.vt("Length exceeded!"),typeListInsertGenerics=(transaction,parent,index,content)=>{if(index>parent._length)throw lengthExceeded();if(0===index)return parent._searchMarker&&updateMarkerChanges(parent._searchMarker,index,content.length),typeListInsertGenericsAfter(transaction,parent,null,content);const startIndex=index,marker=findMarker(parent,index);let n=parent._start;for(null!==marker&&(n=marker.p,0===(index-=marker.index)&&(n=n.prev,index+=n&&n.countable&&!n.deleted?n.length:0));null!==n;n=n.right)if(!n.deleted&&n.countable){if(index<=n.length){index<n.length&&getItemCleanStart(transaction,createID(n.id.client,n.id.clock+index));break}index-=n.length}return parent._searchMarker&&updateMarkerChanges(parent._searchMarker,startIndex,content.length),typeListInsertGenericsAfter(transaction,parent,n,content)},typeListDelete=(transaction,parent,index,length)=>{if(0===length)return;const startIndex=index,startLength=length,marker=findMarker(parent,index);let n=parent._start;for(null!==marker&&(n=marker.p,index-=marker.index);null!==n&&index>0;n=n.right)!n.deleted&&n.countable&&(index<n.length&&getItemCleanStart(transaction,createID(n.id.client,n.id.clock+index)),index-=n.length);for(;length>0&&null!==n;)n.deleted||(length<n.length&&getItemCleanStart(transaction,createID(n.id.client,n.id.clock+length)),n.delete(transaction),length-=n.length),n=n.right;if(length>0)throw lengthExceeded();parent._searchMarker&&updateMarkerChanges(parent._searchMarker,startIndex,-startLength+length)},typeMapDelete=(transaction,parent,key)=>{const c=parent._map.get(key);void 0!==c&&c.delete(transaction)},typeMapSet=(transaction,parent,key,value)=>{const left=parent._map.get(key)||null,doc=transaction.doc,ownClientId=doc.clientID;let content;if(null==value)content=new ContentAny([value]);else switch(value.constructor){case Number:case Object:case Boolean:case Array:case String:content=new ContentAny([value]);break;case Uint8Array:content=new ContentBinary(value);break;case Doc:content=new ContentDoc(value);break;default:if(!(value instanceof AbstractType))throw new Error("Unexpected content type");content=new ContentType(value)}new Item(createID(ownClientId,getState(doc.store,ownClientId)),left,left&&left.lastId,null,null,parent,key,content).integrate(transaction,0)},typeMapGet=(parent,key)=>{parent.doc??warnPrematureAccess();const val=parent._map.get(key);return void 0===val||val.deleted?void 0:val.content.getContent()[val.length-1]},typeMapGetAll=parent=>{const res={};return parent.doc??warnPrematureAccess(),parent._map.forEach(((value,key)=>{value.deleted||(res[key]=value.content.getContent()[value.length-1])})),res},typeMapHas=(parent,key)=>{parent.doc??warnPrematureAccess();const val=parent._map.get(key);return void 0!==val&&!val.deleted},createMapIterator=type=>{return type.doc??warnPrematureAccess(),iterator=type._map.entries(),filter=entry=>!entry[1].deleted,createIterator((()=>{let res;do{res=iterator.next()}while(!res.done&&!filter(res.value));return res}));var iterator,filter};class YArrayEvent extends YEvent{}class YArray extends AbstractType{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(items){const a=new YArray;return a.push(items),a}_integrate(y,item){super._integrate(y,item),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YArray}clone(){const arr=new YArray;return arr.insert(0,this.toArray().map((el=>el instanceof AbstractType?el.clone():el))),arr}get length(){return this.doc??warnPrematureAccess(),this._length}_callObserver(transaction,parentSubs){super._callObserver(transaction,parentSubs),callTypeObservers(this,transaction,new YArrayEvent(this,transaction))}insert(index,content){null!==this.doc?transact(this.doc,(transaction=>{typeListInsertGenerics(transaction,this,index,content)})):this._prelimContent.splice(index,0,...content)}push(content){null!==this.doc?transact(this.doc,(transaction=>{((transaction,parent,content)=>{let n=(parent._searchMarker||[]).reduce(((maxMarker,currMarker)=>currMarker.index>maxMarker.index?currMarker:maxMarker),{index:0,p:parent._start}).p;if(n)for(;n.right;)n=n.right;typeListInsertGenericsAfter(transaction,parent,n,content)})(transaction,this,content)})):this._prelimContent.push(...content)}unshift(content){this.insert(0,content)}delete(index,length=1){null!==this.doc?transact(this.doc,(transaction=>{typeListDelete(transaction,this,index,length)})):this._prelimContent.splice(index,length)}get(index){return typeListGet(this,index)}toArray(){return typeListToArray(this)}slice(start=0,end=this.length){return typeListSlice(this,start,end)}toJSON(){return this.map((c=>c instanceof AbstractType?c.toJSON():c))}map(f){return typeListMap(this,f)}forEach(f){typeListForEach(this,f)}[Symbol.iterator](){return typeListCreateIterator(this)}_write(encoder){encoder.writeTypeRef(YArrayRefID)}}class YMapEvent extends YEvent{constructor(ymap,transaction,subs){super(ymap,transaction),this.keysChanged=subs}}class YMap extends AbstractType{constructor(entries){super(),this._prelimContent=null,this._prelimContent=void 0===entries?new Map:new Map(entries)}_integrate(y,item){super._integrate(y,item),this._prelimContent.forEach(((value,key)=>{this.set(key,value)})),this._prelimContent=null}_copy(){return new YMap}clone(){const map=new YMap;return this.forEach(((value,key)=>{map.set(key,value instanceof AbstractType?value.clone():value)})),map}_callObserver(transaction,parentSubs){callTypeObservers(this,transaction,new YMapEvent(this,transaction,parentSubs))}toJSON(){this.doc??warnPrematureAccess();const map={};return this._map.forEach(((item,key)=>{if(!item.deleted){const v=item.content.getContent()[item.length-1];map[key]=v instanceof AbstractType?v.toJSON():v}})),map}get size(){return[...createMapIterator(this)].length}keys(){return iteratorMap(createMapIterator(this),(v=>v[0]))}values(){return iteratorMap(createMapIterator(this),(v=>v[1].content.getContent()[v[1].length-1]))}entries(){return iteratorMap(createMapIterator(this),(v=>[v[0],v[1].content.getContent()[v[1].length-1]]))}forEach(f){this.doc??warnPrematureAccess(),this._map.forEach(((item,key)=>{item.deleted||f(item.content.getContent()[item.length-1],key,this)}))}[Symbol.iterator](){return this.entries()}delete(key){null!==this.doc?transact(this.doc,(transaction=>{typeMapDelete(transaction,this,key)})):this._prelimContent.delete(key)}set(key,value){return null!==this.doc?transact(this.doc,(transaction=>{typeMapSet(transaction,this,key,value)})):this._prelimContent.set(key,value),value}get(key){return typeMapGet(this,key)}has(key){return typeMapHas(this,key)}clear(){null!==this.doc?transact(this.doc,(transaction=>{this.forEach((function(_value,key,map){typeMapDelete(transaction,map,key)}))})):this._prelimContent.clear()}_write(encoder){encoder.writeTypeRef(YMapRefID)}}const equalAttrs=(a,b)=>a===b||"object"==typeof a&&"object"==typeof b&&a&&b&&object.SQ(a,b);class ItemTextListPosition{constructor(left,right,index,currentAttributes){this.left=left,this.right=right,this.index=index,this.currentAttributes=currentAttributes}forward(){if(null===this.right&&lib0_error.Mq(),this.right.content.constructor===ContentFormat)this.right.deleted||updateCurrentAttributes(this.currentAttributes,this.right.content);else this.right.deleted||(this.index+=this.right.length);this.left=this.right,this.right=this.right.right}}const findNextPosition=(transaction,pos,count)=>{for(;null!==pos.right&&count>0;){if(pos.right.content.constructor===ContentFormat)pos.right.deleted||updateCurrentAttributes(pos.currentAttributes,pos.right.content);else pos.right.deleted||(count<pos.right.length&&getItemCleanStart(transaction,createID(pos.right.id.client,pos.right.id.clock+count)),pos.index+=pos.right.length,count-=pos.right.length);pos.left=pos.right,pos.right=pos.right.right}return pos},findPosition=(transaction,parent,index,useSearchMarker)=>{const currentAttributes=new Map,marker=useSearchMarker?findMarker(parent,index):null;if(marker){const pos=new ItemTextListPosition(marker.p.left,marker.p,marker.index,currentAttributes);return findNextPosition(transaction,pos,index-marker.index)}{const pos=new ItemTextListPosition(null,parent._start,0,currentAttributes);return findNextPosition(transaction,pos,index)}},insertNegatedAttributes=(transaction,parent,currPos,negatedAttributes)=>{for(;null!==currPos.right&&(!0===currPos.right.deleted||currPos.right.content.constructor===ContentFormat&&equalAttrs(negatedAttributes.get(currPos.right.content.key),currPos.right.content.value));)currPos.right.deleted||negatedAttributes.delete(currPos.right.content.key),currPos.forward();const doc=transaction.doc,ownClientId=doc.clientID;negatedAttributes.forEach(((val,key)=>{const left=currPos.left,right=currPos.right,nextFormat=new Item(createID(ownClientId,getState(doc.store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,new ContentFormat(key,val));nextFormat.integrate(transaction,0),currPos.right=nextFormat,currPos.forward()}))},updateCurrentAttributes=(currentAttributes,format)=>{const{key,value}=format;null===value?currentAttributes.delete(key):currentAttributes.set(key,value)},minimizeAttributeChanges=(currPos,attributes)=>{for(;null!==currPos.right&&(currPos.right.deleted||currPos.right.content.constructor===ContentFormat&&equalAttrs(attributes[currPos.right.content.key]??null,currPos.right.content.value));)currPos.forward()},insertAttributes=(transaction,parent,currPos,attributes)=>{const doc=transaction.doc,ownClientId=doc.clientID,negatedAttributes=new Map;for(const key in attributes){const val=attributes[key],currentVal=currPos.currentAttributes.get(key)??null;if(!equalAttrs(currentVal,val)){negatedAttributes.set(key,currentVal);const{left,right}=currPos;currPos.right=new Item(createID(ownClientId,getState(doc.store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,new ContentFormat(key,val)),currPos.right.integrate(transaction,0),currPos.forward()}}return negatedAttributes},insertText=(transaction,parent,currPos,text,attributes)=>{currPos.currentAttributes.forEach(((_val,key)=>{void 0===attributes[key]&&(attributes[key]=null)}));const doc=transaction.doc,ownClientId=doc.clientID;minimizeAttributeChanges(currPos,attributes);const negatedAttributes=insertAttributes(transaction,parent,currPos,attributes),content=text.constructor===String?new ContentString(text):text instanceof AbstractType?new ContentType(text):new ContentEmbed(text);let{left,right,index}=currPos;parent._searchMarker&&updateMarkerChanges(parent._searchMarker,currPos.index,content.getLength()),right=new Item(createID(ownClientId,getState(doc.store,ownClientId)),left,left&&left.lastId,right,right&&right.id,parent,null,content),right.integrate(transaction,0),currPos.right=right,currPos.index=index,currPos.forward(),insertNegatedAttributes(transaction,parent,currPos,negatedAttributes)},formatText=(transaction,parent,currPos,length,attributes)=>{const doc=transaction.doc,ownClientId=doc.clientID;minimizeAttributeChanges(currPos,attributes);const negatedAttributes=insertAttributes(transaction,parent,currPos,attributes);iterationLoop:for(;null!==currPos.right&&(length>0||negatedAttributes.size>0&&(currPos.right.deleted||currPos.right.content.constructor===ContentFormat));){if(!currPos.right.deleted)switch(currPos.right.content.constructor){case ContentFormat:{const{key,value}=currPos.right.content,attr=attributes[key];if(void 0!==attr){if(equalAttrs(attr,value))negatedAttributes.delete(key);else{if(0===length)break iterationLoop;negatedAttributes.set(key,value)}currPos.right.delete(transaction)}else currPos.currentAttributes.set(key,value);break}default:length<currPos.right.length&&getItemCleanStart(transaction,createID(currPos.right.id.client,currPos.right.id.clock+length)),length-=currPos.right.length}currPos.forward()}if(length>0){let newlines="";for(;length>0;length--)newlines+="\n";currPos.right=new Item(createID(ownClientId,getState(doc.store,ownClientId)),currPos.left,currPos.left&&currPos.left.lastId,currPos.right,currPos.right&&currPos.right.id,parent,null,new ContentString(newlines)),currPos.right.integrate(transaction,0),currPos.forward()}insertNegatedAttributes(transaction,parent,currPos,negatedAttributes)},cleanupFormattingGap=(transaction,start,curr,startAttributes,currAttributes)=>{let end=start;const endFormats=lib0_map.vt();for(;end&&(!end.countable||end.deleted);){if(!end.deleted&&end.content.constructor===ContentFormat){const cf=end.content;endFormats.set(cf.key,cf)}end=end.right}let cleanups=0,reachedCurr=!1;for(;start!==end;){if(curr===start&&(reachedCurr=!0),!start.deleted){const content=start.content;switch(content.constructor){case ContentFormat:{const{key,value}=content,startAttrValue=startAttributes.get(key)??null;endFormats.get(key)===content&&startAttrValue!==value||(start.delete(transaction),cleanups++,reachedCurr||(currAttributes.get(key)??null)!==value||startAttrValue===value||(null===startAttrValue?currAttributes.delete(key):currAttributes.set(key,startAttrValue))),reachedCurr||start.deleted||updateCurrentAttributes(currAttributes,content);break}}}start=start.right}return cleanups},cleanupYTextFormatting=type=>{let res=0;return transact(type.doc,(transaction=>{let start=type._start,end=type._start,startAttributes=lib0_map.vt();const currentAttributes=lib0_map.C(startAttributes);for(;end;){if(!1===end.deleted)if(end.content.constructor===ContentFormat)updateCurrentAttributes(currentAttributes,end.content);else res+=cleanupFormattingGap(transaction,start,end,startAttributes,currentAttributes),startAttributes=lib0_map.C(currentAttributes),start=end;end=end.right}})),res},cleanupYTextAfterTransaction=transaction=>{const needFullCleanup=new Set,doc=transaction.doc;for(const[client,afterClock]of transaction.afterState.entries()){const clock=transaction.beforeState.get(client)||0;afterClock!==clock&&iterateStructs(transaction,doc.store.clients.get(client),clock,afterClock,(item=>{item.deleted||item.content.constructor!==ContentFormat||item.constructor===GC||needFullCleanup.add(item.parent)}))}transact(doc,(t=>{iterateDeletedStructs(transaction,transaction.deleteSet,(item=>{if(item instanceof GC||!item.parent._hasFormatting||needFullCleanup.has(item.parent))return;const parent=item.parent;item.content.constructor===ContentFormat?needFullCleanup.add(parent):((transaction,item)=>{for(;item&&item.right&&(item.right.deleted||!item.right.countable);)item=item.right;const attrs=new Set;for(;item&&(item.deleted||!item.countable);){if(!item.deleted&&item.content.constructor===ContentFormat){const key=item.content.key;attrs.has(key)?item.delete(transaction):attrs.add(key)}item=item.left}})(t,item)}));for(const yText of needFullCleanup)cleanupYTextFormatting(yText)}))},deleteText=(transaction,currPos,length)=>{const startLength=length,startAttrs=lib0_map.C(currPos.currentAttributes),start=currPos.right;for(;length>0&&null!==currPos.right;){if(!1===currPos.right.deleted)switch(currPos.right.content.constructor){case ContentType:case ContentEmbed:case ContentString:length<currPos.right.length&&getItemCleanStart(transaction,createID(currPos.right.id.client,currPos.right.id.clock+length)),length-=currPos.right.length,currPos.right.delete(transaction)}currPos.forward()}start&&cleanupFormattingGap(transaction,start,currPos.right,startAttrs,currPos.currentAttributes);const parent=(currPos.left||currPos.right).parent;return parent._searchMarker&&updateMarkerChanges(parent._searchMarker,currPos.index,-startLength+length),currPos};class YTextEvent extends YEvent{constructor(ytext,transaction,subs){super(ytext,transaction),this.childListChanged=!1,this.keysChanged=new Set,subs.forEach((sub=>{null===sub?this.childListChanged=!0:this.keysChanged.add(sub)}))}get changes(){if(null===this._changes){const changes={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=changes}return this._changes}get delta(){if(null===this._delta){const y=this.target.doc,delta=[];transact(y,(transaction=>{const currentAttributes=new Map,oldAttributes=new Map;let item=this.target._start,action=null;const attributes={};let insert="",retain=0,deleteLen=0;const addOp=()=>{if(null!==action){let op=null;switch(action){case"delete":deleteLen>0&&(op={delete:deleteLen}),deleteLen=0;break;case"insert":("object"==typeof insert||insert.length>0)&&(op={insert},currentAttributes.size>0&&(op.attributes={},currentAttributes.forEach(((value,key)=>{null!==value&&(op.attributes[key]=value)})))),insert="";break;case"retain":retain>0&&(op={retain},object.Im(attributes)||(op.attributes=object.kp({},attributes))),retain=0}op&&delta.push(op),action=null}};for(;null!==item;){switch(item.content.constructor){case ContentType:case ContentEmbed:this.adds(item)?this.deletes(item)||(addOp(),action="insert",insert=item.content.getContent()[0],addOp()):this.deletes(item)?("delete"!==action&&(addOp(),action="delete"),deleteLen+=1):item.deleted||("retain"!==action&&(addOp(),action="retain"),retain+=1);break;case ContentString:this.adds(item)?this.deletes(item)||("insert"!==action&&(addOp(),action="insert"),insert+=item.content.str):this.deletes(item)?("delete"!==action&&(addOp(),action="delete"),deleteLen+=item.length):item.deleted||("retain"!==action&&(addOp(),action="retain"),retain+=item.length);break;case ContentFormat:{const{key,value}=item.content;if(this.adds(item)){if(!this.deletes(item)){const curVal=currentAttributes.get(key)??null;equalAttrs(curVal,value)?null!==value&&item.delete(transaction):("retain"===action&&addOp(),equalAttrs(value,oldAttributes.get(key)??null)?delete attributes[key]:attributes[key]=value)}}else if(this.deletes(item)){oldAttributes.set(key,value);const curVal=currentAttributes.get(key)??null;equalAttrs(curVal,value)||("retain"===action&&addOp(),attributes[key]=curVal)}else if(!item.deleted){oldAttributes.set(key,value);const attr=attributes[key];void 0!==attr&&(equalAttrs(attr,value)?null!==attr&&item.delete(transaction):("retain"===action&&addOp(),null===value?delete attributes[key]:attributes[key]=value))}item.deleted||("insert"===action&&addOp(),updateCurrentAttributes(currentAttributes,item.content));break}}item=item.right}for(addOp();delta.length>0;){const lastOp=delta[delta.length-1];if(void 0===lastOp.retain||void 0!==lastOp.attributes)break;delta.pop()}})),this._delta=delta}return this._delta}}class YText extends AbstractType{constructor(string){super(),this._pending=void 0!==string?[()=>this.insert(0,string)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??warnPrematureAccess(),this._length}_integrate(y,item){super._integrate(y,item);try{this._pending.forEach((f=>f()))}catch(e){yjs_console.error(e)}this._pending=null}_copy(){return new YText}clone(){const text=new YText;return text.applyDelta(this.toDelta()),text}_callObserver(transaction,parentSubs){super._callObserver(transaction,parentSubs);const event=new YTextEvent(this,transaction,parentSubs);callTypeObservers(this,transaction,event),!transaction.local&&this._hasFormatting&&(transaction._needFormattingCleanup=!0)}toString(){this.doc??warnPrematureAccess();let str="",n=this._start;for(;null!==n;)!n.deleted&&n.countable&&n.content.constructor===ContentString&&(str+=n.content.str),n=n.right;return str}toJSON(){return this.toString()}applyDelta(delta,{sanitize=!0}={}){null!==this.doc?transact(this.doc,(transaction=>{const currPos=new ItemTextListPosition(null,this._start,0,new Map);for(let i=0;i<delta.length;i++){const op=delta[i];if(void 0!==op.insert){const ins=sanitize||"string"!=typeof op.insert||i!==delta.length-1||null!==currPos.right||"\n"!==op.insert.slice(-1)?op.insert:op.insert.slice(0,-1);("string"!=typeof ins||ins.length>0)&&insertText(transaction,this,currPos,ins,op.attributes||{})}else void 0!==op.retain?formatText(transaction,this,currPos,op.retain,op.attributes||{}):void 0!==op.delete&&deleteText(transaction,currPos,op.delete)}})):this._pending.push((()=>this.applyDelta(delta)))}toDelta(snapshot,prevSnapshot,computeYChange){this.doc??warnPrematureAccess();const ops=[],currentAttributes=new Map,doc=this.doc;let str="",n=this._start;function packStr(){if(str.length>0){const attributes={};let addAttributes=!1;currentAttributes.forEach(((value,key)=>{addAttributes=!0,attributes[key]=value}));const op={insert:str};addAttributes&&(op.attributes=attributes),ops.push(op),str=""}}const computeDelta=()=>{for(;null!==n;){if(isVisible(n,snapshot)||void 0!==prevSnapshot&&isVisible(n,prevSnapshot))switch(n.content.constructor){case ContentString:{const cur=currentAttributes.get("ychange");void 0===snapshot||isVisible(n,snapshot)?void 0===prevSnapshot||isVisible(n,prevSnapshot)?void 0!==cur&&(packStr(),currentAttributes.delete("ychange")):void 0!==cur&&cur.user===n.id.client&&"added"===cur.type||(packStr(),currentAttributes.set("ychange",computeYChange?computeYChange("added",n.id):{type:"added"})):void 0!==cur&&cur.user===n.id.client&&"removed"===cur.type||(packStr(),currentAttributes.set("ychange",computeYChange?computeYChange("removed",n.id):{type:"removed"})),str+=n.content.str;break}case ContentType:case ContentEmbed:{packStr();const op={insert:n.content.getContent()[0]};if(currentAttributes.size>0){const attrs={};op.attributes=attrs,currentAttributes.forEach(((value,key)=>{attrs[key]=value}))}ops.push(op);break}case ContentFormat:isVisible(n,snapshot)&&(packStr(),updateCurrentAttributes(currentAttributes,n.content))}n=n.right}packStr()};return snapshot||prevSnapshot?transact(doc,(transaction=>{snapshot&&splitSnapshotAffectedStructs(transaction,snapshot),prevSnapshot&&splitSnapshotAffectedStructs(transaction,prevSnapshot),computeDelta()}),"cleanup"):computeDelta(),ops}insert(index,text,attributes){if(text.length<=0)return;const y=this.doc;null!==y?transact(y,(transaction=>{const pos=findPosition(transaction,this,index,!attributes);attributes||(attributes={},pos.currentAttributes.forEach(((v,k)=>{attributes[k]=v}))),insertText(transaction,this,pos,text,attributes)})):this._pending.push((()=>this.insert(index,text,attributes)))}insertEmbed(index,embed,attributes){const y=this.doc;null!==y?transact(y,(transaction=>{const pos=findPosition(transaction,this,index,!attributes);insertText(transaction,this,pos,embed,attributes||{})})):this._pending.push((()=>this.insertEmbed(index,embed,attributes||{})))}delete(index,length){if(0===length)return;const y=this.doc;null!==y?transact(y,(transaction=>{deleteText(transaction,findPosition(transaction,this,index,!0),length)})):this._pending.push((()=>this.delete(index,length)))}format(index,length,attributes){if(0===length)return;const y=this.doc;null!==y?transact(y,(transaction=>{const pos=findPosition(transaction,this,index,!1);null!==pos.right&&formatText(transaction,this,pos,length,attributes)})):this._pending.push((()=>this.format(index,length,attributes)))}removeAttribute(attributeName){null!==this.doc?transact(this.doc,(transaction=>{typeMapDelete(transaction,this,attributeName)})):this._pending.push((()=>this.removeAttribute(attributeName)))}setAttribute(attributeName,attributeValue){null!==this.doc?transact(this.doc,(transaction=>{typeMapSet(transaction,this,attributeName,attributeValue)})):this._pending.push((()=>this.setAttribute(attributeName,attributeValue)))}getAttribute(attributeName){return typeMapGet(this,attributeName)}getAttributes(){return typeMapGetAll(this)}_write(encoder){encoder.writeTypeRef(YTextRefID)}}class YXmlTreeWalker{constructor(root,f=()=>!0){this._filter=f,this._root=root,this._currentNode=root._start,this._firstCall=!0,root.doc??warnPrematureAccess()}[Symbol.iterator](){return this}next(){let n=this._currentNode,type=n&&n.content&&n.content.type;if(null!==n&&(!this._firstCall||n.deleted||!this._filter(type)))do{if(type=n.content.type,n.deleted||type.constructor!==YXmlElement&&type.constructor!==YXmlFragment||null===type._start)for(;null!==n;){if(null!==n.right){n=n.right;break}n=n.parent===this._root?null:n.parent._item}else n=type._start}while(null!==n&&(n.deleted||!this._filter(n.content.type)));return this._firstCall=!1,null===n?{value:void 0,done:!0}:(this._currentNode=n,{value:n.content.type,done:!1})}}class YXmlFragment extends AbstractType{constructor(){super(),this._prelimContent=[]}get firstChild(){const first=this._first;return first?first.content.getContent()[0]:null}_integrate(y,item){super._integrate(y,item),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YXmlFragment}clone(){const el=new YXmlFragment;return el.insert(0,this.toArray().map((item=>item instanceof AbstractType?item.clone():item))),el}get length(){return this.doc??warnPrematureAccess(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(filter){return new YXmlTreeWalker(this,filter)}querySelector(query){query=query.toUpperCase();const next=new YXmlTreeWalker(this,(element=>element.nodeName&&element.nodeName.toUpperCase()===query)).next();return next.done?null:next.value}querySelectorAll(query){return query=query.toUpperCase(),array.HT(new YXmlTreeWalker(this,(element=>element.nodeName&&element.nodeName.toUpperCase()===query)))}_callObserver(transaction,parentSubs){callTypeObservers(this,transaction,new YXmlEvent(this,parentSubs,transaction))}toString(){return typeListMap(this,(xml=>xml.toString())).join("")}toJSON(){return this.toString()}toDOM(_document=document,hooks={},binding){const fragment=_document.createDocumentFragment();return void 0!==binding&&binding._createAssociation(fragment,this),typeListForEach(this,(xmlType=>{fragment.insertBefore(xmlType.toDOM(_document,hooks,binding),null)})),fragment}insert(index,content){null!==this.doc?transact(this.doc,(transaction=>{typeListInsertGenerics(transaction,this,index,content)})):this._prelimContent.splice(index,0,...content)}insertAfter(ref,content){if(null!==this.doc)transact(this.doc,(transaction=>{const refItem=ref&&ref instanceof AbstractType?ref._item:ref;typeListInsertGenericsAfter(transaction,this,refItem,content)}));else{const pc=this._prelimContent,index=null===ref?0:pc.findIndex((el=>el===ref))+1;if(0===index&&null!==ref)throw lib0_error.vt("Reference item not found");pc.splice(index,0,...content)}}delete(index,length=1){null!==this.doc?transact(this.doc,(transaction=>{typeListDelete(transaction,this,index,length)})):this._prelimContent.splice(index,length)}toArray(){return typeListToArray(this)}push(content){this.insert(this.length,content)}unshift(content){this.insert(0,content)}get(index){return typeListGet(this,index)}slice(start=0,end=this.length){return typeListSlice(this,start,end)}forEach(f){typeListForEach(this,f)}_write(encoder){encoder.writeTypeRef(YXmlFragmentRefID)}}class YXmlElement extends YXmlFragment{constructor(nodeName="UNDEFINED"){super(),this.nodeName=nodeName,this._prelimAttrs=new Map}get nextSibling(){const n=this._item?this._item.next:null;return n?n.content.type:null}get prevSibling(){const n=this._item?this._item.prev:null;return n?n.content.type:null}_integrate(y,item){super._integrate(y,item),this._prelimAttrs.forEach(((value,key)=>{this.setAttribute(key,value)})),this._prelimAttrs=null}_copy(){return new YXmlElement(this.nodeName)}clone(){const el=new YXmlElement(this.nodeName),attrs=this.getAttributes();return object.jJ(attrs,((value,key)=>{"string"==typeof value&&el.setAttribute(key,value)})),el.insert(0,this.toArray().map((item=>item instanceof AbstractType?item.clone():item))),el}toString(){const attrs=this.getAttributes(),stringBuilder=[],keys=[];for(const key in attrs)keys.push(key);keys.sort();const keysLen=keys.length;for(let i=0;i<keysLen;i++){const key=keys[i];stringBuilder.push(key+'="'+attrs[key]+'"')}const nodeName=this.nodeName.toLocaleLowerCase();return`<${nodeName}${stringBuilder.length>0?" "+stringBuilder.join(" "):""}>${super.toString()}</${nodeName}>`}removeAttribute(attributeName){null!==this.doc?transact(this.doc,(transaction=>{typeMapDelete(transaction,this,attributeName)})):this._prelimAttrs.delete(attributeName)}setAttribute(attributeName,attributeValue){null!==this.doc?transact(this.doc,(transaction=>{typeMapSet(transaction,this,attributeName,attributeValue)})):this._prelimAttrs.set(attributeName,attributeValue)}getAttribute(attributeName){return typeMapGet(this,attributeName)}hasAttribute(attributeName){return typeMapHas(this,attributeName)}getAttributes(snapshot){return snapshot?((parent,snapshot)=>{const res={};return parent._map.forEach(((value,key)=>{let v=value;for(;null!==v&&(!snapshot.sv.has(v.id.client)||v.id.clock>=(snapshot.sv.get(v.id.client)||0));)v=v.left;null!==v&&isVisible(v,snapshot)&&(res[key]=v.content.getContent()[v.length-1])})),res})(this,snapshot):typeMapGetAll(this)}toDOM(_document=document,hooks={},binding){const dom=_document.createElement(this.nodeName),attrs=this.getAttributes();for(const key in attrs){const value=attrs[key];"string"==typeof value&&dom.setAttribute(key,value)}return typeListForEach(this,(yxml=>{dom.appendChild(yxml.toDOM(_document,hooks,binding))})),void 0!==binding&&binding._createAssociation(dom,this),dom}_write(encoder){encoder.writeTypeRef(YXmlElementRefID),encoder.writeKey(this.nodeName)}}class YXmlEvent extends YEvent{constructor(target,subs,transaction){super(target,transaction),this.childListChanged=!1,this.attributesChanged=new Set,subs.forEach((sub=>{null===sub?this.childListChanged=!0:this.attributesChanged.add(sub)}))}}class YXmlHook extends YMap{constructor(hookName){super(),this.hookName=hookName}_copy(){return new YXmlHook(this.hookName)}clone(){const el=new YXmlHook(this.hookName);return this.forEach(((value,key)=>{el.set(key,value)})),el}toDOM(_document=document,hooks={},binding){const hook=hooks[this.hookName];let dom;return dom=void 0!==hook?hook.createDom(this):document.createElement(this.hookName),dom.setAttribute("data-yjs-hook",this.hookName),void 0!==binding&&binding._createAssociation(dom,this),dom}_write(encoder){encoder.writeTypeRef(YXmlHookRefID),encoder.writeKey(this.hookName)}}class YXmlText extends YText{get nextSibling(){const n=this._item?this._item.next:null;return n?n.content.type:null}get prevSibling(){const n=this._item?this._item.prev:null;return n?n.content.type:null}_copy(){return new YXmlText}clone(){const text=new YXmlText;return text.applyDelta(this.toDelta()),text}toDOM(_document=document,hooks,binding){const dom=_document.createTextNode(this.toString());return void 0!==binding&&binding._createAssociation(dom,this),dom}toString(){return this.toDelta().map((delta=>{const nestedNodes=[];for(const nodeName in delta.attributes){const attrs=[];for(const key in delta.attributes[nodeName])attrs.push({key,value:delta.attributes[nodeName][key]});attrs.sort(((a,b)=>a.key<b.key?-1:1)),nestedNodes.push({nodeName,attrs})}nestedNodes.sort(((a,b)=>a.nodeName<b.nodeName?-1:1));let str="";for(let i=0;i<nestedNodes.length;i++){const node=nestedNodes[i];str+=`<${node.nodeName}`;for(let j=0;j<node.attrs.length;j++){const attr=node.attrs[j];str+=` ${attr.key}="${attr.value}"`}str+=">"}str+=delta.insert;for(let i=nestedNodes.length-1;i>=0;i--)str+=`</${nestedNodes[i].nodeName}>`;return str})).join("")}toJSON(){return this.toString()}_write(encoder){encoder.writeTypeRef(YXmlTextRefID)}}class AbstractStruct{constructor(id,length){this.id=id,this.length=length}get deleted(){throw lib0_error.bD()}mergeWith(right){return!1}write(encoder,offset,encodingRef){throw lib0_error.bD()}integrate(transaction,offset){throw lib0_error.bD()}}class GC extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(right){return this.constructor===right.constructor&&(this.length+=right.length,!0)}integrate(transaction,offset){offset>0&&(this.id.clock+=offset,this.length-=offset),addStruct(transaction.doc.store,this)}write(encoder,offset){encoder.writeInfo(0),encoder.writeLen(this.length-offset)}getMissing(transaction,store){return null}}class ContentBinary{constructor(content){this.content=content}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ContentBinary(this.content)}splice(offset){throw lib0_error.bD()}mergeWith(right){return!1}integrate(transaction,item){}delete(transaction){}gc(store){}write(encoder,offset){encoder.writeBuf(this.content)}getRef(){return 3}}class ContentDeleted{constructor(len){this.len=len}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ContentDeleted(this.len)}splice(offset){const right=new ContentDeleted(this.len-offset);return this.len=offset,right}mergeWith(right){return this.len+=right.len,!0}integrate(transaction,item){addToDeleteSet(transaction.deleteSet,item.id.client,item.id.clock,this.len),item.markDeleted()}delete(transaction){}gc(store){}write(encoder,offset){encoder.writeLen(this.len-offset)}getRef(){return 1}}const createDocFromOpts=(guid,opts)=>new Doc({guid,...opts,shouldLoad:opts.shouldLoad||opts.autoLoad||!1});class ContentDoc{constructor(doc){doc._item&&yjs_console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=doc;const opts={};this.opts=opts,doc.gc||(opts.gc=!1),doc.autoLoad&&(opts.autoLoad=!0),null!==doc.meta&&(opts.meta=doc.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ContentDoc(createDocFromOpts(this.doc.guid,this.opts))}splice(offset){throw lib0_error.bD()}mergeWith(right){return!1}integrate(transaction,item){this.doc._item=item,transaction.subdocsAdded.add(this.doc),this.doc.shouldLoad&&transaction.subdocsLoaded.add(this.doc)}delete(transaction){transaction.subdocsAdded.has(this.doc)?transaction.subdocsAdded.delete(this.doc):transaction.subdocsRemoved.add(this.doc)}gc(store){}write(encoder,offset){encoder.writeString(this.doc.guid),encoder.writeAny(this.opts)}getRef(){return 9}}class ContentEmbed{constructor(embed){this.embed=embed}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ContentEmbed(this.embed)}splice(offset){throw lib0_error.bD()}mergeWith(right){return!1}integrate(transaction,item){}delete(transaction){}gc(store){}write(encoder,offset){encoder.writeJSON(this.embed)}getRef(){return 5}}class ContentFormat{constructor(key,value){this.key=key,this.value=value}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ContentFormat(this.key,this.value)}splice(_offset){throw lib0_error.bD()}mergeWith(_right){return!1}integrate(_transaction,item){const p=item.parent;p._searchMarker=null,p._hasFormatting=!0}delete(transaction){}gc(store){}write(encoder,offset){encoder.writeKey(this.key),encoder.writeJSON(this.value)}getRef(){return 6}}class ContentJSON{constructor(arr){this.arr=arr}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentJSON(this.arr)}splice(offset){const right=new ContentJSON(this.arr.slice(offset));return this.arr=this.arr.slice(0,offset),right}mergeWith(right){return this.arr=this.arr.concat(right.arr),!0}integrate(transaction,item){}delete(transaction){}gc(store){}write(encoder,offset){const len=this.arr.length;encoder.writeLen(len-offset);for(let i=offset;i<len;i++){const c=this.arr[i];encoder.writeString(void 0===c?"undefined":JSON.stringify(c))}}getRef(){return 2}}const isDevMode="development"===environment.dn("node_env");class ContentAny{constructor(arr){this.arr=arr,isDevMode&&object.ol(arr)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentAny(this.arr)}splice(offset){const right=new ContentAny(this.arr.slice(offset));return this.arr=this.arr.slice(0,offset),right}mergeWith(right){return this.arr=this.arr.concat(right.arr),!0}integrate(transaction,item){}delete(transaction){}gc(store){}write(encoder,offset){const len=this.arr.length;encoder.writeLen(len-offset);for(let i=offset;i<len;i++){const c=this.arr[i];encoder.writeAny(c)}}getRef(){return 8}}class ContentString{constructor(str){this.str=str}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ContentString(this.str)}splice(offset){const right=new ContentString(this.str.slice(offset));this.str=this.str.slice(0,offset);const firstCharCode=this.str.charCodeAt(offset-1);return firstCharCode>=55296&&firstCharCode<=56319&&(this.str=this.str.slice(0,offset-1)+"�",right.str="�"+right.str.slice(1)),right}mergeWith(right){return this.str+=right.str,!0}integrate(transaction,item){}delete(transaction){}gc(store){}write(encoder,offset){encoder.writeString(0===offset?this.str:this.str.slice(offset))}getRef(){return 4}}const typeRefs=[_decoder=>new YArray,_decoder=>new YMap,_decoder=>new YText,decoder=>new YXmlElement(decoder.readKey()),_decoder=>new YXmlFragment,decoder=>new YXmlHook(decoder.readKey()),decoder=>new YXmlText],YArrayRefID=0,YMapRefID=1,YTextRefID=2,YXmlElementRefID=3,YXmlFragmentRefID=4,YXmlHookRefID=5,YXmlTextRefID=6;class ContentType{constructor(type){this.type=type}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ContentType(this.type._copy())}splice(offset){throw lib0_error.bD()}mergeWith(right){return!1}integrate(transaction,item){this.type._integrate(transaction.doc,item)}delete(transaction){let item=this.type._start;for(;null!==item;)item.deleted?item.id.clock<(transaction.beforeState.get(item.id.client)||0)&&transaction._mergeStructs.push(item):item.delete(transaction),item=item.right;this.type._map.forEach((item=>{item.deleted?item.id.clock<(transaction.beforeState.get(item.id.client)||0)&&transaction._mergeStructs.push(item):item.delete(transaction)})),transaction.changed.delete(this.type)}gc(store){let item=this.type._start;for(;null!==item;)item.gc(store,!0),item=item.right;this.type._start=null,this.type._map.forEach((item=>{for(;null!==item;)item.gc(store,!0),item=item.left})),this.type._map=new Map}write(encoder,offset){this.type._write(encoder)}getRef(){return 7}}const followRedone=(store,id)=>{let item,nextID=id,diff=0;do{diff>0&&(nextID=createID(nextID.client,nextID.clock+diff)),item=getItem(store,nextID),diff=nextID.clock-item.id.clock,nextID=item.redone}while(null!==nextID&&item instanceof Item);return{item,diff}},keepItem=(item,keep)=>{for(;null!==item&&item.keep!==keep;)item.keep=keep,item=item.parent._item},splitItem=(transaction,leftItem,diff)=>{const{client,clock}=leftItem.id,rightItem=new Item(createID(client,clock+diff),leftItem,createID(client,clock+diff-1),leftItem.right,leftItem.rightOrigin,leftItem.parent,leftItem.parentSub,leftItem.content.splice(diff));return leftItem.deleted&&rightItem.markDeleted(),leftItem.keep&&(rightItem.keep=!0),null!==leftItem.redone&&(rightItem.redone=createID(leftItem.redone.client,leftItem.redone.clock+diff)),leftItem.right=rightItem,null!==rightItem.right&&(rightItem.right.left=rightItem),transaction._mergeStructs.push(rightItem),null!==rightItem.parentSub&&null===rightItem.right&&rightItem.parent._map.set(rightItem.parentSub,rightItem),leftItem.length=diff,rightItem},isDeletedByUndoStack=(stack,id)=>array.zN(stack,(s=>isDeleted(s.deletions,id))),redoItem=(transaction,item,redoitems,itemsToDelete,ignoreRemoteMapChanges,um)=>{const doc=transaction.doc,store=doc.store,ownClientID=doc.clientID,redone=item.redone;if(null!==redone)return getItemCleanStart(transaction,redone);let right,parentItem=item.parent._item,left=null;if(null!==parentItem&&!0===parentItem.deleted){if(null===parentItem.redone&&(!redoitems.has(parentItem)||null===redoItem(transaction,parentItem,redoitems,itemsToDelete,ignoreRemoteMapChanges,um)))return null;for(;null!==parentItem.redone;)parentItem=getItemCleanStart(transaction,parentItem.redone)}const parentType=null===parentItem?item.parent:parentItem.content.type;if(null===item.parentSub){for(left=item.left,right=item;null!==left;){let leftTrace=left;for(;null!==leftTrace&&leftTrace.parent._item!==parentItem;)leftTrace=null===leftTrace.redone?null:getItemCleanStart(transaction,leftTrace.redone);if(null!==leftTrace&&leftTrace.parent._item===parentItem){left=leftTrace;break}left=left.left}for(;null!==right;){let rightTrace=right;for(;null!==rightTrace&&rightTrace.parent._item!==parentItem;)rightTrace=null===rightTrace.redone?null:getItemCleanStart(transaction,rightTrace.redone);if(null!==rightTrace&&rightTrace.parent._item===parentItem){right=rightTrace;break}right=right.right}}else if(right=null,item.right&&!ignoreRemoteMapChanges){for(left=item;null!==left&&null!==left.right&&(left.right.redone||isDeleted(itemsToDelete,left.right.id)||isDeletedByUndoStack(um.undoStack,left.right.id)||isDeletedByUndoStack(um.redoStack,left.right.id));)for(left=left.right;left.redone;)left=getItemCleanStart(transaction,left.redone);if(left&&null!==left.right)return null}else left=parentType._map.get(item.parentSub)||null;const nextClock=getState(store,ownClientID),nextId=createID(ownClientID,nextClock),redoneItem=new Item(nextId,left,left&&left.lastId,right,right&&right.id,parentType,item.parentSub,item.content.copy());return item.redone=nextId,keepItem(redoneItem,!0),redoneItem.integrate(transaction,0),redoneItem};class Item extends AbstractStruct{constructor(id,left,origin,right,rightOrigin,parent,parentSub,content){super(id,content.getLength()),this.origin=origin,this.left=left,this.right=right,this.rightOrigin=rightOrigin,this.parent=parent,this.parentSub=parentSub,this.redone=null,this.content=content,this.info=this.content.isCountable()?lib0_binary.KD:0}set marker(isMarked){(this.info&lib0_binary.wn)>0!==isMarked&&(this.info^=lib0_binary.wn)}get marker(){return(this.info&lib0_binary.wn)>0}get keep(){return(this.info&lib0_binary.Dk)>0}set keep(doKeep){this.keep!==doKeep&&(this.info^=lib0_binary.Dk)}get countable(){return(this.info&lib0_binary.KD)>0}get deleted(){return(this.info&lib0_binary.D1)>0}set deleted(doDelete){this.deleted!==doDelete&&(this.info^=lib0_binary.D1)}markDeleted(){this.info|=lib0_binary.D1}getMissing(transaction,store){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=getState(store,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=getState(store,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ID&&this.id.client!==this.parent.client&&this.parent.clock>=getState(store,this.parent.client))return this.parent.client;if(this.origin&&(this.left=getItemCleanEnd(transaction,store,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=getItemCleanStart(transaction,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===GC||this.right&&this.right.constructor===GC)this.parent=null;else if(this.parent){if(this.parent.constructor===ID){const parentItem=getItem(store,this.parent);parentItem.constructor===GC?this.parent=null:this.parent=parentItem.content.type}}else this.left&&this.left.constructor===Item&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Item&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(transaction,offset){if(offset>0&&(this.id.clock+=offset,this.left=getItemCleanEnd(transaction,transaction.doc.store,createID(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(offset),this.length-=offset),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let o,left=this.left;if(null!==left)o=left.right;else if(null!==this.parentSub)for(o=this.parent._map.get(this.parentSub)||null;null!==o&&null!==o.left;)o=o.left;else o=this.parent._start;const conflictingItems=new Set,itemsBeforeOrigin=new Set;for(;null!==o&&o!==this.right;){if(itemsBeforeOrigin.add(o),conflictingItems.add(o),compareIDs(this.origin,o.origin)){if(o.id.client<this.id.client)left=o,conflictingItems.clear();else if(compareIDs(this.rightOrigin,o.rightOrigin))break}else{if(null===o.origin||!itemsBeforeOrigin.has(getItem(transaction.doc.store,o.origin)))break;conflictingItems.has(getItem(transaction.doc.store,o.origin))||(left=o,conflictingItems.clear())}o=o.right}this.left=left}if(null!==this.left){const right=this.left.right;this.right=right,this.left.right=this}else{let r;if(null!==this.parentSub)for(r=this.parent._map.get(this.parentSub)||null;null!==r&&null!==r.left;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(transaction)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),addStruct(transaction.doc.store,this),this.content.integrate(transaction,this),addChangedTypeToTransaction(transaction,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(transaction)}else new GC(this.id,this.length).integrate(transaction,0)}get next(){let n=this.right;for(;null!==n&&n.deleted;)n=n.right;return n}get prev(){let n=this.left;for(;null!==n&&n.deleted;)n=n.left;return n}get lastId(){return 1===this.length?this.id:createID(this.id.client,this.id.clock+this.length-1)}mergeWith(right){if(this.constructor===right.constructor&&compareIDs(right.origin,this.lastId)&&this.right===right&&compareIDs(this.rightOrigin,right.rightOrigin)&&this.id.client===right.id.client&&this.id.clock+this.length===right.id.clock&&this.deleted===right.deleted&&null===this.redone&&null===right.redone&&this.content.constructor===right.content.constructor&&this.content.mergeWith(right.content)){const searchMarker=this.parent._searchMarker;return searchMarker&&searchMarker.forEach((marker=>{marker.p===right&&(marker.p=this,!this.deleted&&this.countable&&(marker.index-=this.length))})),right.keep&&(this.keep=!0),this.right=right.right,null!==this.right&&(this.right.left=this),this.length+=right.length,!0}return!1}delete(transaction){if(!this.deleted){const parent=this.parent;this.countable&&null===this.parentSub&&(parent._length-=this.length),this.markDeleted(),addToDeleteSet(transaction.deleteSet,this.id.client,this.id.clock,this.length),addChangedTypeToTransaction(transaction,parent,this.parentSub),this.content.delete(transaction)}}gc(store,parentGCd){if(!this.deleted)throw lib0_error.Mq();this.content.gc(store),parentGCd?((store,struct,newStruct)=>{const structs=store.clients.get(struct.id.client);structs[findIndexSS(structs,struct.id.clock)]=newStruct})(store,this,new GC(this.id,this.length)):this.content=new ContentDeleted(this.length)}write(encoder,offset){const origin=offset>0?createID(this.id.client,this.id.clock+offset-1):this.origin,rightOrigin=this.rightOrigin,parentSub=this.parentSub,info=this.content.getRef()&lib0_binary.WY|(null===origin?0:lib0_binary.wt)|(null===rightOrigin?0:lib0_binary.D7)|(null===parentSub?0:lib0_binary.KJ);if(encoder.writeInfo(info),null!==origin&&encoder.writeLeftID(origin),null!==rightOrigin&&encoder.writeRightID(rightOrigin),null===origin&&null===rightOrigin){const parent=this.parent;if(void 0!==parent._item){const parentItem=parent._item;if(null===parentItem){const ykey=findRootTypeKey(parent);encoder.writeParentInfo(!0),encoder.writeString(ykey)}else encoder.writeParentInfo(!1),encoder.writeLeftID(parentItem.id)}else parent.constructor===String?(encoder.writeParentInfo(!0),encoder.writeString(parent)):parent.constructor===ID?(encoder.writeParentInfo(!1),encoder.writeLeftID(parent)):lib0_error.Mq();null!==parentSub&&encoder.writeString(parentSub)}this.content.write(encoder,offset)}}const readItemContent=(decoder,info)=>contentRefs[info&lib0_binary.WY](decoder),contentRefs=[()=>{lib0_error.Mq()},decoder=>new ContentDeleted(decoder.readLen()),decoder=>{const len=decoder.readLen(),cs=[];for(let i=0;i<len;i++){const c=decoder.readString();"undefined"===c?cs.push(void 0):cs.push(JSON.parse(c))}return new ContentJSON(cs)},decoder=>new ContentBinary(decoder.readBuf()),decoder=>new ContentString(decoder.readString()),decoder=>new ContentEmbed(decoder.readJSON()),decoder=>new ContentFormat(decoder.readKey(),decoder.readJSON()),decoder=>new ContentType(typeRefs[decoder.readTypeRef()](decoder)),decoder=>{const len=decoder.readLen(),cs=[];for(let i=0;i<len;i++)cs.push(decoder.readAny());return new ContentAny(cs)},decoder=>new ContentDoc(createDocFromOpts(decoder.readString(),decoder.readAny())),()=>{lib0_error.Mq()}];class Skip extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(right){return this.constructor===right.constructor&&(this.length+=right.length,!0)}integrate(transaction,offset){lib0_error.Mq()}write(encoder,offset){encoder.writeInfo(10),lib0_encoding.zd(encoder.restEncoder,this.length-offset)}getMissing(transaction,store){return null}}const glo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:{};!0===glo["__ $YJS$ __"]&&yjs_console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),glo["__ $YJS$ __"]=!0},"./packages/editor/node_modules/color-name/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}}}]);